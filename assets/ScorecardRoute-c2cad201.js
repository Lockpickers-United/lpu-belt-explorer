import{r as n,j as e,T as Se,I as ee,al as ce,am as de,Z as v,an as K,aj as De,N as Ee,R as B,a4 as we,x as N,w as me,a2 as Ie,y as Le,z as Be,ao as Te,a9 as te,p as se,af as U,K as Y,t as A,$ as Ae,v as xe,a0 as ge,a5 as Fe,a7 as ze,a8 as Re,ap as Oe,M as Pe,aq as Ne,ar as Me,O as We,P as He,Q as Ue}from"./index-1626f3a7.js";import{u as _e}from"./useData-f976d07d.js";import{e as H,F as _,r as pe,f as $e,D as $,B as fe,a as Ge,s as qe}from"./BeltStripe-1c6cab5c.js";import{b as ne,S as Ve,a as Ke,s as Ye,F as Je}from"./sortFields-013886a8.js";import{S as Qe,E as ye,d as Ze,L as je,A as ve,D as Xe}from"./CollectionButton-26246cdf.js";import{d as et}from"./Link-b1e9889c.js";import{u as P}from"./useWindowSize-23ba8e16.js";import{A as ie,a as oe,b as ae}from"./Sort-5b343868.js";import{L as O}from"./Link-27547387.js";import{p as tt}from"./chartDefaults-9fc07b21.js";import{B as nt}from"./nivo-bar.es-263251c4.js";import{L as ke,B as st}from"./LoadingDisplay-613eecb0.js";import{T as it}from"./TextField-631b803d.js";import{m as ot,P as at,a as rt}from"./ProfileHeader-883469cf.js";import{I as lt}from"./IntroCopy-2052a0f1.js";import{L as ct}from"./LoadingDisplay-d103a6c0.js";import"./Select-5fe14406.js";import"./Search-3b91c67e.js";import"./PhotoCamera-0bcd7116.js";import"./Dialog-da5a0d6b.js";import"./Autocomplete-29f48354.js";import"./index-d1bc83b7.js";import"./ListItem-c73cc319.js";import"./nivo-legends.es-87a3b498.js";import"./CopyProfileLinkButton-30899d26.js";import"./ToggleButtonGroup-7568a460.js";import"./LPU-c3fa7122.js";import"./LinearProgress-65058c88.js";function dt({entry:s}){const r=H(s).replace(/[\s/]/g,"_").replace(/\W/g,""),i=n.useCallback(l=>{l.preventDefault(),l.stopPropagation();const u=`${window.location.origin}/#/locks?id=${s.id}&name=${r}`,p=window.open(u,"_blank","noopener,noreferrer");p&&(p.opener=null)},[s.id,r]);return e.jsx(Se,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(ee,{onClick:i,children:e.jsx(et,{style:{width:18,height:18}})})})}function xt({children:s,cardEvidence:t,cardBBCount:r,cardDanPoints:i,cardEligibleDan:l,cardNextDanPoints:u,cardNextDanLocks:p}){const{filters:h}=n.useContext(_),{search:g,id:y,tab:E,name:m,sort:f,image:S,...o}=h,d=n.useMemo(()=>t.map(x=>{const b=ce(x.matchId),C=de(x.matchId);return{...b,...x,...C,id:x.id}}),[t]),k=n.useMemo(()=>d.map(x=>{var b,C,c;return{...x,makes:(b=x==null?void 0:x.makeModels)==null?void 0:b.map(({make:a})=>a),fuzzy:pe(((C=x==null?void 0:x.makeModels)==null?void 0:C.map(({make:a,model:I})=>[a,I]).flat().filter(a=>a).concat([x.version,x.notes,x.belt]).join(","))+" "),documentation:[x.exceptionType==="badlink"?"Bad Link":"Valid Link",x.date?"Valid Date":"No Date"],scoring:[x.exceptionType==="nomatch"?"Unmatched":x.exceptionType==="badlink"?"Bad Link":x.exceptionType==="duplicate"?"Duplicate":x.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(x.belt)?"Low Level":"Worth Points"],simpleBelt:(c=x==null?void 0:x.belt)==null?void 0:c.replace(/\s\d/g,"")}}),[d]),j=n.useMemo(()=>{const x=Object.keys(o).map(c=>{const a=o[c];return Array.isArray(a)?a.map(I=>({key:c,value:I})):{key:c,value:a}}).flat(),b=k.filter(c=>x.every(({key:a,value:I})=>Array.isArray(c[a])?c[a].includes(I):c[a]===I)),C=g?$e.go(pe(g),b,{keys:pt,threshold:-25e3}).map(c=>({...c.obj,score:c.score})):b;return f?C.sort((c,a)=>{if(f==="danPointsAscending")return c.points-a.points||v(a.date).valueOf()-v(c.date).valueOf();if(f==="danPointsDescending")return a.points-c.points||v(a.date).valueOf()-v(c.date).valueOf();if(f==="dateAscending")return v(c.date).valueOf()-v(a.date).valueOf()||K(c.simpleBelt,a.simpleBelt);if(f==="dateDescending")return v(a.date).valueOf()-v(c.date).valueOf()||K(c.simpleBelt,a.simpleBelt);if(f==="beltAscending")return De(c.belt,a.belt)||v(a.date).valueOf()-v(c.date).valueOf();if(f==="beltDescending")return K(c.belt,a.belt)||v(a.date).valueOf()-v(c.date).valueOf();if(f==="alphaAscending")return c.fuzzy.localeCompare(a.fuzzy)||a.points-c.points;if(f==="alphaDescending")return a.fuzzy.localeCompare(c.fuzzy)||a.points-c.points}):C.sort((c,a)=>v(a.date).valueOf()-v(c.date).valueOf()||K(c.belt,a.belt)||c.fuzzy.localeCompare(a.fuzzy))},[o,k,g,f]),w=n.useMemo(()=>({allEntries:Ee,cardEvidence:t,cardBBCount:r,cardDanPoints:i,cardEligibleDan:l,cardNextDanPoints:u,cardNextDanLocks:p,visibleEntries:j,getEntryFromId:ce,getProjectEntryFromId:de}),[t,r,i,l,u,p,j]);return e.jsx($.Provider,{value:w,children:s})}const pt=["fuzzy"];function ht({owner:s,evid:t,expanded:r,onExpand:i,merged:l}){const{setFilters:u}=n.useContext(_),{cardEvidence:p,getEntryFromId:h,getProjectEntryFromId:g}=n.useContext($),y=h(t.matchId),E=g(t.matchId),m=y||E,[f,S]=n.useState(!1),o=n.useRef(null);n.useEffect(()=>{if(r&&o&&!f){const D=window.innerWidth<=600?70:74,{id:W}=we.parse(location.search),le=W===t.id;S(!0),setTimeout(()=>{window.scrollTo({left:0,top:o.current.offsetTop-D,behavior:le?"auto":"smooth"})},le?0:100)}else r||S(!1)},[r,m,f,t.id]);let d=m?H(m):t.evidenceNotes;const k=t.exceptionType&&t.evidenceNotes.toLowerCase()!==d.toLowerCase()?t.evidenceNotes:null;d=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:d,d=t.exceptionType&&s&&l?d+" *":d;const j=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,w=t.exceptionId,x=w?p.find(R=>R.id===w):{},b=x?n.useMemo(()=>h(x.matchId),[h,x.matchId]):{},C=b?H(b,"short"):"",c=w?e.jsx(O,{style:{color:"#99c2e5"},onClick:()=>{I(w)},children:C}):null;let a=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"You must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const I=n.useCallback(R=>{u({id:R})},[u]),M=t.points===1?"pt":"pts";let T=t.date?v(t.date).format("L"):"(no date)";T=T.replace("/202","/2"),T=T.replace("/201","/1");const L=t.date?"#fff":"#aaa",F=n.useCallback((R,D)=>{s&&i(D?t.id:!1)},[t.id,i,s]),J=s?{}:{cursor:"default"},Q=s?e.jsx(me,{}):null,{isMobile:z}=P(),Z=z?"block":"flex",X=z?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},G=z?"65%":"56%",q=z?"-2px 0px 3px 0px":"1px 0px 3px 0px",V={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(ie,{expanded:r,onChange:F,ref:o,children:[e.jsxs(oe,{expandIcon:Q,style:{...V,...J},children:[e.jsx(fe,{value:m?m.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:G,flexShrink:0,flexDirection:"column",opacity:j},children:[e.jsx(ne,{value:d,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!k&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:k}),!!m&&!!(m!=null&&m.version)&&e.jsx(ne,{name:"Version",value:e.jsx(N,{style:{fontSize:"0.95rem",lineHeight:1.25},children:m==null?void 0:m.version}),textStyle:(m==null?void 0:m.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:Z,placeItems:"center",marginLeft:10,opacity:j},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:y&&e.jsx(dt,{entry:y})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(Qe,{url:t.link,handleChange:F,exceptionType:t.exceptionType,owner:s})})]}),e.jsxs("div",{style:X,children:[e.jsx("div",{style:{margin:q,color:L,width:90,textAlign:"center"},children:T}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:M})]})})]})]})]}),r&&e.jsx(B.Fragment,{children:e.jsxs(ae,{sx:{padding:"4px 16px 0px 26px"},children:[(a||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),a&&e.jsxs("span",{children:["* ",a," ",c]})]}),e.jsx(ye,{evid:t,handleUpdate:()=>{}})]})})]},t.id)}const ut=B.memo(ht,(s,t)=>{const r=Object.keys(s.evid),i=Object.keys(t.evid);if(r.length!==i.length)return!1;for(let l=0;l<r.length;l++)if(r[l]!==i[l]||s.evid[r[l]]!==t.evid[i[l]])return!1;return s.owner===t.owner&&s.expanded===t.expanded&&s.onExpand===t.onExpand&&s.merged===t.merged}),be=B.createContext({});function mt({children:s}){const{filters:t,addFilters:r,removeFilters:i}=n.useContext(_),l=t.id,u=n.useCallback(h=>{h?r([{key:"id",value:h}],!0):i(["id"])},[r,i]),p=n.useMemo(()=>({expanded:l,setExpanded:u}),[l,u]);return e.jsx(be.Provider,{value:p,children:s})}function gt({beltData:s}){const{width:t}=P(),r=t<=560,i=r?180:175,l=r?{top:0,right:0,bottom:60,left:15}:{top:0,right:0,bottom:60,left:15},u=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#a5a93c"],p=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd"];return e.jsx("div",{style:{height:i,padding:"0px 8px 0px 8px",width:"100%"},children:e.jsx(nt,{data:s,margin:l,padding:.15,colors:h=>u[h.index%u.length],animate:!0,axisBottom:{tickRotation:-45},axisLeft:null,enableGridY:!1,theme:tt,isInteractive:!1,enableLabel:!0,label:h=>h.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:h=>p[h.index%p.length]})},"bar")}function he({entries:s}){const t=n.useMemo(()=>{const r=s.map(({belt:i})=>i&&i.includes("Project")?"Project":i).reduce((i,l)=>(i[l]||(i[l]=0),i[l]++,i),{});return Ie.map(i=>({id:i,label:i,count:r[i]||0,value:r[i]||0}))},[s]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(gt,{beltData:t})})}var re={},ft=Be;Object.defineProperty(re,"__esModule",{value:!0});var Ce=re.default=void 0,yt=ft(Le()),jt=e;Ce=re.default=(0,yt.default)((0,jt.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function vt(){const{setFilters:s}=n.useContext(_),{cardEvidence:t,getEntryFromId:r}=n.useContext($),[i,l]=n.useState(!1),u=n.useCallback(()=>{l(!0)},[]),p=n.useCallback(()=>{l(!1)},[]),h=n.useCallback(o=>{s({id:o}),l(!1)},[s]),g=t.map(o=>{const d=o.exceptionId,k=d?t.find(C=>C.id===d):{},j=k?r(k.matchId):{},w=j?H(j,"short"):"",x=o.matchId?r(o.matchId):null,b=x?H(x,"short"):"";return{...o,supersedingEntryId:d,supersedingLockName:w,matchLockName:b}}),y=g.filter(o=>o.exceptionType==="nomatch"),E=g.filter(o=>o.exceptionType==="badlink"),m=g.filter(o=>o.exceptionType==="duplicate"),f=g.filter(o=>o.exceptionType==="upgraded");if(y.length+E.length+m.length+f.length>0)return e.jsxs(B.Fragment,{children:[e.jsx(ee,{onClick:u,style:{marginRight:5},children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(Te,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:o=>o.zIndex.drawer+1},open:i,onClick:p,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(ee,{onClick:p,children:e.jsx(Ze,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),y.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(te,{style:{marginBottom:20}}),e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:y.map((o,d)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.id)},children:o.evidenceNotes})},d))})]}),E.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:E.map((o,d)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.id)},children:o.matchLockName})},d))})]}),m.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:m.map((o,d)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is a duplicate of ",e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.supersedingEntryId)},children:o.supersedingLockName})]},d))})]}),f.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:f.map((o,d)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is upgraded by ",e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.supersedingEntryId)},children:o.supersedingLockName})]},d))})]})]})})]})}function ue(){const{cardDanPoints:s,cardBBCount:t,cardEligibleDan:r,cardNextDanPoints:i,cardNextDanLocks:l}=n.useContext($),u=se(),p=n.useCallback(()=>{u("/profile/scorecard/upgrades")},[u]);return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:["Eligible for Dan ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:r})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:s})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:t})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[i," point",i!==1&&"s"," and ",l," BB lock",l!==1&&"s"," until next Dan"]}),e.jsx("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:e.jsx(O,{onClick:p,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(vt,{})})]})}function kt({setControlsExpanded:s,adminAction:t}){const{userId:r}=U(),{importUnclaimedEvidence:i}=n.useContext(Y),{isMobile:l}=P(),[u,p]=n.useState(!1),h=se(),[g,y]=n.useState(""),[E,m]=n.useState(null),f=n.useCallback(async()=>{p(!0);const o=await i(r,g);p(!1),o?(y(""),s(!1),t()):m("Cannot find dan sheet tab")},[i,r,g,s,t]),S=l?"block":"flex";return e.jsx(B.Fragment,{children:e.jsx("div",{style:{placeItems:"center",display:S},children:u?e.jsx(ke,{}):e.jsx(B.Fragment,{children:e.jsxs("div",{style:{padding:20},children:[e.jsx("strong",{children:"For Black Belt pickers only."}),e.jsx("br",{}),"Black Belt pickers currently use another scorecard system known as the Dan Sheet. This import allows them to bring their picking history over to the site. If you do not already have a tab in the Dan sheet, this import will not work for you. For those that do, specify the name of your tab in the sheet to import your history into your Scorecard. Please note that tab names are case sensitive. ",e.jsx(O,{onClick:()=>{h("/profile/scorecard/howto")},style:{color:"#bbb",cursor:"pointer"},children:"Click here to learn more."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("div",{style:{padding:"0px",alignItems:"center"},children:e.jsxs("div",{style:{padding:"0px",display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(it,{id:"tab-to-import",label:"Tab to Import",value:g,size:"small",error:!!E,helperText:E,margin:"dense",color:"secondary",onChange:o=>{y(o.target.value)}}),e.jsx(A,{style:{color:"#000",padding:0,lineHeight:"1rem",height:40,marginTop:8,marginLeft:10},variant:"contained",onClick:f,edge:"start",color:"secondary",children:"Import"})]})})]})})})})}v.extend(Ae);function bt({owner:s,date:t}){const{userId:r}=U(),{updateProfileBlackBeltAwardedAt:i}=n.useContext(Y),[l,u]=n.useState(!1),[p,h]=n.useState(!1),[g,y]=n.useState(v.utc(t)),E=n.useCallback((a,I)=>{s&&u(I)},[s]),m=n.useCallback(()=>{y(v.utc(t)),h(!1)},[t]),f=n.useCallback(async()=>{try{i(r,g),xe("Profile updated"),h(!1)}catch(a){console.error("Error while updating profile",a),xe("Error while updating profile")}},[r,g,i]);let S=t?v.utc(t).format("L"):"(no date)";S=S.replace("/202","/2"),S=S.replace("/201","/1");const o={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"},d=s?{}:{cursor:"default"},k=s?e.jsx(me,{}):null,{isMobile:j}=P(),w=j?"block":"flex",x=j?"65%":"56%",b=j?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},C=p?"#fff":"#555",c=p?"#e15c07":"#555";return e.jsxs(B.Fragment,{children:[e.jsxs(ie,{expanded:l,onChange:E,children:[e.jsxs(oe,{expandIcon:k,style:{...o,...d},children:[e.jsx(fe,{value:"Black"}),e.jsx("div",{style:{margin:"4px 0px 0px 8px",width:x,flexShrink:0,flexDirection:"column"},children:e.jsx(ne,{value:"Black Belt Awarded",textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}})}),e.jsxs("div",{style:{display:w,placeItems:"center",marginLeft:10},children:[e.jsx("div",{style:{display:"flex",width:76}}),e.jsx("div",{style:b,children:e.jsx("div",{style:{margin:"4px 0px 0px 10px"},children:S})})]})]}),l&&e.jsx(ae,{sx:{padding:"4px 16px 0px 26px"},children:e.jsx(je,{adapterLocale:v.locale(),dateAdapter:ve,children:e.jsx(B.Fragment,{children:e.jsxs("div",{style:{display:"flex",width:"100%",marginBottom:20},children:[e.jsx(Xe,{label:"Awarded date",value:g,onChange:a=>{y(a),h(!0)},sx:{width:400},disableFuture:!0}),e.jsxs("div",{style:{width:"100%",textAlign:"right",position:"relative",top:"30px",padding:"0px 12px 8px 0px"},children:[e.jsx(A,{style:{marginRight:10,color:c},onClick:m,disabled:!p,children:"Cancel"}),e.jsx(A,{style:{marginRight:0,color:C},onClick:f,disabled:!p,children:"Save"})]})]})})})})]}),e.jsx(te,{}),e.jsx(te,{})]})}function Ct({collectionType:s}){const{user:t}=n.useContext(ge),{userId:r}=U(),i=se(),{isMobile:l}=P(),u=l?{marginTop:20,maxWidth:700,marginLeft:8,marginRight:8,borderRadius:0}:{marginTop:20,maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},p=r===(t==null?void 0:t.uid),h=p?e.jsx("div",{style:{width:"100%",display:"flex",placeItems:"center"},children:e.jsxs("div",{style:{fontSize:"1.0rem",fontWeight:400,width:400,marginLeft:"auto",marginRight:"auto"},children:[e.jsx("strong",{children:"There are no locks in your Scorecard."}),e.jsx("br",{}),'Browse the site and use the "My Collection" button to track locks that you have picked and recorded.',e.jsx("br",{}),e.jsx("br",{}),e.jsx("img",{alt:"My Collection",src:ot})]})}):"There are no locks in this collection.",g=p?s==="safelocks"?"Explore Safe Locks":"Explore Locks":"Go Home",y=n.useCallback(()=>{i(s==="safelocks"?"/safelocks":"/locks")},[i,s]);return e.jsx(st,{alignContent:"center",children:e.jsxs(Fe,{style:u,children:[e.jsx(ze,{children:e.jsx(N,{variant:"h6",align:"center",children:h})}),e.jsxs(Re,{children:[e.jsx("div",{style:{width:"100%"}}),e.jsx(A,{variant:"outlined",color:"secondary",onClick:y,style:{whiteSpace:"nowrap",padding:"10px 30px",margin:10},children:g})]})]})})}function St({owner:s,profile:t,adminAction:r}){const{isMobile:i}=P(),{userId:l}=U(),{visibleEntries:u=[],cardEvidence:p}=n.useContext($),{expanded:h}=n.useContext(be),{filters:g,removeFilters:y}=n.useContext(_),{createEvidenceForEntries:E,removeEvidence:m,removeProfileBlackBeltAwarded:f,updateUserStatistics:S}=n.useContext(Y),{admin:o}=n.useContext(Oe),[d,k]=n.useState(h),[j,w]=n.useState(!1),[x,b]=n.useState("import"),[C,c]=n.useState(!1);h&&h!==d&&k(h);const a=n.useMemo(()=>{if(t&&t.recorded){const D=p.map(W=>W.matchId);return t.recorded.filter(W=>!D.includes(W))}else return[]},[t,p]),I=n.useCallback(D=>{g.id&&y(["id"]),k(D)},[g,y]),M=n.useCallback(async()=>{c(!0),await E(l,a),w(!1),c(!1),r()},[E,l,a,r]),T=n.useCallback(D=>{b(D),w(!j)},[j]),[L,F]=n.useState(null),J=!!L,Q=n.useCallback(D=>{D.preventDefault(),D.stopPropagation(),F(D.currentTarget)},[]),z=n.useCallback(()=>F(null),[]),Z=n.useCallback(async()=>{c(!0),await S(l),c(!1)},[S,l]),X=n.useCallback(async()=>{c(!0),await m(p),await f(l),z(),c(!1),r()},[p,m,z,r,f,l]),G=i?10:40,q=i?"block":"flex",V=(t==null?void 0:t.blackBeltAwardedAt)>0,R=V?"100%":"50%";return e.jsxs("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:[e.jsx(at,{profile:t,page:"scorecard"}),s&&u.length>0&&!t.tabClaimed&&e.jsx("div",{style:{margin:8,padding:"0px 0px"},children:e.jsx(lt,{pageName:"scorecard"})}),u.length>0&&e.jsx(B.Fragment,{children:i?e.jsxs("div",{style:{display:q,padding:"0px 8px 0px 16px"},children:[t.danLevel>0&&e.jsx(ue,{}),e.jsx("div",{style:{marginRight:0,width:"95%"},children:e.jsx(he,{profile:t,entries:u})})]}):e.jsxs("div",{style:{display:q,padding:"10px 8px 0px 16px"},children:[e.jsx("div",{style:{marginRight:0,width:350},children:e.jsx(he,{profile:t,entries:u})}),t.danLevel>0&&e.jsx("div",{style:{flexGrow:1,marginRight:0},children:e.jsx(ue,{})})]})}),(s||o)&&e.jsxs(ie,{expanded:j,disableGutters:!0,children:[e.jsx(oe,{style:{paddingLeft:G,paddingRight:G,placeItems:"center",width:"100%"},children:e.jsxs("div",{style:{width:"100%",placeItems:"center",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",width:"100%",placeItems:"center",textAlign:"center"},children:[!V&&e.jsx("div",{style:{width:"50%",textAlign:"center"},children:e.jsx(A,{variant:"contained",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:R,textAlign:"center"},children:e.jsx(A,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("project"),children:j&&x==="project"?"CANCEL ADD PROJECT":"ADD PROJECT"})})]}),C&&e.jsx(ke,{}),o&&!C&&e.jsx("div",{style:{backgroundColor:"#700",padding:5,marginTop:20},children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{width:"10%",textAlign:"center"},children:"admin"}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:Z,children:"UPDATE STATS"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsxs(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:M,children:["MERGE RECORDED (",a.length,")"]})}),e.jsxs("div",{style:{width:"20%",textAlign:"center"},children:[e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:Q,children:"DELETE SCORECARD"}),e.jsxs(Pe,{anchorEl:L,open:J,onClose:z,children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["You cannot undo delete.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:X,edge:"start",color:"error",children:"Delete"})})]})]})]})})]})}),e.jsxs(ae,{style:{backgroundColor:"#333"},children:[x==="import"&&e.jsx(kt,{setControlsExpanded:w,adminAction:r}),x==="project"&&e.jsx(ye,{evid:null,handleUpdate:T,addProject:!0})]})]}),u.length===0&&e.jsx(Ct,{}),t&&t.blackBeltAwardedAt&&e.jsx(bt,{owner:s,date:t.blackBeltAwardedAt.toDate().toJSON()}),e.jsx("div",{children:u.map(D=>e.jsx(ut,{owner:s,evid:D,expanded:D.id===d,onExpand:I,merged:t.blackBeltAwardedAt>0},D.id))})]})}function Xt(){const{userId:s}=U(),{user:t}=n.useContext(ge),{getProfile:r,getEvidence:i}=n.useContext(Y),{scoredEvidence:l,bbCount:u,danPoints:p,eligibleDan:h,nextDanPoints:g,nextDanLocks:y}=n.useContext(Ne),{isMobile:E}=P(),[m,f]=n.useState(!1),S=n.useCallback(()=>{f(!m)},[m]),o=n.useCallback(async()=>{try{const L=await r(s);if(L){const F=L.displayName?L.displayName.toLowerCase().endsWith("s")?`${L.displayName}'`:`${L.displayName}'s`:"Anonymous";document.title=`LPU Belt Explorer - ${F} Scorecard`}if((t==null?void 0:t.uid)!==s){const F=await i(s);return{profile:L,...Me(F)}}else return{profile:L,scoredEvidence:l,bbCount:u,danPoints:p,eligibleDan:h,nextDanPoints:g,nextDanLocks:y}}catch(L){return console.error("Error loading profile and evidence.",L),null}},[m,t,s,r,i,l,u,p,h,g,y]),{data:d={},loading:k,error:j}=_e({loadFn:o}),w=d?d.profile:{},x=d?d.scoredEvidence:[],b=d?d.bbCount:0,C=d?d.danPoints:0,c=d?d.eligibleDan:0,a=d?d.nextDanPoints:0,I=d?d.nextDanLocks:0,M=e.jsxs(B.Fragment,{children:[e.jsx(Ve,{label:"Scorecard",extraFilters:[{key:"tab",value:"search"}]}),e.jsx(Ke,{sortValues:Ye}),e.jsx(Je,{extraFilters:[{key:"tab",value:"search"}]}),!E&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})]}),T=k?"Loading...":"Profile";return k||j?null:e.jsx(Ge,{filterFields:qe,children:e.jsx(xt,{cardEvidence:x,cardBBCount:b,cardDanPoints:C,cardEligibleDan:c,cardNextDanPoints:a,cardNextDanLocks:I,children:e.jsxs(mt,{children:[e.jsxs(je,{adapterLocale:v.locale(),dateAdapter:ve,children:[e.jsx(We,{title:T,extras:M}),k&&e.jsx(ct,{}),!k&&d&&!j&&e.jsx(St,{owner:t&&t.uid===s,profile:w,adminAction:S}),!k&&(!d||j)&&e.jsx(rt,{}),e.jsx(He,{})]}),e.jsx(Ue,{feature:"scorecard"})]})})})}export{Xt as default};
