import{r as n,A as _,D as v,K as V,j as t,J as F,B as x,I as L,$ as O,R as g,d as $,bE as M,N as W,h as Y,T as N}from"./index-3faf62ea.js";import{p as z,c as K}from"./postData-0e58a5a1.js";import{u as S}from"./useData-bc950469.js";import{d as b}from"./ContentCopy-9e8c89bc.js";import{P as Q,a as U}from"./PlatformBeltCountsTable-5aa90b1d.js";import{d as k}from"./Cached-53c073ea.js";import{L as q}from"./LoadingDisplay-46e59d88.js";import{D as f}from"./Dialog-c5e4f960.js";import{u as G}from"./usePageTitle-31f9c57d.js";import{e as H,f as X}from"./dataUrls-88e95518.js";import{E as J}from"./ErrorMessage-2dfbc38d.js";import{L as Z}from"./LoadingDisplay-2e5a1faa.js";import"./axios-439bb627.js";import"./nivo-bar.es-2feae160.js";import"./nivo-axes.es-906be692.js";import"./nivo-legends.es-60fe833e.js";import"./index-6ab5927b.js";import"./chartDefaults-ca889cb2.js";import"./BeltIcon-022f73e9.js";import"./TableRow-fbf9cdaa.js";import"./Box-1629c1a8.js";import"./CircularProgress-fba763de.js";import"./useDocumentTitle-a3a6ae7f.js";import"./LPU-c3fa7122.js";import"./LinearProgress-e03d79a9.js";function tt(){const{authLoaded:s}=n.useContext(_),{adminRole:r}=n.useContext(v),{user:o}=n.useContext(_),{getProfile:a}=n.useContext(v),i=o?o.uid:null,e=n.useCallback(async()=>{if(!i)return null;try{return await a(i)}catch(h){return console.error("Error loading profile.",h),null}},[a,i]),{data:l={},loading:d,error:u}=S({loadFn:e});return{authLoaded:s,adminRole:r,profile:l,user:o,loading:d,error:u}}function et({text:s,title:r="Text"}){const o=n.useCallback(async()=>{await navigator.clipboard.writeText(s),V(`${r} copied to clipboard.`)},[s,r]);return s?t.jsx(F,{title:`Copy ${r}`,arrow:!0,disableFocusListener:!0,children:s?t.jsx(x,{variant:"outlined",size:"small",onClick:o,style:{color:"#ddd",borderColor:"#aaa"},startIcon:t.jsx(b,{}),children:"Copy"}):t.jsx(L,{onClick:o,children:t.jsx(b,{})})}):null}const{VITE_DEV_FIRESTORE:st}={VITE_LOCAL_DATA:"false",VITE_DISCORD_CLIENT_ID:"1271550138929774725",VITE_DISCORD_CLIENT_SECRET:"CoecO8cx2SyhMq2k3WdWNp-lavxYkeS-",VITE_REDDIT_CLIENT_ID:"i_lvEF-IFPalom2BR_lVjg",VITE_REDDIT_CLIENT_SECRET:"09PAhQfve1tysFh3jQAtmFaG5pWG0A",VITE_DEV_FIRESTORE:"false",VITE_RAFL_VIEW_FORM_ID:"1FAIpQLSf_PQ6XXDYy0cTn_2MeDCwikTOYLRtncPKluFRK-QEYHX0qug",VITE_RAFL_STATE:"hidden",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},rt=st==="true"?"https://explore.lpubelts.com:3443":"https://explore.lpubelts.com:8443";function ot({handleClick:s,title:r="Refresh",iconOnly:o=!1}){return t.jsx(F,{title:"Refresh",arrow:!0,disableFocusListener:!0,children:o?t.jsx(L,{onClick:s,children:t.jsx(k,{})}):t.jsx(x,{variant:"outlined",size:"small",onClick:s,style:{color:"#ddd",borderColor:"#aaa"},startIcon:t.jsx(k,{}),children:r})})}const nt=({data:s,refresh:r})=>{var C,R,E,D,T,B;const{user:o}=tt(),[a,i]=n.useState(!1),[e,l]=n.useState(void 0),[d,u]=n.useState(void 0),{discordBeltCounts:j,redditBeltCounts:h}=s,A=O.reduce((m,p)=>{const c=`${p} Belt`;return m+`${c}	${j[c]}	${h[c]}
`},`Belt	Discord	Reddit
`),w=async()=>{const m=new FormData;m.append("time",$().format("YYYY-MM-DD HH:mm:ss")),i(!0);try{const p=`${rt}/fetch-reddit-flairs`,c=!0,P=6e4;try{u(await z({user:o,url:p,formData:m,snackBars:c,timeoutDuration:P}))}catch(I){console.error("Error fetching reddit belts:",I),l(K(I))}}catch{console.error("Error fetching reddit belts:",e)}finally{i(!1)}},y=n.useCallback(async()=>{u(void 0),i(!1),l(void 0),await r()},[r]);return t.jsxs(g.Fragment,{children:[t.jsxs("div",{style:{maxWidth:700,padding:20,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,justifyItems:"center",backgroundColor:"#000",textAlign:"center"},children:[t.jsx("h2",{children:"Belt Stats by Platform"}),t.jsxs("div",{style:{textAlign:"center",width:"100%"},children:[t.jsx(Q,{data:s}),t.jsx(U,{data:s})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",marginTop:40,justifyContent:"center"},children:[t.jsx(ot,{handleClick:w}),t.jsx("div",{style:{width:16}}),t.jsx(et,{text:A,title:"Reddit Counts"})]})]}),t.jsx(f,{open:a,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(q,{message:"Fetching Reddit Belts, may take a while."})})}),t.jsx(f,{open:!!d&&!e,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsx("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:"Reddit Belts Updated!"}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(x,{onClick:y,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(f,{open:!!e,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",((R=(C=e==null?void 0:e.response)==null?void 0:C.data)==null?void 0:R.message)||(e==null?void 0:e.message),((D=(E=e==null?void 0:e.response)==null?void 0:E.data)==null?void 0:D.status)&&t.jsxs("span",{children:[" (",(B=(T=e==null?void 0:e.response)==null?void 0:T.data)==null?void 0:B.status,")"]})]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(x,{onClick:y,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})})]})},it=nt;function St(){const{data:s,loading:r,error:o,errorMessage:a,refresh:i}=S({urls:at}),{profile:e,user:l}=M();G("Fetch Reddit Belt Data");const d=t.jsx(g.Fragment,{});return t.jsxs(g.Fragment,{children:[t.jsx(W,{title:"Fetch Reddit Belt Data",extras:d}),o&&t.jsx(J,{errorMessage:a}),r&&t.jsx(Z,{}),!r&&!o&&!!s&&t.jsx(it,{data:s,profile:e,user:l,refresh:i}),t.jsx(Y,{}),t.jsx(N,{feature:"redditBelts"})]})}const at={discordBeltCounts:H,redditBeltCounts:X};export{St as default};
