import{d as A,u as C,j as t,R as L,b as N,r as h,A as $,D as E,N as O,F as Y,T as G}from"./index-b2b47f89.js";import{D as X,a as _,r as q}from"./filterFields-8a9acbec.js";import{L as J}from"./LoadingDisplay-eff6225e.js";import{u as K}from"./useData-5dfb1fe4.js";import{u as Q}from"./usePageTitle-5f092410.js";import{s as U}from"./dataUrls-4eb203c4.js";import{P as Z}from"./nivo-line.es-39b2fb82.js";import{p as tt}from"./adminChartDefaults-e02caa29.js";import{A as et}from"./AdminStatsTable-2b430641.js";import{A as M}from"./AdminStatsTableSort-1796998e.js";import{R as nt}from"./RaffleAutocompleteBox-a2601ad8.js";import{L as st}from"./Link-f21161a3.js";import{a as W}from"./RaffleContext-20677a34.js";import{R as at,A as ot}from"./AdminRoleButton-e4de69b0.js";import{R as it}from"./RaffleDataProvider-5d21fb8e.js";import"./LPU-c3fa7122.js";import"./LinearProgress-a850363a.js";import"./useDocumentTitle-3004d4f2.js";import"./nivo-legends.es-1ae70302.js";import"./index-bad69a8e.js";import"./TableRow-51f7d906.js";import"./Search-05f3eb6b.js";import"./Autocomplete-79793e3c.js";import"./Select-2e587c09.js";import"./Chip-7a07e774.js";import"./TextField-75c44832.js";import"./index-9e60c15b.js";const rt=({lineData:p})=>{const i=[p.rafl28days.data],o=[],e=new Map,d=new Map,u=new Map;i.forEach(r=>{const g=[],f=[],T=[];for(let R=0;R<r.length;R++){let m=r[R].date;if(A(m)<A("2024-11-25"))continue;m=m+" 23:59:59";const l=new Map;l.x=m,l.y=r[R].potListViews,g.push(l);const y=new Map;y.x=m,y.y=r[R].potViews,f.push(y);const k=new Map;k.x=m,k.y=r[R].raflForm,T.push(k)}e.id="Pot List",e.data=g,d.id="Pot Views",d.data=f,u.id="Entry Form",u.data=T,o.push(d),o.push(e),o.push(u)});const{width:s}=C(),w=s<=360,x=s<=395,v=s<=428,j=s<=560,b=s<=820,c=w||x?200:v?210:b?230:350,S=j?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:c,width:"100%"},children:t.jsx(Z,{theme:tt,data:o,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:S,height:c,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.2f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function lt({data:p}){const{width:i}=C(),o=i<=560,u={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...o?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:u,children:t.jsx(rt,{lineData:p})})})})}const ct=({data:p})=>{const{rafl28days:i}=p,o=i.data.filter(r=>A(r.date)>A("2024-11-27")),e=o.reduce((r,g)=>(Object.keys(i.data[i.data.length-1]).map(f=>{["date","dateString"].includes(f)||(r[f]=r[f]?r[f]+g[f]:g[f])}),r),{});e.dateString="Total",o.push(e);const d=Object.keys(e).reduce((r,g)=>(r[g]=Math.floor(e[g]/o.length),r),{});d.dateString="Average",o.push(d);const u={columns:i.columns,data:o},{width:s}=C(),w=s<=360,x=s<=395,v=s<=428,j=s<=560,b=s<=820,c=w?".8rem":x?".85rem":v?".9rem":".95rem",S="100%";return t.jsx(et,{tableData:u,tableWidth:S,fontSize:c})},dt=({data:p})=>{const i=N(),{potViewsById:o}=p,{getPotFromId:e}=h.useContext(X),d=[{name:"Pot #",align:"center",id:"potNumber"},{name:"ID",align:"center",id:"id"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],u=!0,[s,w]=h.useState("potNumber"),[x,v]=h.useState(!0),[j,b]=h.useState({}),c=o.data.map(n=>{var F,I;const a=e(n.id);if(!a)return null;let D=a!=null&&a.title?a.title.substring(0,32):`unknown (${n.id})`;D=((F=a==null?void 0:a.title)==null?void 0:F.length)<32||!(a!=null&&a.title)?D:D+"...";const P=(I=n==null?void 0:n.id)==null?void 0:I.replace("2025-","");return{...n,percentViews:Math.floor(n.percentViews*100)+"%",...a,title:D,id:P}}).filter(n=>n).sort((n,a)=>{switch(s){case"potNumber":return n.potNumber-a.potNumber||n.title.localeCompare(a.title);case"id":return n[s].localeCompare(a[s]);case"title":return n[s].localeCompare(a[s]);case"donors":return parseInt(a[s])-parseInt(n[s])||n.title.localeCompare(a.title);case"percentViews":return parseInt(a[s])-parseInt(n[s])||n.views-a.views;default:return parseInt(a[s])-parseInt(n[s])||n.title.localeCompare(a.title)}}),S=x?c:c.reverse(),g=(Object.keys(j).length>0?[S==null?void 0:S.find(n=>n.title===j.itemTitle)]:S||[]).map(n=>n.donors&&n.donors>0?{...n}:{...n,donors:0,tickets:0}),f={columns:d,data:g},T=h.useCallback((n,a)=>{const D=c.find(F=>F.title===a),P=D==null?void 0:D.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return n==="title"?t.jsx(st,{onClick:()=>i(`/rafl/?id=${D.id}&name=${P}`),style:{color:"#fff"},children:a}):a},[i,c]),R=h.useCallback(n=>n!=null&&n.title?n.title:"unknown",[]),{width:m}=C(),l=m<=360,y=m<=395,k=m<=428,V=m<=560,z=m<=820,B=l?".8rem":y?".85rem":k?".9rem":".95rem",H="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(nt,{allItems:c,setItemDetails:b,getOptionTitle:R,searchText:"Search Pots"})})}),t.jsx(M,{tableData:f,tableWidth:H,fontSize:B,sortable:u,sort:s,setSort:w,ascending:x,setAscending:v,linkFunction:T})]})},mt=()=>{const{allCharities:p}=h.useContext(W),i=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],o=!0,[e,d]=h.useState("name"),[u,s]=h.useState(!0),w=p.sort((l,y)=>{switch(e){case"name":return l.name.localeCompare(y.name);case"donors":return y[e]-l[e];case"donations":return y[e]-l[e];default:return l.name.localeCompare(y.name)}}),v=(u?w:w.reverse()).map(l=>l.donations&&l.donations>0?{...l,donations:`$${l.donations}`}:{...l}),j={columns:i,data:v},b=h.useCallback((l,y)=>y,[]),{width:c}=C(),S=c<=360,r=c<=395,g=c<=428,f=c<=560,T=c<=820,R=S?".8rem":r?".85rem":g?".9rem":".95rem",m="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(M,{tableData:j,tableWidth:m,fontSize:R,sortable:o,sort:e,setSort:d,ascending:u,setAscending:s,linkFunction:b})]})};function pt(){var b;Q("RAFL Report");const{data:p,loading:i,error:o}=K({urls:ut}),{siteFullNew:e}=p||{},{width:d}=C(),s=d<560?"8px 8px 32px 8px":"24px 24px 32px 24px",w={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff"},x={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff"},v=(b=e==null?void 0:e.firstVistsLastSevenDays)!=null&&b.countryCount?x:w,j=i?"--":"(updated: "+A(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+` ${e==null?void 0:e.metadata.timezone})`;return i?t.jsx(J,{}):o?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:s,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[t.jsxs("div",{style:v,children:["RAFL Summary",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:j})]}),t.jsx(lt,{data:e}),t.jsx("div",{style:x,children:"Page Tracking"}),t.jsx(ct,{data:e}),t.jsx("div",{style:x,children:"Pot Details"}),t.jsx(dt,{data:e}),t.jsx("div",{style:x,children:"Charity Details"}),t.jsx(mt,{data:e})]})}const ut={siteFullNew:U};function $t(){const{authLoaded:p}=h.useContext($),{adminRole:i}=h.useContext(E),{isMobile:o}=C(),{allPots:e}=h.useContext(W),d=t.jsxs(L.Fragment,{children:[!o&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(at,{active:!0}),t.jsx(ot,{})]});return t.jsx(_,{filterFields:q,children:t.jsx(it,{allEntries:e,children:t.jsxs(L.Fragment,{children:[t.jsx(O,{title:"RAFL Report",extras:d}),p&&i&&t.jsx(pt,{}),t.jsx(Y,{}),t.jsx(G,{feature:"raflReport"})]})})})}export{$t as default};
