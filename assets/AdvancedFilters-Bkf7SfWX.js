import{r as s,F as S,j as t,A as O,a6 as E,ak as W,an as $,O as q,u as P,aa as H,ab as J,B as w}from"./index-DtdEFLiT.js";import{A as B,F as K,R as Q}from"./ViewFilterButtons-CSd1nf4X.js";import{C as U}from"./ChoiceButtonGroup-Bf_o3V5X.js";import{T as X,a as Y}from"./ToggleButtonGroup-CYjIlHkb.js";import{C as V}from"./Collapse-DzcECa40.js";import{F as Z,I as ee,S as te}from"./Select-CDYMkW7q.js";import{D as se}from"./DataContext-B-bRfWwX.js";function le({group:r={},onChange:e}){const{fieldName:f="",matchType:m="Is",operator:p="OR",values:i=[],groupIndex:n=0}=r,{filterFields:g}=s.useContext(S),v=g.find(a=>a.fieldName===f)||{},b=s.useMemo(()=>[{label:"OR",value:"OR"},{label:"AND",value:"AND"}],[]),h=s.useCallback(()=>{const a=[...i,""];e&&e({values:a})},[e,i]),o=s.useCallback(a=>{const u=(a==null?void 0:a.value)||(a==null?void 0:a.label)||"OR";e&&e({operator:u})},[e]),y=s.useCallback((a,u)=>{const l=i.map((c,I)=>I===a?u:c);e&&e({values:l})},[e,i]),F=s.useCallback(a=>{const u=i.filter((l,c)=>c!==a);e&&e({values:u})},[e,i]);return t.jsxs("div",{children:[i.length>0&&i.map((a,u)=>t.jsxs("div",{style:{display:"block",width:250},children:[t.jsx(B,{...v,active:!0,group:r,groupIndex:n,matchType:m,operator:p,valueIndex:u,currentValue:a,groupValues:i,onFilter:l=>y(u,l),onRemove:()=>F(u),handleAddValue:h,size:"small"},u),u===0&&i.length>1&&t.jsx(U,{options:b,defaultValue:p,onChange:o,small:!0,rounded:!0,style:{margin:"0px 0 13px 0"}})]},u)),i.length===0&&t.jsx(B,{...v,active:!0,group:r,groupIndex:n,matchType:m,operator:p,currentValue:"",onFilter:a=>e&&e({values:[a]}),onRemove:()=>e&&e({values:[]}),handleAddValue:h,size:"small"},0)]})}function ae({options:r,onChange:e,defaultValue:f,rounded:m,small:p=!1,style:i={}}){const[n,g]=s.useState(f||r[0].value),v=s.useCallback(o=>()=>{const y=r.find(F=>F.value===o);g(o),e&&e(y)},[e,r]),b=p?{padding:"1px 10px"}:{padding:"6px 12px"},h=m?null:{borderRadius:0};return t.jsx(X,{variant:"outlined",style:{...i,borderRadius:m?4:0},children:r.map(o=>t.jsx(Y,{onClick:v(o.value),style:{color:n===o.value?"#eee":"#777",backgroundColor:n===o.value?o.backgroundColor||"#292929":"#111",borderColor:"#000",...b,...h},value:String(n),children:o.label},o.value))})}function re({group:r={},onChange:e}){const{isLoggedIn:f}=s.useContext(O),{beta:m}=s.useContext(E),{filterFields:p,advancedFilterGroups:i}=s.useContext(S),{fieldName:n="",matchType:g="Is"}=r,[v,b]=s.useState(n),h=s.useMemo(()=>p.filter(l=>(!l.beta||m)&&(!l.userBased||f)).filter(l=>!i().some(c=>c.fieldName===l.fieldName&&l.fieldName!==n)),[i,m,n,p,f]),o=s.useCallback(l=>{const c=l.target.value;b(c),e&&e({fieldName:c,values:[]}),setTimeout(()=>document.activeElement.blur())},[e]),y=s.useMemo(()=>[{label:"Is",value:"Is"},{label:"Not",value:"Is Not",backgroundColor:"#733030"}],[]),F=s.useCallback(l=>{const c=(l==null?void 0:l.value)||(l==null?void 0:l.label)||"Is";e&&e({matchType:c})},[e]),[a,u]=s.useState(!1);return s.useEffect(()=>{u(!0)},[]),t.jsx(V,{in:a||n.length>0,unmountOnExit:!0,children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",margin:"0px 0 12px 0",alignItems:"flex-start"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",marginTop:0},children:[t.jsxs(Z,{style:{width:200,marginRight:0,marginTop:8},size:"small",children:[t.jsx(ee,{color:"info",children:"Filter"}),t.jsx(te,{value:v,label:"Filter",onChange:o,color:"info",name:"fieldName",children:h.map((l,c)=>t.jsx(W,{value:l.fieldName,children:l.label},c))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx(ae,{options:y,defaultValue:g,onChange:F,small:!1,rounded:!0,style:{height:40,margin:"8px 12px 8px 12px",borderRadius:4}}),t.jsx("br",{})]})]}),t.jsx("div",{style:{display:"flex",alignItems:"flex-start",marginTop:8},children:t.jsx(le,{group:r,onChange:e})})]})})}function pe(){const{advancedFilterGroups:r,setAdvancedFilterGroups:e,showAdvancedSearch:f,setShowAdvancedSearch:m,hideAdvancedSearch:p,filterFields:i,filterCount:n,removeFilters:g,clearFilters:v}=s.useContext(S),{visibleEntries:b=[],visibleBeltEntries:h}=s.useContext(se),{beta:o}=s.useContext(E),{isLoggedIn:y}=s.useContext(O),F=$(),a=q.parse(F.search);s.useEffect(()=>{a.preview==="advanced"&&(m(!0),g(["preview"]))},[g,a.preview,m]);const u=s.useMemo(()=>r().filter(x=>{const d=i.find(j=>j.fieldName===x.fieldName);return(!(d!=null&&d.beta)||o)&&(!(d!=null&&d.userBased)||y)}),[r,o,i,y]),l=s.useCallback(()=>{const x=[...r(),{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}];e(x)},[r,e]),c=s.useCallback(()=>{v()},[v]),I=s.useCallback((x,d)=>{const N=r().map((C,_)=>_===x?{...C,...d}:C);e(N)},[r,e]),M=s.useCallback(x=>{let j=r().filter((N,C)=>C!==x);j.length===0&&(j=[{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),e(j)},[r,e]);s.useEffect(()=>{r().length===0&&!p&&e([{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),n>0&&m(!0)},[r,n,p,e,m]);const{isMobile:R}=P(),G=R?{maxWidth:700,borderRadius:0}:{maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},T=R?8:16,D=R?2:0,[z,k]=s.useState(!1);s.useEffect(()=>{p?k(!1):(f||n>0)&&k(!0)},[f,n,p]);const[L,A]=s.useState(!1);return s.useEffect(()=>{if(f||n>0)A(!0);else{const x=setTimeout(()=>{A(!1)},300);return()=>clearTimeout(x)}},[f,n]),t.jsx(V,{in:z,unmountOnExit:!0,children:L&&t.jsx(H,{style:{...G,paddingBottom:0,paddingTop:16},id:"advanced-filters",children:t.jsxs(J,{style:{paddingTop:0,paddingLeft:T,paddingRight:T,alignItems:"top"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"top",marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"top"},children:[t.jsxs("div",{style:{display:"flex",marginRight:36,marginBottom:0,alignItems:"center"},children:[t.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem"},children:"Filters"}),t.jsxs("div",{style:{fontWeight:400,fontSize:"1.0rem",marginLeft:8},children:["(",(h||b||[]).length||0," Lock",(h||b||[]).length!==1&&"s",")"]})]}),t.jsx(K,{style:{margin:"16px 0px 0px 0px"}})]}),t.jsx("div",{style:{flexGrow:1,textAlign:"right",alignItems:"top",marginTop:D},children:t.jsx(Q,{alwaysShow:!0})})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:u.map((x,d)=>t.jsx(re,{group:{...x,groupIndex:d,groupId:x._id},groupIndex:d,onChange:j=>I(d,j),onRemove:()=>M(d)},x._id||d))}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:[t.jsx(w,{onClick:c,variant:"contained",size:"small",style:{backgroundColor:"#444",marginRight:16},children:"Clear"}),t.jsx(w,{onClick:l,variant:"contained",color:"info",size:"small",children:"Add Filter"})]})]})})})}export{pe as A};
