import{r as l,aQ as C,a_ as S,a1 as a,as as z,ag as L,K as P,j as F,R as B}from"./index-9644fca3.js";import{F as M,r as k,f as E,D as T}from"./index-b19e64d1.js";function Q({children:x,cardEvidence:n,cardBBCount:u,cardDanPoints:c,cardEligibleDan:p,cardNextDanPoints:f,cardNextDanLocks:m}){const{filters:v}=l.useContext(M),{search:g,id:b,tab:K,name:U,sort:o,image:W,...O}=v,h=l.useMemo(()=>n.map(s=>{const r=C(s.matchId),i=S(s.matchId);return{...r,...s,...i,id:s.id}}),[n]),j=l.useMemo(()=>h.map(s=>{var r,i,e;return{...s,makes:(r=s==null?void 0:s.makeModels)==null?void 0:r.map(({make:t})=>t),fuzzy:k(((i=s==null?void 0:s.makeModels)==null?void 0:i.map(({make:t,model:d})=>[t,d]).flat().filter(t=>t).concat([s.version,s.notes,s.belt]).join(","))+" "),documentation:[s.exceptionType==="badlink"?"Bad Link":"Valid Link",s.date?"Valid Date":"No Date"],scoring:[s.exceptionType==="nomatch"?"Unmatched":s.exceptionType==="badlink"?"Bad Link":s.exceptionType==="duplicate"?"Duplicate":s.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(s.belt)?"Low Level":"Worth Points"],simpleBelt:(e=s==null?void 0:s.belt)==null?void 0:e.replace(/\s\d/g,"")}}),[h]),A=l.useMemo(()=>{const s=Object.keys(O).map(e=>{const t=O[e];return Array.isArray(t)?t.map(d=>({key:e,value:d})):{key:e,value:t}}).flat(),r=j.filter(e=>s.every(({key:t,value:d})=>Array.isArray(e[t])?e[t].includes(d):e[t]===d)),i=g?E.go(k(g),r,{keys:I,threshold:-25e3}).map(e=>({...e.obj,score:e.score})):r;return o?i.sort((e,t)=>{if(o==="danPointsAscending")return e.points-t.points||a(t.date).valueOf()-a(e.date).valueOf();if(o==="danPointsDescending")return t.points-e.points||a(t.date).valueOf()-a(e.date).valueOf();if(o==="dateAscending")return a(e.date).valueOf()-a(t.date).valueOf()||z(e.simpleBelt,t.simpleBelt);if(o==="dateDescending")return a(t.date).valueOf()-a(e.date).valueOf()||z(e.simpleBelt,t.simpleBelt);if(o==="beltAscending")return L(e.belt,t.belt)||a(t.date).valueOf()-a(e.date).valueOf();if(o==="beltDescending")return z(e.belt,t.belt)||a(t.date).valueOf()-a(e.date).valueOf();if(o==="alphaAscending")return e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;if(o==="alphaDescending")return t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points}):i.sort((e,t)=>a(t.date).valueOf()-a(e.date).valueOf()||z(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy))},[O,j,g,o]),D=l.useMemo(()=>({allEntries:P,cardEvidence:n,cardBBCount:u,cardDanPoints:c,cardEligibleDan:p,cardNextDanPoints:f,cardNextDanLocks:m,visibleEntries:A,getEntryFromId:C,getProjectEntryFromId:S}),[n,u,c,p,f,m,A]);return F.jsx(T.Provider,{value:D,children:x})}const I=["fuzzy"],R=B.createContext({});function V({children:x}){const{filters:n,addFilters:u,removeFilters:c}=l.useContext(M),p=n.id,f=l.useCallback(v=>{v?u([{key:"id",value:v}],!0):c(["id"])},[u,c]),m=l.useMemo(()=>({expanded:p,setExpanded:f}),[p,f]);return F.jsx(R.Provider,{value:m,children:x})}export{R as S,Q as a,V as b};
