import{r as n,F as W,am as D,aK as S,g as y,a8 as H,j as K,ap as O,d as r,K as T,R as L}from"./index-DHH7yk3Z.js";import{D as J,f as Q}from"./DataContext-DZKCE__Z.js";import{r as U}from"./index-B0odXij6.js";function se({children:g,cardActivity:l,cardBBCount:d,cardDanPoints:h,cardEligibleDan:i,cardNextDanPoints:o,cardNextDanLocks:M,cardUniqueLocks:c,cardMaxBelt:b,popularLocks:x,popularLocksBB:e,profile:t,blackBeltScorecard:m}){const{filters:z}=n.useContext(W),{search:a,id:p,tab:Z,name:_,sort:P,image:$,locks:q,...I}=z,C=n.useMemo(()=>l.map(s=>{const u=D(s.matchId),f=S(s.matchId),v=y(s.matchId),A=v?"Belt":f?"Project":"Lock";return{...s,...u,...f,...v,id:s.id,type:A}}),[l]),E=n.useMemo(()=>C.reduce((s,u)=>(s[u.matchId]=u,s),{}),[C]),k=n.useMemo(()=>x.map(s=>({...D(s.id),...E[s.id],popularityRank:s.rank,userCount:s.saveCount})),[x,E]),w=n.useMemo(()=>e==null?void 0:e.map(s=>({...D(s.id),...E[s.id],popularityRank:s.rank,userCount:s.saveCount})),[e,E]),j=n.useMemo(()=>{const s=(u,f)=>{const v=String(f??""),A=v.startsWith("!"),G=A?v.slice(1):v;return{key:u,value:G,negative:A}};return Object.keys(I).map(u=>{const f=I[u];return Array.isArray(f)?f.map(v=>s(u,v)):s(u,f)}).flat()},[I]),F=n.useMemo(()=>N(C,j,a,P,t),[C,j,t,a,P]),Y=n.useMemo(()=>N(k,j.concat({key:"exceptionType",value:void 0}),a,"popular",t),[k,j,t,a]),R=n.useMemo(()=>(t==null?void 0:t.blackBeltAwardedAt)>0,[t]),V=n.useMemo(()=>({allEntries:H,cardActivity:l,cardBBCount:d,cardDanPoints:h,cardEligibleDan:i,cardNextDanPoints:o,cardNextDanLocks:M,visibleEntries:F,popularEntries:Y,bbPopularEntries:w,cardUniqueLocks:c,cardMaxBelt:b,blackBeltUser:R,blackBeltScorecard:m,getEntryFromId:D,getProjectEntryFromId:S,getAwardEntryFromId:y}),[l,d,h,i,o,M,F,Y,w,c,b,R,m]);return K.jsx(J.Provider,{value:V,children:g})}function N(g,l,d,h,i={}){const o=(i==null?void 0:i.userLockNotes)||{},c=g.map(e=>{var t,m,z;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:a})=>a),fuzzy:U(((m=e==null?void 0:e.makeModels)==null?void 0:m.map(({make:a,model:p})=>[a,p]).flat().filter(a=>a).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],content:[o[e.id]||o[e.matchId]?"Has Personal Notes":void 0].flat().filter(a=>a),scoring:[(()=>{switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}return"Worth Points"})()],simpleBelt:(z=e==null?void 0:e.belt)==null?void 0:z.replace(/\s\d/g,""),personalNotes:o[e.id]||o[e.matchId]}}).filter(e=>l.every(({key:t,value:m,negative:z})=>{const a=e[t];if(Array.isArray(a)){const p=a.includes(m);return z?!p:p}else{const p=a===m;return z?!p:p}})),b=d?Q.go(U(d),c,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):c,x=(()=>{switch(h){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||T(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||O(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"dateAscending":return(e,t)=>r(e.date).valueOf()-r(t.date).valueOf()||O(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>r(t.date).valueOf()-r(e.date).valueOf()||O(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>T(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"beltDescending":return(e,t)=>O(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>r(r(t.date).format("YYYY-MM-DD")).valueOf()-r(r(e.date).format("YYYY-MM-DD")).valueOf()||O(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return b.sort(x)}const X=L.createContext({});function ae({children:g}){const{filters:l,addFilters:d,removeFilters:h}=n.useContext(W),i=l.id,o=n.useCallback(c=>{c?d([{key:"id",value:c}],!0):h(["id"])},[d,h]),M=n.useMemo(()=>({expanded:i,setExpanded:o}),[i,o]);return K.jsx(X.Provider,{value:M,children:g})}export{X as S,se as a,ae as b};
