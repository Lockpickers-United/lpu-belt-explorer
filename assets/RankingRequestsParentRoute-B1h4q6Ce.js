import{r as a,A as b,D as j,bE as R,bF as h,bG as v,bH as D,j as t,R as q,a9 as E,e as S,N as k,B,bb as N,h as A,bI as F}from"./index-Dh83uZet.js";import{L as C}from"./LoadingDisplay-DBdpmxV9.js";import{D as L}from"./LockDataProvider-Dx_aaefF.js";import{n as M}from"./dataUrls-DVxTtpO-.js";import{p as w,c as I}from"./postData-DPERWgYc.js";import"./Box-BfZMVdZo.js";import"./CircularProgress-GMYlbVq9.js";import"./filterEntriesAdvanced-k2ruZYIw.js";import"./DataContext-DzxqkHMZ.js";import"./index-Dy-uAbNt.js";import"./collectionStatsById-DY1NVZ7h.js";import"./useData-DMDw4Rly.js";import"./setDeep-J6HEwWhX.js";import"./stringUtils-BsiQ3MZ5.js";import"./entryName-CSxWzxgx.js";import"./index-B9ygI19o.js";async function P({activityData:i}){const r=`${M}/log-activity`,e=!1,u=JSON.stringify({activityData:i});try{return await w({url:r,json:u,snackBars:e})}catch(c){throw console.error(I(c)),c}}function tt(){const{authLoaded:i,isLoggedIn:r}=a.useContext(b),{lockCollection:e}=a.useContext(j),[u,c]=a.useState([]),l=a.useRef(0);a.useEffect(()=>{const n=R(v(F,"ranking-requests"),h("requestStatus","!=","Deleted")),x=r?D(n,m=>{const p=m.docs.length;l.current+=p;const f=[{activity:"READ",activityCount:p,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName}];l.current>p&&f.push({activity:"REFRESH",activityCount:p,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName,prod:!1}),P({activityData:f}),c(g=>{const d=new Map(g.map(s=>[s.id,s]));return m.docChanges().forEach(s=>{const o={id:s.doc.id,...s.doc.data()};s.type==="added"?d.has(o.id)||d.set(o.id,o):s.type==="modified"?d.set(o.id,o):s.type==="removed"&&d.delete(o.id)}),Array.from(d.values())})},m=>{console.error("Error getting ranking requests from DB:",m)}):(()=>{});return()=>x()},[r]);const y=a.useMemo(()=>u.filter(n=>n.makeModels&&n.makeModels[0].make&&n.makeModels[0].model),[u]);return t.jsxs(q.Fragment,{children:[!i&&t.jsx(C,{}),i&&r&&t.jsx(E,{context:y}),i&&!r&&t.jsx(S,{children:t.jsxs(L,{allEntries:[],children:[t.jsx(k,{title:"Please Sign In"}),t.jsx("div",{style:{maxWidth:700,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:46,marginBottom:46},children:t.jsxs("div",{style:{textAlign:"center",marginTop:40},children:["We're sorry, you must be signed in to request locks.",t.jsx("br",{}),t.jsx("br",{}),t.jsx(B,{style:{color:"#fff"},children:t.jsx(N,{})})]})})]})}),t.jsx(A,{})]})}export{tt as default};
