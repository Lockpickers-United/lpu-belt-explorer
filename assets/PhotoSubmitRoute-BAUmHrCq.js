import{r as o,D as nt,d as it,u as U,j as t,B as k,T as rt,bC as lt,R as dt,e as ct,a9 as mt,N as pt}from"./index-Bm6m2Om2.js";import{I as xt}from"./IntroCopy-BDpK8sXP.js";import{u as ht}from"./usePageTitle-CP6r2KF4.js";import{L as ut}from"./LockEntrySearchBox-BSdX66cd.js";import{B as gt}from"./BeltIcon-CJkn0DTp.js";import{D as jt}from"./Dropzone-CPdcfzbh.js";import{L as ft}from"./LoadingDisplay-BhZwzRr1.js";import"./filterEntriesAdvanced-CXYqTsym.js";import{D as bt}from"./DataContext-CQjWI8HO.js";import"./index-Bwt0ZGG8.js";import{n as yt}from"./dataUrls-CThgH6Wi.js";import"./entryName-Bb_WhnLo.js";import{p as vt,c as kt}from"./postData-BppOjEZQ.js";import{C as Ct}from"./Checkbox-BVVIW1iS.js";import{C as St}from"./Collapse-_qN3GE2w.js";import{T as C}from"./TextField-7PMIoZcU.js";import{I as Lt,a as Nt}from"./ImageListItem-CUVKOTLt.js";import{D as S}from"./Dialog-BXQThPRj.js";import{D as It}from"./LockDataProvider-CUeWT0sP.js";import"./index-BAScVyHy.js";import"./index-0mjKNuJM.js";import"./index-Dpbz9CVq.js";import"./Search-CFwTqlBy.js";import"./useFormControl-DGEMYn-k.js";import"./Select-CJtr4w59.js";import"./BeltStripeMini-Bst9xgJs.js";import"./index-BtJyv6BG.js";import"./Cancel-DTcOOxzF.js";import"./LoadingDisplaySmall-pa3JuDWc.js";import"./Box-Dz36KBpD.js";import"./CircularProgress-Cd-H5Ut-.js";import"./index-xsH4HHeE.js";import"./SwitchBase-DBZz_6j0.js";import"./collectionStatsById-DY1NVZ7h.js";import"./useData-CA8i_qs9.js";import"./setDeep-J6HEwWhX.js";import"./stringUtils-BsiQ3MZ5.js";function Ft({profile:a,user:r}){const{allEntries:m}=o.useContext(bt),{updateProfileField:u}=o.useContext(nt),[s,x]=o.useState({}),[j,L]=o.useState(void 0),[d,f]=o.useState([]),[$,N]=o.useState(void 0),[I,b]=o.useState(!1),[c,F]=o.useState(void 0),[p,w]=o.useState(!1),[W,D]=o.useState(""),[z,B]=o.useState(""),[h,A]=o.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)||""),[y,E]=o.useState(!1),O=it().format("YYYYMMDD-HHMMss"),l=m.find(e=>e.id===(s==null?void 0:s.lockId)),_=!!(s!=null&&s.lockName)&&!!(s!=null&&s.lockId)&&!!h&&d.length>0,R=`${s.lockName}_${s.lockId}_`.replace("/","+"),T=`${h}`.replace("/","+"),M=d.map(e=>e.name),Y=o.useCallback((e,n)=>{f(e)},[]),H=d.length===1?"File":"Files",K=async e=>{e.preventDefault(),b(!0);const n=`${O}_${R}_${T}`,i=new FormData;d.forEach(g=>{const{base:v,ext:at}=wt(g.name);i.append("files",g,`${n}/${R}_${v}_${T}.${at}`)}),i.append("droppedFileNames",M),i.append("lockFullName",s.lockFullName),i.append("lockName",s.lockName),i.append("version",l==null?void 0:l.version),i.append("belt",l==null?void 0:l.belt),i.append("lockId",s.lockId),i.append("photoCredit",h),i.append("displayName",a==null?void 0:a.displayName),i.append("uploadsDir",n),i.append("notes",z);const et=`${yt}/upload`,ot=!0,st=3e4;try{N(await vt({user:r,url:et,formData:i,snackBars:ot,timeoutDuration:st})),q(h)}catch(g){F(kt(g)),x([]),d.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{b(!1)}},G=o.useCallback(e=>{x(e),L(m.find(n=>n.id===e.lockId))},[m]),q=o.useCallback(e=>{u("photoCredit",e)},[u]),J=o.useCallback(e=>{const{value:n}=e.target;A(n)},[]),Q=o.useCallback(e=>{const{value:n}=e.target;B(n)},[]),P=o.useCallback(()=>{x({}),L(void 0),d.forEach(e=>URL.revokeObjectURL(e.preview)),f([]),N(void 0),b(!1),F(void 0),w(!1),D(""),B(""),E(!y)},[d,y]),V=o.useCallback(()=>{w(!p),x([])},[p]),X=o.useCallback(e=>{const{value:n}=e.target;D(n),x({lockFullName:n,lockName:n,lockId:"NOTINLIST"})},[]),Z=p?.5:1,{flexStyle:tt}=U();return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:K,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"30px 0px 10px"},children:"Select Lock"}),t.jsx("div",{style:{opacity:Z},children:t.jsx(ut,{handleChangeLock:G,allEntries:m,disabled:p,reset:y})}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx(Ct,{onChange:V,color:"info",size:"small",id:"notInList",checked:p})," Submit photos for a lock not on the site."]}),t.jsxs(St,{in:p,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:W,style:{width:400},onChange:X,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:tt},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(jt,{files:d||[],otherFiles:[],handleDroppedFiles:Y,maxFiles:5,backgroundColor:"#333"}),j&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),j.media?t.jsx("div",{children:t.jsx(Lt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:j.media.map(e=>t.jsx(Nt,{children:t.jsx("img",{srcSet:`${e.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${e.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:e.title,loading:"lazy"})},e.thumbnailUrl))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),s.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex"},children:[s.lockId!=="NOTINLIST"&&t.jsx(gt,{value:l==null?void 0:l.belt,style:{marginBottom:-10}}),t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:s.lockFullName})]}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:h,style:{width:350},onChange:J,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:z,onChange:Q}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!_||I,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:I,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(ft,{})})}),t.jsx(S,{open:!!$&&!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[H," Uploaded Successfully!"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:P,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[c==null?void 0:c.message,t.jsx("br",{}),"(Error code ",c==null?void 0:c.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:P,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(rt,{feature:"uploadPhotos"})]})}function wt(a){const r=a.lastIndexOf(".");return r===-1?{base:a,ext:""}:{base:a.substring(0,r),ext:a.substring(r)}}function xe(){const{isMobile:a}=U(),{profile:r,user:m}=lt();ht("Contribute Photos");const u=t.jsx(dt.Fragment,{children:!a&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return t.jsx(ct,{children:t.jsxs(It,{allEntries:mt,profile:r,children:[t.jsx(pt,{title:"Contribute Photos",extras:u}),r&&!r.photoCredit&&t.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:t.jsx(xt,{pageName:"photoUpload",maxWidth:820})}),t.jsx(Ft,{profile:r,user:m})]})})}export{xe as default};
