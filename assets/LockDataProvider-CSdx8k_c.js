import{r,F as j,aw as I,al as S,d,az as v,ak as O,j as B}from"./index-D6MTDNWa.js";import{D as F,f as N}from"./DataContext-B8tAxZlA.js";import{r as x}from"./index-BuKlRDGE.js";import{c as P}from"./collectionStatsById-DY1NVZ7h.js";import{u as R}from"./useData-KjF_06Nn.js";import{h as w}from"./dataUrls-ZPc7x5xp.js";function Y({children:C,allEntries:c,profile:i}){const{filters:D}=r.useContext(j),{search:n,id:L,tab:V,name:W,sort:o,image:K,expandAll:b,...z}=D,{data:p,loading:k,error:h}=R({urls:E}),f=r.useMemo(()=>p&&!k&&!h?p.lockbazzarEntryIds:[],[p,h,k]),y=r.useMemo(()=>c.map(t=>{var s,u,l;return{...t,makes:t.makeModels[0].make?t.makeModels.map(({make:e})=>e):t.makeModels[0].model,fuzzy:x(t.makeModels.map(({make:e,model:a})=>[e,a]).flat().filter(e=>e).concat([t.version,t.notes,t.belt]).join(",")),content:[(s=t.media)!=null&&s.some(e=>!e.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(u=t.media)!=null&&u.some(e=>e.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((l=t.links)==null?void 0:l.length)>0?"Has Links":"No Links",S[t.belt].danPoints>0?"Worth Dan Points":void 0,d(t.lastUpdated).isAfter(d().subtract(1,"days"))?"Updated Recently":void 0,t.belt.startsWith("Black")?"Is Black":void 0,t.belt!=="Unranked"?"Is Ranked":void 0].flat().filter(e=>e),collection:I.locks.map.map(e=>i&&i[e.key]&&i[e.key].includes(t.id)?e.label:"Not "+e.label),collectionSaves:P[t.id]||0,simpleBelt:t.belt.replace(/\s\d/g,"")}}),[c,i]),A=r.useMemo(()=>{const t=Object.keys(z).map(e=>{const a=z[e];return Array.isArray(a)?a.map(m=>({key:e,value:m})):{key:e,value:a}}).flat(),s=y.filter(e=>t.every(({key:a,value:m})=>Array.isArray(e[a])?e[a].includes(m):e[a]===m)),u=n&&s.find(e=>e.id===n);let l=s;return u?l=[u]:n&&(l=N.go(x(n),s,{keys:H,threshold:-25e3}).map(e=>({...e.obj,score:e.score}))),o?l.sort((e,a)=>{if(o==="popularity")return a.collectionSaves-e.collectionSaves||a.views-e.views||e.fuzzy.localeCompare(a.fuzzy);if(o==="beltAscending")return v(e.belt,a.belt);if(o==="beltDescending")return O(e.belt,a.belt);if(o==="alphaAscending")return e.fuzzy.localeCompare(a.fuzzy);if(o==="alphaDescending")return a.fuzzy.localeCompare(e.fuzzy);if(o==="recentlyUpdated")return Math.floor(d(a.lastUpdated).valueOf()/3600)-Math.floor(d(e.lastUpdated).valueOf()/3600)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy);if(o==="dateAdded")return Math.floor(d(a.dateAdded).valueOf()/3600*24)-Math.floor(d(e.dateAdded).valueOf()/3600*24)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy)}):l},[z,y,n,o]),M=r.useCallback(t=>c.find(s=>s.id===t),[c]),g=r.useCallback(t=>f==null?void 0:f.includes(t),[f]),U=r.useMemo(()=>({allEntries:c,visibleEntries:A,getEntryFromId:M,expandAll:b,profile:i,lockbazzarAvailable:g}),[c,M,A,b,i,g]);return B.jsx(F.Provider,{value:U,children:C})}const H=["fuzzy"],E={lockbazzarEntryIds:w};export{Y as D};
