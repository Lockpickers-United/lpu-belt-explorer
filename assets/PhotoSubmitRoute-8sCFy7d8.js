import{r as o,D as at,d as nt,u as U,j as t,B as k,T as it,bB as rt,R as lt,e as dt,a9 as ct,N as mt}from"./index-Cgfn-mCc.js";import{I as pt}from"./IntroCopy-CqiianYj.js";import{u as xt}from"./usePageTitle-HXFpBaDE.js";import{L as ht}from"./LockEntrySearchBox-pla2kM8K.js";import{B as ut}from"./BeltIcon-DZjvVOy-.js";import{D as gt}from"./Dropzone-g1KPqjyn.js";import{L as jt}from"./LoadingDisplay-CTaY_75H.js";import{D as ft}from"./DataContext-bhTao4M0.js";import"./index-Cf-HLik8.js";import{n as yt}from"./dataUrls-DkJe4Pqg.js";import"./entryName-cppTej4X.js";import{p as bt,c as vt}from"./postData-BLdLRMKm.js";import{C as kt}from"./Checkbox-BHXDu0Ny.js";import{C as Ct}from"./Collapse-D79hPWqs.js";import{T as C}from"./TextField-SwR3dSuc.js";import{I as St,a as Lt}from"./ImageListItem-B_wW_rNR.js";import{D as S}from"./Dialog-CkgMmqAV.js";import{D as Nt}from"./LockDataProvider-DBZ54W9F.js";import"./index-DFf3B4-x.js";import"./index-Cr9LtMiW.js";import"./index-mLpEmo-C.js";import"./Search-BNZuVbKN.js";import"./useFormControl-CZVisSLC.js";import"./Select-C0T24sM3.js";import"./BeltStripeMini-DhalcTA0.js";import"./index-BWPP-DhC.js";import"./Cancel-CTa5zckb.js";import"./Box-cNlZz2mk.js";import"./CircularProgress-DAtJ7LuB.js";import"./index-xsH4HHeE.js";import"./SwitchBase-DVl58MBb.js";import"./collectionStatsById-DY1NVZ7h.js";import"./useData-p_x7laOI.js";import"./filterEntriesAdvanced-B_LinbMH.js";import"./setDeep-J6HEwWhX.js";import"./stringUtils-BsiQ3MZ5.js";function It({profile:a,user:r}){const{allEntries:m}=o.useContext(ft),{updateProfileField:u}=o.useContext(at),[s,x]=o.useState({}),[j,L]=o.useState(void 0),[d,f]=o.useState([]),[$,N]=o.useState(void 0),[I,y]=o.useState(!1),[c,w]=o.useState(void 0),[p,B]=o.useState(!1),[W,D]=o.useState(""),[F,R]=o.useState(""),[h,A]=o.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)||""),[b,E]=o.useState(!1),O=nt().format("YYYYMMDD-HHMMss"),l=m.find(e=>e.id===(s==null?void 0:s.lockId)),_=!!(s!=null&&s.lockName)&&!!(s!=null&&s.lockId)&&!!h&&d.length>0,z=`${s.lockName}_${s.lockId}_`.replace("/","+"),T=`${h}`.replace("/","+"),M=d.map(e=>e.name),Y=d.length===1?"File":"Files",H=async e=>{e.preventDefault(),y(!0);const n=`${O}_${z}_${T}`,i=new FormData;d.forEach(g=>{const{base:v,ext:st}=wt(g.name);i.append("files",g,`${n}/${z}_${v}_${T}.${st}`)}),i.append("droppedFileNames",M),i.append("lockFullName",s.lockFullName),i.append("lockName",s.lockName),i.append("version",l==null?void 0:l.version),i.append("belt",l==null?void 0:l.belt),i.append("lockId",s.lockId),i.append("photoCredit",h),i.append("displayName",a==null?void 0:a.displayName),i.append("uploadsDir",n),i.append("notes",F);const tt=`${yt}/upload`,et=!0,ot=3e4;try{N(await bt({user:r,url:tt,formData:i,snackBars:et,timeoutDuration:ot})),G(h)}catch(g){w(vt(g)),x([]),d.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{y(!1)}},K=o.useCallback(e=>{x(e),L(m.find(n=>n.id===e.lockId))},[m]),G=o.useCallback(e=>{u("photoCredit",e)},[u]),q=o.useCallback(e=>{const{value:n}=e.target;A(n)},[]),J=o.useCallback(e=>{const{value:n}=e.target;R(n)},[]),P=o.useCallback(()=>{x({}),L(void 0),d.forEach(e=>URL.revokeObjectURL(e.preview)),f([]),N(void 0),y(!1),w(void 0),B(!1),D(""),R(""),E(!b)},[d,b]),Q=o.useCallback(()=>{B(!p),x([])},[p]),V=o.useCallback(e=>{const{value:n}=e.target;D(n),x({lockFullName:n,lockName:n,lockId:"NOTINLIST"})},[]),X=p?.5:1,{flexStyle:Z}=U();return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:H,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"30px 0px 10px"},children:"Select Lock"}),t.jsx("div",{style:{opacity:X},children:t.jsx(ht,{handleChangeLock:K,allEntries:m,disabled:p,reset:b})}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx(kt,{onChange:Q,color:"info",size:"small",id:"notInList",checked:p})," Submit photos for a lock not on the site."]}),t.jsxs(Ct,{in:p,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:W,style:{width:400},onChange:V,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:Z},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(gt,{files:d,setFiles:f}),j&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),j.media?t.jsx("div",{children:t.jsx(St,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:j.media.map(e=>t.jsx(Lt,{children:t.jsx("img",{srcSet:`${e.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${e.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:e.title,loading:"lazy"})},e.thumbnailUrl))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),s.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex"},children:[s.lockId!=="NOTINLIST"&&t.jsx(ut,{value:l==null?void 0:l.belt,style:{marginBottom:-10}}),t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:s.lockFullName})]}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:h,style:{width:350},onChange:q,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:F,onChange:J}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!_||I,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:I,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(jt,{})})}),t.jsx(S,{open:!!$&&!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[Y," Uploaded Successfully!"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:P,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[c==null?void 0:c.message,t.jsx("br",{}),"(Error code ",c==null?void 0:c.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:P,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(it,{feature:"uploadPhotos"})]})}function wt(a){const r=a.lastIndexOf(".");return r===-1?{base:a,ext:""}:{base:a.substring(0,r),ext:a.substring(r)}}function me(){const{isMobile:a}=U(),{profile:r,user:m}=rt();xt("Contribute Photos");const u=t.jsx(lt.Fragment,{children:!a&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return t.jsx(dt,{children:t.jsxs(Nt,{allEntries:ct,profile:r,children:[t.jsx(mt,{title:"Contribute Photos",extras:u}),r&&!r.photoCredit&&t.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:t.jsx(pt,{pageName:"photoUpload",maxWidth:820})}),t.jsx(It,{profile:r,user:m})]})})}export{me as default};
