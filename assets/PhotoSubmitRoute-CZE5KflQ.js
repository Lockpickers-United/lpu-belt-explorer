import{r as o,D as nt,d as rt,u as U,j as t,B as k,T as lt,bC as dt,R as ct,e as mt,a8 as pt,N as xt}from"./index-D02rhWvO.js";import{I as ht}from"./IntroCopy-BGUUX03P.js";import{u as ut}from"./usePageTitle-YoGyojx1.js";import{L as gt}from"./LockEntrySearchBox-ChG-wuAW.js";import{B as jt}from"./BeltIcon-n0_F0mDU.js";import{D as ft}from"./Dropzone-B2eSrY2r.js";import{L as bt}from"./LoadingDisplay-BcF2dPGM.js";import"./filterEntriesAdvanced-t9HSPofx.js";import{D as yt}from"./DataContext-CFsNhElt.js";import"./index-HQ9teVFt.js";import{n as vt}from"./dataUrls-DVxTtpO-.js";import"./entryName-CSWFa3Vj.js";import{p as kt,c as Ct}from"./postData-D7k2jS9Y.js";import{C as St}from"./Checkbox-CZb0JsLv.js";import{C as Lt}from"./Collapse-DOwcrfGm.js";import{T as C}from"./TextField-DWVeRavV.js";import{I as Nt,a as It}from"./ImageListItem-DSjFXo3V.js";import{D as S}from"./Dialog-BusofdQb.js";import{D as wt}from"./LockDataProvider-DCPtz0H4.js";import"./index-oZFlLpR5.js";import"./index-Dr6oOMHm.js";import"./index-DOuS_NaK.js";import"./Search-DBDyM-Qu.js";import"./useFormControl-hn_DuAXX.js";import"./Select-BpAeeYBe.js";import"./BeltStripeMini-6-BvwFIk.js";import"./index-Ch_DjGT9.js";import"./Cancel-v6nwPjpK.js";import"./LoadingDisplaySmall-DwyvYB6i.js";import"./Box-BFTNTPY9.js";import"./CircularProgress-CAy03GOz.js";import"./index-B9ygI19o.js";import"./SwitchBase-Ci0zBUkY.js";import"./collectionStatsById-DY1NVZ7h.js";import"./useData-CUSynm9P.js";import"./setDeep-J6HEwWhX.js";import"./stringUtils-BsiQ3MZ5.js";function Ft({profile:a,user:r}){const{allEntries:m}=o.useContext(yt),{updateProfileField:u}=o.useContext(nt),[s,x]=o.useState({}),[j,L]=o.useState(void 0),[d,f]=o.useState([]),[$,N]=o.useState(void 0),[I,b]=o.useState(!1),[c,w]=o.useState(void 0),[p,F]=o.useState(!1),[W,B]=o.useState(""),[D,z]=o.useState(""),[h,A]=o.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)||""),[y,E]=o.useState(!1),O=rt().format("YYYYMMDD-HHMMss"),l=m.find(e=>e.id===(s==null?void 0:s.lockId)),_=!!(s!=null&&s.lockName)&&!!(s!=null&&s.lockId)&&!!h&&d.length>0,R=`${s.lockName}_${s.lockId}_`.replace("/","+"),P=`${h}`.replace("/","+"),M=d.map(e=>e.name),Y=o.useCallback((e,i)=>{f(e)},[]),H=d.length===1?"File":"Files",K=async e=>{e.preventDefault(),b(!0);const i=`${O}_${R}_${P}`,n=new FormData;d.forEach(g=>{const{base:v,ext:it}=Bt(g.name);n.append("files",g,`${i}/${R}_${v}_${P}.${it}`)}),n.append("droppedFileNames",M),n.append("lockFullName",s.lockFullName),n.append("lockName",s.lockName),n.append("version",l==null?void 0:l.version),n.append("belt",l==null?void 0:l.belt),n.append("lockId",s.lockId),n.append("photoCredit",h),n.append("displayName",a==null?void 0:a.displayName),n.append("uploadsDir",i),n.append("notes",D);const ot=`${vt}/upload`,st=!0,at=45e3;try{N(await kt({user:r,url:ot,formData:n,snackBars:st,timeoutDuration:at})),q(h)}catch(g){w(Ct(g)),x([]),d.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{b(!1)}},G=o.useCallback(e=>{x(e),L(m.find(i=>i.id===e.lockId))},[m]),q=o.useCallback(e=>{u("photoCredit",e)},[u]),J=o.useCallback(e=>{const{value:i}=e.target;A(i)},[]),Q=o.useCallback(e=>{const{value:i}=e.target;z(i)},[]),T=o.useCallback(()=>{x({}),L(void 0),d.forEach(e=>URL.revokeObjectURL(e.preview)),f([]),N(void 0),b(!1),w(void 0),F(!1),B(""),z(""),E(!y)},[d,y]),V=o.useCallback(()=>{F(!p),x([])},[p]),X=o.useCallback(e=>{const{value:i}=e.target;B(i),x({lockFullName:i,lockName:i,lockId:"NOTINLIST"})},[]),Z=p?.5:1,{flexStyle:tt,isMobile:et}=U();return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:K,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"30px 0px 10px"},children:"Select Lock"}),t.jsx("div",{style:{opacity:Z},children:t.jsx(gt,{handleChangeLock:G,allEntries:m,disabled:p,reset:y})}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx(St,{onChange:V,color:"info",size:"small",id:"notInList",checked:p})," Submit photos for a lock not on the site."]}),t.jsxs(Lt,{in:p,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:W,style:{width:400},onChange:X,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:tt},children:[t.jsxs("div",{style:{marginRight:50,marginBottom:20,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),et&&t.jsx("div",{style:{fontSize:"0.9rem",marginBottom:10,fontStyle:"italic"},children:"Previews may not appear on some mobile devices, but images will be uploaded."}),t.jsx(ft,{files:d||[],otherFiles:[],handleDroppedFiles:Y,maxFiles:5,backgroundColor:"#333"}),j&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),j.media?t.jsx("div",{children:t.jsx(Nt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:j.media.map(e=>t.jsx(It,{children:t.jsx("img",{srcSet:`${e.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${e.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:e.title,loading:"lazy"})},e.thumbnailUrl))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),s.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex"},children:[s.lockId!=="NOTINLIST"&&t.jsx(jt,{value:l==null?void 0:l.belt,style:{marginBottom:-10}}),t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:s.lockFullName})]}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:h,style:{width:350},onChange:J,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:D,onChange:Q}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!_||I,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:I,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(bt,{})})}),t.jsx(S,{open:!!$&&!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[H," Uploaded Successfully!"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:T,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[c==null?void 0:c.message,t.jsx("br",{}),"(Error code ",c==null?void 0:c.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:T,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(lt,{feature:"uploadPhotos"})]})}function Bt(a){const r=a.lastIndexOf(".");return r===-1?{base:a,ext:""}:{base:a.substring(0,r),ext:a.substring(r)}}function he(){const{isMobile:a}=U(),{profile:r,user:m}=dt();ut("Contribute Photos");const u=t.jsx(ct.Fragment,{children:!a&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return t.jsx(mt,{children:t.jsxs(wt,{allEntries:pt,profile:r,children:[t.jsx(xt,{title:"Contribute Photos",extras:u}),r&&!r.photoCredit&&t.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:t.jsx(ht,{pageName:"photoUpload",maxWidth:820})}),t.jsx(Ft,{profile:r,user:m})]})})}export{he as default};
