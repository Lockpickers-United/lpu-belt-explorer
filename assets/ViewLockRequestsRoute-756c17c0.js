import{r as s,K as M,j as e,J as P,I as Z,b9 as ue,R as T,ad as me,O as pe,P as he,$ as ge,B as q,A as ee,d as X,ag as xe,u as O,W as fe,F as je,D as ke,bA as ve,e as Se,N as Ce}from"./index-30fcc6e1.js";import{u as be}from"./usePageTitle-3cd921ea.js";import{F as E}from"./FieldValue-b9bb0c1f.js";import{L as ye}from"./LockImageGallery-39a323fb.js";import{e as te}from"./entryName-a27c4287.js";import{d as qe}from"./ExpandMore-49f8b4fd.js";import{D as _}from"./DataContext-1227a7de.js";import{d as we}from"./Link-07924034.js";import{a as $,S as Re,D as Be}from"./SubNav-f46932c6.js";import{r as Le,a as se}from"./rankingRequestData-d3ef79e5.js";import{B as Ee}from"./BeltStripe-503be4a6.js";import{d as Ae}from"./AddCircle-76c9a5a7.js";import{L as Te}from"./LoadingDisplayWhite-cf0c79a5.js";import{p as oe}from"./postData-493eae0b.js";import{D as V}from"./Dialog-7b6f6b54.js";import{T as A}from"./TextField-5d601a92.js";import{C as ze}from"./CopyEntryTextButton-07c8be2a.js";import{A as De,a as Ue,b as Ie}from"./AccordionSummary-7718edb3.js";import{A as Me}from"./AccordionActions-4429c521.js";import"./index-cfbfe6ba.js";import"./dataUrls-46e31bfb.js";import{S as Fe}from"./SearchBox-47bc3552.js";import{V as Ne}from"./ViewFilterButtons-bf0ab4b0.js";import{a as We}from"./sortFields-b1bde6f9.js";import{L as $e}from"./Link-7ac796e2.js";import{a as Ve}from"./filterFields-37f5ace1.js";import"./useDocumentTitle-c584eae0.js";import"./ImageGallery-cd60496e.js";import"./ImageViewer-7b9f1548.js";import"./Launch-c599b7dd.js";import"./LinearProgress-eb496019.js";import"./DialogContent-feecb8a2.js";import"./ImageListItem-ea54b590.js";import"./Select-f76f9549.js";import"./ToggleButtonGroup-8f6d768c.js";import"./CircularProgress-87834adf.js";import"./axios-3a665b0f.js";import"./ContentCopy-beb9a718.js";import"./Collapse-2707e2fd.js";import"./Search-3b17405c.js";import"./Sort-4d512d66.js";import"./Chip-4d8f6905.js";import"./FilterAlt-408e0e16.js";import"./Box-98c692f2.js";import"./LockListContext-039fe87f.js";import"./Cancel-8c541dc1.js";function Pe({entry:t,nameType:a}){const o=s.useCallback(async()=>{const d=te(t,a).replace(/[\s/]/g,"_").replace(/\W/g,""),n=`${window.location.origin}/#/rankingrequests/view?id=${t.id}&name=${d}`;await navigator.clipboard.writeText(n),M("Link copied to clipboard.")},[t,a]);return e.jsx(P,{title:"Copy Link to Request",arrow:!0,disableFocusListener:!0,children:e.jsx(Z,{onClick:o,children:e.jsx(we,{})})})}function Oe({requestMod:t,handleClick:a}){return t?e.jsx(P,{title:"Edit Request",arrow:!0,disableFocusListener:!0,children:e.jsx(Z,{onClick:a,style:{height:38,width:38,marginTop:"auto",marginBottom:"auto"},children:e.jsx(ue,{style:{height:20,width:20}})})}):null}function _e({entry:t,requestMod:a,form:o,setForm:l,setUpdated:d}){const[n,i]=s.useState(!1),m=me.filter(f=>!["Unranked","Project"].includes(f));s.useEffect(()=>{setTimeout(()=>{l({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt})},100)},[t,l]);const h=s.useCallback(f=>{const{name:g,value:x}=f.target;g==="requestStatus"&&x==="Ranked"?i(!0):g==="requestStatus"&&(i(!1),delete o.belt),l({...o,[g]:x}),d(!0)},[o,l,d]);return e.jsxs(T.Fragment,{children:[a&&e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Status"}),e.jsx($,{changeHandler:h,name:"requestStatus",form:{},optionsList:Le,multiple:!1,value:o.requestStatus||t.requestStatus,defaultValue:o.requestStatus||t.requestStatus,size:"small",width:200})]}),a&&(o.belt||n)&&e.jsx("div",{style:{marginTop:8},children:e.jsx($,{changeHandler:h,name:"belt",form:o,optionsList:m,multiple:!1,defaultValue:t.belt||"",size:"small",width:200,label:"belt"})})]})}var H={},He=he;Object.defineProperty(H,"__esModule",{value:!0});var ae=H.default=void 0,Ge=He(pe()),Ye=e;ae=H.default=(0,Ge.default)((0,Ye.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");function Je({user:t,entry:a}){const[o,l]=s.useState(!1),[d,n]=s.useState(!1),[i,m]=s.useState({}),[h,f]=s.useState(!1),{profile:g}=s.useContext(_),{requestedBy:x=[]}=a,p=x.find(u=>u.userId===t.uid&&u.owner)||!1,k=x.find(u=>u.userId===t.uid)||!1,w=x.length>1?x.length:"",r=x.length>1?"2px solid #444":"",S=p?"#999":"#fff",F=k?e.jsx(Ae,{fontSize:"small",style:{color:S}}):e.jsx(ae,{fontSize:"small"}),z=p?"You requested this lock":k?"Click to remove your vote":"Add Your Vote",N=p||o?"default":"pointer",C=s.useCallback(u=>{const{name:R,value:y}=u.target;m({...i,[R]:y}),f(i.discordUsername&&i.discordUsername.length>0||i.redditUsername&&i.redditUsername.length>0)},[i]),D=s.useCallback(u=>{u.preventDefault(),u.stopPropagation(),m({}),f(!1),n(!1)},[]),v=s.useCallback(async()=>{if(o)return;if(p){M("You requested this lock",{variant:"info",autoHideDuration:1e3});return}l(!0);const u={...i,entryId:a.id,owner:!1,userId:t.uid,displayName:g.displayName},R=`${se}/request-vote`,y=JSON.stringify({newVote:u});try{await oe({user:t,url:R,json:y,snackBars:!0})}catch(U){console.error("Error updating vote:",U)}finally{l(!1),m({}),f(!1),n(!1)}},[a.id,i,p,o,g.displayName,t]),b=s.useCallback(u=>{if(u.preventDefault(),u.stopPropagation(),!o){if(p){M("You requested this lock",{variant:"info",autoHideDuration:3e3});return}k?v().then():n(!0)}},[v,k,p,o]);return e.jsxs(T.Fragment,{children:[e.jsx(P,{title:z,arrow:!0,disableFocusListener:!0,children:o?e.jsx("div",{onClick:b,style:{padding:"4px 0px",marginTop:"auto",marginBottom:"auto",alignItems:"center",justifyContent:"right"},children:e.jsx(Te,{})}):e.jsx("div",{onClick:b,style:{border:r,borderRadius:18,padding:"4px 10px",marginTop:"auto",marginBottom:"auto",display:"flex",alignItems:"center",justifyContent:"right",fontWeight:600,cursor:N},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[w>1&&e.jsx("span",{style:{marginLeft:5,marginRight:7},children:w}),F]})})}),e.jsx(V,{open:d,onClose:D,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",maxWidth:340,padding:20},onClick:u=>u.stopPropagation(),children:[e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:10},children:"Upvote Request"}),e.jsx("div",{style:{marginBottom:20,fontSize:"0.95rem",lineHeight:"1.3rem"},children:"A lot of work goes into ranking locks, and we use these votes to prioritize which locks are considered. Please only vote for locks you are specifically interested in."}),e.jsxs("div",{style:{flexGrow:1},children:[e.jsxs("div",{style:{fontSize:"1.1rem"},children:["Notes ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(A,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",style:{},value:i.notes||"",maxLength:1200,id:"notes",onChange:C})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500},children:"Contact Info"}),e.jsxs("div",{style:{},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"Discord Username"}),e.jsx(A,{type:"text",name:"discordUsername",style:{width:200},onChange:C,value:i.discordUsername||"",color:"info",size:"small"})]}),e.jsxs("div",{style:{marginTop:5},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"AND/OR Reddit Username"}),e.jsx(A,{type:"text",name:"redditUsername",style:{width:200},onChange:C,value:i.redditUsername||"",color:"info",size:"small"})]})]}),e.jsxs("div",{style:{marginTop:15},children:[e.jsxs("div",{style:{fontSize:"1rem"},children:["Your current belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx($,{changeHandler:C,name:"userBelt",form:i,optionsList:["Unranked",...ge],multiple:!1,defaultValue:"",size:"small",width:200})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",marginTop:25},children:[e.jsx(q,{onClick:D,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:v,variant:"contained",color:"success",disabled:!h,children:"SAVE"})]})]})})]})}function Ke({upvote:t,voteNum:a}){const{notes:o,discordUsername:l,redditUsername:d,userBelt:n}=t,i=[l&&`@${l}`,d&&`u/${d.replace(/^\/*u\//,"")}`].filter(Boolean).join(" • "),m=n&&` (${n})`,h=(o==null?void 0:o.length)>0?`> ${o}`:"";return e.jsxs("div",{style:{marginBottom:10},children:[a+1,". ",e.jsx("strong",{children:i}),m," ",h]})}function Qe({entry:t,expanded:a,onExpand:o,requestMod:l}){var J,K;const{user:d}=s.useContext(ee),n=s.useRef(null),{expandAll:i}=s.useContext(_),[m,h]=s.useState(!1),[f,g]=s.useState(!1),[x,p]=s.useState(!1),[k,w]=s.useState(!1),[r,S]=s.useState({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt}),{requestedBy:F=[]}=t,z=F.filter(c=>!c.owner);s.useEffect(()=>{setTimeout(()=>{S({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt})},100)},[t,S]);const N=s.useCallback((c,j)=>{o&&o(j?t.id:!1)},[t.id,o]),C=s.useCallback(c=>{const{name:j,value:B}=c.target;S({...r,[j]:B}),w(!0)},[r]),D=s.useCallback(c=>{c.preventDefault(),c.stopPropagation(),g(!0)},[g]),v=s.useCallback(()=>{S({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt}),g(!1),p(!1)},[t]),b=s.useCallback(async c=>{var L,Q;const j=`${se}/update-request`,B=JSON.stringify({entry:c});try{await oe({user:d,url:j,json:B,snackBars:!1})}catch(W){console.error("Error updating vote:",W);let ce=((Q=(L=W.response)==null?void 0:L.data)==null?void 0:Q.message)||W.message;M(`Error updating request: ${ce}`,{variant:"error",autoHideDuration:3e3})}finally{v()}},[v,d]),u=s.useCallback(async()=>{const c={...t.originalEntry,requestStatus:"Deleted",lastUpdated:X().toISOString()};await b(c)},[t.originalEntry,b]),R=s.useCallback(async()=>{if(!k)return;r.requestStatus==="Deleted"&&p(!0);const c={...t.originalEntry,makeModels:[{make:r.make,model:r.model}],requestStatus:r.requestStatus||t.requestStatus,belt:r.belt||t.belt,lastUpdated:X().toISOString()};["Ranked","Deleted"].includes(c.requestStatus)||delete c.belt,r.requestStatus==="Deleted"?p(!0):await b(c)},[t,r,b,k]),y=s.useCallback(()=>{p(!1)},[p]);s.useEffect(()=>{if(a&&n&&!m&&!i){const j=window.innerWidth<=600?70:74,{id:B}=xe.parse(location.search),L=B===t.id;h(!0),setTimeout(()=>{window.scrollTo({left:0,top:n.current.offsetTop-j,behavior:L?"auto":"smooth"})},L?0:100)}else a||h(!1)},[a,t,m,i]);const{discord:U,reddit:G}=t.usernames||{},ie=[U&&`@${U}`,G&&`u/${G.replace(/^\/*u\//,"")}`].filter(Boolean).join(" • "),le=t.userBelt?` (${t.userBelt})`:"",ne=t.belt&&t.belt!=="Unranked"?` (${t.belt})`:"",re=!r.make||r.model.length<1||r.requestStatus==="Ranked"&&!r.belt,de={maxWidth:700,marginLeft:"auto",marginRight:"auto"},{flexStyle:I}=O(),Y=t.requestStatus==="Declined"?.5:1;return e.jsxs(T.Fragment,{children:[e.jsxs(De,{expanded:a,onChange:N,style:de,ref:n,children:[e.jsxs(Ue,{expandIcon:e.jsx(qe,{}),style:{cursor:"pointer"},children:[e.jsx(Ee,{value:t.belt}),e.jsx("div",{style:{display:I,width:"100%",alignItems:"center",opacity:Y},children:e.jsxs("div",{style:{display:I,width:"100%",alignItems:"center",opacity:Y},children:[e.jsx(fe,{primary:te(t),primaryTypographyProps:{fontWeight:500,fontSize:"1.1rem"},secondary:t.lockingMechanisms.join(", "),secondaryTypographyProps:{fontSize:"0.9rem"},style:{padding:"0px 0px 0px 10px"}}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"right",marginRight:10},children:t.requestStatus!=="Submitted"&&e.jsxs("span",{children:[t.requestStatus,ne]})})]})}),e.jsx(Je,{user:d,entry:t}),e.jsx(Oe,{handleClick:D,requestMod:l})]}),a&&e.jsxs(Ie,{sx:{padding:"0px 16px 0px 16px"},children:[e.jsx("div",{style:{display:I,width:"100%"},children:!!((J=t.notes)!=null&&J.length)&&e.jsx(E,{name:"Notes",value:t.notes,style:{marginRight:20}})}),e.jsxs("div",{style:{display:I,width:"100%",marginTop:15},children:[e.jsx(E,{name:"Requested By",value:ie+le,style:{marginRight:30},headerStyle:{color:"#aaa",fontSize:"0.9rem"}}),!!t.approximateBelt&&e.jsx(E,{name:"Suggested Belt",value:`${t.approximateBelt} Belt`,style:{marginRight:30},headerStyle:{color:"#aaa",fontSize:"0.9rem"}}),!!t.hazLocc&&e.jsx(E,{name:"Has Lock(s)",value:t.hazLocc,style:{marginRight:0},headerStyle:{color:"#aaa",fontSize:"0.9rem"}})]}),!!((K=t.media)!=null&&K.length)&&e.jsx("div",{style:{marginLeft:6},children:e.jsx(ye,{entry:t})}),z.length>0&&l&&e.jsx(E,{name:"Upvotes",style:{marginRight:20,marginTop:10},headerStyle:{color:"#bbb",fontSize:"1rem"},value:z.map((c,j)=>e.jsx(Ke,{upvote:c,voteNum:j},c.userId))}),e.jsxs(Me,{children:[e.jsx(ze,{entry:t}),e.jsx(Pe,{entry:t})]})]})]}),e.jsx(V,{open:f,onClose:v,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:30},children:[e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Edit Request",e.jsx("br",{})]}),e.jsx("div",{style:{marginTop:0},children:e.jsx(_e,{entry:t,requestMod:l,form:r,setForm:S,setShowEditRequest:g,setUpdated:w})}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Brand"}),e.jsx(A,{type:"text",name:"make",size:"small",style:{width:200},color:"info",onChange:C,value:r.make||"",error:r.make.length===0})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Model Name"}),e.jsx(A,{type:"text",name:"model",size:"small",style:{width:200},color:"info",onChange:C,value:r.model||"",error:r.model.length===0})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:[e.jsx(q,{onClick:v,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:R,variant:"contained",color:"success",disabled:re||!k,children:"SAVE"})]})]})}),e.jsx(V,{open:x,onClose:y,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.5}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Are you sure you want to delete?",e.jsx("br",{}),"Action cannot be undone.",e.jsx("br",{})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center"},children:[e.jsx(q,{onClick:y,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:u,variant:"contained",color:"error",children:"DELETE"})]})]})})]})}function Xe({label:t,sortValues:a,resetAll:o}){const{isMobile:l}=O(),d=l?"block":"flex",n=l?{maxWidth:700,marginLeft:"auto",marginRight:"auto",padding:8}:{maxWidth:700,marginLeft:"auto",marginRight:"auto",padding:12};return e.jsxs("div",{style:{display:d,...n,backgroundColor:"#333",minHeight:72},children:[e.jsx("div",{style:{display:"flex",flexGrow:1,marginLeft:8},children:e.jsx(Fe,{label:t,keepOpen:!0})}),!!a&&e.jsx("div",{style:{margin:"12px 20px 0px 20px"},children:e.jsx(Ne,{sortValues:a,resetAll:o})})]})}function Ze({requestMod:t}){const{visibleEntries:a=[],expandAll:o}=s.useContext(_),{filters:l}=s.useContext(je),[d,n]=s.useState(l.id),i=s.useMemo(()=>[{label:"Request a Lock",page:"/rankingrequests/submit"},{label:"View Requests",page:"/rankingrequests/view"}],[]);return e.jsxs(T.Fragment,{children:[e.jsx(Re,{options:i,defaultValue:i[1].label}),e.jsxs("div",{style:{maxWidth:720,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t&&e.jsx("div",{style:{textAlign:"right",marginRight:7,marginBottom:5},children:e.jsx($e,{onClick:()=>console.log("visibleEntries",a),style:{color:"#444",cursor:"pointer",marginLeft:10},children:"LOG"})}),e.jsx(Xe,{sortValues:We,label:"Lock Requests",resetAll:!0}),a.map((m,h)=>e.jsx(Qe,{entry:m,expanded:m.id===d||!!o,onExpand:n,requestMod:t},h))]})]})}function Ht(){be("View Lock Requests");const{user:t,userClaims:a}=s.useContext(ee),{lockCollection:o}=s.useContext(ke),l=["requestAdmin","admin"].some(m=>a.includes(m)),{isMobile:d}=O(),n=ve(),i=e.jsx(T.Fragment,{children:!d&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(Se,{filterFields:Ve,children:e.jsxs(Be,{allEntries:n,profile:o,children:[e.jsx(Ce,{title:"View Lock Requests",extras:i}),e.jsx(Ze,{user:t,requestMod:l})]})})}export{Ht as default};
