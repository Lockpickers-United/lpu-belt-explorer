import{u as U,b as q,r,g as F,d as _,j as e,B as G,R as z,A as V,D as J,S as K,c as Q,N as X,e as u,T as L,F as Z}from"./index-11d041f4.js";import{c as $}from"./dataUrls-d878baa3.js";import{D as ee,F as te,a as oe,s as ne}from"./filterFields-f690bdd7.js";import{S as re,a as ie,b as ae}from"./ScorecardListContext-5333bf91.js";import{L as de}from"./LoadingDisplay-0ede1744.js";import{u as I}from"./useData-f4514d82.js";import{S as M}from"./ScorecardRow-e69e8b67.js";import"./index-57146f77.js";import{u as se}from"./usePageTitle-1eabeccb.js";import{L as W}from"./Link-b91a2de8.js";import{L as le,A as ce}from"./BeltIcon-6d34b5f2.js";function f({profile:o,importResults:i,service:a}){var P;se("Import Results");const{isMobile:c}=U(),j=q(),{cardActivity:v=[]}=r.useContext(ee),y=r.useMemo(()=>{const t=a==="Reddit"?/reddit.com/i:/discord.com/i;return v.filter(s=>s.collectionDB==="awards"&&t.test(s.link)).map(s=>({...s,...F(s.matchId)}))},[v,a]),d=i!=null&&i.awards?(P=i==null?void 0:i.awards)==null?void 0:P.map(t=>({...t,...F(t.matchId),date:_(t.awardedAt).format()})).sort((t,s)=>_(s.date).valueOf()-_(t.date).valueOf()):[],k=d.reduce((t,s)=>(t[s.matchId]=s,t),{}),x=y.filter(t=>!k[t.matchId]),C=x.length>0?"new ":"",{expanded:g}=r.useContext(re),{filters:m,removeFilters:w}=r.useContext(te),[l,A]=r.useState(g);g&&g!==l&&A(g);const n=r.useCallback(()=>{window.location=window.location.origin+"/#/profile/scorecard"},[]),b=r.useCallback(()=>{j("/profile/edit")},[j]),D=r.useCallback(t=>{m.id&&w(["id"]),A(t)},[m,w]),h=c?"block":"flex";return e.jsxs("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:[e.jsxs("div",{style:{display:h,padding:"16px 16px"},children:[e.jsxs("div",{style:{fontSize:"1.5rem",flexGrow:1},children:[a," Import Results"]}),e.jsx("div",{style:{padding:16},children:e.jsx(G,{variant:"contained",color:"secondary",style:{lineHeight:"1.2rem"},onClick:()=>n(),children:"VIEW SCORECARD"})})]}),e.jsxs("div",{style:{fontSize:"1rem",padding:"0px 16px"},children:[d.length>0&&e.jsxs("strong",{children:["Congratulations ",i.username,"! "]}),"Here are your rankings from ",a,".",e.jsx("div",{style:{height:8}}),a==="Discord"&&e.jsxs("span",{children:["Your approved rankings will be updated automatically as long as you have your Discord username in your Profile. You can remove it at any time in ",e.jsx(W,{onClick:()=>b(),style:{color:"#d9d9ff"},children:"Edit Profile"}),". If you have more than one Discord username, please run the import under both names to get all of your rankings."]}),a==="Reddit"&&e.jsxs("span",{children:["You'll need to import again to pick up new belts once they have been approved and you've been flagged on Reddit. We save your username and it will never be shown to other users. You can remove it at any time in ",e.jsx(W,{onClick:()=>b(),style:{color:"#d9d9ff"},children:"Edit Profile"}),"."]}),e.jsx("div",{style:{margin:"20px 0px"},children:"If you have an approved belt that is not showing up here, reach out to us in #belt-explorer on the LPU Discord server for help. Mods and #belt-requests are a different team who won't be able to help."}),e.jsx("div",{style:{height:16}})]}),e.jsx("div",{style:{height:8,backgroundColor:"#000"}}),e.jsxs(z.Fragment,{children:[(d==null?void 0:d.length)===0&&e.jsxs("div",{style:{padding:16,fontWeight:700,fontSize:"1.2rem"},children:["No ",C,"approved belts found"]}),(d==null?void 0:d.length)>0&&e.jsxs("div",{children:[a==="Reddit"&&e.jsx("div",{style:{padding:16,fontWeight:700,fontSize:"1.2rem"},children:"New Belts"}),d==null?void 0:d.map(t=>e.jsx(M,{owner:!0,activity:t,expanded:t.id===l,onExpand:D,merged:o.blackBeltAwardedAt>0},t.id))]}),e.jsx("div",{style:{height:8,backgroundColor:"#000"}}),x.length>0&&e.jsxs("div",{style:{},children:[e.jsx("div",{style:{padding:16,fontWeight:700,fontSize:"1.2rem"},children:"Existing Belts"}),x==null?void 0:x.map(t=>e.jsx(M,{owner:!0,activity:t,expanded:t.id===l,onExpand:D,merged:o.blackBeltAwardedAt>0},t.id))]})]})]})}function Ce({syncStatus:o,syncResult:i,service:a}){const{user:c}=r.useContext(V),{getProfile:j}=r.useContext(J),{scoredActivity:v,bbCount:y,danPoints:d,eligibleDan:k,nextDanPoints:x,nextDanLocks:C}=r.useContext(K),{getMessageById:g}=r.useContext(Q),[m,w]=r.useState(!1),l=r.useCallback(()=>{w(!m)},[m]),A=r.useCallback(async()=>{try{return{profile:c!=null&&c.uid?await j(c==null?void 0:c.uid):{},scoredActivity:v,bbCount:y,danPoints:d,eligibleDan:k,nextDanPoints:x,nextDanLocks:C}}catch(B){return console.error("Error loading profile and activity.",B),null}},[m,j,c,v,y,d,k,x,C]),{data:n={},loading:b,error:D}=I({loadFn:A}),h=n?n.profile:{},P=n?n.scoredActivity:[],t=n?n.bbCount:0,s=n?n.danPoints:0,N=n?n.eligibleDan:0,R=n?n.nextDanPoints:0,S=n?n.nextDanLocks:0,E=I({url:$}),T=E.data?E.data.scorecardLocks:[],Y=null,p=g({none_found:"none_found",access_denied:"access_denied",token_failed:"token_failed",data_failed:"data_failed",token_expired:"token_expired",debug_download:"debug_download"}[[o]]),O=e.jsx(z.Fragment,{children:e.jsx("br",{})}),H=b?"Loading...":"Profile";return b||D?null:e.jsx(oe,{filterFields:ne,children:e.jsx(ie,{cardActivity:P,cardBBCount:t,cardDanPoints:s,cardEligibleDan:N,cardNextDanPoints:R,cardNextDanLocks:S,popularLocks:T,children:e.jsxs(ae,{children:[e.jsxs(le,{adapterLocale:_.locale(),dateAdapter:ce,children:[e.jsx(X,{title:H,extras:Y}),!o&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(de,{}),"Please wait, this may take a minute or so.",e.jsx("br",{}),e.jsx("br",{})]}),o==="debug_download"&&e.jsxs("div",{style:{maxWidth:500,padding:40,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16,textAlign:"center"},children:[e.jsx("strong",{children:"Your Reddit modmail has been downloaded!"}),e.jsx("br",{}),e.jsx("br",{}),"Please send the ",e.jsx("strong",{children:"reddit-modmail-debug.json"})," file to your friendly LPU Belts developers so they can help fix the problem we are debugging."]}),o==="complete"&&e.jsx(f,{profile:h,adminAction:l,importResults:i,syncStatus:o,service:a}),o==="debug_download"&&e.jsx(u,{override:p}),o==="token_expired"&&e.jsxs("div",{children:[e.jsx(u,{override:p}),e.jsx(f,{profile:h,adminAction:l,importResults:i,syncStatus:o,service:a})]}),o==="token_failed"&&e.jsxs("div",{children:[e.jsx(u,{override:p}),e.jsx(f,{profile:h,adminAction:l,importResults:i,syncStatus:o,service:a}),e.jsx(L,{feature:"authError-token_failed"})]}),o==="access_denied"&&e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx(u,{override:p}),e.jsx(f,{profile:h,adminAction:l,importResults:i,syncStatus:o,service:a}),e.jsx(L,{feature:"authError-access_denied"})]}),o==="none_found"&&e.jsxs("div",{style:{textAlign:"left"},children:[e.jsx(u,{override:p}),e.jsx(f,{profile:h,adminAction:l,importResults:i,syncStatus:o,service:a})]}),o==="data_failed"&&e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(u,{override:p}),e.jsx(f,{profile:h,adminAction:l,importResults:i,syncStatus:o,service:a}),e.jsx(L,{feature:"authError-data_failed"})]}),e.jsx(Z,{extras:O})]}),e.jsx(L,{feature:"importPreview"})]})})})}export{Ce as I};
