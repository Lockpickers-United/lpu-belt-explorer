import{r as n,j as e,T as ve,I as ee,al as he,am as me,Z as v,an as Y,aj as Te,N as Ae,R as I,a4 as Fe,x as W,w as ke,ao as ze,a2 as Oe,C as Pe,D as Re,ap as Ne,a9 as ae,p as re,af as G,K as te,t as A,$ as Me,v as _,a0 as be,a5 as We,a7 as He,a8 as Ue,aq as $e,M as Ce,y as Q,z as Z,A as X,ar as _e,as as Ge,O as Ve,P as qe,Q as Je}from"./index-1b2542bd.js";import{u as Ke}from"./useData-64e52a67.js";import{e as R,F as V,r as ue,f as Ye,D as H,B as Se,a as Qe,s as Ze}from"./BeltStripe-3d6bf984.js";import{b as ie,d as Xe,S as et,a as tt,s as st,F as nt}from"./sortFields-df8d6bb8.js";import{S as ot,E as Ee,d as at,L as De,A as we,D as it}from"./CollectionButton-b296861a.js";import{d as rt}from"./Link-158b41bb.js";import{u as N}from"./useWindowSize-c786a3ce.js";import{A as le,a as ce,b as de}from"./Sort-8f1389dd.js";import{L as P}from"./Link-4c6ac2de.js";import{p as lt}from"./chartDefaults-9fc07b21.js";import{B as ct}from"./nivo-bar.es-817c0e35.js";import{L as Ie,B as dt}from"./LoadingDisplay-a73e0d77.js";import{T as xt}from"./TextField-ded70b83.js";import{m as pt,P as ht,a as mt}from"./ProfileHeader-56e0b68f.js";import{I as ut}from"./IntroCopy-ce33a5bb.js";import{L as gt}from"./LoadingDisplay-3e676d0b.js";import{d as ge,a as fe,b as ft,c as jt}from"./download-2bcf1f85.js";import"./Select-b876243b.js";import"./Search-89f1c824.js";import"./PhotoCamera-2f417095.js";import"./Dialog-3970fb28.js";import"./Autocomplete-4a702033.js";import"./index-8c917f53.js";import"./ListItem-3c1c1a3f.js";import"./nivo-legends.es-bfa9af08.js";import"./CopyProfileLinkButton-136688f1.js";import"./ToggleButtonGroup-187a7c54.js";import"./LPU-c3fa7122.js";import"./LinearProgress-b447abf1.js";function yt({entry:a}){const i=R(a).replace(/[\s/]/g,"_").replace(/\W/g,""),p=n.useCallback(s=>{s.preventDefault(),s.stopPropagation();const d=`${window.location.origin}/#/locks?id=${a.id}&name=${i}`,m=window.open(d,"_blank","noopener,noreferrer");m&&(m.opener=null)},[a.id,i]);return e.jsx(ve,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(ee,{onClick:p,children:e.jsx(rt,{style:{width:18,height:18}})})})}function vt({children:a,cardEvidence:t,cardBBCount:i,cardDanPoints:p,cardEligibleDan:s,cardNextDanPoints:d,cardNextDanLocks:m}){const{filters:u}=n.useContext(V),{search:g,id:j,tab:b,name:x,sort:f,image:C,...o}=u,r=n.useMemo(()=>t.map(h=>{const S=he(h.matchId),E=me(h.matchId);return{...S,...h,...E,id:h.id}}),[t]),y=n.useMemo(()=>r.map(h=>{var S,E,c;return{...h,makes:(S=h==null?void 0:h.makeModels)==null?void 0:S.map(({make:l})=>l),fuzzy:ue(((E=h==null?void 0:h.makeModels)==null?void 0:E.map(({make:l,model:B})=>[l,B]).flat().filter(l=>l).concat([h.version,h.notes,h.belt]).join(","))+" "),documentation:[h.exceptionType==="badlink"?"Bad Link":"Valid Link",h.date?"Valid Date":"No Date"],scoring:[h.exceptionType==="nomatch"?"Unmatched":h.exceptionType==="badlink"?"Bad Link":h.exceptionType==="duplicate"?"Duplicate":h.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(h.belt)?"Low Level":"Worth Points"],simpleBelt:(c=h==null?void 0:h.belt)==null?void 0:c.replace(/\s\d/g,"")}}),[r]),k=n.useMemo(()=>{const h=Object.keys(o).map(c=>{const l=o[c];return Array.isArray(l)?l.map(B=>({key:c,value:B})):{key:c,value:l}}).flat(),S=y.filter(c=>h.every(({key:l,value:B})=>Array.isArray(c[l])?c[l].includes(B):c[l]===B)),E=g?Ye.go(ue(g),S,{keys:kt,threshold:-25e3}).map(c=>({...c.obj,score:c.score})):S;return f?E.sort((c,l)=>{if(f==="danPointsAscending")return c.points-l.points||v(l.date).valueOf()-v(c.date).valueOf();if(f==="danPointsDescending")return l.points-c.points||v(l.date).valueOf()-v(c.date).valueOf();if(f==="dateAscending")return v(c.date).valueOf()-v(l.date).valueOf()||Y(c.simpleBelt,l.simpleBelt);if(f==="dateDescending")return v(l.date).valueOf()-v(c.date).valueOf()||Y(c.simpleBelt,l.simpleBelt);if(f==="beltAscending")return Te(c.belt,l.belt)||v(l.date).valueOf()-v(c.date).valueOf();if(f==="beltDescending")return Y(c.belt,l.belt)||v(l.date).valueOf()-v(c.date).valueOf();if(f==="alphaAscending")return c.fuzzy.localeCompare(l.fuzzy)||l.points-c.points;if(f==="alphaDescending")return l.fuzzy.localeCompare(c.fuzzy)||l.points-c.points}):E.sort((c,l)=>v(l.date).valueOf()-v(c.date).valueOf()||Y(c.belt,l.belt)||c.fuzzy.localeCompare(l.fuzzy))},[o,y,g,f]),w=n.useMemo(()=>({allEntries:Ae,cardEvidence:t,cardBBCount:i,cardDanPoints:p,cardEligibleDan:s,cardNextDanPoints:d,cardNextDanLocks:m,visibleEntries:k,getEntryFromId:he,getProjectEntryFromId:me}),[t,i,p,s,d,m,k]);return e.jsx(H.Provider,{value:w,children:a})}const kt=["fuzzy"];function bt({owner:a,evid:t,expanded:i,onExpand:p,merged:s}){const{setFilters:d}=n.useContext(V),{cardEvidence:m,getEntryFromId:u,getProjectEntryFromId:g}=n.useContext(H),j=u(t.matchId),b=g(t.matchId),x=j||b,[f,C]=n.useState(!1),o=n.useRef(null);n.useEffect(()=>{if(i&&o&&!f){const D=window.innerWidth<=600?70:74,{id:$}=Fe.parse(location.search),pe=$===t.id;C(!0),setTimeout(()=>{window.scrollTo({left:0,top:o.current.offsetTop-D,behavior:pe?"auto":"smooth"})},pe?0:100)}else i||C(!1)},[i,x,f,t.id]);let r=x?R(x):t.evidenceNotes;const y=t.exceptionType&&t.evidenceNotes.toLowerCase()!==r.toLowerCase()?t.evidenceNotes:null;r=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:r,r=t.exceptionType&&a&&s?r+" *":r;const k=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,w=t.exceptionId,h=w?m.find(O=>O.id===w):{},S=h?n.useMemo(()=>u(h.matchId),[u,h.matchId]):{},E=S?R(S,"short"):"",c=w?e.jsx(P,{style:{color:"#99c2e5"},onClick:()=>{B(w)},children:E}):null;let l=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"You must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const B=n.useCallback(O=>{d({id:O})},[d]),U=t.points===1?"pt":"pts";let T=t.date?v(t.date).format("L"):"(no date)";T=T.replace("/202","/2"),T=T.replace("/201","/1");const M=t.date?"#fff":"#aaa",L=n.useCallback((O,D)=>{a&&p(D?t.id:!1)},[t.id,p,a]),z=a?{}:{cursor:"default"},se=a?e.jsx(ke,{}):null,{isMobile:F}=N(),ne=F?"block":"flex",oe=F?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},q=F?"65%":"56%",J=F?"-2px 0px 3px 0px":"1px 0px 3px 0px",K={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(le,{expanded:i,onChange:L,ref:o,children:[e.jsxs(ce,{expandIcon:se,style:{...K,...z},children:[e.jsx(Se,{value:x?x.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:q,flexShrink:0,flexDirection:"column",opacity:k},children:[e.jsx(ie,{value:r,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!y&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:y}),!!x&&!!(x!=null&&x.version)&&e.jsx(ie,{name:"Version",value:e.jsx(W,{style:{fontSize:"0.95rem",lineHeight:1.25},children:x==null?void 0:x.version}),textStyle:(x==null?void 0:x.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:ne,placeItems:"center",marginLeft:10,opacity:k},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:j&&e.jsx(yt,{entry:j})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(ot,{url:t.link,handleChange:L,exceptionType:t.exceptionType,owner:a})})]}),e.jsxs("div",{style:oe,children:[e.jsx("div",{style:{margin:J,color:M,width:90,textAlign:"center"},children:T}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:U})]})})]})]})]}),i&&e.jsx(I.Fragment,{children:e.jsxs(de,{sx:{padding:"4px 16px 0px 26px"},children:[(l||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),l&&e.jsxs("span",{children:["* ",l," ",c]})]}),e.jsx(Ee,{evid:t,handleUpdate:()=>{}})]})})]},t.id)}const Ct=I.memo(bt,(a,t)=>{const i=Object.keys(a.evid),p=Object.keys(t.evid);if(i.length!==p.length)return!1;for(let s=0;s<i.length;s++)if(i[s]!==p[s]||a.evid[i[s]]!==t.evid[p[s]])return!1;return a.owner===t.owner&&a.expanded===t.expanded&&a.onExpand===t.onExpand&&a.merged===t.merged}),Le=I.createContext({});function St({children:a}){const{filters:t,addFilters:i,removeFilters:p}=n.useContext(V),s=t.id,d=n.useCallback(u=>{u?i([{key:"id",value:u}],!0):p(["id"])},[i,p]),m=n.useMemo(()=>({expanded:s,setExpanded:d}),[s,d]);return e.jsx(Le.Provider,{value:m,children:a})}function Et({beltData:a}){const{width:t}=N(),i=t<=560,p=i?190:175,s=i?-90:-45,d=i?{top:0,right:0,bottom:80,left:15}:{top:0,right:0,bottom:60,left:15},m=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#3e3e3e","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c"],u=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#aaa","#000","#000","#000","#000","#000","#000"];return e.jsx("div",{style:{height:p,padding:"0px 0px 0px 0px",width:"100%"},children:e.jsx(ct,{data:a,margin:d,padding:.15,colors:g=>m[g.index%m.length],animate:!0,axisBottom:{tickRotation:s},axisLeft:null,enableGridY:!1,theme:lt,isInteractive:!1,enableLabel:!0,label:g=>g.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:g=>u[g.index%u.length]})},"bar")}function je({entries:a}){const t=n.useMemo(()=>{const i=a.map(({belt:s})=>(s&&s.includes("Project"),s)).reduce((s,d)=>(s[d]||(s[d]=0),s[d]++,s),{});i.Project=a.reduce((s,d)=>d.simpleBelt==="Project"?s+1:s,0);let p=i.Project>0?ze:Oe;return i.Unranked||(p=p.filter(s=>s!=="Unranked")),p.map(s=>({id:s,label:s,count:i[s]||0,value:i[s]||0}))},[a]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(Et,{beltData:t})})}var xe={},Dt=Re;Object.defineProperty(xe,"__esModule",{value:!0});var Be=xe.default=void 0,wt=Dt(Pe()),It=e;Be=xe.default=(0,wt.default)((0,It.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function Lt(){const{setFilters:a}=n.useContext(V),{cardEvidence:t,getEntryFromId:i}=n.useContext(H),[p,s]=n.useState(!1),d=n.useCallback(()=>{s(!0)},[]),m=n.useCallback(()=>{s(!1)},[]),u=n.useCallback(o=>{a({id:o}),s(!1)},[a]),g=t.map(o=>{const r=o.exceptionId,y=r?t.find(E=>E.id===r):{},k=y?i(y.matchId):{},w=k?R(k,"short"):"",h=o.matchId?i(o.matchId):null,S=h?R(h,"short"):"";return{...o,supersedingEntryId:r,supersedingLockName:w,matchLockName:S}}),j=g.filter(o=>o.exceptionType==="nomatch"),b=g.filter(o=>o.exceptionType==="badlink"),x=g.filter(o=>o.exceptionType==="duplicate"),f=g.filter(o=>o.exceptionType==="upgraded");if(j.length+b.length+x.length+f.length>0)return e.jsxs(I.Fragment,{children:[e.jsx(ee,{onClick:d,style:{marginRight:0},children:e.jsx(Be,{fontSize:"small"})}),e.jsx(Ne,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:o=>o.zIndex.drawer+1},open:p,onClick:m,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(ee,{onClick:m,children:e.jsx(at,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),j.length>0&&e.jsxs(I.Fragment,{children:[e.jsx(ae,{style:{marginBottom:20}}),e.jsx(W,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:j.map((o,r)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(P,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.id)},children:o.evidenceNotes})},r))})]}),b.length>0&&e.jsxs(I.Fragment,{children:[e.jsx(W,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:b.map((o,r)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(P,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.id)},children:o.matchLockName})},r))})]}),x.length>0&&e.jsxs(I.Fragment,{children:[e.jsx(W,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:x.map((o,r)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is a duplicate of ",e.jsx(P,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.supersedingEntryId)},children:o.supersedingLockName})]},r))})]}),f.length>0&&e.jsxs(I.Fragment,{children:[e.jsx(W,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:f.map((o,r)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is upgraded by ",e.jsx(P,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.supersedingEntryId)},children:o.supersedingLockName})]},r))})]})]})})]})}function ye(){const{cardDanPoints:a,cardBBCount:t,cardEligibleDan:i,cardNextDanPoints:p,cardNextDanLocks:s}=n.useContext(H),d=re(),m=n.useCallback(()=>{d("/profile/scorecard/upgrades")},[d]);return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:["Eligible for Dan ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:i})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:a})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:t})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[p," point",p!==1&&"s"," and ",s," BB lock",s!==1&&"s"," to next Dan"]}),e.jsx("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:e.jsx(P,{onClick:m,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(Lt,{})})]})}function Bt({setControlsExpanded:a,adminAction:t}){const{userId:i}=G(),{importUnclaimedEvidence:p}=n.useContext(te),{isMobile:s}=N(),[d,m]=n.useState(!1),u=re(),[g,j]=n.useState(""),[b,x]=n.useState(null),f=n.useCallback(async()=>{m(!0);const o=await p(i,g);m(!1),o?(j(""),a(!1),t()):x("Cannot find dan sheet tab")},[p,i,g,a,t]),C=s?"block":"flex";return e.jsx(I.Fragment,{children:e.jsx("div",{style:{placeItems:"center",display:C},children:d?e.jsx(Ie,{}):e.jsx(I.Fragment,{children:e.jsxs("div",{style:{padding:20},children:[e.jsx("strong",{children:"For Black Belt pickers only."}),e.jsx("br",{}),"Black Belt pickers currently use another scorecard system known as the Dan Sheet. This import allows them to bring their picking history over to the site. If you do not already have a tab in the Dan sheet, this import will not work for you. For those that do, specify the name of your tab in the sheet to import your history into your Scorecard. Please note that tab names are case sensitive. ",e.jsx(P,{onClick:()=>{u("/profile/scorecard/howto")},style:{color:"#bbb",cursor:"pointer"},children:"Click here to learn more."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("div",{style:{padding:"0px",alignItems:"center"},children:e.jsxs("div",{style:{padding:"0px",display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(xt,{id:"tab-to-import",label:"Tab to Import",value:g,size:"small",error:!!b,helperText:b,margin:"dense",color:"secondary",onChange:o=>{j(o.target.value)}}),e.jsx(A,{style:{color:"#000",padding:0,lineHeight:"1rem",height:40,marginTop:8,marginLeft:10},variant:"contained",onClick:f,edge:"start",color:"secondary",children:"Import"})]})})]})})})})}v.extend(Me);function Tt({owner:a,date:t}){const{userId:i}=G(),{updateProfileBlackBeltAwardedAt:p}=n.useContext(te),[s,d]=n.useState(!1),[m,u]=n.useState(!1),[g,j]=n.useState(v.utc(t)),b=n.useCallback((l,B)=>{a&&d(B)},[a]),x=n.useCallback(()=>{j(v.utc(t)),u(!1)},[t]),f=n.useCallback(async()=>{try{p(i,g),_("Profile updated"),u(!1)}catch(l){console.error("Error while updating profile",l),_("Error while updating profile")}},[i,g,p]);let C=t?v.utc(t).format("L"):"(no date)";C=C.replace("/202","/2"),C=C.replace("/201","/1");const o={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"},r=a?{}:{cursor:"default"},y=a?e.jsx(ke,{}):null,{isMobile:k}=N(),w=k?"block":"flex",h=k?"65%":"56%",S=k?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},E=m?"#fff":"#555",c=m?"#e15c07":"#555";return e.jsxs(I.Fragment,{children:[e.jsxs(le,{expanded:s,onChange:b,children:[e.jsxs(ce,{expandIcon:y,style:{...o,...r},children:[e.jsx(Se,{value:"Black"}),e.jsx("div",{style:{margin:"4px 0px 0px 8px",width:h,flexShrink:0,flexDirection:"column"},children:e.jsx(ie,{value:"Black Belt Awarded",textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}})}),e.jsxs("div",{style:{display:w,placeItems:"center",marginLeft:10},children:[e.jsx("div",{style:{display:"flex",width:76}}),e.jsx("div",{style:S,children:e.jsx("div",{style:{margin:"4px 0px 0px 10px"},children:C})})]})]}),s&&e.jsx(de,{sx:{padding:"4px 16px 0px 26px"},children:e.jsx(De,{adapterLocale:v.locale(),dateAdapter:we,children:e.jsx(I.Fragment,{children:e.jsxs("div",{style:{display:"flex",width:"100%",marginBottom:20},children:[e.jsx(it,{label:"Awarded date",value:g,onChange:l=>{j(l),u(!0)},sx:{width:400},disableFuture:!0}),e.jsxs("div",{style:{width:"100%",textAlign:"right",position:"relative",top:"30px",padding:"0px 12px 8px 0px"},children:[e.jsx(A,{style:{marginRight:10,color:c},onClick:x,disabled:!m,children:"Cancel"}),e.jsx(A,{style:{marginRight:0,color:E},onClick:f,disabled:!m,children:"Save"})]})]})})})})]}),e.jsx(ae,{}),e.jsx(ae,{})]})}function At({collectionType:a}){const{user:t}=n.useContext(be),{userId:i}=G(),p=re(),{isMobile:s}=N(),d=s?{marginTop:20,maxWidth:700,marginLeft:8,marginRight:8,borderRadius:0}:{marginTop:20,maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},m=i===(t==null?void 0:t.uid),u=m?e.jsx("div",{style:{width:"100%",display:"flex",placeItems:"center"},children:e.jsxs("div",{style:{fontSize:"1.0rem",fontWeight:400,width:400,marginLeft:"auto",marginRight:"auto"},children:[e.jsx("strong",{children:"There are no locks in your Scorecard."}),e.jsx("br",{}),'Browse the site and use the "My Collection" button to track locks that you have picked and recorded.',e.jsx("br",{}),e.jsx("br",{}),e.jsx("img",{alt:"My Collection",src:pt})]})}):"There are no locks in this collection.",g=m?a==="safelocks"?"Explore Safe Locks":"Explore Locks":"Go Home",j=n.useCallback(()=>{p(a==="safelocks"?"/safelocks":"/locks")},[p,a]);return e.jsx(dt,{alignContent:"center",children:e.jsxs(We,{style:d,children:[e.jsx(He,{children:e.jsx(W,{variant:"h6",align:"center",children:u})}),e.jsxs(Ue,{children:[e.jsx("div",{style:{width:"100%"}}),e.jsx(A,{variant:"outlined",color:"secondary",onClick:j,style:{whiteSpace:"nowrap",padding:"10px 30px",margin:10},children:g})]})]})})}function Ft({owner:a,profile:t,adminAction:i}){const{isMobile:p}=N(),{userId:s}=G(),{visibleEntries:d=[],cardEvidence:m}=n.useContext(H),{expanded:u}=n.useContext(Le),{filters:g,removeFilters:j}=n.useContext(V),{createEvidenceForEntries:b,removeEvidence:x,removeProfileBlackBeltAwarded:f,updateUserStatistics:C}=n.useContext(te),{admin:o}=n.useContext($e),[r,y]=n.useState(u),[k,w]=n.useState(!1),[h,S]=n.useState("import"),[E,c]=n.useState(!1);u&&u!==r&&y(u);const l=n.useMemo(()=>{if(t&&t.recorded){const D=m.map($=>$.matchId);return t.recorded.filter($=>!D.includes($))}else return[]},[t,m]),B=n.useCallback(D=>{g.id&&j(["id"]),y(D)},[g,j]),U=n.useCallback(async()=>{c(!0),await b(s,l),w(!1),c(!1),i()},[b,s,l,i]),T=n.useCallback(D=>{S(D),w(!k)},[k]),[M,L]=n.useState(null),z=!!M,se=n.useCallback(D=>{D.preventDefault(),D.stopPropagation(),L(D.currentTarget)},[]),F=n.useCallback(()=>L(null),[]),ne=n.useCallback(async()=>{c(!0),await C(s),c(!1)},[C,s]),oe=n.useCallback(async()=>{c(!0),await x(m),await f(s),F(),c(!1),i()},[m,x,F,i,f,s]),q=p?10:40,J=p?"block":"flex",K=(t==null?void 0:t.blackBeltAwardedAt)>0,O=K?"100%":"50%";return e.jsxs("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:[e.jsx(ht,{profile:t,page:"scorecard"}),a&&d.length>0&&!t.tabClaimed&&e.jsx("div",{style:{margin:8,padding:"0px 0px"},children:e.jsx(ut,{pageName:"scorecard"})}),d.length>0&&e.jsx(I.Fragment,{children:p?e.jsxs("div",{style:{display:J,padding:"0px 8px 0px 16px"},children:[t.danLevel>0&&e.jsx(ye,{}),e.jsx("div",{style:{marginRight:0,width:"95%"},children:e.jsx(je,{profile:t,entries:d})})]}):e.jsxs("div",{style:{display:J,padding:"10px 8px 0px 16px"},children:[e.jsx("div",{style:{marginRight:0,width:380},children:e.jsx(je,{profile:t,entries:d})}),t.danLevel>0&&e.jsx("div",{style:{flexGrow:1,marginRight:0},children:e.jsx(ye,{})})]})}),(a||o)&&e.jsxs(le,{expanded:k,disableGutters:!0,children:[e.jsx(ce,{style:{paddingLeft:q,paddingRight:q,placeItems:"center",width:"100%"},children:e.jsxs("div",{style:{width:"100%",placeItems:"center",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",width:"100%",placeItems:"center",textAlign:"center"},children:[!K&&e.jsx("div",{style:{width:"50%",textAlign:"center"},children:e.jsx(A,{variant:"contained",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:O,textAlign:"center"},children:e.jsx(A,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("project"),children:k&&h==="project"?"CANCEL ADD PROJECT":"ADD PROJECT"})})]}),E&&e.jsx(Ie,{}),o&&!E&&e.jsx("div",{style:{backgroundColor:"#700",padding:5,marginTop:20},children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{width:"10%",textAlign:"center"},children:"admin"}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:ne,children:"UPDATE STATS"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsxs(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:U,children:["MERGE RECORDED (",l.length,")"]})}),e.jsxs("div",{style:{width:"20%",textAlign:"center"},children:[e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:se,children:"DELETE SCORECARD"}),e.jsxs(Ce,{anchorEl:M,open:z,onClose:F,children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["You cannot undo delete.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:oe,edge:"start",color:"error",children:"Delete"})})]})]})]})})]})}),e.jsxs(de,{style:{backgroundColor:"#333"},children:[h==="import"&&e.jsx(Bt,{setControlsExpanded:w,adminAction:i}),h==="project"&&e.jsx(Ee,{evid:null,handleUpdate:T,addProject:!0})]})]}),d.length===0&&e.jsx(At,{}),t&&t.blackBeltAwardedAt&&e.jsx(Tt,{owner:a,date:t.blackBeltAwardedAt.toDate().toJSON()}),e.jsx("div",{children:d.map(D=>e.jsx(Ct,{owner:a,evid:D,expanded:D.id===r,onExpand:B,merged:t.blackBeltAwardedAt>0},D.id))})]})}function zt(){const[a,t]=n.useState(null),i=!!a,p=n.useCallback(j=>t(j.currentTarget),[]),s=n.useCallback(()=>t(null),[]),{visibleEntries:d=[]}=n.useContext(H),m=n.useCallback(()=>{const j=JSON.stringify(d);s(),ge("scorecardData.json",j),_("Current Scorecard entries downloaded as scorecardData.json")},[s,d]),u=n.useCallback(()=>{const b=d.map(x=>({id:x.id,make:x.makeModels.map(f=>f.make).join(","),model:x.makeModels.map(f=>f.model).join(","),version:x.version,belt:x.belt,name:R(x),versionText:x.version?" ("+x.version+")":""})).map(x=>"* "+x.name+x.versionText).join(`
`);s(),navigator.clipboard.writeText(b),_("Current scorecard entries copied to clipboard.")},[s,d]),g=n.useCallback(()=>{const j=["id","name","version","belt","modifier","points","date","link"],b=d.map(o=>({id:o.matchId,make:o.makeModels.map(r=>r.make).join(","),model:o.makeModels.map(r=>r.model).join(","),version:o.version,belt:o.belt,link:o.link,modifier:o.modifier,points:o.points,date:o.date?v(o.date).format("L"):"",name:R(o)})),x=j.join(","),f=b.map(o=>j.map(r=>o[r]).map(r=>{const y=`${r??""}`.replace(/"/g,'""');return/(\s|,|")/.test(y)?`"${y}"`:y}).join(",")).join(`
`),C=`${x}
${f}`;s(),ge("scorecardData.csv",C),_("Current Scorecard entries downloaded as scorecardData.csv")},[s,d]);return e.jsxs(I.Fragment,{children:[e.jsx(ve,{title:"Export",arrow:!0,disableFocusListener:!0,children:e.jsx(ee,{onClick:p,children:e.jsx(fe,{})})}),e.jsxs(Ce,{anchorEl:a,open:i,onClose:s,children:[e.jsxs(Q,{disabled:!0,children:[e.jsx(Z,{children:e.jsx(fe,{fontSize:"small"})}),e.jsx(X,{children:"Export"})]}),e.jsxs(Q,{onClick:u,children:[e.jsx(Z,{children:e.jsx(Xe,{fontSize:"small"})}),e.jsx(X,{children:"Copy to clipboard"})]}),e.jsxs(Q,{onClick:g,children:[e.jsx(Z,{children:e.jsx(ft,{fontSize:"small"})}),e.jsx(X,{children:"CSV"})]}),e.jsxs(Q,{onClick:m,children:[e.jsx(Z,{children:e.jsx(jt,{fontSize:"small"})}),e.jsx(X,{children:"JSON"})]})]})]})}function ds(){const{userId:a}=G(),{user:t}=n.useContext(be),{getProfile:i,getEvidence:p}=n.useContext(te),{scoredEvidence:s,bbCount:d,danPoints:m,eligibleDan:u,nextDanPoints:g,nextDanLocks:j}=n.useContext(_e),{isMobile:b}=N(),[x,f]=n.useState(!1),C=n.useCallback(()=>{f(!x)},[x]),o=n.useCallback(async()=>{try{const L=await i(a);if(L){const z=L.displayName?L.displayName.toLowerCase().endsWith("s")?`${L.displayName}'`:`${L.displayName}'s`:"Anonymous";document.title=`LPU Belt Explorer - ${z} Scorecard`}if((t==null?void 0:t.uid)!==a){const z=await p(a);return{profile:L,...Ge(z)}}else return{profile:L,scoredEvidence:s,bbCount:d,danPoints:m,eligibleDan:u,nextDanPoints:g,nextDanLocks:j}}catch(L){return console.error("Error loading profile and evidence.",L),null}},[x,t,a,i,p,s,d,m,u,g,j]),{data:r={},loading:y,error:k}=Ke({loadFn:o}),w=r?r.profile:{},h=r?r.scoredEvidence:[],S=r?r.bbCount:0,E=r?r.danPoints:0,c=r?r.eligibleDan:0,l=r?r.nextDanPoints:0,B=r?r.nextDanLocks:0,U=e.jsxs(I.Fragment,{children:[e.jsx(et,{label:"Scorecard",extraFilters:[{key:"tab",value:"search"}]}),e.jsx(tt,{sortValues:st}),e.jsx(nt,{extraFilters:[{key:"tab",value:"search"}]}),!b&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})]}),T=e.jsxs(I.Fragment,{children:[e.jsx("br",{}),e.jsx(zt,{})]}),M=y?"Loading...":"Profile";return y||k?null:e.jsx(Qe,{filterFields:Ze,children:e.jsx(vt,{cardEvidence:h,cardBBCount:S,cardDanPoints:E,cardEligibleDan:c,cardNextDanPoints:l,cardNextDanLocks:B,children:e.jsxs(St,{children:[e.jsxs(De,{adapterLocale:v.locale(),dateAdapter:we,children:[e.jsx(Ve,{title:M,extras:U}),y&&e.jsx(gt,{}),!y&&r&&!k&&e.jsx(Ft,{owner:t&&t.uid===a,profile:w,adminAction:C}),!y&&(!r||k)&&e.jsx(mt,{}),e.jsx(qe,{extras:T})]}),e.jsx(Je,{feature:"scorecard"})]})})})}export{ds as default};
