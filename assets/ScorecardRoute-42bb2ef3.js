import{r as n,j as e,T as Se,I as ee,al as ce,am as de,Z as v,an as K,aj as De,N as Ee,R as B,a4 as we,x as N,w as me,ao as Le,a2 as Ie,y as Be,z as Te,ap as Ae,a9 as te,p as se,af as U,K as Y,t as A,$ as Fe,v as xe,a0 as ge,a5 as ze,a7 as Pe,a8 as Re,aq as Oe,M as Ne,ar as Me,as as We,O as He,P as Ue,Q as _e}from"./index-22f4ff74.js";import{u as $e}from"./useData-e5a5215d.js";import{e as H,F as _,r as pe,f as Ge,D as $,B as fe,a as qe,s as Ve}from"./BeltStripe-7a56a6b6.js";import{b as ne,S as Ke,a as Ye,s as Je,F as Qe}from"./sortFields-838d8259.js";import{S as Ze,E as ye,d as Xe,L as je,A as ve,D as et}from"./CollectionButton-e3b41548.js";import{d as tt}from"./Link-9efc20fc.js";import{u as O}from"./useWindowSize-f8498853.js";import{A as ie,a as ae,b as oe}from"./Sort-d78959f8.js";import{L as R}from"./Link-a1b6ecb9.js";import{p as nt}from"./chartDefaults-9fc07b21.js";import{B as st}from"./nivo-bar.es-c1999992.js";import{L as ke,B as it}from"./LoadingDisplay-cabbd2c7.js";import{T as at}from"./TextField-3f1c141f.js";import{m as ot,P as rt,a as lt}from"./ProfileHeader-5c58bd3f.js";import{I as ct}from"./IntroCopy-eb05dee0.js";import{L as dt}from"./LoadingDisplay-351dc61a.js";import"./Select-3399bee0.js";import"./Search-77cf39d7.js";import"./PhotoCamera-541f6a9f.js";import"./Dialog-bcedaa5e.js";import"./Autocomplete-fdf4bc89.js";import"./index-c3c7e55d.js";import"./ListItem-f4992511.js";import"./nivo-legends.es-296b74e3.js";import"./CopyProfileLinkButton-2983e61f.js";import"./ToggleButtonGroup-49eee1dd.js";import"./LPU-c3fa7122.js";import"./LinearProgress-81d16038.js";function xt({entry:i}){const a=H(i).replace(/[\s/]/g,"_").replace(/\W/g,""),d=n.useCallback(s=>{s.preventDefault(),s.stopPropagation();const p=`${window.location.origin}/#/locks?id=${i.id}&name=${a}`,h=window.open(p,"_blank","noopener,noreferrer");h&&(h.opener=null)},[i.id,a]);return e.jsx(Se,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(ee,{onClick:d,children:e.jsx(tt,{style:{width:18,height:18}})})})}function pt({children:i,cardEvidence:t,cardBBCount:a,cardDanPoints:d,cardEligibleDan:s,cardNextDanPoints:p,cardNextDanLocks:h}){const{filters:u}=n.useContext(_),{search:m,id:y,tab:E,name:g,sort:f,image:S,...o}=u,c=n.useMemo(()=>t.map(x=>{const b=ce(x.matchId),C=de(x.matchId);return{...b,...x,...C,id:x.id}}),[t]),k=n.useMemo(()=>c.map(x=>{var b,C,l;return{...x,makes:(b=x==null?void 0:x.makeModels)==null?void 0:b.map(({make:r})=>r),fuzzy:pe(((C=x==null?void 0:x.makeModels)==null?void 0:C.map(({make:r,model:L})=>[r,L]).flat().filter(r=>r).concat([x.version,x.notes,x.belt]).join(","))+" "),documentation:[x.exceptionType==="badlink"?"Bad Link":"Valid Link",x.date?"Valid Date":"No Date"],scoring:[x.exceptionType==="nomatch"?"Unmatched":x.exceptionType==="badlink"?"Bad Link":x.exceptionType==="duplicate"?"Duplicate":x.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(x.belt)?"Low Level":"Worth Points"],simpleBelt:(l=x==null?void 0:x.belt)==null?void 0:l.replace(/\s\d/g,"")}}),[c]),j=n.useMemo(()=>{const x=Object.keys(o).map(l=>{const r=o[l];return Array.isArray(r)?r.map(L=>({key:l,value:L})):{key:l,value:r}}).flat(),b=k.filter(l=>x.every(({key:r,value:L})=>Array.isArray(l[r])?l[r].includes(L):l[r]===L)),C=m?Ge.go(pe(m),b,{keys:ht,threshold:-25e3}).map(l=>({...l.obj,score:l.score})):b;return f?C.sort((l,r)=>{if(f==="danPointsAscending")return l.points-r.points||v(r.date).valueOf()-v(l.date).valueOf();if(f==="danPointsDescending")return r.points-l.points||v(r.date).valueOf()-v(l.date).valueOf();if(f==="dateAscending")return v(l.date).valueOf()-v(r.date).valueOf()||K(l.simpleBelt,r.simpleBelt);if(f==="dateDescending")return v(r.date).valueOf()-v(l.date).valueOf()||K(l.simpleBelt,r.simpleBelt);if(f==="beltAscending")return De(l.belt,r.belt)||v(r.date).valueOf()-v(l.date).valueOf();if(f==="beltDescending")return K(l.belt,r.belt)||v(r.date).valueOf()-v(l.date).valueOf();if(f==="alphaAscending")return l.fuzzy.localeCompare(r.fuzzy)||r.points-l.points;if(f==="alphaDescending")return r.fuzzy.localeCompare(l.fuzzy)||r.points-l.points}):C.sort((l,r)=>v(r.date).valueOf()-v(l.date).valueOf()||K(l.belt,r.belt)||l.fuzzy.localeCompare(r.fuzzy))},[o,k,m,f]),w=n.useMemo(()=>({allEntries:Ee,cardEvidence:t,cardBBCount:a,cardDanPoints:d,cardEligibleDan:s,cardNextDanPoints:p,cardNextDanLocks:h,visibleEntries:j,getEntryFromId:ce,getProjectEntryFromId:de}),[t,a,d,s,p,h,j]);return e.jsx($.Provider,{value:w,children:i})}const ht=["fuzzy"];function ut({owner:i,evid:t,expanded:a,onExpand:d,merged:s}){const{setFilters:p}=n.useContext(_),{cardEvidence:h,getEntryFromId:u,getProjectEntryFromId:m}=n.useContext($),y=u(t.matchId),E=m(t.matchId),g=y||E,[f,S]=n.useState(!1),o=n.useRef(null);n.useEffect(()=>{if(a&&o&&!f){const D=window.innerWidth<=600?70:74,{id:W}=we.parse(location.search),le=W===t.id;S(!0),setTimeout(()=>{window.scrollTo({left:0,top:o.current.offsetTop-D,behavior:le?"auto":"smooth"})},le?0:100)}else a||S(!1)},[a,g,f,t.id]);let c=g?H(g):t.evidenceNotes;const k=t.exceptionType&&t.evidenceNotes.toLowerCase()!==c.toLowerCase()?t.evidenceNotes:null;c=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:c,c=t.exceptionType&&i&&s?c+" *":c;const j=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,w=t.exceptionId,x=w?h.find(P=>P.id===w):{},b=x?n.useMemo(()=>u(x.matchId),[u,x.matchId]):{},C=b?H(b,"short"):"",l=w?e.jsx(R,{style:{color:"#99c2e5"},onClick:()=>{L(w)},children:C}):null;let r=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"You must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const L=n.useCallback(P=>{p({id:P})},[p]),M=t.points===1?"pt":"pts";let T=t.date?v(t.date).format("L"):"(no date)";T=T.replace("/202","/2"),T=T.replace("/201","/1");const I=t.date?"#fff":"#aaa",F=n.useCallback((P,D)=>{i&&d(D?t.id:!1)},[t.id,d,i]),J=i?{}:{cursor:"default"},Q=i?e.jsx(me,{}):null,{isMobile:z}=O(),Z=z?"block":"flex",X=z?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},G=z?"65%":"56%",q=z?"-2px 0px 3px 0px":"1px 0px 3px 0px",V={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(ie,{expanded:a,onChange:F,ref:o,children:[e.jsxs(ae,{expandIcon:Q,style:{...V,...J},children:[e.jsx(fe,{value:g?g.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:G,flexShrink:0,flexDirection:"column",opacity:j},children:[e.jsx(ne,{value:c,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!k&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:k}),!!g&&!!(g!=null&&g.version)&&e.jsx(ne,{name:"Version",value:e.jsx(N,{style:{fontSize:"0.95rem",lineHeight:1.25},children:g==null?void 0:g.version}),textStyle:(g==null?void 0:g.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:Z,placeItems:"center",marginLeft:10,opacity:j},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:y&&e.jsx(xt,{entry:y})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(Ze,{url:t.link,handleChange:F,exceptionType:t.exceptionType,owner:i})})]}),e.jsxs("div",{style:X,children:[e.jsx("div",{style:{margin:q,color:I,width:90,textAlign:"center"},children:T}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:M})]})})]})]})]}),a&&e.jsx(B.Fragment,{children:e.jsxs(oe,{sx:{padding:"4px 16px 0px 26px"},children:[(r||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),r&&e.jsxs("span",{children:["* ",r," ",l]})]}),e.jsx(ye,{evid:t,handleUpdate:()=>{}})]})})]},t.id)}const mt=B.memo(ut,(i,t)=>{const a=Object.keys(i.evid),d=Object.keys(t.evid);if(a.length!==d.length)return!1;for(let s=0;s<a.length;s++)if(a[s]!==d[s]||i.evid[a[s]]!==t.evid[d[s]])return!1;return i.owner===t.owner&&i.expanded===t.expanded&&i.onExpand===t.onExpand&&i.merged===t.merged}),be=B.createContext({});function gt({children:i}){const{filters:t,addFilters:a,removeFilters:d}=n.useContext(_),s=t.id,p=n.useCallback(u=>{u?a([{key:"id",value:u}],!0):d(["id"])},[a,d]),h=n.useMemo(()=>({expanded:s,setExpanded:p}),[s,p]);return e.jsx(be.Provider,{value:h,children:i})}function ft({beltData:i}){const{width:t}=O(),a=t<=560,d=a?190:175,s=a?-90:-45,p=a?{top:0,right:0,bottom:80,left:15}:{top:0,right:0,bottom:60,left:15},h=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#3e3e3e","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c"],u=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#aaa","#000","#000","#000","#000","#000","#000"];return e.jsx("div",{style:{height:d,padding:"0px 0px 0px 0px",width:"100%"},children:e.jsx(st,{data:i,margin:p,padding:.15,colors:m=>h[m.index%h.length],animate:!0,axisBottom:{tickRotation:s},axisLeft:null,enableGridY:!1,theme:nt,isInteractive:!1,enableLabel:!0,label:m=>m.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:m=>u[m.index%u.length]})},"bar")}function he({entries:i}){const t=n.useMemo(()=>{const a=i.map(({belt:s})=>(s&&s.includes("Project"),s)).reduce((s,p)=>(s[p]||(s[p]=0),s[p]++,s),{});a.Project=i.reduce((s,p)=>p.simpleBelt==="Project"?s+1:s,0);let d=a.Project>0?Le:Ie;return a.Unranked||(d=d.filter(s=>s!=="Unranked")),d.map(s=>({id:s,label:s,count:a[s]||0,value:a[s]||0}))},[i]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(ft,{beltData:t})})}var re={},yt=Te;Object.defineProperty(re,"__esModule",{value:!0});var Ce=re.default=void 0,jt=yt(Be()),vt=e;Ce=re.default=(0,jt.default)((0,vt.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function kt(){const{setFilters:i}=n.useContext(_),{cardEvidence:t,getEntryFromId:a}=n.useContext($),[d,s]=n.useState(!1),p=n.useCallback(()=>{s(!0)},[]),h=n.useCallback(()=>{s(!1)},[]),u=n.useCallback(o=>{i({id:o}),s(!1)},[i]),m=t.map(o=>{const c=o.exceptionId,k=c?t.find(C=>C.id===c):{},j=k?a(k.matchId):{},w=j?H(j,"short"):"",x=o.matchId?a(o.matchId):null,b=x?H(x,"short"):"";return{...o,supersedingEntryId:c,supersedingLockName:w,matchLockName:b}}),y=m.filter(o=>o.exceptionType==="nomatch"),E=m.filter(o=>o.exceptionType==="badlink"),g=m.filter(o=>o.exceptionType==="duplicate"),f=m.filter(o=>o.exceptionType==="upgraded");if(y.length+E.length+g.length+f.length>0)return e.jsxs(B.Fragment,{children:[e.jsx(ee,{onClick:p,style:{marginRight:0},children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(Ae,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:o=>o.zIndex.drawer+1},open:d,onClick:h,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(ee,{onClick:h,children:e.jsx(Xe,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),y.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(te,{style:{marginBottom:20}}),e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:y.map((o,c)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(R,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.id)},children:o.evidenceNotes})},c))})]}),E.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:E.map((o,c)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(R,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.id)},children:o.matchLockName})},c))})]}),g.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:g.map((o,c)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is a duplicate of ",e.jsx(R,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.supersedingEntryId)},children:o.supersedingLockName})]},c))})]}),f.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(N,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:f.map((o,c)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is upgraded by ",e.jsx(R,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{u(o.supersedingEntryId)},children:o.supersedingLockName})]},c))})]})]})})]})}function ue(){const{cardDanPoints:i,cardBBCount:t,cardEligibleDan:a,cardNextDanPoints:d,cardNextDanLocks:s}=n.useContext($),p=se(),h=n.useCallback(()=>{p("/profile/scorecard/upgrades")},[p]);return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:["Eligible for Dan ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:a})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:i})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:t})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[d," point",d!==1&&"s"," and ",s," BB lock",s!==1&&"s"," to next Dan"]}),e.jsx("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:e.jsx(R,{onClick:h,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(kt,{})})]})}function bt({setControlsExpanded:i,adminAction:t}){const{userId:a}=U(),{importUnclaimedEvidence:d}=n.useContext(Y),{isMobile:s}=O(),[p,h]=n.useState(!1),u=se(),[m,y]=n.useState(""),[E,g]=n.useState(null),f=n.useCallback(async()=>{h(!0);const o=await d(a,m);h(!1),o?(y(""),i(!1),t()):g("Cannot find dan sheet tab")},[d,a,m,i,t]),S=s?"block":"flex";return e.jsx(B.Fragment,{children:e.jsx("div",{style:{placeItems:"center",display:S},children:p?e.jsx(ke,{}):e.jsx(B.Fragment,{children:e.jsxs("div",{style:{padding:20},children:[e.jsx("strong",{children:"For Black Belt pickers only."}),e.jsx("br",{}),"Black Belt pickers currently use another scorecard system known as the Dan Sheet. This import allows them to bring their picking history over to the site. If you do not already have a tab in the Dan sheet, this import will not work for you. For those that do, specify the name of your tab in the sheet to import your history into your Scorecard. Please note that tab names are case sensitive. ",e.jsx(R,{onClick:()=>{u("/profile/scorecard/howto")},style:{color:"#bbb",cursor:"pointer"},children:"Click here to learn more."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("div",{style:{padding:"0px",alignItems:"center"},children:e.jsxs("div",{style:{padding:"0px",display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(at,{id:"tab-to-import",label:"Tab to Import",value:m,size:"small",error:!!E,helperText:E,margin:"dense",color:"secondary",onChange:o=>{y(o.target.value)}}),e.jsx(A,{style:{color:"#000",padding:0,lineHeight:"1rem",height:40,marginTop:8,marginLeft:10},variant:"contained",onClick:f,edge:"start",color:"secondary",children:"Import"})]})})]})})})})}v.extend(Fe);function Ct({owner:i,date:t}){const{userId:a}=U(),{updateProfileBlackBeltAwardedAt:d}=n.useContext(Y),[s,p]=n.useState(!1),[h,u]=n.useState(!1),[m,y]=n.useState(v.utc(t)),E=n.useCallback((r,L)=>{i&&p(L)},[i]),g=n.useCallback(()=>{y(v.utc(t)),u(!1)},[t]),f=n.useCallback(async()=>{try{d(a,m),xe("Profile updated"),u(!1)}catch(r){console.error("Error while updating profile",r),xe("Error while updating profile")}},[a,m,d]);let S=t?v.utc(t).format("L"):"(no date)";S=S.replace("/202","/2"),S=S.replace("/201","/1");const o={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"},c=i?{}:{cursor:"default"},k=i?e.jsx(me,{}):null,{isMobile:j}=O(),w=j?"block":"flex",x=j?"65%":"56%",b=j?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},C=h?"#fff":"#555",l=h?"#e15c07":"#555";return e.jsxs(B.Fragment,{children:[e.jsxs(ie,{expanded:s,onChange:E,children:[e.jsxs(ae,{expandIcon:k,style:{...o,...c},children:[e.jsx(fe,{value:"Black"}),e.jsx("div",{style:{margin:"4px 0px 0px 8px",width:x,flexShrink:0,flexDirection:"column"},children:e.jsx(ne,{value:"Black Belt Awarded",textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}})}),e.jsxs("div",{style:{display:w,placeItems:"center",marginLeft:10},children:[e.jsx("div",{style:{display:"flex",width:76}}),e.jsx("div",{style:b,children:e.jsx("div",{style:{margin:"4px 0px 0px 10px"},children:S})})]})]}),s&&e.jsx(oe,{sx:{padding:"4px 16px 0px 26px"},children:e.jsx(je,{adapterLocale:v.locale(),dateAdapter:ve,children:e.jsx(B.Fragment,{children:e.jsxs("div",{style:{display:"flex",width:"100%",marginBottom:20},children:[e.jsx(et,{label:"Awarded date",value:m,onChange:r=>{y(r),u(!0)},sx:{width:400},disableFuture:!0}),e.jsxs("div",{style:{width:"100%",textAlign:"right",position:"relative",top:"30px",padding:"0px 12px 8px 0px"},children:[e.jsx(A,{style:{marginRight:10,color:l},onClick:g,disabled:!h,children:"Cancel"}),e.jsx(A,{style:{marginRight:0,color:C},onClick:f,disabled:!h,children:"Save"})]})]})})})})]}),e.jsx(te,{}),e.jsx(te,{})]})}function St({collectionType:i}){const{user:t}=n.useContext(ge),{userId:a}=U(),d=se(),{isMobile:s}=O(),p=s?{marginTop:20,maxWidth:700,marginLeft:8,marginRight:8,borderRadius:0}:{marginTop:20,maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},h=a===(t==null?void 0:t.uid),u=h?e.jsx("div",{style:{width:"100%",display:"flex",placeItems:"center"},children:e.jsxs("div",{style:{fontSize:"1.0rem",fontWeight:400,width:400,marginLeft:"auto",marginRight:"auto"},children:[e.jsx("strong",{children:"There are no locks in your Scorecard."}),e.jsx("br",{}),'Browse the site and use the "My Collection" button to track locks that you have picked and recorded.',e.jsx("br",{}),e.jsx("br",{}),e.jsx("img",{alt:"My Collection",src:ot})]})}):"There are no locks in this collection.",m=h?i==="safelocks"?"Explore Safe Locks":"Explore Locks":"Go Home",y=n.useCallback(()=>{d(i==="safelocks"?"/safelocks":"/locks")},[d,i]);return e.jsx(it,{alignContent:"center",children:e.jsxs(ze,{style:p,children:[e.jsx(Pe,{children:e.jsx(N,{variant:"h6",align:"center",children:u})}),e.jsxs(Re,{children:[e.jsx("div",{style:{width:"100%"}}),e.jsx(A,{variant:"outlined",color:"secondary",onClick:y,style:{whiteSpace:"nowrap",padding:"10px 30px",margin:10},children:m})]})]})})}function Dt({owner:i,profile:t,adminAction:a}){const{isMobile:d}=O(),{userId:s}=U(),{visibleEntries:p=[],cardEvidence:h}=n.useContext($),{expanded:u}=n.useContext(be),{filters:m,removeFilters:y}=n.useContext(_),{createEvidenceForEntries:E,removeEvidence:g,removeProfileBlackBeltAwarded:f,updateUserStatistics:S}=n.useContext(Y),{admin:o}=n.useContext(Oe),[c,k]=n.useState(u),[j,w]=n.useState(!1),[x,b]=n.useState("import"),[C,l]=n.useState(!1);u&&u!==c&&k(u);const r=n.useMemo(()=>{if(t&&t.recorded){const D=h.map(W=>W.matchId);return t.recorded.filter(W=>!D.includes(W))}else return[]},[t,h]),L=n.useCallback(D=>{m.id&&y(["id"]),k(D)},[m,y]),M=n.useCallback(async()=>{l(!0),await E(s,r),w(!1),l(!1),a()},[E,s,r,a]),T=n.useCallback(D=>{b(D),w(!j)},[j]),[I,F]=n.useState(null),J=!!I,Q=n.useCallback(D=>{D.preventDefault(),D.stopPropagation(),F(D.currentTarget)},[]),z=n.useCallback(()=>F(null),[]),Z=n.useCallback(async()=>{l(!0),await S(s),l(!1)},[S,s]),X=n.useCallback(async()=>{l(!0),await g(h),await f(s),z(),l(!1),a()},[h,g,z,a,f,s]),G=d?10:40,q=d?"block":"flex",V=(t==null?void 0:t.blackBeltAwardedAt)>0,P=V?"100%":"50%";return e.jsxs("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:[e.jsx(rt,{profile:t,page:"scorecard"}),i&&p.length>0&&!t.tabClaimed&&e.jsx("div",{style:{margin:8,padding:"0px 0px"},children:e.jsx(ct,{pageName:"scorecard"})}),p.length>0&&e.jsx(B.Fragment,{children:d?e.jsxs("div",{style:{display:q,padding:"0px 8px 0px 16px"},children:[t.danLevel>0&&e.jsx(ue,{}),e.jsx("div",{style:{marginRight:0,width:"95%"},children:e.jsx(he,{profile:t,entries:p})})]}):e.jsxs("div",{style:{display:q,padding:"10px 8px 0px 16px"},children:[e.jsx("div",{style:{marginRight:0,width:380},children:e.jsx(he,{profile:t,entries:p})}),t.danLevel>0&&e.jsx("div",{style:{flexGrow:1,marginRight:0},children:e.jsx(ue,{})})]})}),(i||o)&&e.jsxs(ie,{expanded:j,disableGutters:!0,children:[e.jsx(ae,{style:{paddingLeft:G,paddingRight:G,placeItems:"center",width:"100%"},children:e.jsxs("div",{style:{width:"100%",placeItems:"center",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",width:"100%",placeItems:"center",textAlign:"center"},children:[!V&&e.jsx("div",{style:{width:"50%",textAlign:"center"},children:e.jsx(A,{variant:"contained",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:P,textAlign:"center"},children:e.jsx(A,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("project"),children:j&&x==="project"?"CANCEL ADD PROJECT":"ADD PROJECT"})})]}),C&&e.jsx(ke,{}),o&&!C&&e.jsx("div",{style:{backgroundColor:"#700",padding:5,marginTop:20},children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{width:"10%",textAlign:"center"},children:"admin"}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>T("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:Z,children:"UPDATE STATS"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsxs(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:M,children:["MERGE RECORDED (",r.length,")"]})}),e.jsxs("div",{style:{width:"20%",textAlign:"center"},children:[e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:Q,children:"DELETE SCORECARD"}),e.jsxs(Ne,{anchorEl:I,open:J,onClose:z,children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["You cannot undo delete.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:X,edge:"start",color:"error",children:"Delete"})})]})]})]})})]})}),e.jsxs(oe,{style:{backgroundColor:"#333"},children:[x==="import"&&e.jsx(bt,{setControlsExpanded:w,adminAction:a}),x==="project"&&e.jsx(ye,{evid:null,handleUpdate:T,addProject:!0})]})]}),p.length===0&&e.jsx(St,{}),t&&t.blackBeltAwardedAt&&e.jsx(Ct,{owner:i,date:t.blackBeltAwardedAt.toDate().toJSON()}),e.jsx("div",{children:p.map(D=>e.jsx(mt,{owner:i,evid:D,expanded:D.id===c,onExpand:L,merged:t.blackBeltAwardedAt>0},D.id))})]})}function en(){const{userId:i}=U(),{user:t}=n.useContext(ge),{getProfile:a,getEvidence:d}=n.useContext(Y),{scoredEvidence:s,bbCount:p,danPoints:h,eligibleDan:u,nextDanPoints:m,nextDanLocks:y}=n.useContext(Me),{isMobile:E}=O(),[g,f]=n.useState(!1),S=n.useCallback(()=>{f(!g)},[g]),o=n.useCallback(async()=>{try{const I=await a(i);if(I){const F=I.displayName?I.displayName.toLowerCase().endsWith("s")?`${I.displayName}'`:`${I.displayName}'s`:"Anonymous";document.title=`LPU Belt Explorer - ${F} Scorecard`}if((t==null?void 0:t.uid)!==i){const F=await d(i);return{profile:I,...We(F)}}else return{profile:I,scoredEvidence:s,bbCount:p,danPoints:h,eligibleDan:u,nextDanPoints:m,nextDanLocks:y}}catch(I){return console.error("Error loading profile and evidence.",I),null}},[g,t,i,a,d,s,p,h,u,m,y]),{data:c={},loading:k,error:j}=$e({loadFn:o}),w=c?c.profile:{},x=c?c.scoredEvidence:[],b=c?c.bbCount:0,C=c?c.danPoints:0,l=c?c.eligibleDan:0,r=c?c.nextDanPoints:0,L=c?c.nextDanLocks:0,M=e.jsxs(B.Fragment,{children:[e.jsx(Ke,{label:"Scorecard",extraFilters:[{key:"tab",value:"search"}]}),e.jsx(Ye,{sortValues:Je}),e.jsx(Qe,{extraFilters:[{key:"tab",value:"search"}]}),!E&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})]}),T=k?"Loading...":"Profile";return k||j?null:e.jsx(qe,{filterFields:Ve,children:e.jsx(pt,{cardEvidence:x,cardBBCount:b,cardDanPoints:C,cardEligibleDan:l,cardNextDanPoints:r,cardNextDanLocks:L,children:e.jsxs(gt,{children:[e.jsxs(je,{adapterLocale:v.locale(),dateAdapter:ve,children:[e.jsx(He,{title:T,extras:M}),k&&e.jsx(dt,{}),!k&&c&&!j&&e.jsx(Dt,{owner:t&&t.uid===i,profile:w,adminAction:S}),!k&&(!c||j)&&e.jsx(lt,{}),e.jsx(Ue,{})]}),e.jsx(_e,{feature:"scorecard"})]})})})}export{en as default};
