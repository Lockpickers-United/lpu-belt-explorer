import{r,F as j,aw as I,al as S,d as u,az as b,ak as B,j as O}from"./index-DVRtqeBN.js";import{D as P,f as w}from"./DataContext-B5zL9AB1.js";import{r as C}from"./index-BaRAsXqj.js";import{c as F}from"./collectionStatsById-DY1NVZ7h.js";import{u as H}from"./useData-UfkF9JBA.js";import{h as R}from"./dataUrls-ZPc7x5xp.js";function Z({children:U,allEntries:d,profile:a}){const{filters:D}=r.useContext(j),{search:i,id:V,tab:W,name:K,sort:o,image:q,expandAll:k,...z}=D,{data:v,loading:p,error:h}=H({urls:E}),f=r.useMemo(()=>v&&!p&&!h?v.lockbazzarEntryIds:[],[v,h,p]),A=r.useMemo(()=>{const l=(a==null?void 0:a.userLockNotes)||{};return d.map(s=>{var m,c,t;return{...s,makes:s.makeModels[0].make?s.makeModels.map(({make:e})=>e):s.makeModels[0].model,fuzzy:C(s.makeModels.map(({make:e,model:n})=>[e,n]).flat().filter(e=>e).concat([s.version,s.notes,s.belt]).join(",")),content:[(m=s.media)!=null&&m.some(e=>!e.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(c=s.media)!=null&&c.some(e=>e.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((t=s.links)==null?void 0:t.length)>0?"Has Links":"No Links",S[s.belt].danPoints>0?"Worth Dan Points":void 0,u(s.lastUpdated).isAfter(u().subtract(1,"days"))?"Updated Recently":void 0,s.belt.startsWith("Black")?"Is Black":void 0,s.belt!=="Unranked"?"Is Ranked":void 0,l[s.id]?"Has Personal Notes":void 0].flat().filter(e=>e),collection:I.locks.map.map(e=>a&&a[e.key]&&a[e.key].includes(s.id)?e.label:"Not "+e.label),collectionSaves:F[s.id]||0,simpleBelt:s.belt.replace(/\s\d/g,""),personalNotes:l[s.id]}})},[d,a]),M=r.useMemo(()=>{const l=Object.keys(z).map(t=>{const e=z[t];return Array.isArray(e)?e.map(n=>({key:t,value:n})):{key:t,value:e}}).flat(),s=A.filter(t=>l.every(({key:e,value:n})=>Array.isArray(t[e])?t[e].includes(n):t[e]===n)),m=i&&s.find(t=>t.id===i);let c=s;return m?c=[m]:i&&(c=w.go(C(i),s,{keys:L,threshold:-25e3}).map(t=>({...t.obj,score:t.score}))),o?c.sort((t,e)=>{if(o==="popularity")return e.collectionSaves-t.collectionSaves||e.views-t.views||t.fuzzy.localeCompare(e.fuzzy);if(o==="beltAscending")return b(t.belt,e.belt);if(o==="beltDescending")return B(t.belt,e.belt);if(o==="alphaAscending")return t.fuzzy.localeCompare(e.fuzzy);if(o==="alphaDescending")return e.fuzzy.localeCompare(t.fuzzy);if(o==="recentlyUpdated")return Math.floor(u(e.lastUpdated).valueOf()/3600)-Math.floor(u(t.lastUpdated).valueOf()/3600)||b(t.belt,e.belt)||t.fuzzy.localeCompare(e.fuzzy);if(o==="dateAdded")return Math.floor(u(e.dateAdded).valueOf()/3600*24)-Math.floor(u(t.dateAdded).valueOf()/3600*24)||b(t.belt,e.belt)||t.fuzzy.localeCompare(e.fuzzy)}):c},[z,A,i,o]),y=r.useCallback(l=>d.find(s=>s.id===l),[d]),g=r.useCallback(l=>f==null?void 0:f.includes(l),[f]),x=r.useMemo(()=>(a==null?void 0:a.blackBeltAwardedAt)>0,[a]),N=r.useMemo(()=>({allEntries:d,visibleEntries:M,getEntryFromId:y,expandAll:k,profile:a,blackBeltUser:x,lockbazzarAvailable:g}),[d,M,y,k,a,x,g]);return O.jsx(P.Provider,{value:N,children:U})}const L=["fuzzy"],E={lockbazzarEntryIds:R};export{Z as D};
