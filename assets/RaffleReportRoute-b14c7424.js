import{d as F,u as R,j as t,R as M,b as X,r as f,A as _,N as J,F as K,T as Q}from"./index-f4300893.js";import{D as Z,a as tt,r as et}from"./filterFields-336f0cfb.js";import{L as nt}from"./LoadingDisplay-22a34167.js";import{u as V}from"./useData-825fdf3a.js";import{u as ot}from"./usePageTitle-606f5940.js";import{h as st,s as it,f as at}from"./dataUrls-6cc1b85c.js";import{P as H}from"./nivo-line.es-a2223ffb.js";import{p as N}from"./adminChartDefaults-e02caa29.js";import{A as rt}from"./AdminStatsTable-30355327.js";import{A as Y,R as lt,a as ct}from"./RaffleYOYLines-75733656.js";import{R as dt}from"./RaffleAutocompleteBox-4f9f1bc0.js";import{L as mt}from"./Link-964409de.js";import{R as B,s as A,A as ut}from"./AdminRoleButton-94d560ee.js";import{C as ft}from"./ChoiceButtonGroup-91820743.js";import{B as ht}from"./nivo-bar.es-3c3989cb.js";import{p as pt}from"./chartDefaults-9fc07b21.js";import{R as xt}from"./ReportButton-e9e9fe6d.js";import{R as gt}from"./RaffleDataProvider-e5c14ff8.js";import"./LPU-c3fa7122.js";import"./LinearProgress-2e9fec55.js";import"./useDocumentTitle-6d5d8ba0.js";import"./nivo-legends.es-2e1c8b06.js";import"./index-f197e3f0.js";import"./TableRow-71afa06e.js";import"./Search-1029c0b2.js";import"./Autocomplete-29dd54bf.js";import"./Select-6e91fb08.js";import"./Chip-126e6bec.js";import"./TextField-7f95e975.js";import"./index-8b242a3e.js";import"./ToggleButtonGroup-2e98da72.js";const yt=({lineData:o})=>{const r=[o.rafl28days.data],s=[],n=new Map,e=new Map,a=new Map;r.forEach(m=>{const g=[],j=[],k=[];for(let w=0;w<m.length;w++){let v=m[w].date;if(F(v)<F("2024-12-25"))continue;v=v+" 23:59:59";const h=new Map;h.x=v,h.y=m[w].potListViews,g.push(h);const p=new Map;p.x=v,p.y=m[w].potViews,j.push(p);const T=new Map;T.x=v,T.y=m[w].raflForm,k.push(T)}n.id="Pot List",n.data=g,e.id="Pot Views",e.data=j,a.id="Entry Form",a.data=k,s.push(e),s.push(n),s.push(a)});const{width:l}=R(),d=l<=360,u=l<=395,x=l<=428,b=l<=560,D=l<=820,y=d||u?200:x?210:D?230:350,C=b?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:y,width:"100%"},children:t.jsx(H,{theme:N,data:s,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:C,height:y,curve:"natural",yScale:{type:"linear",min:0,max:"5000",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function jt({data:o}){const{width:r}=R(),s=r<=560,a={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...s?{}:{display:"flex"}};return t.jsx(M.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:a,children:t.jsx(yt,{lineData:o})})})})}const bt=({data:o})=>{const{rafl28days:r}=o,s=r.data.filter(m=>F(m.date)>F("2024-12-28")),n=s.reduce((m,g)=>(Object.keys(r.data[r.data.length-1]).map(j=>{["date","dateString"].includes(j)||(m[j]=m[j]?m[j]+g[j]:g[j])}),m),{});n.dateString="Total",s.push(n);const e=Object.keys(n).reduce((m,g)=>(m[g]=Math.floor(n[g]/s.length),m),{});e.dateString="Average",s.push(e);const a={columns:r.columns,data:s},{width:l}=R(),d=l<=360,u=l<=395,x=l<=428,b=l<=560,D=l<=820,y=d?".8rem":u?".85rem":x?".9rem":".95rem",C="100%";return t.jsx(rt,{tableData:a,tableWidth:C,fontSize:y})},wt=({statsData:o})=>{const r=X(),{potViewsById:s}=o,{getPotFromId:n}=f.useContext(Z),{data:e}=V({url:st}),{potWatches:a}=e||{},l=[{name:"Pot #",align:"center",id:"potNumber"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"},{id:"watchlists",name:"Watchlists",align:"center"}],d=!0,[u,x]=f.useState("potNumber"),[b,D]=f.useState(!0),[y,C]=f.useState({}),m=s.data.map(i=>{var P,z;const c=n(i.id);if(!c)return null;let S=c!=null&&c.title?c.title.substring(0,32):`unknown (${i.id})`;S=((P=c==null?void 0:c.title)==null?void 0:P.length)<32||!(c!=null&&c.title)?S:S+"...";const W=(z=i==null?void 0:i.id)==null?void 0:z.replace("2025-","");return{...i,percentViews:Math.floor(i.percentViews*100)+"%",...c,title:S,id:W,watchlists:(a==null?void 0:a[i.id])||0}}).filter(i=>i).sort((i,c)=>{switch(u){case"potNumber":return i.potNumber-c.potNumber||i.title.localeCompare(c.title);case"id":return i[u].localeCompare(c[u]);case"title":return i[u].localeCompare(c[u]);case"donors":return parseInt(c[u])-parseInt(i[u])||i.title.localeCompare(c.title);case"percentViews":return parseInt(c[u])-parseInt(i[u])||i.views-c.views;default:return parseInt(c[u])-parseInt(i[u])||i.title.localeCompare(c.title)}}),g=b?m:m.reverse(),k=(Object.keys(y).length>0?[g==null?void 0:g.find(i=>i.title===y.itemTitle)]:g||[]).map(i=>i.donors&&i.donors>0?{...i}:{...i,donors:0,tickets:0}),w={columns:l,data:k},v=f.useCallback((i,c)=>{const S=m.find(P=>P.title===c),W=S==null?void 0:S.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return i==="title"?t.jsx(mt,{onClick:()=>r(`/rafl/?id=${S.id}&name=${W}`),style:{color:"#fff"},children:c}):c},[r,m]),h=f.useCallback(i=>i!=null&&i.title?i.title:"unknown",[]),{width:p}=R(),T=p<=360,O=p<=395,G=p<=428,q=p<=560,E=p<=820,U=T?".8rem":O?".85rem":G?".9rem":".95rem",$="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(dt,{allItems:m,setItemDetails:C,getOptionTitle:h,searchText:"Search Pots"})})}),t.jsx(Y,{tableData:w,tableWidth:$,fontSize:U,sortable:d,sort:u,setSort:x,ascending:b,setAscending:D,linkFunction:v})]})},vt=()=>{const{allCharities:o}=f.useContext(B),r=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],s=!0,[n,e]=f.useState("name"),[a,l]=f.useState(!0),d=o.sort((h,p)=>{switch(n){case"name":return h.name.localeCompare(p.name);case"donors":return p[n]-h[n];case"donations":return p[n]-h[n];default:return h.name.localeCompare(p.name)}}),x=(a?d:d.reverse()).map(h=>h.donations&&h.donations>0?{...h,donations:`$${h.donations}`}:{...h}),b={columns:r,data:x},D=f.useCallback((h,p)=>p,[]),{width:y}=R(),C=y<=360,m=y<=395,g=y<=428,j=y<=560,k=y<=820,w=C?".8rem":m?".85rem":g?".9rem":".95rem",v="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(Y,{tableData:b,tableWidth:v,fontSize:w,sortable:s,sort:n,setSort:e,ascending:a,setAscending:l,linkFunction:D})]})};function L({chartHeight:o,chartdata:r,showAxisBottom:s,colors:n,tickValues:e,curve:a}){const l=s?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},d=s?"bottom":"top-left",u=s?70:20,x=s?0:20;return t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(H,{theme:N,data:r,enableGridX:!1,enableGridY:!1,colors:n,lineWidth:3,margin:l,height:o,curve:a??"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:e||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:s?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:s?[]:[{anchor:d,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:x,translateY:u,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const Dt=({data:o})=>{const r=Object.keys(o).sort((e,a)=>e.localeCompare(a)).reduce((e,a)=>{const l=a+" 23:59:59";return e.donorsCum=e.donorsCum+o[a].totalDonors||o[a].totalDonors,A(e,["totalDonors"],{x:l,y:o[a].totalDonorCountUnique}),A(e,["cumulativeDonors"],{x:l,y:o[a].cumDonorsUnique}),e.donationsCum=e.donationsCum+o[a].totalDonations||o[a].totalDonations,A(e,["totalDonations"],{x:l,y:o[a].totalDonations}),A(e,["cumulativeDonations"],{x:l,y:e.donationsCum}),e},[]),s={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},n=120;return Object.keys(o).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(M.Fragment,{children:[t.jsx("div",{style:s,children:"Donations"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations Cumulative",data:r.cumulativeDonations}],chartHeight:n,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations",data:r.totalDonations}],chartHeight:n,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:s,children:"Unique Donors"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors Cumulative",data:r.cumulativeDonors}],chartHeight:n,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors",data:r.totalDonors}],chartHeight:n,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},St=({beltDistribution:o})=>{const{width:r}=R(),s=r<500,n=250,e=s?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},a=s?-45:0,l=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:n},children:t.jsx(ht,{data:o,maxValue:"auto",margin:e,padding:.15,colors:d=>l[d.index%l.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:a},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:pt,isInteractive:!1})})};function Rt({data:o}){const r=f.useMemo(()=>I.map(d=>({value:o.beltDonations[d]?o.beltDonations[d]/o.totalDonations:0,id:d,label:d})),[o]),s=f.useMemo(()=>I.map(d=>({value:o.beltDonorCountUnique[d]?o.beltDonorCountUnique[d]/o.totalDonorCountUnique:0,id:d,label:d})),[o]),n=f.useMemo(()=>[{label:"Donations",data:r},{label:"Donors",data:s}],[r,s]),[e,a]=f.useState(n[0]),l=f.useCallback(d=>a(d),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ft,{options:n,onChange:l}),t.jsx(St,{beltDistribution:e.data})]})}const I=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"];function Ct(){ot("RAFL Report");const{data:o,loading:r,error:s}=V({urls:kt}),{siteFullNew:n,raflResponseDetails:e}=o||{},{width:a}=R(),d=a<560?"8px 8px 32px 8px":"24px 24px 32px 24px",u={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},x={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},b=u,D=r?"--":"(updated: "+F(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return r?t.jsx(nt,{}):s?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:d,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:b,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:D})]}),t.jsx(lt,{}),t.jsx("div",{style:{height:20}}),t.jsx(jt,{data:n}),t.jsx("div",{style:x,children:"Totals Over Time"}),t.jsx(ct,{data:e==null?void 0:e.detailedData}),t.jsx(Dt,{data:e==null?void 0:e.detailedData}),t.jsx("div",{style:x,children:"Belt Distribution"}),t.jsx(Rt,{data:e==null?void 0:e.summaryData}),t.jsx("div",{style:x,children:"Page Tracking"}),t.jsx(bt,{data:n}),t.jsx("div",{style:x,children:"Pot Details"}),t.jsx(wt,{statsData:n}),t.jsx("div",{style:x,children:"Charity Details"}),t.jsx(vt,{data:n})]})}const kt={siteFullNew:it,raflResponseDetails:at};function ie(){const{authLoaded:o}=f.useContext(_),{isMobile:r}=R(),{allPots:s}=f.useContext(B),{raffleAdmin:n}=f.useContext(B),e=t.jsxs(M.Fragment,{children:[!r&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(xt,{active:!0}),t.jsx(ut,{})]});return t.jsx(tt,{filterFields:et,children:t.jsx(gt,{allEntries:s,children:t.jsxs(M.Fragment,{children:[t.jsx(J,{title:"RAFL Report",extras:e}),o&&n&&t.jsx(Ct,{}),t.jsx(K,{}),t.jsx(Q,{feature:"raflReport"})]})})})}export{ie as default};
