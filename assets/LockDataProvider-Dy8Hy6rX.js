import{r,F as H,aA as L,aq as V,d as f,K as x,ap as _,j as q}from"./index-VHPGETNz.js";import{D as G,f as K}from"./DataContext-DutyMEYg.js";import{r as I}from"./index-CV_Ulnjh.js";import{c as W}from"./collectionStatsById-DY1NVZ7h.js";import{u as T}from"./useData-Bx3Z1NyX.js";import{h as $}from"./dataUrls-DkJe4Pqg.js";import{f as J}from"./filterEntriesAdvanced-B_LinbMH.js";import{s as Q}from"./setDeep-J6HEwWhX.js";function X(v){try{return new RegExp(v),!0}catch(c){if(c instanceof SyntaxError)return!1;throw c}}function ne({children:v,allEntries:c,profile:o}){const{filters:O,advancedFilterGroups:M}=r.useContext(H),{search:d,tab:i,sort:n,expandAll:A}=O,{data:g,loading:B,error:C}=T({urls:Z}),h=r.useMemo(()=>g&&!B&&!C?g.lockbazzarEntryIds:[],[g,C,B]),[b,U]=r.useState(.3),u=r.useMemo(()=>{const a=(o==null?void 0:o.userLockNotes)||{};let l=[];return c.map(e=>{var z,j,N,F;const s=(z=e.media)==null?void 0:z.map(t=>{var k,R;return t&&t.title&&((k=t.title)!=null&&k.includes("By:"))&&Q(l,[""],t.title.replace("By: ","").trim()),(R=t==null?void 0:t.thumbnailUrl)!=null&&R.includes("flickr.com")&&(t.thumbnailUrl=t.thumbnailUrl.replace("_w_d.jpg","_w.jpg")),t});return{...e,media:s,makes:e.makeModels[0].make?e.makeModels.map(({make:t})=>t):e.makeModels[0].model,fuzzy:I(e.makeModels.map(({make:t,model:k})=>[t,k]).flat().filter(t=>t).concat([e.version,e.notes,e.belt]).join(",")),content:[(j=e.media)!=null&&j.some(t=>!t.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(N=e.media)!=null&&N.some(t=>t.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((F=e.links)==null?void 0:F.length)>0?"Has Links":"No Links",V[e.belt].danPoints>0?"Worth Dan Points":void 0,f(e.lastUpdated).isAfter(f().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,a[e.id]?"Has Personal Notes":void 0].flat().filter(t=>t),collection:L.locks.map.map(t=>o&&o[t.key]&&o[t.key].includes(e.id)?t.label:"Not "+t.label),collectionSaves:W[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:a[e.id],photographers:l==null?void 0:l.names}})},[c,o]),m=r.useCallback(a=>{const l=d&&a.find(s=>s.id===d);if(l)return[l];const e=/^\((.*)\)$/.exec(d);return e&&X(e[1])?a.reduce((s,z)=>(z.fuzzy.match(new RegExp(e[1],"i"))&&s.push(z),s),[]):d?K.go(I(d),a,{keys:Y,threshold:-23e3}).map(s=>({...s.obj,score:s.score})).filter(s=>s.score>b):a},[d,b]),y=r.useMemo(()=>i==="search"||!i?m(u):m(u).filter(a=>a.simpleBelt===i),[u,m,i]),p=r.useMemo(()=>{const a=J({advancedFilterGroups:M(),entries:u}),l=m([...a]);return n?l.sort((e,s)=>{if(n==="popularity")return s.collectionSaves-e.collectionSaves||s.views-e.views||e.fuzzy.localeCompare(s.fuzzy);if(n==="beltAscending")return x(e.belt,s.belt);if(n==="beltDescending")return _(e.belt,s.belt);if(n==="alphaAscending")return e.fuzzy.localeCompare(s.fuzzy);if(n==="alphaDescending")return s.fuzzy.localeCompare(e.fuzzy);if(n==="recentlyUpdated")return Math.floor(f(s.lastUpdated).valueOf()/3600)-Math.floor(f(e.lastUpdated).valueOf()/3600)||x(e.belt,s.belt)||e.fuzzy.localeCompare(s.fuzzy);if(n==="dateAdded")return Math.floor(f(s.dateAdded).valueOf()/3600*24)-Math.floor(f(e.dateAdded).valueOf()/3600*24)||x(e.belt,s.belt)||e.fuzzy.localeCompare(s.fuzzy)}):l},[M,u,m,n]),S=r.useCallback(a=>c.find(l=>l.id===a),[c]),w=r.useMemo(()=>i==="search"||!i?p:p.filter(a=>a.simpleBelt===i),[i,p]),D=r.useCallback(a=>h==null?void 0:h.includes(a),[h]),E=r.useMemo(()=>(o==null?void 0:o.blackBeltAwardedAt)>0,[o]),P=r.useMemo(()=>({allEntries:c,mappedEntries:u,searchedBeltEntries:y,visibleEntries:p,visibleBeltEntries:w,getEntryFromId:S,expandAll:A,profile:o,blackBeltUser:E,lockbazzarAvailable:D,searchCutoff:b,setSearchCutoff:U}),[c,u,y,p,w,S,A,o,E,D,b,U]);return q.jsx(G.Provider,{value:P,children:v})}const Y=["fuzzy"],Z={lockbazzarEntryIds:$};export{ne as D};
