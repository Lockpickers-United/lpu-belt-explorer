import{r,F as N,ag as E,aJ as R,g as S,a2 as J,j as W,ak as z,d as s,az as y,R as L}from"./index-DEH8NPFZ.js";import{D as V,f as K}from"./DataContext-DuDb1eyv.js";import{r as T}from"./index-Dq2898EV.js";function te({children:f,cardActivity:d,cardBBCount:l,cardDanPoints:p,cardEligibleDan:u,cardNextDanPoints:o,cardNextDanLocks:v,cardUniqueLocks:i,cardMaxBelt:h,popularLocks:g,popularLocksBB:e,profile:t,blackBeltScorecard:c}){const{filters:M}=r.useContext(N),{search:n,id:A,tab:X,name:Z,sort:D,image:_,locks:$,...j}=M,O=r.useMemo(()=>d.map(a=>{const m=E(a.matchId),C=R(a.matchId),F=S(a.matchId),H=F?"Belt":C?"Project":"Lock";return{...a,...m,...C,...F,id:a.id,type:H}}),[d]),b=r.useMemo(()=>O.reduce((a,m)=>(a[m.matchId]=m,a),{}),[O]),I=r.useMemo(()=>g.map(a=>({...E(a.id),...b[a.id],popularityRank:a.rank,userCount:a.saveCount})),[g,b]),P=r.useMemo(()=>e==null?void 0:e.map(a=>({...E(a.id),...b[a.id],popularityRank:a.rank,userCount:a.saveCount})),[e,b]),x=r.useMemo(()=>Object.keys(j).map(a=>{const m=j[a];return Array.isArray(m)?m.map(C=>({key:a,value:C})):{key:a,value:m}}).flat(),[j]),w=r.useMemo(()=>U(O,x,n,D,t),[O,x,t,n,D]),Y=r.useMemo(()=>U(I,x.concat({key:"exceptionType",value:void 0}),n,"popular",t),[I,x,t,n]),k=r.useMemo(()=>(t==null?void 0:t.blackBeltAwardedAt)>0,[t]),G=r.useMemo(()=>({allEntries:J,cardActivity:d,cardBBCount:l,cardDanPoints:p,cardEligibleDan:u,cardNextDanPoints:o,cardNextDanLocks:v,visibleEntries:w,popularEntries:Y,bbPopularEntries:P,cardUniqueLocks:i,cardMaxBelt:h,blackBeltUser:k,blackBeltScorecard:c,getEntryFromId:E,getProjectEntryFromId:R,getAwardEntryFromId:S}),[d,l,p,u,o,v,w,Y,P,i,h,k,c]);return W.jsx(V.Provider,{value:G,children:f})}function U(f,d,l,p,u={}){const o=(u==null?void 0:u.userLockNotes)||{},i=f.map(e=>{var t,c,M;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:n})=>n),fuzzy:T(((c=e==null?void 0:e.makeModels)==null?void 0:c.map(({make:n,model:A})=>[n,A]).flat().filter(n=>n).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],content:[o[e.id]||o[e.matchId]?"Has Personal Notes":void 0].flat().filter(n=>n),scoring:[(()=>{switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}return"Worth Points"})()],simpleBelt:(M=e==null?void 0:e.belt)==null?void 0:M.replace(/\s\d/g,""),personalNotes:o[e.id]||o[e.matchId]}}).filter(e=>d.every(({key:t,value:c})=>Array.isArray(e[t])?e[t].includes(c):e[t]===c)),h=l?K.go(T(l),i,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):i,g=(()=>{switch(p){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||y(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||z(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"dateAscending":return(e,t)=>s(e.date).valueOf()-s(t.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>s(t.date).valueOf()-s(e.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>y(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"beltDescending":return(e,t)=>z(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>s(s(t.date).format("YYYY-MM-DD")).valueOf()-s(s(e.date).format("YYYY-MM-DD")).valueOf()||z(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return h.sort(g)}const Q=L.createContext({});function ae({children:f}){const{filters:d,addFilters:l,removeFilters:p}=r.useContext(N),u=d.id,o=r.useCallback(i=>{i?l([{key:"id",value:i}],!0):p(["id"])},[l,p]),v=r.useMemo(()=>({expanded:u,setExpanded:o}),[u,o]);return W.jsx(Q.Provider,{value:v,children:f})}export{Q as S,te as a,ae as b};
