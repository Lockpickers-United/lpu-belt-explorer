import{r as s,K as M,j as e,J as P,I as Z,b9 as ue,R as z,ad as me,O as pe,P as he,$ as ge,B as q,A as ee,d as X,ag as fe,u as O,W as xe,F as je,b as ke,D as ve,bA as Ce,e as Se,N as be}from"./index-6718c2da.js";import{u as ye}from"./usePageTitle-b517f657.js";import{F as E}from"./FieldValue-17ced94b.js";import{L as qe}from"./LockImageGallery-70c7211a.js";import{e as te}from"./entryName-5383522f.js";import{d as we}from"./ExpandMore-fe8b6710.js";import{D as _}from"./DataContext-89d97534.js";import{d as Re}from"./Link-f8a57b9c.js";import{S as $,D as Be}from"./SelectBox-d1fba218.js";import{r as Le,a as se}from"./rankingRequestData-d3ef79e5.js";import{B as Ee}from"./BeltStripe-6585195c.js";import{d as Te}from"./AddCircle-8c89ebe5.js";import{L as ze}from"./LoadingDisplayWhite-5fc19717.js";import{p as oe}from"./postData-03537c12.js";import{D as V}from"./Dialog-4b1b0875.js";import{T}from"./TextField-d6ba0fb6.js";import{C as Ae}from"./CopyEntryTextButton-9bdde036.js";import{A as De,a as Ue,b as Ie}from"./AccordionSummary-5c59db62.js";import{A as Me}from"./AccordionActions-f13b5b33.js";import"./index-e7f902ca.js";import"./dataUrls-46e31bfb.js";import{S as Fe}from"./SearchBox-c752f441.js";import{V as Ne}from"./ViewFilterButtons-87b64fd8.js";import{a as We}from"./sortFields-b1bde6f9.js";import{C as $e}from"./ChoiceButtonGroup-60b29af6.js";import{L as Ve}from"./Link-e37b8a64.js";import{a as Pe}from"./filterFields-0c3ff25d.js";import"./useDocumentTitle-e3b1d56f.js";import"./ImageGallery-9ede8978.js";import"./ImageViewer-d20a1c35.js";import"./Launch-3d320d82.js";import"./LinearProgress-ff0fd2a1.js";import"./DialogContent-71d482e9.js";import"./ImageListItem-7c31eb64.js";import"./Select-0fe1cb6e.js";import"./CircularProgress-d74a9ab5.js";import"./axios-3a665b0f.js";import"./ContentCopy-ab7e2708.js";import"./Collapse-5b8e7e6c.js";import"./Search-0d55f295.js";import"./Sort-0f328e3a.js";import"./Chip-8079f2ca.js";import"./FilterAlt-7a69f150.js";import"./Box-a0c5b89c.js";import"./LockListContext-6d30798f.js";import"./ToggleButtonGroup-c973de44.js";import"./Cancel-ae53d6f2.js";function Oe({entry:t,nameType:a}){const o=s.useCallback(async()=>{const d=te(t,a).replace(/[\s/]/g,"_").replace(/\W/g,""),l=`${window.location.origin}/#/rankingrequests/view?id=${t.id}&name=${d}`;await navigator.clipboard.writeText(l),M("Link copied to clipboard.")},[t,a]);return e.jsx(P,{title:"Copy Link to Request",arrow:!0,disableFocusListener:!0,children:e.jsx(Z,{onClick:o,children:e.jsx(Re,{})})})}function _e({requestMod:t,handleClick:a}){return t?e.jsx(P,{title:"Edit Request",arrow:!0,disableFocusListener:!0,children:e.jsx(Z,{onClick:a,style:{height:38,width:38,marginTop:"auto",marginBottom:"auto"},children:e.jsx(ue,{style:{height:20,width:20}})})}):null}function He({entry:t,requestMod:a,form:o,setForm:n,setUpdated:d}){const[l,i]=s.useState(!1),m=me.filter(p=>!["Unranked","Project"].includes(p));s.useEffect(()=>{setTimeout(()=>{n({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt})},100)},[t,n]);const f=s.useCallback(p=>{const{name:h,value:x}=p.target;h==="requestStatus"&&x==="Ranked"?i(!0):h==="requestStatus"&&(i(!1),delete o.belt),n({...o,[h]:x}),d(!0)},[o,n,d]);return e.jsxs(z.Fragment,{children:[a&&e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Status"}),e.jsx($,{changeHandler:f,name:"requestStatus",form:{},optionsList:Le,multiple:!1,value:o.requestStatus||t.requestStatus,defaultValue:o.requestStatus||t.requestStatus,size:"small",width:200})]}),a&&(o.belt||l)&&e.jsx("div",{style:{marginTop:8},children:e.jsx($,{changeHandler:f,name:"belt",form:o,optionsList:m,multiple:!1,defaultValue:t.belt||"",size:"small",width:200,label:"belt"})})]})}var H={},Ge=he;Object.defineProperty(H,"__esModule",{value:!0});var ae=H.default=void 0,Ye=Ge(pe()),Je=e;ae=H.default=(0,Ye.default)((0,Je.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");function Ke({user:t,entry:a}){const[o,n]=s.useState(!1),[d,l]=s.useState(!1),[i,m]=s.useState({}),[f,p]=s.useState(!1),{profile:h}=s.useContext(_),{requestedBy:x=[]}=a,g=x.find(u=>u.userId===t.uid&&u.owner)||!1,k=x.find(u=>u.userId===t.uid)||!1,w=x.length>1?x.length:"",r=x.length>1?"2px solid #444":"",C=g?"#999":"#fff",F=k?e.jsx(Te,{fontSize:"small",style:{color:C}}):e.jsx(ae,{fontSize:"small"}),A=g?"You requested this lock":k?"Click to remove your vote":"Add Your Vote",N=g||o?"default":"pointer",S=s.useCallback(u=>{const{name:R,value:y}=u.target;m({...i,[R]:y}),p(i.discordUsername&&i.discordUsername.length>0||i.redditUsername&&i.redditUsername.length>0)},[i]),D=s.useCallback(u=>{u.preventDefault(),u.stopPropagation(),m({}),p(!1),l(!1)},[]),v=s.useCallback(async()=>{if(o)return;if(g){M("You requested this lock",{variant:"info",autoHideDuration:1e3});return}n(!0);const u={...i,entryId:a.id,owner:!1,userId:t.uid,displayName:h.displayName},R=`${se}/request-vote`,y=JSON.stringify({newVote:u});try{await oe({user:t,url:R,json:y,snackBars:!0})}catch(U){console.error("Error updating vote:",U)}finally{n(!1),m({}),p(!1),l(!1)}},[a.id,i,g,o,h.displayName,t]),b=s.useCallback(u=>{if(u.preventDefault(),u.stopPropagation(),!o){if(g){M("You requested this lock",{variant:"info",autoHideDuration:3e3});return}k?v().then():l(!0)}},[v,k,g,o]);return e.jsxs(z.Fragment,{children:[e.jsx(P,{title:A,arrow:!0,disableFocusListener:!0,children:o?e.jsx("div",{onClick:b,style:{padding:"4px 0px",marginTop:"auto",marginBottom:"auto",alignItems:"center",justifyContent:"right"},children:e.jsx(ze,{})}):e.jsx("div",{onClick:b,style:{border:r,borderRadius:18,padding:"4px 10px",marginTop:"auto",marginBottom:"auto",display:"flex",alignItems:"center",justifyContent:"right",fontWeight:600,cursor:N},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[w>1&&e.jsx("span",{style:{marginLeft:5,marginRight:7},children:w}),F]})})}),e.jsx(V,{open:d,onClose:D,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",maxWidth:340,padding:20},onClick:u=>u.stopPropagation(),children:[e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:10},children:"Upvote Request"}),e.jsx("div",{style:{marginBottom:20,fontSize:"0.95rem",lineHeight:"1.3rem"},children:"A lot of work goes into ranking locks, and we use these votes to prioritize which locks are considered. Please only vote for locks you are specifically interested in."}),e.jsxs("div",{style:{flexGrow:1},children:[e.jsxs("div",{style:{fontSize:"1.1rem"},children:["Notes ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(T,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",style:{},value:i.notes||"",maxLength:1200,id:"notes",onChange:S})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500},children:"Contact Info"}),e.jsxs("div",{style:{},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"Discord Username"}),e.jsx(T,{type:"text",name:"discordUsername",style:{width:200},onChange:S,value:i.discordUsername||"",color:"info",size:"small"})]}),e.jsxs("div",{style:{marginTop:5},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"AND/OR Reddit Username"}),e.jsx(T,{type:"text",name:"redditUsername",style:{width:200},onChange:S,value:i.redditUsername||"",color:"info",size:"small"})]})]}),e.jsxs("div",{style:{marginTop:15},children:[e.jsxs("div",{style:{fontSize:"1rem"},children:["Your current belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx($,{changeHandler:S,name:"userBelt",form:i,optionsList:["Unranked",...ge],multiple:!1,defaultValue:"",size:"small",width:200})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",marginTop:25},children:[e.jsx(q,{onClick:D,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:v,variant:"contained",color:"success",disabled:!f,children:"SAVE"})]})]})})]})}function Qe({upvote:t,voteNum:a}){const{notes:o,discordUsername:n,redditUsername:d,userBelt:l}=t,i=[n&&`@${n}`,d&&`u/${d.replace(/^\/*u\//,"")}`].filter(Boolean).join(" â€¢ "),m=l&&` (${l})`,f=(o==null?void 0:o.length)>0?`> ${o}`:"";return e.jsxs("div",{style:{marginBottom:10},children:[a+1,". ",e.jsx("strong",{children:i}),m," ",f]})}function Xe({entry:t,expanded:a,onExpand:o,requestMod:n}){var J,K;const{user:d}=s.useContext(ee),l=s.useRef(null),{expandAll:i}=s.useContext(_),[m,f]=s.useState(!1),[p,h]=s.useState(!1),[x,g]=s.useState(!1),[k,w]=s.useState(!1),[r,C]=s.useState({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt}),{requestedBy:F=[]}=t,A=F.filter(c=>!c.owner);s.useEffect(()=>{setTimeout(()=>{C({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt})},100)},[t,C]);const N=s.useCallback((c,j)=>{o&&o(j?t.id:!1)},[t.id,o]),S=s.useCallback(c=>{const{name:j,value:B}=c.target;C({...r,[j]:B}),w(!0)},[r]),D=s.useCallback(c=>{c.preventDefault(),c.stopPropagation(),h(!0)},[h]),v=s.useCallback(()=>{C({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt}),h(!1),g(!1)},[t]),b=s.useCallback(async c=>{var L,Q;const j=`${se}/update-request`,B=JSON.stringify({entry:c});try{await oe({user:d,url:j,json:B,snackBars:!1})}catch(W){console.error("Error updating vote:",W);let ce=((Q=(L=W.response)==null?void 0:L.data)==null?void 0:Q.message)||W.message;M(`Error updating request: ${ce}`,{variant:"error",autoHideDuration:3e3})}finally{v()}},[v,d]),u=s.useCallback(async()=>{const c={...t.originalEntry,requestStatus:"Deleted",lastUpdated:X().toISOString()};await b(c)},[t.originalEntry,b]),R=s.useCallback(async()=>{if(!k)return;r.requestStatus==="Deleted"&&g(!0);const c={...t.originalEntry,makeModels:[{make:r.make,model:r.model}],requestStatus:r.requestStatus||t.requestStatus,belt:r.belt||t.belt,lastUpdated:X().toISOString()};["Ranked","Deleted"].includes(c.requestStatus)||delete c.belt,r.requestStatus==="Deleted"?g(!0):await b(c)},[t,r,b,k]),y=s.useCallback(()=>{g(!1)},[g]);s.useEffect(()=>{if(a&&l&&!m&&!i){const j=window.innerWidth<=600?70:74,{id:B}=fe.parse(location.search),L=B===t.id;f(!0),setTimeout(()=>{window.scrollTo({left:0,top:l.current.offsetTop-j,behavior:L?"auto":"smooth"})},L?0:100)}else a||f(!1)},[a,t,m,i]);const{discord:U,reddit:G}=t.usernames||{},ie=[U&&`@${U}`,G&&`u/${G.replace(/^\/*u\//,"")}`].filter(Boolean).join(" â€¢ "),ne=t.userBelt?` (${t.userBelt})`:"",le=t.belt&&t.belt!=="Unranked"?` (${t.belt})`:"",re=!r.make||r.model.length<1||r.requestStatus==="Ranked"&&!r.belt,de={maxWidth:700,marginLeft:"auto",marginRight:"auto"},{flexStyle:I}=O(),Y=t.requestStatus==="Declined"?.5:1;return e.jsxs(z.Fragment,{children:[e.jsxs(De,{expanded:a,onChange:N,style:de,ref:l,children:[e.jsxs(Ue,{expandIcon:e.jsx(we,{}),style:{cursor:"pointer"},children:[e.jsx(Ee,{value:t.belt}),e.jsx("div",{style:{display:I,width:"100%",alignItems:"center",opacity:Y},children:e.jsxs("div",{style:{display:I,width:"100%",alignItems:"center",opacity:Y},children:[e.jsx(xe,{primary:te(t),primaryTypographyProps:{fontWeight:500,fontSize:"1.1rem"},secondary:t.lockingMechanisms.join(", "),secondaryTypographyProps:{fontSize:"0.9rem"},style:{padding:"0px 0px 0px 10px"}}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"right",marginRight:10},children:t.requestStatus!=="Submitted"&&e.jsxs("span",{children:[t.requestStatus,le]})})]})}),e.jsx(Ke,{user:d,entry:t}),e.jsx(_e,{handleClick:D,requestMod:n})]}),a&&e.jsxs(Ie,{sx:{padding:"0px 16px 0px 16px"},children:[e.jsx("div",{style:{display:I,width:"100%"},children:!!((J=t.notes)!=null&&J.length)&&e.jsx(E,{name:"Notes",value:t.notes,style:{marginRight:20}})}),e.jsxs("div",{style:{display:I,width:"100%",marginTop:15},children:[e.jsx(E,{name:"Requested By",value:ie+ne,style:{marginRight:30},headerStyle:{color:"#aaa",fontSize:"0.9rem"}}),!!t.approximateBelt&&e.jsx(E,{name:"Suggested Belt",value:`${t.approximateBelt} Belt`,style:{marginRight:30},headerStyle:{color:"#aaa",fontSize:"0.9rem"}}),!!t.hazLocc&&e.jsx(E,{name:"Has Lock(s)",value:t.hazLocc,style:{marginRight:0},headerStyle:{color:"#aaa",fontSize:"0.9rem"}})]}),!!((K=t.media)!=null&&K.length)&&e.jsx("div",{style:{marginLeft:6},children:e.jsx(qe,{entry:t})}),A.length>0&&n&&e.jsx(E,{name:"Upvotes",style:{marginRight:20,marginTop:10},headerStyle:{color:"#bbb",fontSize:"1rem"},value:A.map((c,j)=>e.jsx(Qe,{upvote:c,voteNum:j},c.userId))}),e.jsxs(Me,{children:[e.jsx(Ae,{entry:t}),e.jsx(Oe,{entry:t})]})]})]}),e.jsx(V,{open:p,onClose:v,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:30},children:[e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Edit Request",e.jsx("br",{})]}),e.jsx("div",{style:{marginTop:0},children:e.jsx(He,{entry:t,requestMod:n,form:r,setForm:C,setShowEditRequest:h,setUpdated:w})}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Brand"}),e.jsx(T,{type:"text",name:"make",size:"small",style:{width:200},color:"info",onChange:S,value:r.make||"",error:r.make.length===0})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Model Name"}),e.jsx(T,{type:"text",name:"model",size:"small",style:{width:200},color:"info",onChange:S,value:r.model||"",error:r.model.length===0})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:[e.jsx(q,{onClick:v,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:R,variant:"contained",color:"success",disabled:re||!k,children:"SAVE"})]})]})}),e.jsx(V,{open:x,onClose:y,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.5}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Are you sure you want to delete?",e.jsx("br",{}),"Action cannot be undone.",e.jsx("br",{})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center"},children:[e.jsx(q,{onClick:y,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:u,variant:"contained",color:"error",children:"DELETE"})]})]})})]})}function Ze({label:t,sortValues:a,resetAll:o}){const{isMobile:n}=O(),d=n?"block":"flex",l=n?{maxWidth:700,marginLeft:"auto",marginRight:"auto",padding:8}:{maxWidth:700,marginLeft:"auto",marginRight:"auto",padding:12};return e.jsxs("div",{style:{display:d,...l,backgroundColor:"#333",minHeight:72},children:[e.jsx("div",{style:{display:"flex",flexGrow:1,marginLeft:8},children:e.jsx(Fe,{label:t,keepOpen:!0})}),!!a&&e.jsx("div",{style:{margin:"12px 20px 0px 20px"},children:e.jsx(Ne,{sortValues:a,resetAll:o})})]})}function et({requestMod:t}){const{visibleEntries:a=[],expandAll:o}=s.useContext(_),{filters:n}=s.useContext(je),[d,l]=s.useState(n.id),i=s.useMemo(()=>[{label:"Request a Lock",page:"/rankingrequests/submit"},{label:"View Requests",page:"/rankingrequests/view"}],[]),m=ke(),f=s.useCallback(p=>{m(p.page)},[m]);return e.jsxs(z.Fragment,{children:[e.jsx("div",{style:{marginBottom:20,marginTop:1},children:e.jsx($e,{options:i,onChange:f,defaultValue:i[1].label})}),e.jsxs("div",{style:{maxWidth:720,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t&&e.jsx(Ve,{onClick:()=>console.log("visibleEntries",a),style:{color:"#444",cursor:"pointer",marginLeft:10},children:"LOG"}),e.jsx(Ze,{sortValues:We,label:"Lock Requests",resetAll:!0}),a.map((p,h)=>e.jsx(Xe,{entry:p,expanded:p.id===d||!!o,onExpand:l,requestMod:t},h))]})]})}function Yt(){ye("View Ranking Requests");const{user:t,userClaims:a}=s.useContext(ee),{lockCollection:o}=s.useContext(ve),n=["requestAdmin","admin"].some(m=>a.includes(m)),{isMobile:d}=O(),l=Ce(),i=e.jsx(z.Fragment,{children:!d&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(Se,{filterFields:Pe,children:e.jsxs(Be,{allEntries:l,profile:o,children:[e.jsx(be,{title:"Ranking Requests",extras:i}),e.jsx(et,{user:t,requestMod:n})]})})}export{Yt as default};
