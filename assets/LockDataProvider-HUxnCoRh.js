import{r,F as L,aA as V,aq as _,d as m,K as v,ap as q,j as G}from"./index-CVYv3nxH.js";import{D as K,f as W}from"./DataContext-P4qvZ122.js";import{r as I}from"./index-DXMuMz8P.js";import{c as T}from"./collectionStatsById-DY1NVZ7h.js";import{u as $}from"./useData-BhIHpfcf.js";import{h as J}from"./dataUrls-DkJe4Pqg.js";import{f as Q}from"./filterEntriesAdvanced-B_LinbMH.js";import{s as X}from"./setDeep-J6HEwWhX.js";import{i as Y}from"./stringUtils-BsiQ3MZ5.js";import{e as R}from"./entryName-CTL8knYQ.js";function ue({children:O,allEntries:d,profile:o}){const{filters:P,advancedFilterGroups:g}=r.useContext(L),{search:u,tab:i,sort:c,expandAll:M}=P,{data:k,loading:x,error:A}=$({urls:ee}),b=r.useMemo(()=>k&&!x&&!A?k.lockbazzarEntryIds:[],[k,A,x]),[h,B]=r.useState("0.30"),n=r.useMemo(()=>{const a=(o==null?void 0:o.userLockNotes)||{};let l=[];return d.map(e=>{var z,S,j,F;const t=(z=e.media)==null?void 0:z.map(s=>{var w,E;return s&&s.title&&((w=s.title)!=null&&w.includes("By:"))&&X(l,[""],s.title.replace("By: ","").trim()),(E=s==null?void 0:s.thumbnailUrl)!=null&&E.includes("flickr.com")&&(s.thumbnailUrl=s.thumbnailUrl.replace("_w_d.jpg","_w.jpg")),s});return{...e,media:t,makes:e.makeModels[0].make?e.makeModels.map(({make:s})=>s):e.makeModels[0].model,fuzzy:I([R(e,"long")].concat([e.version,e.notes,e.belt]).join(",")),content:[(S=e.media)!=null&&S.some(s=>!s.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(j=e.media)!=null&&j.some(s=>s.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((F=e.links)==null?void 0:F.length)>0?"Has Links":"No Links",_[e.belt].danPoints>0?"Worth Dan Points":void 0,m(e.lastUpdated).isAfter(m().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,a[e.id]?"Has Personal Notes":void 0].flat().filter(s=>s),collection:V.locks.map.map(s=>o&&o[s.key]&&o[s.key].includes(e.id)?s.label:"Not "+s.label),collectionSaves:T[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:a[e.id],photographers:l==null?void 0:l.names}})},[d,o]),f=r.useCallback(a=>{const l=u&&a.find(t=>t.id===u);if(l)return[l];const e=/^\/(.*)\/$/.exec(u);return e&&Y(e[1])?a.reduce((t,z)=>(R(z,"long").match(new RegExp(e[1],"i"))&&t.push(z),t),[]):u?W.go(I(u),a,{keys:Z,threshold:-23e3}).map(t=>({...t.obj,score:t.score})).filter(t=>t.score>parseFloat(h)):a},[u,h]),C=r.useMemo(()=>i==="search"||!i?f(n):f(n).filter(a=>a.simpleBelt===i),[n,f,i]),p=r.useMemo(()=>{const a=Q({advancedFilterGroups:g(),entries:n}),l=f([...a]);return c?l.sort((e,t)=>{if(c==="popularity")return t.collectionSaves-e.collectionSaves||t.views-e.views||e.fuzzy.localeCompare(t.fuzzy);if(c==="beltAscending")return v(e.belt,t.belt);if(c==="beltDescending")return q(e.belt,t.belt);if(c==="alphaAscending")return e.fuzzy.localeCompare(t.fuzzy);if(c==="alphaDescending")return t.fuzzy.localeCompare(e.fuzzy);if(c==="recentlyUpdated")return Math.floor(m(t.lastUpdated).valueOf()/3600)-Math.floor(m(e.lastUpdated).valueOf()/3600)||v(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy);if(c==="dateAdded")return Math.floor(m(t.dateAdded).valueOf()/3600*24)-Math.floor(m(e.dateAdded).valueOf()/3600*24)||v(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}):l},[g,n,f,c]),U=r.useCallback(a=>d.find(l=>l.id===a),[d]),y=r.useMemo(()=>i==="search"||!i?p:p.filter(a=>a.simpleBelt===i),[i,p]),D=r.useCallback(a=>b==null?void 0:b.includes(a),[b]),N=r.useMemo(()=>(o==null?void 0:o.blackBeltAwardedAt)>0,[o]),H=r.useMemo(()=>({allEntries:d,mappedEntries:n,searchedBeltEntries:C,visibleEntries:p,visibleBeltEntries:y,getEntryFromId:U,expandAll:M,profile:o,blackBeltUser:N,lockbazzarAvailable:D,searchCutoff:h,setSearchCutoff:B}),[d,n,C,p,y,U,M,o,N,D,h,B]);return G.jsx(K.Provider,{value:H,children:O})}const Z=["fuzzy"],ee={lockbazzarEntryIds:J};export{ue as D};
