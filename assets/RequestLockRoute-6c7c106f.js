import{r as o,u as I,j as e,R as F,a8 as le,B as z,H as W,A as de,b as ce,Y as K,T as me,D as ue,bC as he,Z as pe,N as ge}from"./index-415cda15.js";import{u as fe}from"./usePageTitle-bb5bcb7e.js";import{D as Z,a as xe}from"./DataContext-12a912fb.js";import{S as M,D as ye}from"./SelectBox-2b92e321.js";import{a as je}from"./filterFields-f703f32d.js";import{D as ke}from"./Dropzone-76dcb14f.js";import{L as ve}from"./LoadingDisplay-6d84150e.js";import{e as J}from"./entryName-19a7c345.js";import{s as be,a as Ce,b as we}from"./setDeep-8470365e.js";import{d as Be}from"./Search-159497ac.js";import{A as Se}from"./Autocomplete-9cbdb066.js";import{T as C}from"./TextField-e08b4be9.js";import{I as Re}from"./Chip-cd513c9a.js";import{C as Le}from"./ChoiceButtonGroup-d540c7a8.js";import{a as Te}from"./rankingRequestData-d3ef79e5.js";import{a as Me}from"./axios-439bb627.js";import{L as Q}from"./Link-fc95f3d7.js";import{C as X}from"./Collapse-18a9be45.js";import{C as ze}from"./Checkbox-d1ba7039.js";import{D as E}from"./Dialog-427c4fd0.js";import"./useDocumentTitle-0753ed46.js";import"./index-14d87f72.js";import"./Select-bbe9f62e.js";import"./index-a5adc662.js";import"./Box-a82b671a.js";import"./CircularProgress-527f121c.js";import"./ToggleButtonGroup-3993f335.js";function De({name:n,changeHandler:a,options:l,style:i,disabled:h=!1,reset:w,placeholder:p="Search...",noOptionsMessage:g,noOptionsHandler:m,inputValueHandler:c}){const k=o.useRef(),[x,R]=o.useState(!1),t=o.useCallback(()=>R(!1),[]),{isMobile:v}=I(),[L,D]=o.useState(""),u=g&&m?e.jsx(z,{onClick:m,variant:"contained",color:"success",children:g}):null,B=o.useCallback((b,y)=>{l.includes(y)?a({target:{name:n,value:y}}):a({target:{name:n,value:void 0}})},[l,a,n]),S=(b,y)=>{c&&c(y),D(y)};return e.jsxs(F.Fragment,{children:[e.jsx(Se,{disabled:h,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,autoHighlight:!0,fullWidth:!0,style:i,options:l,name:n,onChange:B,inputValue:L,onInputChange:S,renderInput:b=>e.jsx(C,{...b,placeholder:p,variant:"outlined",color:"info",inputRef:k,InputProps:{...b.InputProps,startAdornment:e.jsx(Re,{position:"start",children:e.jsx(Be,{})})}}),noOptionsText:u},w||h),e.jsx(le,{invisible:!0,open:x&&v,onClick:t})]})}async function qe({formData:n,user:a,setUploadError:l}){const i=new AbortController,h=setTimeout(()=>{i.abort()},1e4),w=Math.floor(Math.random()*1e6);try{const p=await a.getIdToken(),g=await Me.post(`${Te}/request-lock?${w}`,n,{headers:{Authorization:"Bearer "+p,"Content-Type":"multipart/form-data"},signal:i.signal});if(clearTimeout(h),g.ok)return W("Votes updated"),await g.json().catch(()=>({}));{let m="Error creating request";try{m=(await g.json()).message||m,W(`Error creating request: ${m}`,{variant:"error",autoHideDuration:3e3})}catch{}return{response:{data:{status:g.status,message:m}}}}}catch(p){throw clearTimeout(h),console.error("Error during authentication or server request:",ee(p)),W("Error creating request",{variant:"error",autoHideDuration:3e3}),l(ee(p)),p}}const ee=n=>{if(n.response.data&&typeof n.response.data=="string"){const a=n.message.match(/code (\d+)/)[1],l=n.response.data.match(/<pre>([\s\S]*?)<\/pre>/)[1];return{response:{data:{status:a,message:l}}}}else return n};function Ue(){var V,_,Y,G;const{allEntries:n}=o.useContext(Z),{user:a}=o.useContext(de),{profile:l}=o.useContext(Z),[i,h]=o.useState([]),[w,p]=o.useState(void 0),[g,m]=o.useState(!1),[c,k]=o.useState(!1),[x,R]=o.useState(!1),[t,v]=o.useState({id:te(8)}),[L,D]=o.useState(""),u=o.useCallback(s=>{const{name:r,value:f}=s.target;v({...t,[r]:f})},[t]),B=o.useCallback(()=>{R(!x);const s={...t};s.altBrand=!s.altBrand,s.altBrand?(s.newBrand=L,delete s.make):delete s.newBrand,setTimeout(()=>{v(s)},10),setTimeout(()=>{s.altBrand&&(document.getElementById("newBrand").focus(),document.getElementById("newBrand").select())},100)},[x,t,L]),S=o.useMemo(()=>n==null?void 0:n.sort((s,r)=>J(s,"short").localeCompare(J(r,"short"))).reduce((s,r)=>{const f=r.version?r.version:void 0;return r.makeModels.map(j=>{const d=j.make?j.make:j.model;be(s,["allMakes"],d.trim());const A=j.make?j.model.trim():"Any";Ce(s,["makeModels",d],{model:A,versionText:f})}),s.lockingMechanisms=s.lockingMechanisms||[],we(s,["lockingMechanisms"],r.lockingMechanisms?[...new Set([...s.lockingMechanisms,...r.lockingMechanisms,"Multiple"])].sort():s.lockingMechanisms),s},{}),[n]),b=o.useMemo(()=>{var s;return(s=S.allMakes)==null?void 0:s.sort((r,f)=>r.localeCompare(f))},[S]),y=(t.make||t.newBrand)&&t.model&&t.lockingMechanisms&&t.lockingMechanisms.length>0&&(t.redditUsername||t.discordUsername)&&i.length>0,P=`${t.make||t.newBrand}_${t.model}`.replace("/","+"),O=t.redditUsername&&t.discordUsername?[t.redditUsername,t.discordUsername].join("_").replace("/","+"):`${t.redditUsername||t.discordUsername}`.replace("/","+"),se=async s=>{s.preventDefault(),m(!0);const r={...t,displayName:(l==null?void 0:l.displayName)||"no display name",make:t.make||t.newBrand,droppedFileNames:i.map(d=>d.name),requestStatus:"Submitted"};delete r.altBrand,delete r.newBrand;const f=new FormData;Object.keys(r).forEach(d=>{f.append(d,r[d])});const j=`${P}-${O}`.toLowerCase();i.forEach(d=>{const{base:A,ext:re}=Ae(d.name);f.append("files",d,`${j}/${P}_${A}_${O}.${re}`.toLowerCase())});try{const d=await qe({formData:f,user:a,setUploadError:k});p(d)}catch(d){k(d)}finally{m(!1)}c||(i.forEach(d=>URL.revokeObjectURL(d.preview)),h([]),m(!1)),v(r)},ne=o.useCallback(()=>{i.forEach(s=>URL.revokeObjectURL(s.preview)),h([]),R(!x),v({id:te(8)}),p(void 0),m(!1),k(void 0),setTimeout(()=>{window.scrollTo({left:0,top:0,behavior:"smooth"})},100)},[x,i]),oe=o.useCallback(()=>{p(void 0),m(!1),k(void 0)},[]),$=o.useMemo(()=>[{label:"Request a Lock",page:"/rankingrequests/submit"},{label:"View Requests",page:"/rankingrequests/view"}],[]),q=ce(),ae=o.useCallback(s=>{q(s.page)},[q]),ie=t.altBrand>0?.5:1,{isMobile:N,flexStyle:T}=I(),H=N?300:660,U=N?8:16;return e.jsxs(F.Fragment,{children:[e.jsx("div",{style:{marginBottom:20,marginTop:1},children:e.jsx(Le,{options:$,onChange:ae,defaultValue:$[0].label})}),e.jsxs("div",{style:{maxWidth:720,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[e.jsxs("div",{style:{marginBottom:30,marginRight:U,lineHeight:"1.5rem"},children:[e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:700,marginBottom:10},children:"Suggest a Lock"}),"The lock ranking process for Lockpickers United is a detailed one. It's a community process and identifying new locks for ranking is a big part of it. Use the form below to submit a lock for ranking. A lot of work goes into adding a new lock to the belt rankings, please provide as much information as possible to do your part in the process.",e.jsx("br",{}),e.jsx("br",{}),"Please note that while all requests will be considered, not all locks can be put into the ranking process. Factors include the availability of locks to review, general availability of locks to the community, access to photos and detailed lock information, and the projected value to the community of adding them to the list. Yellow & Orange locks are not added frequently. Â ",e.jsx(Q,{onClick:()=>q("/view?pageId=classificationProcess"),style:{color:"#aaa",cursor:"pointer",fontWeight:700},children:"Click here to learn more"})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,padding:`10px ${U}px`,backgroundColor:"#222",marginBottom:20},children:"Lock Request Info"}),e.jsxs("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:se,children:[e.jsxs("div",{style:{paddingLeft:U},children:[e.jsxs("div",{style:{display:T,marginBottom:30},children:[e.jsxs("div",{children:[e.jsx(X,{in:!t.altBrand,children:e.jsxs("div",{style:{marginRight:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Choose Brand"}),e.jsx(De,{changeHandler:u,options:b,name:"make",style:{width:300,opacity:ie},reset:x,disabled:t.altBrand,inputValueHandler:D,noOptionsMessage:"Add a brand",noOptionsHandler:B})]})}),e.jsxs(X,{in:t.altBrand,children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Enter New Brand"}),e.jsx(C,{type:"text",id:"newBrand",name:"newBrand",value:t.newBrand||"",style:{width:300,marginBottom:0},onChange:u,color:"info"})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(ze,{onChange:B,id:"altBrand",name:"altBrand",checked:t.altBrand||!1,color:"info",size:"small",inputProps:{tabIndex:-1}}),e.jsx(Q,{onClick:B,style:{color:"#fff"},children:"Submit a lock for a new brand."})]})]}),e.jsxs("div",{style:{marginTop:0},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Model Name"}),e.jsx(C,{type:"text",name:"model",style:{width:300},onChange:u,value:t.model||"",color:"info"})]})]}),e.jsxs("div",{style:{display:T,marginTop:20},children:[e.jsxs("div",{style:{marginRight:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Locking Mechanism"}),e.jsx(M,{changeHandler:u,name:"lockingMechanisms",form:t,optionsList:S.lockingMechanisms,size:"large",width:200,multiple:!1,defaultValue:""})]}),e.jsxs("div",{style:{flexGrow:1,maxWidth:440},children:[e.jsxs("div",{style:{fontSize:"1.1rem"},children:["Notes ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:4,color:"info",style:{},value:t.notes||"",maxLength:1200,id:"notes",onChange:u})]})]}),e.jsxs("div",{style:{width:H,marginTop:30},children:[e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:["Lock Photos (at least 1 required)",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"1.0rem",fontWeight:400},children:"Please include body, key, keyway, and if guttable, pictures of all relevant features"})]}),e.jsx(ke,{files:i,setFiles:h})]}),e.jsxs("div",{style:{display:T,marginTop:30,width:H},children:[e.jsxs("div",{style:{marginRight:20},children:[e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:5},children:["Approximate Belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(M,{changeHandler:u,name:"approxBelt",form:t,optionsList:K,multiple:!1,defaultValue:"",size:"large",width:300})]}),e.jsxs("div",{style:{marginTop:0,width:300},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:5},children:"Can you provide locks for review?"}),e.jsx(M,{changeHandler:u,name:"hazLocc",form:t,optionsList:["Yes","No"],multiple:!1,defaultValue:"",size:"large",width:300})]})]}),e.jsxs("div",{style:{marginTop:30},children:[e.jsx("div",{style:{marginRight:50,width:300},children:e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500},children:"Contact Info"})}),e.jsxs("div",{style:{display:T},children:[e.jsxs("div",{style:{marginRight:20},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"Discord Username"}),e.jsx(C,{type:"text",name:"discordUsername",style:{width:200},onChange:u,value:t.discordUsername||"",color:"info"})]}),e.jsxs("div",{style:{marginRight:40},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"AND/OR Reddit Username"}),e.jsx(C,{type:"text",name:"redditUsername",style:{width:200},onChange:u,value:t.redditUsername||"",color:"info"})]}),e.jsxs("div",{style:{marginTop:0},children:[e.jsxs("div",{style:{fontSize:"1rem"},children:["Your current belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(M,{changeHandler:u,name:"userBelt",form:t,optionsList:["Unranked",...K],multiple:!1,defaultValue:"",size:"large",width:200})]})]})]})]}),e.jsx("div",{style:{marginTop:30,width:"100%",display:"flex",justifyContent:"center"},children:e.jsx(z,{type:"submit",variant:"contained",color:"info",disabled:!y||g,children:"Submit"})})]}),e.jsx(E,{open:g,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:e.jsx(ve,{})})}),e.jsx(E,{open:!!w&&!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsx("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:"Lock request submitted!"}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:ne,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(E,{open:!!c,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",e.jsx("br",{}),"Please try again later.",e.jsx("br",{})]}),e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",(_=(V=c==null?void 0:c.response)==null?void 0:V.data)==null?void 0:_.message," (",(G=(Y=c==null?void 0:c.response)==null?void 0:Y.data)==null?void 0:G.status,")"]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:oe,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(me,{feature:"uploadPhotos"})]})]})}function Ae(n){const a=n.lastIndexOf(".");return a===-1?{base:n,ext:""}:{base:n.substring(0,a),ext:n.substring(a)}}function te(n){const a="0123456789ABCDEF";let l="";for(let i=0;i<n;++i)l+=a.charAt(Math.floor(Math.random()*a.length));return l.toLowerCase()}function dt(){fe("Lock Ranking Request");const{lockCollection:n}=o.useContext(ue),{isMobile:a}=I(),l=he(),i=pe.concat(l),h=e.jsx(F.Fragment,{children:!a&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(xe,{filterFields:je,children:e.jsxs(ye,{allEntries:i,profile:n,children:[e.jsx(ge,{title:"Lock Ranking Request",extras:h}),e.jsx(Ue,{})]})})}export{dt as default};
