import{r,F as I,aw as S,al as B,d as n,az as v,ak as O,j as w}from"./index-Prhh25DF.js";import{D as F,f as N}from"./DataContext-DAT1aOTB.js";import{r as C}from"./index-scj23aL-.js";import{c as P}from"./collectionStatsById-DY1NVZ7h.js";import{u as R}from"./useData-COqztJ0L.js";import{h as H}from"./dataUrls-ZPc7x5xp.js";function Z({children:U,allEntries:d,profile:s}){const{filters:D}=r.useContext(I),{search:i,id:V,tab:W,name:K,sort:o,image:q,expandAll:b,...z}=D,{data:p,loading:k,error:h}=R({urls:L}),m=r.useMemo(()=>p&&!k&&!h?p.lockbazzarEntryIds:[],[p,h,k]),A=r.useMemo(()=>d.map(t=>{var l,u,c;return{...t,makes:t.makeModels[0].make?t.makeModels.map(({make:e})=>e):t.makeModels[0].model,fuzzy:C(t.makeModels.map(({make:e,model:a})=>[e,a]).flat().filter(e=>e).concat([t.version,t.notes,t.belt]).join(",")),content:[(l=t.media)!=null&&l.some(e=>!e.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(u=t.media)!=null&&u.some(e=>e.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((c=t.links)==null?void 0:c.length)>0?"Has Links":"No Links",B[t.belt].danPoints>0?"Worth Dan Points":void 0,n(t.lastUpdated).isAfter(n().subtract(1,"days"))?"Updated Recently":void 0,t.belt.startsWith("Black")?"Is Black":void 0,t.belt!=="Unranked"?"Is Ranked":void 0].flat().filter(e=>e),collection:S.locks.map.map(e=>s&&s[e.key]&&s[e.key].includes(t.id)?e.label:"Not "+e.label),collectionSaves:P[t.id]||0,simpleBelt:t.belt.replace(/\s\d/g,"")}}),[d,s]),y=r.useMemo(()=>{const t=Object.keys(z).map(e=>{const a=z[e];return Array.isArray(a)?a.map(f=>({key:e,value:f})):{key:e,value:a}}).flat(),l=A.filter(e=>t.every(({key:a,value:f})=>Array.isArray(e[a])?e[a].includes(f):e[a]===f)),u=i&&l.find(e=>e.id===i);let c=l;return u?c=[u]:i&&(c=N.go(C(i),l,{keys:E,threshold:-25e3}).map(e=>({...e.obj,score:e.score}))),o?c.sort((e,a)=>{if(o==="popularity")return a.collectionSaves-e.collectionSaves||a.views-e.views||e.fuzzy.localeCompare(a.fuzzy);if(o==="beltAscending")return v(e.belt,a.belt);if(o==="beltDescending")return O(e.belt,a.belt);if(o==="alphaAscending")return e.fuzzy.localeCompare(a.fuzzy);if(o==="alphaDescending")return a.fuzzy.localeCompare(e.fuzzy);if(o==="recentlyUpdated")return Math.floor(n(a.lastUpdated).valueOf()/3600)-Math.floor(n(e.lastUpdated).valueOf()/3600)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy);if(o==="dateAdded")return Math.floor(n(a.dateAdded).valueOf()/3600*24)-Math.floor(n(e.dateAdded).valueOf()/3600*24)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy)}):c},[z,A,i,o]),M=r.useCallback(t=>d.find(l=>l.id===t),[d]),g=r.useCallback(t=>m==null?void 0:m.includes(t),[m]),x=r.useMemo(()=>(s==null?void 0:s.blackBeltAwardedAt)>0,[s]),j=r.useMemo(()=>({allEntries:d,visibleEntries:y,getEntryFromId:M,expandAll:b,profile:s,blackBeltUser:x,lockbazzarAvailable:g}),[d,y,M,b,s,x,g]);return w.jsx(F.Provider,{value:j,children:U})}const E=["fuzzy"],L={lockbazzarEntryIds:H};export{Z as D};
