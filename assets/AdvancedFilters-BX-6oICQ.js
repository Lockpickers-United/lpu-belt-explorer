import{r as s,F as S,j as t,A as O,a6 as E,ak as W,an as $,O as q,u as P,aa as H,ab as J,B as w}from"./index-1-4DE_pP.js";import{A as B,F as K,R as Q}from"./ViewFilterButtons-BhFCHz8G.js";import{C as U}from"./ChoiceButtonGroup-C6cvB1O3.js";import{T as X,a as Y}from"./ToggleButtonGroup-uRCTuVvZ.js";import{C as V}from"./Collapse-CAfdaVB4.js";import{F as Z,I as ee,S as te}from"./Select-BoUI-E1h.js";import{D as se}from"./DataContext-BEEtOGCN.js";function le({group:n={},onChange:e}){const{fieldName:f="",matchType:m="Is",operator:p="OR",values:r=[],groupIndex:i=0}=n,{filterFields:g}=s.useContext(S),v=g.find(a=>a.fieldName===f)||{},b=s.useMemo(()=>[{label:"OR",value:"OR"},{label:"AND",value:"AND"}],[]),h=s.useCallback(()=>{const a=[...r,""];e&&e({values:a})},[e,r]),o=s.useCallback(a=>{const u=(a==null?void 0:a.value)||(a==null?void 0:a.label)||"OR";e&&e({operator:u})},[e]),y=s.useCallback((a,u)=>{const l=r.map((c,I)=>I===a?u:c);e&&e({values:l})},[e,r]),F=s.useCallback(a=>{const u=r.filter((l,c)=>c!==a);e&&e({values:u})},[e,r]);return t.jsxs("div",{children:[r.length>0&&r.map((a,u)=>t.jsxs("div",{style:{display:"block",width:250},children:[t.jsx(B,{...v,active:!0,group:n,groupIndex:i,matchType:m,operator:p,valueIndex:u,currentValue:a,groupValues:r,onFilter:l=>y(u,l),onRemove:()=>F(u),handleAddValue:h,size:"small"},u),u===0&&r.length>1&&t.jsx(U,{options:b,defaultValue:p,onChange:o,small:!0,rounded:!0,style:{margin:"0px 0 13px 0"}})]},u)),r.length===0&&t.jsx(B,{...v,active:!0,group:n,groupIndex:i,matchType:m,operator:p,currentValue:"",onFilter:a=>e&&e({values:[a]}),onRemove:()=>e&&e({values:[]}),handleAddValue:h,size:"small"},0)]})}function ae({options:n,onChange:e,defaultValue:f,rounded:m,small:p=!1,style:r={}}){const[i,g]=s.useState(f||n[0].value),v=s.useCallback(o=>()=>{const y=n.find(F=>F.value===o);g(o),e&&e(y)},[e,n]),b=p?{padding:"1px 10px"}:{padding:"6px 12px"},h=m?null:{borderRadius:0};return t.jsx(X,{variant:"outlined",style:{...r,borderRadius:m?4:0},children:n.map(o=>t.jsx(Y,{onClick:v(o.value),style:{color:i===o.value?"#eee":"#777",backgroundColor:i===o.value?o.backgroundColor||"#292929":"#111",borderColor:"#000",...b,...h},value:String(i),children:o.label},o.value))})}function ne({group:n={},onChange:e}){const{isLoggedIn:f}=s.useContext(O),{beta:m}=s.useContext(E),{filterFields:p,advancedFilterGroups:r}=s.useContext(S),{fieldName:i="",matchType:g="Is"}=n,[v,b]=s.useState(i),h=s.useMemo(()=>p.filter(l=>(!l.beta||m)&&(!l.userBased||f)).filter(l=>!r().some(c=>c.fieldName===l.fieldName&&l.fieldName!==i)),[r,m,i,p,f]),o=s.useCallback(l=>{const c=l.target.value;b(c),e&&e({fieldName:c,values:[]}),setTimeout(()=>document.activeElement.blur())},[e]),y=s.useMemo(()=>[{label:"Is",value:"Is"},{label:"Not",value:"Is Not",backgroundColor:"#733030"}],[]),F=s.useCallback(l=>{const c=(l==null?void 0:l.value)||(l==null?void 0:l.label)||"Is";e&&e({matchType:c})},[e]),[a,u]=s.useState(!1);return s.useEffect(()=>{u(!0)},[]),t.jsx(V,{in:a||i.length>0,unmountOnExit:!0,children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",margin:"0px 0 12px 0",alignItems:"flex-start"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",marginTop:0},children:[t.jsxs(Z,{style:{width:200,marginRight:0,marginTop:8},size:"small",children:[t.jsx(ee,{color:"info",children:"Filter"}),t.jsx(te,{value:v,label:"Filter",onChange:o,color:"info",name:"fieldName",children:h.map((l,c)=>t.jsx(W,{value:l.fieldName,children:l.label},c))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx(ae,{options:y,defaultValue:g,onChange:F,small:!1,rounded:!0,style:{height:40,margin:"8px 12px 8px 12px",borderRadius:4}}),t.jsx("br",{})]})]}),t.jsx("div",{style:{display:"flex",alignItems:"flex-start",marginTop:8},children:t.jsx(le,{group:n,onChange:e})})]})})}function pe(){const{advancedFilterGroups:n,setAdvancedFilterGroups:e,showAdvancedSearch:f,setShowAdvancedSearch:m,hideAdvancedSearch:p,filterFields:r,filterCount:i,removeFilters:g,clearFilters:v}=s.useContext(S),{visibleEntries:b=[],visibleBeltEntries:h}=s.useContext(se),{beta:o}=s.useContext(E),{isLoggedIn:y}=s.useContext(O),F=$(),a=q.parse(F.search);s.useEffect(()=>{a.preview==="advanced"&&(m(!0),g(["preview"]))},[g,a.preview,m]);const u=s.useMemo(()=>n().filter(x=>{const d=r.find(j=>j.fieldName===x.fieldName);return(!(d!=null&&d.beta)||o)&&(!(d!=null&&d.userBased)||y)}),[n,o,r,y]),l=s.useCallback(()=>{const x=[...n(),{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}];e(x)},[n,e]),c=s.useCallback(()=>{v()},[v]),I=s.useCallback((x,d)=>{const N=n().map((C,_)=>_===x?{...C,...d}:C);e(N)},[n,e]),M=s.useCallback(x=>{let j=n().filter((N,C)=>C!==x);j.length===0&&(j=[{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),e(j)},[n,e]);s.useEffect(()=>{n().length===0&&!p&&e([{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),i>0&&m(!0)},[n,i,p,e,m]);const{isMobile:R}=P(),G=R?{maxWidth:700,borderRadius:0}:{maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},A=R?8:16,D=R?2:0,[z,T]=s.useState(!1);s.useEffect(()=>{p?T(!1):(f||i>0)&&T(!0)},[f,i,p]);const[L,k]=s.useState(!1);return s.useEffect(()=>{if(f||i>0)k(!0);else{const x=setTimeout(()=>{k(!1)},300);return()=>clearTimeout(x)}},[f,i]),t.jsx(V,{in:z,unmountOnExit:!0,children:L&&t.jsx(H,{style:{...G,paddingBottom:0,paddingTop:16},id:"advanced-filters",children:t.jsxs(J,{style:{paddingTop:0,paddingLeft:A,paddingRight:A,alignItems:"top"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"top",marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"top"},children:[t.jsxs("div",{style:{display:"flex",marginRight:36,marginBottom:0,alignItems:"center"},children:[t.jsx("div",{style:{fontWeight:700,fontSize:"1.3rem"},children:"Advanced Filters"}),t.jsxs("div",{style:{fontWeight:400,fontSize:"1.0rem",marginLeft:8},children:["(",(h||b||[]).length||0," Lock",(h||b||[]).length!==1&&"s",")"]})]}),t.jsx(K,{style:{margin:"16px 0px 0px 0px"}})]}),t.jsx("div",{style:{flexGrow:1,textAlign:"right",alignItems:"top",marginTop:D},children:t.jsx(Q,{alwaysShow:!0})})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:u.map((x,d)=>t.jsx(ne,{group:{...x,groupIndex:d,groupId:x._id},groupIndex:d,onChange:j=>I(d,j),onRemove:()=>M(d)},x._id||d))}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:[t.jsx(w,{onClick:c,variant:"contained",size:"small",style:{backgroundColor:"#444",marginRight:16},children:"Clear"}),t.jsx(w,{onClick:l,variant:"contained",color:"info",size:"small",children:"Add Filter"})]})]})})})}export{pe as A};
