import{d as R,u as w,j as t,R as L,r as p,b as z,L as H,A as Y,e as N,N as O,h as q,T as G}from"./index-D01eBc1l.js";import{c as I}from"./filterFields-BCRMGmQe.js";import{L as X}from"./LoadingDisplay-C2kTzkgv.js";import{u as P}from"./useData-C7DPD_N1.js";import{u as E}from"./usePageTitle-CQPZEzG2.js";import{j as U,k as $,m as _}from"./dataUrls-CThgH6Wi.js";import{y as A}from"./nivo-line-wWuIGXrz.js";import{p as V}from"./adminChartDefaults-CBhS7ojG.js";import{A as J}from"./AdminStatsTable-CKiIynXa.js";import{R as K}from"./RaffleAutocompleteBox-C-WMHKfR.js";import{R as k}from"./RaffleContext-CNnOV64i.js";import{D as B}from"./DataTableSort-CZp4A5ln.js";import{R as Q,a as Z}from"./RaffleYOYLines-CXqvx-Ai.js";import{C as tt}from"./ChoiceButtonGroup-Bes6M91q.js";import{X as et}from"./nivo-bar-DbkbN3IE.js";import{p as it}from"./chartDefaults-pV7GKcxU.js";import{A as nt}from"./AdminToolsButton-PWY3NgBG.js";import{R as at}from"./RaffleHeader-C7IiN8ak.js";import"./LPU-DltM2OBF.js";import"./LinearProgress-CVhgtVVD.js";import"./nivo-legends-utFuNPIK.js";import"./nivo-axes-BlnHuVMA.js";import"./uniq-CxMiNLuq.js";import"./line-CLQgg_SF.js";import"./TableRow-B0D9mV6D.js";import"./Search-DeRDyapx.js";import"./useFormControl-CG68q2Yj.js";import"./Select-7y2lZ8-z.js";import"./TextField-DsCikjIk.js";import"./index-CK0MffGD.js";import"./setDeep-J6HEwWhX.js";import"./ArrowDropDown-BhR-EAyl.js";import"./ToggleButtonGroup-Cvsp3sPq.js";import"./_baseClone-ro_2OR6C.js";import"./EmojiEvents-D6g3aiCg.js";import"./Cached-Xtxyeobc.js";import"./ExpandMore-DyrSLy9U.js";import"./CircularProgress-l3ElRn1S.js";import"./Box-BeXILIrE.js";import"./AccordionSummary-D6jrZoEQ.js";import"./Collapse-C2GtEAfg.js";const st=({lineData:i})=>{const s=[i.rafl28days.data],e=[],n=new Map,l=new Map,m=new Map;s.forEach(f=>{const b=[],j=[],a=[];for(let c=0;c<f.length;c++){let h=f[c].date;if(R(h)<R("2024-12-25"))continue;h=h+" 23:59:59";const y=new Map;y.x=h,y.y=f[c].potListViews,b.push(y);const v=new Map;v.x=h,v.y=f[c].potViews,j.push(v);const D=new Map;D.x=h,D.y=f[c].raflForm,a.push(D)}n.id="Pot List",n.data=b,l.id="Pot Views",l.data=j,m.id="Entry Form",m.data=a,e.push(l),e.push(n),e.push(m)});const{width:d}=w(),r=d<=360,x=d<=395,o=d<=428,u=d<=560,g=d<=820,S=r||x?200:o?210:g?230:350,C=u?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:S,width:"100%"},children:t.jsx(A,{theme:V,data:e,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:C,height:S,curve:"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function ot({data:i}){const{width:s}=w(),e=s<=560,m={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...e?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:m,children:t.jsx(st,{lineData:i})})})})}const rt=({data:i})=>{const{rafl28days:s}=i,e=s.data.filter(f=>R(f.date)>R("2024-12-28")),n=e.reduce((f,b)=>(Object.keys(s.data[s.data.length-1]).map(j=>{["date","dateString"].includes(j)||(f[j]=f[j]?f[j]+b[j]:b[j])}),f),{});n.dateString="Total",e.push(n);const l=Object.keys(n).reduce((f,b)=>(f[b]=Math.floor(n[b]/e.length),f),{});l.dateString="Average",e.push(l);const m={columns:s.columns,data:e},{width:d}=w(),r=d<=360,x=d<=395,o=d<=428,u=d<=560,g=d<=820,S=r?".8rem":x?".85rem":o?".9rem":".95rem";return t.jsx(J,{tableData:m,tableWidth:"100%",fontSize:S})},lt=({statsData:i})=>{const{allPots:s}=p.useContext(k),{potViewsById:e}=i,{data:n}=P({url:U}),{potWatches:l}=n||{},m=z(),d=[{name:"Pot #",align:"center",id:"potNumber"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views",descending:!0},{id:"uniqueDonorCount",name:"Donors",align:"center",descending:!0},{id:"totalTickets",name:"Tickets",align:"center",descending:!0},{id:"watchlists",name:"Watchlists",align:"center",descending:!0}],[r,x]=p.useState({}),o=s.map(a=>{var D,W;const c=s.find(F=>F.id===a.id)||{};if(!c)return null;const h=e.data.find(F=>F.id===a.id)||{};a={...a,views:h.views||0,percentViews:h.percentViews||0,uniqueDonorCount:h.uniqueDonorCount||0,totalTickets:h.totalTickets||0};let y=c!=null&&c.title?c.title.substring(0,28):`unknown (${a.id})`;y=((D=c==null?void 0:c.title)==null?void 0:D.length)<28||!(c!=null&&c.title)?y:y+"...";const v=(W=a==null?void 0:a.id)==null?void 0:W.replace("2025-","");return{...a,...c,title:y,id:v,watchlists:(l==null?void 0:l[a.id])||0,percentViews:Math.floor(a.percentViews*100)+"%"}}).filter(a=>a),g=(Object.keys(r).length>0?[o==null?void 0:o.find(a=>a.title===r.itemTitle)]:o||[]).map(a=>a.donors&&a.donors>0?{...a}:{...a,donors:0,tickets:0}),C={columns:d,rows:g,defaultSort:"potNumber",sortable:!0},f=p.useCallback((a,c)=>{const h=o.find(v=>v.title===c),y=h==null?void 0:h.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return a==="title"?t.jsx(H,{onClick:()=>m(`/rafl/?id=2025-${h.id}&name=${y}`),style:{color:"#fff"},children:c}):c},[m,o]),b=p.useCallback(a=>a!=null&&a.title?a.title:"unknown",[]);return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(K,{allItems:o,value:r.itemTitle||null,setItemDetails:x,getOptionTitle:b,searchText:"Search Pots"})})}),t.jsx(B,{tableData:C,tableWidth:"100%",linkFunction:f})]})},dt=()=>{const{allCharities:i}=p.useContext(k),{isMobile:s}=w(),e=s?24:48,n=i.map(o=>{var g;let u=o!=null&&o.name?o==null?void 0:o.name.substring(0,e):"unknown";return u=((g=o==null?void 0:o.name)==null?void 0:g.length)<e?u:u+"...",{...o,displayName:u}}),d={columns:[{id:"displayName",align:"left",name:"Charity Name"},{id:"donations2024",name:"2024",align:"left",displayField:"donations2024text",descending:!0},{id:"donations2025",name:"2025",align:"center",displayField:"donations2025text",descending:!0},{id:"donations",name:"Raised",align:"right",displayField:"donationsText",descending:!0},{id:"donors",name:"Donors",align:"center",descending:!0}],rows:n,defaultSort:"displayName",sortable:!0},r="100%",x=p.useCallback((o,u)=>u,[]);return t.jsx("div",{style:{marginTop:20,width:r},children:t.jsx(B,{tableData:d,tableWidth:r,linkFunction:x})})};function T({chartHeight:i,chartdata:s,showAxisBottom:e,colors:n,tickValues:l,curve:m}){const d=e?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},r=e?"bottom":"top-left",x=e?70:20,o=e?0:20;return t.jsx("div",{style:{height:i,width:"100%"},children:t.jsx(A,{theme:V,data:s,enableGridX:!1,enableGridY:!1,colors:n,lineWidth:3,margin:d,height:i,curve:m??"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:l||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:e?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:e?[]:[{anchor:r,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:o,translateY:x,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const ct=()=>{const{summary:i}=p.useContext(k),s={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},e=120;return i.lineDataCurrent.cumulativeDonations.length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:s,children:"Donations"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(T,{chartdata:[{id:"Donations Cumulative",data:i.lineDataCurrent.cumulativeDonations}],chartHeight:e,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(T,{chartdata:[{id:"Donations",data:i.lineDataCurrent.totalDonations}],chartHeight:e,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:s,children:"Unique Donors"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(T,{chartdata:[{id:"Donors Cumulative",data:i.lineDataCurrent.cumulativeUniqueDonors}],chartHeight:e,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(T,{chartdata:[{id:"Donors",data:i.lineDataCurrent.totalEntries}],chartHeight:e,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},mt=({beltDistribution:i})=>{const{width:s}=w(),e=s<500,n=250,l=e?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},m=e?-45:0,d=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:n},children:t.jsx(et,{data:i,maxValue:"auto",margin:l,padding:.15,colors:r=>d[r.index%d.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:m},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:it,isInteractive:!1})})};function ut({data:i}){const s=p.useMemo(()=>M.map(r=>({value:i.beltDonations[r]?i.beltDonations[r]/i.totalDonations:0,id:r,label:r})),[i]),e=p.useMemo(()=>M.map(r=>({value:i.beltDonorCountUnique[r]?i.beltDonorCountUnique[r]/i.totalDonorCountUnique:0,id:r,label:r})),[i]),n=p.useMemo(()=>[{label:"Donations",data:s},{label:"Donors",data:e}],[s,e]),[l,m]=p.useState(n[0]),d=p.useCallback(r=>m(r),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(tt,{options:n,onChange:d}),t.jsx(mt,{beltDistribution:l.data})]})}const M=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"];function ft(){E("RAFL Report");const{data:i,loading:s,error:e}=P({urls:ht}),{raflResponseDetails:n,raflSiteStats2025:l}=i||{},{allPots:m}=p.useContext(k),{width:d}=w(),x=d<560?"8px 8px 32px 8px":"24px 24px 32px 24px",o={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},u={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},g=o,S=s?"--":"(updated: "+R(n==null?void 0:n.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return s?t.jsx(X,{}):e?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:x,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:g,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:S})]}),t.jsx(Q,{animate:!1}),t.jsx("div",{style:o,children:"Totals Over Time"}),t.jsx(Z,{}),t.jsx(ct,{data:n==null?void 0:n.detailedData}),t.jsx("div",{style:u,children:"Site Traffic"}),t.jsx(ot,{data:l}),t.jsx("div",{style:u,children:"Belt Distribution"}),t.jsx(ut,{data:n==null?void 0:n.summaryData}),t.jsx("div",{style:u,children:"Page Tracking"}),t.jsx(rt,{data:l}),t.jsx("div",{style:u,children:"Pot Details"}),t.jsx(lt,{statsData:l,allPots:m}),t.jsx("div",{style:u,children:"Charity Details"}),t.jsx(dt,{})]})}const ht={raflSiteStats2025:_,raflResponseDetails:$};function ie(){const{authLoaded:i}=p.useContext(Y),{isMobile:s}=w(),{raffleAdmin:e}=p.useContext(k),n=t.jsxs(L.Fragment,{children:[!s&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(nt,{})]}),l=s?8:0,m={maxWidth:800,marginLeft:"auto",marginRight:"auto",paddingLeft:l,paddingRight:l};return t.jsx(N,{filterFields:I,children:t.jsxs("div",{style:m,children:[t.jsx(O,{title:"RAFL Report",extras:n}),t.jsx(at,{page:"reports",width:700}),i&&e&&t.jsx(ft,{}),t.jsx(q,{}),t.jsx(G,{feature:"raflReport"})]})})}export{ie as default};
