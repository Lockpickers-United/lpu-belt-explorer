import{j as e,X as k,r as a,ad as z,a5 as L,R as E,U as w,W as T,bs as M,B as S,b as A,u as B,bL as W}from"./index-Bj9mg9S5.js";import{R as C}from"./RaffleContext-CaYAFCDM.js";import{C as D}from"./Cached-D6r1w_jF.js";import{E as N}from"./ExpandMore-DPsIWtls.js";import{V as P}from"./AdminToolButtons-BVJ3cVAE.js";import{C as O,c as $}from"./CircularProgress-AwRYr0nl.js";import{n as q}from"./dataUrls-CThgH6Wi.js";import{a as H}from"./index-xsH4HHeE.js";import{B as I}from"./Box-BvGlLdTW.js";import{A as G,a as U,b as V}from"./AccordionSummary-CgPPn5gZ.js";function Z({diameter:t=40}){return e.jsx("div",{style:{display:"flex",placeItems:"center",justifyContent:"center",width:t,height:t},children:e.jsx(O,{variant:"indeterminate",disableShrink:!0,sx:{color:c=>(c.palette.mode==="light","#fff"),animationDuration:"550ms",[`& .${$.circle}`]:{strokeLinecap:"round"}},size:18,thickness:5})})}const J=(t,c)=>{const[r,s]=t.split("#"),l=r.includes("?")?"&":"?";return`${r}${l}${c}${s?"#"+s:""}`},_=async({user:t,url:c,formData:r,json:s,snackBars:l,timeoutDuration:f=15e3})=>{var g,y,v,j,b,R;const n=new AbortController,h=setTimeout(()=>{n.abort()},f),x=Math.floor(Math.random()*1e6),m=t?await t.getIdToken():null,i=s!==void 0&&r===void 0,d={...m&&{Authorization:`Bearer ${m}`}},u=i?s:r;let o=u;try{typeof FormData<"u"&&u instanceof FormData&&(o=Object.fromEntries(u.entries()))}catch{}try{const p=await H.get(J(c,x),{headers:d,signal:n.signal,params:o});return clearTimeout(h),p.data}catch(p){clearTimeout(h);const F=p.name==="CanceledError"||p.code==="ERR_CANCELED"||((g=p.message)==null?void 0:g.includes("aborted"))?"Request timed out. Please try again.":((j=(v=(y=p.response)==null?void 0:y.data)==null?void 0:v.error)==null?void 0:j.message)||((R=(b=p.response)==null?void 0:b.data)==null?void 0:R.message)||p.message||"Error during authentication or server request";throw{...p,message:F}}};function X({refresh:t,page:c}){const[r,s]=a.useState(!1),[l,f]=a.useState(""),[n,h]=a.useState(!1),{preview:x,setPreview:m}=a.useContext(C),[i,d]=z(),u=i.has("preview"),o=x||u,g=a.useCallback(async()=>{const b=`${q}/refresh-preview`;try{s(!0);const R=await _({url:b,snackBars:!1,timeoutDuration:3e4});k("Request successful",{variant:"success"}),f(R)}catch(R){k(`Error creating request: ${R.message}`,{variant:"error",autoHideDuration:3e3})}finally{s(!1)}await t()},[t]),y=a.useRef(null),v=a.useCallback(()=>{u?(i.delete("preview"),d(i),m(!1)):m(!x)},[x,u,i,m,d]);L("p",()=>v(),{preventDefault:!0});const j=o?"#983de6":"#fff";return e.jsxs(E.Fragment,{children:[c!=="pots"?e.jsx(I,{ref:y,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:e.jsx(w,{style:{padding:8},disabled:!0,children:e.jsx(P,{style:{color:j,opacity:.5},fontSize:"small"})})}):e.jsx(I,{ref:y,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:o?e.jsx(M,{in:o,direction:"left",appear:!1,children:e.jsxs("div",{style:{display:"flex",flexGrow:1,marginRight:0},children:[e.jsx(S,{onClick:v,style:{padding:"0px 8px 0px 0px",marginRight:0,color:"#8830d3",fontSize:"1.0rem",lineHeight:"1.2rem",whiteSpace:"nowrap"},children:"PREVIEW MODE ON"}),r?e.jsx("div",{style:{marginRight:0},children:e.jsx(Z,{diameter:36})}):e.jsx(T,{title:"Refresh From Sheet",arrow:!0,disableFocusListener:!0,children:e.jsx(w,{onClick:g,style:{marginRight:0},children:e.jsx(D,{fontSize:"small"})})}),e.jsx(w,{onClick:v,style:{padding:8},children:e.jsx(P,{style:{color:j},fontSize:"small"})})]})}):e.jsx(T,{title:"Toggle Preview Mode",arrow:!0,disableFocusListener:!0,children:e.jsx(w,{onClick:v,style:{padding:8},children:e.jsx(P,{style:{color:j},fontSize:"small"})})})}),(l==null?void 0:l.status)==="Errors"&&e.jsxs(G,{expanded:n,onChange:()=>h(!n),sx:{".MuiAccordionSummary-content":{margin:0}},children:[e.jsx(U,{expandIcon:e.jsx(N,{}),style:{maxWidth:700,margin:"0px auto 10px auto",paddingLeft:20,fontWeight:700,fontSize:"1rem",backgroundColor:"#e34141"},children:"There were errors trying to import"}),e.jsx(V,{style:{maxWidth:700,margin:"20px auto 10px auto",padding:10,fontWeight:400,fontSize:"0.8rem",backgroundColor:"#e34141",display:"flex",alignItems:"center"},children:e.jsx("pre",{children:JSON.stringify(l,null,2)})})]})]})}function K({page:t,width:c=700}){const{preview:r,setPreview:s,refresh:l}=a.useContext(C),[f,n]=z(),h=f.has("preview"),x=r||h,m=A(),{setAnimateTotal:i}=a.useContext(C),d=a.useCallback(j=>{m(j),i(!1)},[m,i]),u=a.useCallback(()=>{x&&t==="pots"&&(f.delete("preview"),n(f),s(!1))},[t,f,s,n,x]),{isMobile:o}=B(),g=o?"1.0rem":"1.03rem",y=!r||t!=="pots"||!o,v={maxWidth:c,marginLeft:"auto",marginRight:"auto",display:"flex",alignItems:"center",height:40};return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:v,children:[e.jsx(w,{style:{padding:4},onClick:u,disabled:t!=="pots",children:e.jsx(W,{fontSize:"medium",style:{color:"#4c82fd"}})}),y&&e.jsxs(E.Fragment,{children:[e.jsx(S,{onClick:()=>d("/rafl/admin"),style:{padding:"0px 8px",marginRight:10,marginLeft:10,color:t==="entries"?"#48adf1":"#ccc",fontSize:g},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="entries",children:"ENTRIES"}),e.jsx(S,{onClick:()=>d("/rafl/reports"),style:{padding:"0px 8px",marginRight:10,color:t==="reports"?"#48adf1":"#ccc",fontSize:g},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="reports",children:"REPORTS"})]}),e.jsx("div",{style:{display:"flex",flexGrow:1,justifyContent:"right"},children:e.jsx(X,{page:t,refresh:l})})]}),e.jsx("div",{style:{height:2}})]})}function ce({page:t,width:c=700}){const{raflState:r,raffleAdminRole:s}=a.useContext(C),l=A(),{setAnimateTotal:f}=a.useContext(C),n=a.useCallback(y=>{l(y),f(!1)},[l,f]),{isMobile:h,flexStyle:x}=B(),m=h?0:4,i=h?"1.0rem":"1.03rem",d=h?3:10,u={maxWidth:c,marginLeft:"auto",marginRight:"auto",marginTop:10,padding:"0px 0px 0px 0px",fontWeight:700,display:x};let o=r!=="preview"||s||h?"PRIZES":"PRIZE PREVIEW";o=["hidden","post"].includes(r)?o.replace("PRIZES","2026 PRIZES"):o;const g=r==="live"||s?"ENTER":"INFO";return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:u,children:[e.jsx("div",{style:{flexGrow:1,fontSize:"1.7rem",marginTop:0},children:"LPU Annual Raffle"}),e.jsxs("div",{style:{marginTop:m,justifyItems:"right"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(S,{onClick:()=>n("/rafl"),style:{marginRight:d,color:t==="pots"?"#fff":"#ccc",fontSize:i},disabled:t==="pots",children:o}),r==="preview"&&!s&&e.jsx(S,{onClick:()=>n("/rafl/announce"),style:{marginRight:d,color:t==="announce"?"#fff":"#ccc",fontSize:i},disabled:t==="announce",children:"CONTRIBUTE"}),(r!=="hidden"||s)&&e.jsx(S,{onClick:()=>n("/rafl/charities"),style:{marginRight:d,color:t==="charities"?"#fff":"#ccc",fontSize:i},disabled:t==="charities",children:"CHARITIES"}),(["preview","live","post"].includes(r)||s)&&e.jsx(S,{onClick:()=>n("/rafl/enter"),style:{marginRight:0,color:t==="enter"?"#fff":"#ccc",fontSize:i},children:g}),(["live","post"].includes(r)||s)&&e.jsx(S,{onClick:()=>n("/rafl/stats"),style:{marginLeft:d,color:t==="stats"?"#fff":"#ccc",fontSize:i},children:"STATS"})]})]}),s&&e.jsx(K,{page:t,width:c}),e.jsx("div",{style:{height:8}})]})}export{ce as R};
