import{K as le,M as ae,j as e,r,u as G,R as N,G as he,I as ne,a8 as fe,B as O,b as je,a$ as ye,aa as ie,D as ge,N as ve,F as be,T as Ce}from"./index-58313a23.js";import{u as ke}from"./usePageTitle-70760d12.js";import{R as Re}from"./RaffleHeader-6980a86e.js";import{R as Fe}from"./RaffleAutocompleteBox-ee1e6673.js";import{a as Q,b as Ie}from"./RaffleContext-37dc1758.js";import{R as Se}from"./RaffleSubHead-da36e29e.js";import{d as oe}from"./Search-f642a533.js";import{A as Te}from"./Autocomplete-054a8f8c.js";import{T as W,F as Pe}from"./TextField-af26104a.js";import{I as Ae}from"./Chip-181c19bd.js";import{F as E,I as we,S as $e}from"./Select-e7d2108c.js";import{L as J}from"./Link-5c98dc42.js";import{D as ze}from"./Dialog-7997f6be.js";import{R as Me,A as Le}from"./AdminRoleButton-1b05789b.js";import{R as Be}from"./RaffleNotLiveDialog-2858acbe.js";import"./useDocumentTitle-8f33597b.js";import"./useData-96d1832e.js";import"./dataUrls-b0d1ea1b.js";import"./index-ef1c6acd.js";var X={},Ee=ae;Object.defineProperty(X,"__esModule",{value:!0});var ce=X.default=void 0,We=Ee(le()),Ne=e;ce=X.default=(0,We.default)((0,Ne.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function _e({questionStyle:i,index:m,potData:n,handlePotChange:R,showIssues:t,removePot:y}){const a=r.useContext(Q),{isMobile:F,flexStyle:l}=G(),C=!1,I={maxWidth:700},f=r.useRef(),[c,w]=r.useState(n[m]),S=Array.from(Object.keys(n)).length>1;if(n[m].tickets!==c.tickets||n[m].itemFullTitle!==c.itemFullTitle){const x=c.itemFullTitle&&c.tickets;R(m,c,x)}const B=r.useMemo(()=>{let x=[],h={},v={},H={},z={};return a.allPots.filter(u=>u.formId>0).sort((u,b)=>parseInt(u.potNumber)-parseInt(b.potNumber)||u.title.localeCompare(b.title)).map(u=>{const b=`Pot ${u.potNumber} - ${u.title}`;v[b]=u.title,h[b]=u.id,H[b]=u.potNumber,x.push(b)}).filter(u=>u),{options:x,itemIds:h,itemTitles:v,itemPotNumbers:H,itemFormIds:z}},[a]),{options:o,itemIds:p,itemTitles:j,itemPotNumbers:k}=B,T=r.useCallback(x=>{const h=x.target.value.replace(/[^0-9]/,""),v={...c,tickets:h};w(v)},[c]),_=r.useCallback((x,h)=>{let v;o.includes(h)?v={itemFullTitle:h,itemTitle:j[h],itemId:p[h],itemPotNumber:k[h],itemIndex:o.indexOf(h)}:v={},w({...c,...v})},[o,c,j,p,k]),[$,D]=r.useState(!1),g=r.useCallback(()=>{D(!0),setTimeout(()=>f.current.focus(),15)},[]),Y=r.useCallback(()=>D(!1),[]),K=$&&C?{width:"auto",position:"fixed",left:60,right:0,paddingRight:16,maxWidth:"unset",zIndex:9999999,backgroundColor:"#272727"}:{},P=t&&!c.itemFullTitle?{borderBottom:"#b00 solid 4px"}:{};return e.jsxs("div",{style:{display:l,margin:12},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100,minWidth:280},children:[e.jsx("div",{style:{...i},children:"Selected Pot"}),e.jsx("div",{style:{height:4}}),e.jsxs(N.Fragment,{children:[!$&&C&&e.jsx(he,{title:"Search",arrow:!0,disableFocusListener:!0,children:e.jsx(ne,{color:"inherit",onClick:g,children:e.jsx(oe,{})})}),($||!C)&&e.jsx(Te,{selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:{...I,...K},options:o,onChange:_,renderInput:x=>e.jsx(W,{...x,style:P,placeholder:"Search Pots",variant:"standard",color:"info",inputRef:f,InputProps:{...x.InputProps,startAdornment:e.jsx(Ae,{position:"start",children:e.jsx(oe,{})})}})}),e.jsx(fe,{invisible:!0,open:$&&C,onClick:Y})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:t&&!c.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsxs(E,{children:[!F&&e.jsx("div",{style:i,children:" "}),e.jsx(W,{type:"text",name:"tickets",label:"Tickets",value:n[m].tickets?n[m].tickets:"",error:t&&!c.tickets,helperText:t&&!n[m].tickets?"Required Field":" ",onChange:T,color:"info",size:"small",style:{width:120}})]}),S&&e.jsxs("div",{style:{marginLeft:10},children:[!F&&e.jsx("div",{style:i,children:" "}),e.jsx(ne,{color:"warning",onClick:()=>y(m),children:e.jsx(ce,{})})]})]})]})}var Z={},De=ae;Object.defineProperty(Z,"__esModule",{value:!0});var de=Z.default=void 0,He=De(le()),Ue=e;de=Z.default=(0,He.default)((0,Ue.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");function qe({donation:i,questionStyle:m,potData:n,showIssues:R,setPotData:t,allocated:y}){const a=Array.from(Object.keys(n)),F=i?parseInt(i)-y:0-y,l=r.useCallback(()=>{const o=a[a.length-1]+1e3,p={...n};p[o]={tickets:0},t(p)},[n,a,t]),C=r.useCallback(o=>{const p={...n};delete p[o],t(p)},[n,t]),I=r.useCallback(()=>{const o=Math.floor(i/a.length),p=i%a.length;a.map((j,k)=>{const T={...n};k===0&&i?T[j].tickets=o+p:i?T[j].tickets=o:T[j].tickets=0,t(T)})},[i,n,a,t]),f=r.useCallback((o,p)=>{const j={...n};j[o]=p,t(j)},[n,t]),c=F>0?{color:"#0b0",fontWeight:700}:F<0?{color:"#b00",fontWeight:700}:{},{isMobile:w,flexStyle:S}=G(),B=w?"1.0rem":"1.2rem";return e.jsxs(N.Fragment,{children:[a.map(o=>e.jsx(_e,{questionStyle:m,index:o,potData:n,handlePotChange:f,showIssues:R,removePot:C},o)),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(O,{variant:"outlined",onClick:()=>{l()},size:"small",color:"info",startIcon:e.jsx(de,{}),children:"Add Pot"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",fontSize:B,marginTop:15},children:[e.jsxs("div",{style:{display:S,padding:8},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Total tickets"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:i||0})]})]}),e.jsxs("div",{style:{display:S,padding:8,margin:"0px 10px"},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Allocated"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:y})]})]}),e.jsxs("div",{style:{display:S,padding:8},children:[e.jsx("div",{style:{...c},children:e.jsx("nobr",{children:"Remaining"})}),e.jsxs("div",{style:{...c},children:[" ",e.jsx("strong",{children:i||y?F:0})]})]}),i&&e.jsx("div",{style:{display:S,padding:8,marginLeft:10,alignContent:"center"},children:e.jsx(J,{onClick:()=>{I()},style:{color:"#417ee6",fontWeight:700},children:"Auto"})})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",textAlign:"center"},children:R&&i>y?e.jsx("span",{children:"All tickets must be assigned to a pot"}):R&&i<y?e.jsx("span",{children:"You have too many tickets allocated"}):e.jsx("span",{children:" "})})]})}function Oe(){const i=je(),{raffleAdminRole:m}=r.useContext(Q),[n,R]=r.useState(!1),[t,y]=r.useState({}),[a,F]=r.useState({}),[l,C]=r.useState({0:{tickets:0}}),I=Array.from(Object.keys(l)),{raflQuestionMap:f,displayStats:c,setDisplayStats:w}=r.useContext(Q),[S,B]=r.useState(!0);S&&c&&(w(!1),B(!1));const o=r.useMemo(()=>I.reduce((s,d)=>{const A=parseInt(l[d].tickets)?parseInt(l[d].tickets):0;return s=s?s+A:A,s},0),[l,I]),p=r.useMemo(()=>I.reduce((s,d)=>!(l[d].tickets&&l[d].tickets),!1),[l,I]),j=r.useCallback(s=>{const d=window.open(s,"_blank","noopener,noreferrer");d&&(d.opener=null)},[]),k=r.useCallback(s=>{const d={...t};s.target.name==="donation"?d[s.target.name]=s.target.value.replace(/[^0-9]/,""):d[s.target.name]=s.target.value,y(d)},[t]),T=r.useCallback((s,d)=>{const A={...l};A[s]=d,C(A)},[l]),_=r.useCallback(()=>{const s="https://docs.google.com/forms/d/e/1FAIpQLSe0Rr8mykkE5FAgzUACzGsGYq_mN-vS34arr2uL0QDEFHBSNQ/viewform?usp=pp_url",d=`&entry.${f[0].formId}=${encodeURIComponent(t.platform)}`,A=`&entry.${f[1].formId}=${encodeURIComponent(t.username)}`,me=`&entry.${f[2].formId}=${encodeURIComponent(a.itemTitle)}`,pe=`&entry.${f[3].formId}=${encodeURIComponent(t.receipt)}`,xe=`&entry.${f[4].formId}=${encodeURIComponent(t.donation)}`,ee=[d,A,me,pe,xe],te=Object.keys(l).reduce((L,re)=>{const V=f.find(ue=>ue.text===l[re].itemFullTitle),se=`&entry.${(V==null?void 0:V.formId)||"undefined"}=${l[re].tickets}`;return L=(L==null?void 0:L.length)>0?`${L}${se}`:se,L},"");console.log("url",`${ee.join("")}${te}`),R(!0),j(`${s}${ee.join("")}${te}`)},[a,t,j,l,f]),$=Ie.map(s=>({...s,title:s.name})),D=r.useCallback(s=>s.name,[]),[g,Y]=r.useState(!1),K=["platform","username","charity","donation"],P=s=>K.includes(s)&&!t[s]&&g,x=(t.receipt||g)&&!ye(t.receipt),h=x?"Receipt link is not a valid URL":" ",v=g&&!a.itemFullTitle,H=parseInt(t.donation)!==parseInt(o),z=!t.platform||!t.username||!a.itemFullTitle||!t.donation||!t.receipt||x||!!p||H,u=z?"#666":"#4dd04d",{flexStyle:b}=G(),M={maxWidth:700,marginLeft:"auto",marginRight:"auto"},U={fontSize:"1.5rem",fontWeight:700,marginBottom:8},q={fontSize:"1.1rem",fontWeight:400,marginBottom:8};return e.jsxs(N.Fragment,{children:[e.jsxs("div",{style:{paddingBottom:32},children:[e.jsx(Se,{text:"ENTRY FORM"}),e.jsxs("div",{style:{...M,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:U,children:"About You"}),e.jsxs("div",{style:{display:b,margin:"12px 12px 0px 12px"},children:[e.jsxs(E,{style:{width:250,marginRight:16},size:"small",error:P("platform"),children:[e.jsx(we,{color:"info",children:"Preferred Platform"}),e.jsxs($e,{value:t.platform?t.platform:"",label:"Preferred Platform",onChange:k,color:"info",name:"platform",children:[e.jsx(ie,{value:"Discord",children:"Discord"}),e.jsx(ie,{value:"Reddit",children:"Reddit"})]}),e.jsx(Pe,{children:P("platform")?"Required Field":" "})]}),e.jsx(E,{style:{width:250},size:"small",children:e.jsx(W,{type:"text",name:"username",label:"Username",value:t.username?t.username:"",error:P("username"),helperText:P("username")?"Required Field":" ",onChange:k,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{...M,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:U,children:"Your Donation"}),e.jsxs("div",{style:{display:b,margin:"12px 12px 0px 12px"},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100},children:[e.jsx("div",{style:q,children:"Selected Charity"}),e.jsx("div",{style:{height:6}}),e.jsx(Fe,{allItems:$,setItemDetails:F,getOptionTitle:D,searchText:"Search Charities",error:v}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:g&&!a.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...q},children:"Total donation in USD"}),e.jsx(E,{children:e.jsx(W,{type:"text",name:"donation",label:"Donation Amount",value:t.donation?t.donation:"",error:P("donation"),helperText:P("donation")?"Required Field":" ",onChange:k,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{margin:"6px 12px 0px 12px"},children:[e.jsxs("div",{style:q,children:["Receipt from approved charity ",e.jsx("span",{style:{fontWeight:400},children:"(hosted image link, must contain a visible date)"})]}),e.jsx(E,{fullWidth:!0,children:e.jsx(W,{type:"text",name:"receipt",label:"Receipt Link",error:x,helperText:h,value:t.receipt?t.receipt:"",onChange:k,color:"info",size:"small",fullWidth:!0})})]})]}),e.jsxs("div",{style:{...M,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:U,children:"Your Pots"}),e.jsx(qe,{donation:t.donation,potData:l,handlePotChange:T,questionStyle:q,showIssues:g,setPotData:C,allocated:o})]}),e.jsxs("div",{style:{...M,padding:"20px 20px 20px 20px"},children:[e.jsx("div",{style:{...U,textAlign:"center"},children:"All Done?"}),e.jsxs("div",{style:{...M,justifyContent:"center",marginTop:0,display:"flex"},children:[e.jsx("div",{style:{display:z?"flex":"none"},children:e.jsx(O,{variant:"outlined",onClick:()=>{Y(!g)},style:{marginRight:20,color:g?"#de2323":"#bbb",borderColor:g?"#de2323":"#bbb"},children:"Show Issues"})}),e.jsx(O,{style:{backgroundColor:u,color:"#000"},variant:"contained",disabled:z,onClick:_,children:"Review Entry on Google"})]}),m&&e.jsx("div",{style:{...M,justifyContent:"center",marginTop:16,color:"#de2323",display:z?"flex":"none"},children:e.jsx(O,{style:{color:"#b00"},variant:"text",onClick:_,children:"Test Send Incomplete"})})]})]}),e.jsx(ze,{open:n,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.9}}},children:e.jsxs("div",{style:{width:320,textAlign:"center",padding:30,fontSize:"1.1rem"},children:[e.jsx("span",{style:{fontSize:"1.3rem",fontWeight:700},children:"Thanks for entering!"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.2rem",lineHeight:"1.2rem"},children:["Make sure you hit ",e.jsx("strong",{children:"SUBMIT"})," on the google review form or your entry will not be counted.",e.jsx("br",{}),e.jsx("br",{})]}),"You can always make another donation and submit again... ",e.jsx(J,{onClick:()=>i("/rafl"),style:{color:"#ddd",textDecorationColor:"#888",cursor:"pointer"},children:"Take another look at the pots!"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(J,{onClick:()=>R(!1),children:"(close)"})]})})]})}function pt(){const{lockCollection:i}=r.useContext(ge),{isMobile:m}=G();ke("RAFL Entry Form");const n=e.jsxs(N.Fragment,{children:[!m&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),e.jsx(Me,{}),e.jsx(Le,{})]});return e.jsxs(N.Fragment,{children:[e.jsx(ve,{title:"RAFL Entry Form",extras:n}),e.jsx(Re,{page:"entryform"}),e.jsx(Oe,{profile:i}),e.jsx(be,{}),e.jsx(Ce,{feature:"raflForm"}),e.jsx(Be,{})]})}export{pt as default};
