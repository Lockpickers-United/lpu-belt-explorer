import{r as s,H as I,j as e,G as P,I as Z,aV as ue,R as z,ab as me,K as pe,M as he,Y as ge,B as q,A as ee,d as X,ae as fe,u as O,U as xe,b as je,D as ke,bC as ve,N as Se}from"./index-2be545be.js";import{u as Ce}from"./usePageTitle-2b8b3aea.js";import{F as E}from"./FieldValue-2c6d9ff0.js";import{L as be}from"./LockImageGallery-f585ed3a.js";import{e as te}from"./entryName-2e50a817.js";import{d as ye}from"./ExpandMore-80389774.js";import{D as _,F as qe,a as we}from"./DataContext-682a0955.js";import{d as Re}from"./Link-448a96e1.js";import{S as V,D as Be}from"./SelectBox-8201d57f.js";import{r as Le,a as se}from"./rankingRequestData-d3ef79e5.js";import{B as Ee}from"./BeltStripe-712ab82d.js";import{d as Te}from"./AddCircle-a44c6616.js";import{L as ze}from"./LoadingDisplayWhite-584b1b6c.js";import{p as oe}from"./postData-29b0d461.js";import{D as $}from"./Dialog-9223d38a.js";import{T}from"./TextField-f69b3aba.js";import{C as Ae}from"./CopyEntryTextButton-3b55415c.js";import{A as De,a as Ue,b as Me}from"./AccordionSummary-f9f7263c.js";import{A as Ie}from"./AccordionActions-83826a76.js";import"./index-dec1c8bd.js";import{S as Fe}from"./SearchBox-6d6c3a86.js";import{V as Ne}from"./ViewFilterButtons-bdf0cc62.js";import{a as We}from"./sortFields-5471f00e.js";import{C as Ve}from"./ChoiceButtonGroup-74f7f356.js";import{L as $e}from"./Link-c21e1151.js";import{a as Pe}from"./filterFields-c5a61622.js";import"./useDocumentTitle-52fa3bd1.js";import"./ImageGallery-c0691adf.js";import"./ImageViewer-d6ae9cc7.js";import"./Launch-c82d4341.js";import"./LinearProgress-ee6c2463.js";import"./DialogContent-0dd22c64.js";import"./ImageListItem-4ca15491.js";import"./Select-56221e34.js";import"./CircularProgress-3ae84037.js";import"./axios-439bb627.js";import"./ContentCopy-dcf8857c.js";import"./Collapse-f2328264.js";import"./Box-8b25064a.js";import"./Chip-e7f3cb72.js";import"./Search-0ab03872.js";import"./Badge-1c4bc712.js";import"./LockListContext-e9c70045.js";import"./ToggleButtonGroup-74f46e02.js";function Oe({entry:t,nameType:o}){const a=s.useCallback(async()=>{const d=te(t,o).replace(/[\s/]/g,"_").replace(/\W/g,""),l=`${window.location.origin}/#/rankingrequests/view?id=${t.id}&name=${d}`;await navigator.clipboard.writeText(l),I("Link copied to clipboard.")},[t,o]);return e.jsx(P,{title:"Copy Link to Request",arrow:!0,disableFocusListener:!0,children:e.jsx(Z,{onClick:a,children:e.jsx(Re,{})})})}function _e({requestMod:t,handleClick:o}){return t?e.jsx(P,{title:"Edit Request",arrow:!0,disableFocusListener:!0,children:e.jsx(Z,{onClick:o,style:{height:38,width:38,marginTop:"auto",marginBottom:"auto"},children:e.jsx(ue,{style:{height:20,width:20}})})}):null}function He({entry:t,requestMod:o,form:a,setForm:n,setUpdated:d}){const[l,i]=s.useState(!1),p=me.filter(m=>!["Unranked","Project"].includes(m));s.useEffect(()=>{setTimeout(()=>{n({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt})},100)},[t,n]);const f=s.useCallback(m=>{const{name:h,value:x}=m.target;h==="requestStatus"&&x==="Ranked"?i(!0):h==="requestStatus"&&(i(!1),delete a.belt),n({...a,[h]:x}),d(!0)},[a,n,d]);return e.jsxs(z.Fragment,{children:[o&&e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Status"}),e.jsx(V,{changeHandler:f,name:"requestStatus",form:{},optionsList:Le,multiple:!1,value:a.requestStatus||t.requestStatus,defaultValue:a.requestStatus||t.requestStatus,size:"small",width:200})]}),o&&(a.belt||l)&&e.jsx("div",{style:{marginTop:8},children:e.jsx(V,{changeHandler:f,name:"belt",form:a,optionsList:p,multiple:!1,defaultValue:t.belt||"",size:"small",width:200,label:"belt"})})]})}var H={},Ge=he;Object.defineProperty(H,"__esModule",{value:!0});var ae=H.default=void 0,Ye=Ge(pe()),Je=e;ae=H.default=(0,Ye.default)((0,Je.jsx)("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"AddCircleOutline");function Ke({user:t,entry:o}){const[a,n]=s.useState(!1),[d,l]=s.useState(!1),[i,p]=s.useState({}),[f,m]=s.useState(!1),{profile:h}=s.useContext(_),{requestedBy:x=[]}=o,g=x.find(u=>u.userId===t.uid&&u.owner)||!1,k=x.find(u=>u.userId===t.uid)||!1,w=x.length>1?x.length:"",r=x.length>1?"2px solid #444":"",S=g?"#999":"#fff",F=k?e.jsx(Te,{fontSize:"small",style:{color:S}}):e.jsx(ae,{fontSize:"small"}),A=g?"You requested this lock":k?"Click to remove your vote":"Add Your Vote",N=g||a?"default":"pointer",C=s.useCallback(u=>{const{name:R,value:y}=u.target;p({...i,[R]:y}),m(i.discordUsername&&i.discordUsername.length>0||i.redditUsername&&i.redditUsername.length>0)},[i]),D=s.useCallback(u=>{u.preventDefault(),u.stopPropagation(),p({}),m(!1),l(!1)},[]),v=s.useCallback(async()=>{if(a)return;if(g){I("You requested this lock",{variant:"info",autoHideDuration:1e3});return}n(!0);const u={...i,entryId:o.id,owner:!1,userId:t.uid,displayName:h.displayName},R=`${se}/request-vote`,y=JSON.stringify({newVote:u});try{await oe({user:t,url:R,json:y,snackBars:!0})}catch(U){console.error("Error updating vote:",U)}finally{n(!1),p({}),m(!1),l(!1)}},[o.id,i,g,a,h.displayName,t]),b=s.useCallback(u=>{if(u.preventDefault(),u.stopPropagation(),!a){if(g){I("You requested this lock",{variant:"info",autoHideDuration:3e3});return}k?v().then():l(!0)}},[v,k,g,a]);return e.jsxs(z.Fragment,{children:[e.jsx(P,{title:A,arrow:!0,disableFocusListener:!0,children:a?e.jsx("div",{onClick:b,style:{padding:"4px 0px",marginTop:"auto",marginBottom:"auto",alignItems:"center",justifyContent:"right"},children:e.jsx(ze,{})}):e.jsx("div",{onClick:b,style:{border:r,borderRadius:18,padding:"4px 10px",marginTop:"auto",marginBottom:"auto",display:"flex",alignItems:"center",justifyContent:"right",fontWeight:600,cursor:N},children:e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[w>1&&e.jsx("span",{style:{marginLeft:5,marginRight:7},children:w}),F]})})}),e.jsx($,{open:d,onClose:D,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",maxWidth:340,padding:20},onClick:u=>u.stopPropagation(),children:[e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:10},children:"Upvote Request"}),e.jsx("div",{style:{marginBottom:20,fontSize:"0.95rem",lineHeight:"1.3rem"},children:"A lot of work goes into ranking locks, and we use these votes to prioritize which locks are considered. Please only vote for locks you are specifically interested in."}),e.jsxs("div",{style:{flexGrow:1},children:[e.jsxs("div",{style:{fontSize:"1.1rem"},children:["Notes ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(T,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",style:{},value:i.notes||"",maxLength:1200,id:"notes",onChange:C})]}),e.jsxs("div",{style:{marginTop:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500},children:"Contact Info"}),e.jsxs("div",{style:{},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"Discord Username"}),e.jsx(T,{type:"text",name:"discordUsername",style:{width:200},onChange:C,value:i.discordUsername||"",color:"info",size:"small"})]}),e.jsxs("div",{style:{marginTop:5},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"AND/OR Reddit Username"}),e.jsx(T,{type:"text",name:"redditUsername",style:{width:200},onChange:C,value:i.redditUsername||"",color:"info",size:"small"})]})]}),e.jsxs("div",{style:{marginTop:15},children:[e.jsxs("div",{style:{fontSize:"1rem"},children:["Your current belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(V,{changeHandler:C,name:"userBelt",form:i,optionsList:["Unranked",...ge],multiple:!1,defaultValue:"",size:"small",width:200})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",marginTop:25},children:[e.jsx(q,{onClick:D,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:v,variant:"contained",color:"success",disabled:!f,children:"SAVE"})]})]})})]})}function Qe({upvote:t,voteNum:o}){const{notes:a,discordUsername:n,redditUsername:d,userBelt:l}=t,i=[n&&`@${n}`,d&&`u/${d.replace(/^\/*u\//,"")}`].filter(Boolean).join(" • "),p=l&&` (${l})`,f=(a==null?void 0:a.length)>0?`> ${a}`:"";return e.jsxs("div",{style:{marginBottom:10},children:[o+1,". ",e.jsx("strong",{children:i}),p," ",f]})}function Xe({entry:t,expanded:o,onExpand:a,requestMod:n}){var J,K;const{user:d}=s.useContext(ee),l=s.useRef(null),{expandAll:i}=s.useContext(_),[p,f]=s.useState(!1),[m,h]=s.useState(!1),[x,g]=s.useState(!1),[k,w]=s.useState(!1),[r,S]=s.useState({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt}),{requestedBy:F=[]}=t,A=F.filter(c=>!c.owner);s.useEffect(()=>{setTimeout(()=>{S({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt})},100)},[t,S]);const N=s.useCallback((c,j)=>{a&&a(j?t.id:!1)},[t.id,a]),C=s.useCallback(c=>{const{name:j,value:B}=c.target;S({...r,[j]:B}),w(!0)},[r]),D=s.useCallback(c=>{c.preventDefault(),c.stopPropagation(),h(!0)},[h]),v=s.useCallback(()=>{S({make:t.makeModels?t.makeModels[0].make:"",model:t.makeModels?t.makeModels[0].model:"",requestStatus:t.requestStatus,belt:t.belt}),h(!1),g(!1)},[t]),b=s.useCallback(async c=>{var L,Q;const j=`${se}/update-request`,B=JSON.stringify({entry:c});try{await oe({user:d,url:j,json:B,snackBars:!1})}catch(W){console.error("Error updating vote:",W);let ce=((Q=(L=W.response)==null?void 0:L.data)==null?void 0:Q.message)||W.message;I(`Error updating request: ${ce}`,{variant:"error",autoHideDuration:3e3})}finally{v()}},[v,d]),u=s.useCallback(async()=>{const c={...t.originalEntry,requestStatus:"Deleted",lastUpdated:X().toISOString()};await b(c)},[t.originalEntry,b]),R=s.useCallback(async()=>{if(!k)return;r.requestStatus==="Deleted"&&g(!0);const c={...t.originalEntry,makeModels:[{make:r.make,model:r.model}],requestStatus:r.requestStatus||t.requestStatus,belt:r.belt||t.belt,lastUpdated:X().toISOString()};["Ranked","Deleted"].includes(c.requestStatus)||delete c.belt,r.requestStatus==="Deleted"?g(!0):await b(c)},[t,r,b,k]),y=s.useCallback(()=>{g(!1)},[g]);s.useEffect(()=>{if(o&&l&&!p&&!i){const j=window.innerWidth<=600?70:74,{id:B}=fe.parse(location.search),L=B===t.id;f(!0),setTimeout(()=>{window.scrollTo({left:0,top:l.current.offsetTop-j,behavior:L?"auto":"smooth"})},L?0:100)}else o||f(!1)},[o,t,p,i]);const{discord:U,reddit:G}=t.usernames||{},ie=[U&&`@${U}`,G&&`u/${G.replace(/^\/*u\//,"")}`].filter(Boolean).join(" • "),ne=t.userBelt?` (${t.userBelt})`:"",le=t.belt&&t.belt!=="Unranked"?` (${t.belt})`:"",re=!r.make||r.model.length<1||r.requestStatus==="Ranked"&&!r.belt,de={maxWidth:700,marginLeft:"auto",marginRight:"auto"},{flexStyle:M}=O(),Y=t.requestStatus==="Declined"?.5:1;return e.jsxs(z.Fragment,{children:[e.jsxs(De,{expanded:o,onChange:N,style:de,ref:l,children:[e.jsxs(Ue,{expandIcon:e.jsx(ye,{}),style:{cursor:"pointer"},children:[e.jsx(Ee,{value:t.belt}),e.jsx("div",{style:{display:M,width:"100%",alignItems:"center",opacity:Y},children:e.jsxs("div",{style:{display:M,width:"100%",alignItems:"center",opacity:Y},children:[e.jsx(xe,{primary:te(t),primaryTypographyProps:{fontWeight:500,fontSize:"1.1rem"},secondary:t.lockingMechanisms.join(", "),secondaryTypographyProps:{fontSize:"0.9rem"},style:{padding:"0px 0px 0px 10px"}}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"right",marginRight:10},children:t.requestStatus!=="Submitted"&&e.jsxs("span",{children:[t.requestStatus,le]})})]})}),e.jsx(Ke,{user:d,entry:t}),e.jsx(_e,{handleClick:D,requestMod:n})]}),o&&e.jsxs(Me,{sx:{padding:"0px 16px 0px 16px"},children:[e.jsx("div",{style:{display:M,width:"100%"},children:!!((J=t.notes)!=null&&J.length)&&e.jsx(E,{name:"Notes",value:t.notes,style:{marginRight:20}})}),e.jsxs("div",{style:{display:M,width:"100%",marginTop:15},children:[e.jsx(E,{name:"Requested By",value:ie+ne,style:{marginRight:30},headerStyle:{color:"#aaa",fontSize:"0.9rem"}}),!!t.approximateBelt&&e.jsx(E,{name:"Suggested Belt",value:`${t.approximateBelt} Belt`,style:{marginRight:30},headerStyle:{color:"#aaa",fontSize:"0.9rem"}}),!!t.hazLocc&&e.jsx(E,{name:"Has Lock(s)",value:t.hazLocc,style:{marginRight:0},headerStyle:{color:"#aaa",fontSize:"0.9rem"}})]}),!!((K=t.media)!=null&&K.length)&&e.jsx("div",{style:{marginLeft:6},children:e.jsx(be,{entry:t})}),A.length>0&&n&&e.jsx(E,{name:"Upvotes",style:{marginRight:20,marginTop:10},headerStyle:{color:"#bbb",fontSize:"1rem"},value:A.map((c,j)=>e.jsx(Qe,{upvote:c,voteNum:j},c.userId))}),e.jsxs(Ie,{children:[e.jsx(Ae,{entry:t}),e.jsx(Oe,{entry:t})]})]})]}),e.jsx($,{open:m,onClose:v,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:30},children:[e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Edit Request",e.jsx("br",{})]}),e.jsx("div",{style:{marginTop:0},children:e.jsx(He,{entry:t,requestMod:n,form:r,setForm:S,setShowEditRequest:h,setUpdated:w})}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Brand"}),e.jsx(T,{type:"text",name:"make",size:"small",style:{width:200},color:"info",onChange:C,value:r.make||"",error:r.make.length===0})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Model Name"}),e.jsx(T,{type:"text",name:"model",size:"small",style:{width:200},color:"info",onChange:C,value:r.model||"",error:r.model.length===0})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",marginTop:20},children:[e.jsx(q,{onClick:v,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:R,variant:"contained",color:"success",disabled:re||!k,children:"SAVE"})]})]})}),e.jsx($,{open:x,onClose:y,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.5}}},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.3rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Are you sure you want to delete?",e.jsx("br",{}),"Action cannot be undone.",e.jsx("br",{})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center"},children:[e.jsx(q,{onClick:y,variant:"contained",color:"success",style:{marginRight:20,backgroundColor:"#999"},children:"CANCEL"}),e.jsx(q,{onClick:u,variant:"contained",color:"error",children:"DELETE"})]})]})})]})}function Ze({label:t,sortValues:o,resetAll:a}){const{isMobile:n}=O(),d=n?"block":"flex",l=n?{maxWidth:700,marginLeft:"auto",marginRight:"auto",padding:8}:{maxWidth:700,marginLeft:"auto",marginRight:"auto",padding:12};return e.jsxs("div",{style:{display:d,...l,backgroundColor:"#333",minHeight:72},children:[e.jsx("div",{style:{display:"flex",flexGrow:1,marginLeft:8},children:e.jsx(Fe,{label:t,keepOpen:!0})}),!!o&&e.jsx("div",{style:{margin:"12px 20px 0px 20px"},children:e.jsx(Ne,{sortValues:o,resetAll:a})})]})}function et({requestMod:t}){const{visibleEntries:o=[],expandAll:a}=s.useContext(_),{filters:n}=s.useContext(qe),[d,l]=s.useState(n.id),i=s.useMemo(()=>[{label:"Request a Lock",page:"/rankingrequests/submit"},{label:"View Requests",page:"/rankingrequests/view"}],[]),p=je(),f=s.useCallback(m=>{p(m.page)},[p]);return e.jsxs(z.Fragment,{children:[e.jsx("div",{style:{marginBottom:20,marginTop:1},children:e.jsx(Ve,{options:i,onChange:f,defaultValue:i[1].label})}),e.jsxs("div",{style:{maxWidth:720,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t&&e.jsx($e,{onClick:()=>console.log("visibleEntries",o),style:{color:"#444",cursor:"pointer",marginLeft:10},children:"LOG"}),e.jsx(Ze,{sortValues:We,label:"Lock Requests",resetAll:!0}),o.map((m,h)=>e.jsx(Xe,{entry:m,expanded:m.id===d||!!a,onExpand:l,requestMod:t},h))]})]})}function _t(){Ce("View Ranking Requests");const{user:t,userClaims:o}=s.useContext(ee),{lockCollection:a}=s.useContext(ke),n=(o==null?void 0:o.requestAdmin)||(o==null?void 0:o.admin),{isMobile:d}=O(),l=ve(),i=e.jsx(z.Fragment,{children:!d&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(we,{filterFields:Pe,children:e.jsxs(Be,{allEntries:l,profile:a,children:[e.jsx(Se,{title:"Ranking Requests",extras:i}),e.jsx(et,{user:t,requestMod:n})]})})}export{_t as default};
