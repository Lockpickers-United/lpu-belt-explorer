import{r as s,ac as b,b0 as Y,g as w,Z as L,j as P,d as r,az as z,aq as B,R as T}from"./index-91192932.js";import{F as y,D as U,f as W}from"./filterFields-b268817b.js";import{r as F}from"./index-63790b58.js";function K({children:v,cardActivity:n,cardBBCount:o,cardDanPoints:i,cardEligibleDan:d,cardNextDanPoints:l,cardNextDanLocks:p,popularLocks:c}){const{filters:e}=s.useContext(y),{search:t,id:m,tab:M,name:f,sort:h,image:G,locks:V,...E}=e,g=s.useMemo(()=>n.map(a=>{const u=b(a.matchId),O=Y(a.matchId),A=w(a.matchId),S=A?"Belt":O?"Project":"Lock";return{...a,...u,...O,...A,id:a.id,type:S}}),[n]),C=s.useMemo(()=>g.reduce((a,u)=>(a[u.matchId]=u,a),{}),[g]),k=s.useMemo(()=>c.map(a=>({...b(a.id),...C[a.id],popularityRank:a.rank,userCount:a.saveCount})),[c,C]),x=s.useMemo(()=>Object.keys(E).map(a=>{const u=E[a];return Array.isArray(u)?u.map(O=>({key:a,value:O})):{key:a,value:u}}).flat(),[E]),j=s.useMemo(()=>I(g,x,t,h),[g,x,t,h]),D=s.useMemo(()=>I(k,x.concat({key:"exceptionType",value:void 0}),t,"popular"),[k,x,t]),R=s.useMemo(()=>({allEntries:L,cardActivity:n,cardBBCount:o,cardDanPoints:i,cardEligibleDan:d,cardNextDanPoints:l,cardNextDanLocks:p,visibleEntries:j,popularEntries:D,getEntryFromId:b,getProjectEntryFromId:Y,getAwardEntryFromId:w}),[n,o,i,d,l,p,j,D]);return P.jsx(U.Provider,{value:R,children:v})}function I(v,n,o,i){const l=v.map(e=>{var t,m,M;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:f})=>f),fuzzy:F(((m=e==null?void 0:e.makeModels)==null?void 0:m.map(({make:f,model:h})=>[f,h]).flat().filter(f=>f).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}return"Worth Points"})()],simpleBelt:(M=e==null?void 0:e.belt)==null?void 0:M.replace(/\s\d/g,"")}}).filter(e=>n.every(({key:t,value:m})=>Array.isArray(e[t])?e[t].includes(m):e[t]===m)),p=o?W.go(F(o),l,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):l,c=(()=>{switch(i){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||B(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"dateAscending":return(e,t)=>r(e.date).valueOf()-r(t.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>r(t.date).valueOf()-r(e.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>B(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"beltDescending":return(e,t)=>z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>r(r(t.date).format("YYYY-MM-DD")).valueOf()-r(r(e.date).format("YYYY-MM-DD")).valueOf()||z(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return p.sort(c)}const q=T.createContext({});function Q({children:v}){const{filters:n,addFilters:o,removeFilters:i}=s.useContext(y),d=n.id,l=s.useCallback(c=>{c?o([{key:"id",value:c}],!0):i(["id"])},[o,i]),p=s.useMemo(()=>({expanded:d,setExpanded:l}),[d,l]);return P.jsx(q.Provider,{value:p,children:v})}export{q as S,K as a,Q as b};
