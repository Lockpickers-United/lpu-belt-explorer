import{u as B,r as t,j as e,R as O,aj as re,D as E,d as ce,B as z,T as de,A as me,e as pe,N as he}from"./index-DPobvnYl.js";import{u as ue}from"./usePageTitle-CgE0xTUt.js";import{A as xe,I as ge,S as fe}from"./Search-CEMRkrSg.js";import{T as R}from"./TextField-DhI-GsQ_.js";import{D as je}from"./Dropzone-DkpP6T3Q.js";import{L as be}from"./LoadingDisplay-lKNpQqWC.js";import{R as ke}from"./RaffleContext-C_o2zIZK.js";import{p as ye,c as ve}from"./postData-Bw3smmQd.js";import{n as Ce}from"./dataUrls-CThgH6Wi.js";import{C as Se}from"./Checkbox-BHNzXWWJ.js";import{C as Ne}from"./Collapse-Dc1ZN4_j.js";import{I as Le,a as Fe}from"./ImageListItem-BRmsGZNE.js";import{D as A}from"./Dialog-C5S22W6b.js";import"./useFormControl-BWRnqrJR.js";import"./Select-CkUj_VNZ.js";import"./index-BisLIoFD.js";import"./Cancel-Co5V193-.js";import"./LoadingDisplaySmall-B-BnMzNb.js";import"./Box-57ZD3oQt.js";import"./CircularProgress-DkmgQ1zL.js";import"./useData-C1nMP74d.js";import"./index-B66keAKl.js";import"./setDeep-J6HEwWhX.js";import"./index-xsH4HHeE.js";import"./SwitchBase-BoCXHFjZ.js";function Ie({handleChangeLock:n,allEntries:c=[],disabled:u,reset:g=!1}){const a={maxWidth:700},{isMobile:x}=B(),k=t.useRef();console.log("allEntries",c);const C=t.useMemo(()=>{let s={};return{allLocks:[...c].sort((d,h)=>{d.title.localeCompare(h.title)}).reduce((d,h)=>{const j=`${h.contributedBy.join(", ")} - ${h.title}`;return d.push({id:h.id,lockName:j}),s[j]=j,d},[]).filter(d=>d),lockNames:s}},[c]),{allLocks:m,lockNames:f}=C,S=m.sort((s,l)=>s.lockName.localeCompare(l.lockName)).map(s=>({label:s.lockName,id:s.id}));console.log("options",S);const N=t.useCallback((s,l)=>{n(l?{lockFullName:l.label,lockName:f[l.label],lockId:l.id}:{})},[f,n]),[L,y]=t.useState(!1),p=t.useCallback(()=>y(!1),[]);return e.jsxs(O.Fragment,{children:[e.jsx(xe,{disabled:u,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:a,options:S,onChange:N,renderInput:s=>e.jsx(R,{...s,placeholder:"Search Locks",variant:"standard",color:"info",inputRef:k,InputProps:{...s.InputProps,startAdornment:e.jsx(ge,{position:"start",children:e.jsx(fe,{})})}}),isOptionEqualToValue:(s,l)=>s.label===l.label,getOptionLabel:s=>s.label,renderOption:(s,l)=>{const{key:d,...h}=s;return e.jsx("div",{...h,style:{...s.style,height:34,padding:0,overflow:"elipsis",whiteSpace:"nowrap",color:l.belt==="Unranked"?"#aaa":"#fff",fontSize:"0.95rem",marginLeft:10},children:l.label},d)}},g||u),e.jsx(re,{invisible:!0,open:L&&x,onClick:p})]})}function Re({profile:n,user:c}){const{allPots:u=[]}=t.useContext(ke),{updateProfileField:g}=t.useContext(E),[a,x]=t.useState({}),[k,C]=t.useState(void 0),[m,f]=t.useState([]),[S,N]=t.useState(void 0),[L,y]=t.useState(!1),[p,s]=t.useState(void 0),[l,d]=t.useState(!1),[h,j]=t.useState(""),[D,$]=t.useState(""),[v,M]=t.useState((n==null?void 0:n.photoCredit)||(n==null?void 0:n.displayName)||""),[P,_]=t.useState(!1),F=t.useMemo(()=>[...u],[u]),Y=ce().format("YYYYMMDD-HHMMss"),b=F.find(o=>o.id===(a==null?void 0:a.lockId)),H=!!(a!=null&&a.lockFullName)&&!!(a!=null&&a.lockId)&&!!v&&m.length>0;console.log("lockDetails",a);const W=`${a.lockName}_${a.lockId}_`.replace("/","+"),T=`${v}`.replace("/","+"),K=m.map(o=>o.name),q=t.useCallback((o,i)=>{f(o)},[]),G=m.length===1?"File":"Files",V=async o=>{o.preventDefault(),y(!0);const i=`${Y}_${W}_${T}`,r=new FormData;m.forEach(I=>{const{base:w,ext:ie}=Pe(I.name);r.append("files",I,`${i}/${W}_${w}_${T}.${ie}`)}),r.append("droppedFileNames",K),r.append("lockFullName",a.lockFullName),r.append("lockName",a.lockName),r.append("version",b==null?void 0:b.version),r.append("belt",b==null?void 0:b.belt),r.append("lockId",a.lockId),r.append("photoCredit",v),r.append("displayName",n==null?void 0:n.displayName),r.append("uploadsDir",i),r.append("notes",D);const ne=`${Ce}/upload`,ae=!0,le=3e4;try{N(await ye({user:c,url:ne,formData:r,snackBars:ae,timeoutDuration:le})),Q(v)}catch(I){s(ve(I)),x([]),m.forEach(w=>URL.revokeObjectURL(w.preview)),f([])}finally{y(!1)}},J=t.useCallback(o=>{x(o),C(F.find(i=>i.id===o.lockId))},[F]),Q=t.useCallback(o=>{g("photoCredit",o)},[g]),X=t.useCallback(o=>{const{value:i}=o.target;M(i)},[]),Z=t.useCallback(o=>{const{value:i}=o.target;$(i)},[]),U=t.useCallback(()=>{x({}),C(void 0),m.forEach(o=>URL.revokeObjectURL(o.preview)),f([]),N(void 0),y(!1),s(void 0),d(!1),j(""),$(""),_(!P)},[m,P]),ee=t.useCallback(()=>{d(!l),x([])},[l]),te=t.useCallback(o=>{const{value:i}=o.target;j(i),x({lockFullName:i,lockName:i,lockId:"NOTINLIST"})},[]),oe=l?.5:1,{flexStyle:se}=B();return e.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[e.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:V,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"30px 0px 10px"},children:"Select Pot"}),e.jsx("div",{style:{opacity:oe},children:e.jsx(Ie,{handleChangeLock:J,allEntries:F,disabled:l,reset:P})}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(Se,{onChange:ee,color:"info",size:"small",id:"notInList",checked:l})," Submit photos for a pot not on the site."]}),e.jsxs(Ne,{in:l,style:{marginTop:10},children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),e.jsx("br",{}),e.jsx(R,{type:"text",id:"altLockName",name:"altLockName",value:h,style:{width:400},onChange:te,color:"info"})]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:se},children:[e.jsxs("div",{style:{marginRight:50,width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",e.jsx("br",{})]}),e.jsx(je,{files:m||[],otherFiles:[],handleDroppedFiles:q,maxFiles:5,backgroundColor:"#333"}),k&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",e.jsx("br",{})]}),k.media?e.jsx("div",{children:e.jsx(Le,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:k.media.map((o,i)=>e.jsx(Fe,{children:e.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},i))})}):e.jsx("span",{children:"no images"})]})]}),e.jsxs("div",{style:{width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",e.jsx("br",{})]}),a.lockFullName&&e.jsxs("span",{children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),e.jsx("br",{}),e.jsx("div",{style:{display:"flex"},children:e.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:a.lockFullName})}),e.jsx("br",{})]}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),e.jsx("br",{}),e.jsx(R,{type:"text",name:"photoCredit",value:v,style:{width:350},onChange:X,color:"info"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),e.jsx("br",{}),e.jsx(R,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:D,onChange:Z}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(z,{type:"submit",variant:"contained",color:"info",disabled:!H||L,children:"Upload"})]})]}),e.jsx("br",{}),e.jsx("br",{})]})}),e.jsx(A,{open:L,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:e.jsx(be,{})})}),e.jsx(A,{open:!!S&&!p,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:10,textAlign:"center"},children:[G," Uploaded Successfully!"]}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:60,textAlign:"center"},children:"Images will be added to the site shortly"}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:U,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(A,{open:!!p,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",e.jsx("br",{}),"Please try again later.",e.jsx("br",{})]}),e.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[p==null?void 0:p.message,e.jsx("br",{}),"(Error code ",p==null?void 0:p.status,")"]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:U,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(de,{feature:"uploadPhotos"})]})}function Pe(n){const c=n.lastIndexOf(".");return c===-1?{base:n,ext:""}:{base:n.substring(0,c),ext:n.substring(c)}}function ot(){const{isMobile:n}=B(),{lockCollection:c}=t.useContext(E),{user:u}=t.useContext(me);ue("RAFL Pot Photos");const g=e.jsx(O.Fragment,{children:!n&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsxs(pe,{children:[e.jsx(he,{title:"RAFL Pot Photos",extras:g}),e.jsx(Re,{profile:c,user:u})]})}export{ot as default};
