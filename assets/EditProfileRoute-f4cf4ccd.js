import{r as a,K as f,p as T,U as y,v as l,j as e,V as F,a7 as S,R as u,W as R,t as d,a8 as Y,M as U,O as V,H as $,P as z}from"./index-9996b264.js";import{u as G}from"./useDocumentTitle-9327d07b.js";import{l as H}from"./LPU-c3fa7122.js";import{C as M}from"./CopyProfileLinkButton-27460c77.js";import{L as W}from"./LoadingDisplay-41655430.js";import{T as Z}from"./TextField-91052728.js";import{P as _}from"./MustBeLoggedIn-0e453a99.js";import{L as q}from"./LinearProgress-1f74f56b.js";import"./Link-c30cf7b4.js";import"./Box-2992fcf3.js";import"./Select-bd9b5865.js";function I(){const{lockCollection:t,updateProfileDisplayName:n,deleteAllUserData:s}=a.useContext(f),[r,m]=a.useState(t.displayName||""),[x,p]=a.useState(null),[j,h]=a.useState(!1),g=T(),{user:c}=a.useContext(y),b=a.useCallback(o=>{const{value:k}=o.target;m(k)},[]),C=a.useCallback(o=>o.target.select(),[]),v=a.useCallback(async()=>{try{await n(r),l("Profile updated")}catch(o){console.error("Error while updating profile",o),l("Error while updating profile")}},[n,r]),w=a.useCallback(async()=>{try{await n(null),m(""),l("Display Name cleared")}catch(o){console.error("Error while updating profile",o),l("Error while updating profile")}},[n]),D=a.useCallback(()=>{g(`/profile/${c.uid}`)},[g,c.uid]),P=a.useCallback(o=>{o.preventDefault(),o.stopPropagation(),p(o.currentTarget)},[]),L=a.useCallback(async()=>{h(!0),await s(c.uid),p(null),h(!1),l("All data has been deleted")},[s,c]),i=r.length>0&&!K.test(r.toString()),A=r.length===0||r===(t==null?void 0:t.displayName),N=i?"Display name must only include A-Z, 0-9, _ and -.":"",B=r.length>0?"Edit Profile":"Create Profile",E=r.length>0?` (${r}) `:"";return e.jsxs(F,{style:{maxWidth:380,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46},children:[e.jsx(S,{title:B,action:null}),j?e.jsx(W,{}):e.jsxs(u.Fragment,{children:[e.jsxs(R,{children:[t!=null&&t.displayName?e.jsxs("div",{style:{marginBottom:10},children:["Your display name ",E," shows up on the leaderboard and your profile can be shared with others.",e.jsx("br",{}),e.jsx("br",{}),"Your Google login information will never be displayed to other users."]}):e.jsxs("div",{style:{marginBottom:10},children:["Your display name will show up on the leaderboard and your profile can be shared with others.",e.jsx("br",{}),e.jsx("br",{}),"Your Google login information will never be displayed to other users."]}),e.jsx("br",{}),e.jsxs("div",{style:{width:"100%"},children:[e.jsx(Z,{error:i,variant:"outlined",color:"secondary",label:"Display Name",helperText:N,value:r||"",onChange:b,onFocus:C,inputProps:{maxLength:32},size:"small",style:{width:260}}),e.jsx(d,{variant:"outlined",color:i?void 0:"success",onClick:v,disabled:i||A,style:{marginLeft:16,marginRight:0,marginBottom:10,height:40},children:"Save"})]})]}),e.jsx(Y,{children:e.jsxs("div",{style:{width:"100%",textAlign:"center",margin:"10px 0px 10px 0px"},children:[(t==null?void 0:t.displayName)&&e.jsx(d,{variant:"outlined",color:"info",onClick:w,disabled:i,style:{marginBottom:10,color:"#4972ab",padding:"5px 19px"},children:"Clear Display Name"}),e.jsx(d,{variant:"outlined",color:"info",onClick:D,style:{marginLeft:15,marginBottom:10,color:"#4972ab",padding:"5px 19px"},children:"View Profile"})]})}),e.jsxs("div",{style:{width:"100%",textAlign:"center",margin:"10px 0px 10px 0px"},children:[e.jsx(d,{variant:"outlined",color:"info",onClick:P,style:{marginBottom:10,color:"#4972ab",padding:"5px 110px"},children:"Delete All Data"}),e.jsxs(U,{anchorEl:x,open:!!x,onClose:()=>p(null),children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["This will permanently delete all of your data.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(d,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:L,edge:"start",color:"error",children:"Delete"})})]})]})]})]})}const K=/^[\sa-zA-Z0-9_-]{1,32}$/;function ie(){const{authLoaded:t,isLoggedIn:n}=a.useContext(y),{dbLoaded:s}=a.useContext(f);G("LPU Belt Explorer - Edit Profile");const r=e.jsx(u.Fragment,{children:e.jsx(M,{page:"collection"})});return e.jsxs(u.Fragment,{children:[e.jsx(V,{title:"Edit Profile",extras:r}),(!t||!s)&&e.jsxs(u.Fragment,{children:[e.jsx(q,{variant:"indeterminate",color:"secondary"}),e.jsx("img",{alt:"Loading",src:H,style:{marginLeft:"auto",marginRight:"auto",display:"block"}})]}),t&&!n&&e.jsx(_,{}),t&&n&&s&&e.jsx(I,{}),e.jsx($,{}),e.jsx(z,{feature:"editprofile"})]})}export{ie as default};
