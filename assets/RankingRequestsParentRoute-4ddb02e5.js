import{r as n,A as h,D as j,bC as b,bD as v,bE as R,bF as D,j as t,R as q,$ as E,N as C,B as M,aB as S,F as k,bG as w}from"./index-71c5eed6.js";import{L as A}from"./LoadingDisplay-5cf5e59f.js";import{a as B}from"./DataContext-c1f23a1c.js";import{D as F}from"./LockDataProvider-2064bc21.js";import{a as N}from"./rankingRequestData-6c3ae9f1.js";import"./Box-51fe652a.js";import"./CircularProgress-04e30e9a.js";import"./index-f26db119.js";async function T({activityData:u}){const a=new AbortController,e=setTimeout(()=>{a.abort()},1e4),m=Math.floor(Math.random()*1e6);try{const s=await fetch(`${N}/log-activity?${m}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityData:u}),signal:a.signal});if(clearTimeout(e),s.ok)return await s.json().catch(()=>({}));{let o="Error updating request";try{const d=await s.json();console.error("errorData",d),o=d.message||o}catch{}return{response:{data:{status:s.status,message:o}}}}}catch(s){throw clearTimeout(e),console.error("Error during authentication or server request:",s),s}}function J(){const{authLoaded:u,isLoggedIn:a}=n.useContext(h),{lockCollection:e}=n.useContext(j),[m,s]=n.useState([]),o=n.useRef(0);n.useEffect(()=>{const c=b(R(w,"ranking-requests"),v("requestStatus","!=","Deleted")),y=a?D(c,p=>{const f=p.docs.length;o.current+=f;const g=[{activity:"READ",activityCount:f,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName}];o.current>f&&g.push({activity:"REFRESH",activityCount:f,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName}),T({activityData:g}),s(x=>{const l=new Map(x.map(r=>[r.id,r]));return p.docChanges().forEach(r=>{const i={id:r.doc.id,...r.doc.data()};r.type==="added"?l.has(i.id)||l.set(i.id,i):r.type==="modified"?l.set(i.id,i):r.type==="removed"&&l.delete(i.id)}),Array.from(l.values())})},p=>{console.error("Error getting ranking requests from DB:",p)}):()=>{};return()=>y()},[a]);const d=n.useMemo(()=>m.filter(c=>c.makeModels&&c.makeModels[0].make&&c.makeModels[0].model),[m]);return t.jsxs(q.Fragment,{children:[!u&&t.jsx(A,{}),u&&a&&t.jsx(E,{context:d}),u&&!a&&t.jsx(B,{children:t.jsxs(F,{allEntries:[],children:[t.jsx(C,{title:"Please Sign In"}),t.jsx("div",{style:{maxWidth:700,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:46,marginBottom:46},children:t.jsxs("div",{style:{textAlign:"center",marginTop:40},children:["We're sorry, you must be signed in to request locks.",t.jsx("br",{}),t.jsx("br",{}),t.jsx(M,{style:{color:"#fff"},children:t.jsx(S,{})})]})})]})}),t.jsx(k,{})]})}export{J as default};
