import{b as D,r as f,d as k,j as s,u as h}from"./index-83b6e166.js";import{L as W}from"./LoadingDisplay-fd9eba85.js";import{u as T}from"./usePageTitle-4ce191e9.js";import{u as F}from"./useData-dd4e955c.js";import{n as H}from"./dataUrls-e1e30111.js";import{A as L}from"./AdminStatsTableSort-27568d2a.js";import{L as _}from"./Link-dbbe300a.js";import{P as Y}from"./nivo-line.es-667b4a0f.js";import{p as z}from"./chartDefaults-270235e0.js";import{A as M}from"./AdminStatsTable-72f131f0.js";import"./LPU-c3fa7122.js";import"./LinearProgress-e5c36a8d.js";import"./useDocumentTitle-8447f853.js";import"./TableRow-5120ebd9.js";import"./nivo-legends.es-2b63aaf7.js";import"./index-9ab77843.js";const C=({data:n})=>{const a=D(),{dailyTotals:t,requestSubscriptions:l}=n,m=[{name:"Date",align:"left",id:"date"},{name:"Total Reads",align:"left",id:"reads"},{name:"Writes",align:"left",id:"writes"},{name:"",align:"left",id:"spacer"},{name:"Subscription Reads",align:"left",id:"subscriptionReads"},{name:"Subscription Refresh Reads",align:"left",id:"subscriptionRefreshes"}],o=!0,[r,d]=f.useState("date"),[p,u]=f.useState(!0),x=Object.keys(t).map(e=>{const c=k(e),j=t[e].READ,w=t[e].WRITE,y=l[e].READ||0,E=l[e].REFRESH||0;return{date:c.format("MM/DD/YYYY"),reads:j,writes:w,spacer:"|",subscriptionReads:y,subscriptionRefreshes:E}}).filter(e=>e).sort((e,c)=>{switch(r){case"reads":return e.reads-c.reads;default:return parseInt(c[r])-parseInt(e[r])}}),b=p?x:x.reverse(),g={columns:m,data:b},S=f.useCallback((e,c)=>e==="title"?s.jsx(_,{onClick:()=>a(`/foobar/${c}`),style:{color:"#fff"},children:c}):c,[a]),{isMobile:v}=h(),R=v?".8rem":".95rem",i="100%";return s.jsx("div",{children:s.jsx(L,{tableData:g,tableWidth:i,fontSize:R,sortable:o,sort:r,setSort:d,ascending:p,setAscending:u,linkFunction:S})})};function I({data:n}){const{width:a}=h(),t=a<=360,l=a<=395,m=a<=560,o=t?230:l?270:m?290:350,r=m?["midnight","2 am","4 am","6 am","8 am","10 am","noon","2 pm","4 pm","6 pm","8 pm","10 pm"]:["midnight","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","noon","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"];return s.jsx("div",{style:{height:o},children:s.jsx(Y,{theme:O,data:n,colors:["#007de2","#16325d"],lineWidth:3,margin:{top:10,right:20,bottom:70,left:58},curve:"natural",xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},axisBottom:{tickValues:r,tickSize:5,tickPadding:5,tickRotation:-45,direction:"row"},legends:[{anchor:"bottom",itemTextColor:"#ddd",text:{fontSize:18},direction:"row",justify:!1,translateX:0,translateY:75,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const P={grid:{line:{stroke:"#333",strokeWidth:1}}},O={...z,...P},V=({data:n})=>{const{hourly:a}=n,t=["midnight","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","noon","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"],m=[{id:"Hourly Requests",data:Object.keys(a).map(o=>{const r=t[parseInt(o)],d=Object.keys(a[o]).reduce((p,u)=>p+a[o][u],0);return{x:r,y:d}}).sort((o,r)=>t.indexOf(o.x)-t.indexOf(r.x))}];return s.jsx("div",{children:s.jsx(I,{data:m})})},$=({data:n})=>{const a=D(),{bySource:t}=n,l=[{name:"Date",align:"left",id:"date"},{name:"Export Collections",align:"left",id:"collectionsExport_lockcollections"},{name:"Export Evidence",align:"left",id:"awardsEvidenceExport_evidence"},{name:"Export Awards",align:"left",id:"awardsEvidenceExport_awards"},{name:"Requests Subscriptions",align:"left",id:"request_subscription"},{name:"Request Votes",align:"left",id:"request_upvote"},{name:"Request Updates",align:"left",id:"request_update"}],m=!0,[o,r]=f.useState("date"),[d,p]=f.useState(!0),u=Object.keys(t).map(i=>{var q;const e=k(i),c=t[i].collectionsExport_lockcollections,j=t[i].awardsEvidenceExport_evidence,w=((q=t[i])==null?void 0:q.awardsEvidenceExport_awards)||0,y=t[i]["request-subscription"]||0,E=t[i]["request-upvote"]||0,A=t[i]["request-update"]||0;return{date:e.format("MM/DD/YYYY"),collectionsExport_lockcollections:c,awardsEvidenceExport_evidence:j,awardsEvidenceExport_awards:w,request_subscription:y,request_upvote:E,request_update:A}}).filter(i=>i).sort((i,e)=>{switch(o){case"reads":return i.reads-e.reads;default:return parseInt(e[o])-parseInt(i[o])}}),x=d?u:u.reverse(),b={columns:l,data:x},g=f.useCallback((i,e)=>i==="title"?s.jsx(_,{onClick:()=>a(`/foobar/${e}`),style:{color:"#fff"},children:e}):e,[a]),{isMobile:S}=h(),v=S?".8rem":".95rem",R="100%";return s.jsx("div",{children:s.jsx(M,{tableData:b,tableWidth:R,fontSize:v,sortable:m,sort:o,setSort:r,ascending:d,setAscending:p,linkFunction:g})})};function nt(){T("Firebase Activity Report");const{data:n,loading:a,error:t}=F({url:`${H}/process-firebase-log`}),{width:l}=h(),o=l<560?"8px 8px 32px 8px":"24px 24px 32px 24px",r={margin:"56px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff"},d={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff"};return a?s.jsx(W,{}):t?null:s.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:o,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[s.jsxs("div",{style:d,children:["Firebase Activity Report",s.jsx("br",{})]}),s.jsx(C,{data:n,loading:a,error:t}),s.jsx("div",{style:r,children:"Hourly Requests"}),s.jsx(V,{data:n,loading:a,error:t}),s.jsx("div",{style:r,children:"Requests by Source"}),s.jsx($,{data:n})]})}export{nt as default};
