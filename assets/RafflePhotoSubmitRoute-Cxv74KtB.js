import{r as e,D as U,b as dt,d as ct,u as E,j as t,L as $,B as k,T as mt,A as pt,R as xt,e as ht,N as ut,h as gt}from"./index-DET38viF.js";import{u as ft}from"./usePageTitle-B1nuMojt.js";import{R as jt}from"./RaflPotSearchBox-dffrAwZU.js";import{D as yt}from"./Dropzone-B_XRtvfn.js";import{L as bt}from"./LoadingDisplay-C86nXFHO.js";import{R as vt}from"./RaffleContext-BcTK-Ydy.js";import{p as kt,c as Ct}from"./postData-BrDQenQK.js";import{n as St}from"./dataUrls-CThgH6Wi.js";import{C as Lt}from"./Checkbox-iIcV_M2q.js";import{C as Nt}from"./Collapse-DkyeyLVe.js";import{T as C}from"./TextField-10cHcabT.js";import{I as Rt,a as Ft}from"./ImageListItem-JmAx1Yoj.js";import{D as S}from"./Dialog-DQodCXm4.js";import{A as Pt}from"./AdminToolButtons-Cp-RsGXQ.js";import"./Search-DPKbmRE3.js";import"./useFormControl-CvbJlEzn.js";import"./Select-DTphF9nj.js";import"./Chip-B-uay3vG.js";import"./index-D-W0XS_y.js";import"./Cancel-89yIzt6T.js";import"./LoadingDisplaySmall-B_0q1ryW.js";import"./Box-D3NFgwAa.js";import"./CircularProgress-BvXmrNLp.js";import"./useData-Dg-PJMmr.js";import"./index-OSYDjWVb.js";import"./setDeep-J6HEwWhX.js";import"./index-xsH4HHeE.js";import"./SwitchBase-rgtgIl1s.js";import"./EmojiEvents-B55-nfNG.js";function wt({profile:s,user:d}){const{allPots:x=[]}=e.useContext(vt),{updateProfileField:h}=e.useContext(U),[n,c]=e.useState({}),[g,L]=e.useState(void 0),[r,f]=e.useState([]),[O,N]=e.useState(void 0),[R,j]=e.useState(!1),[l,F]=e.useState(void 0),[m,P]=e.useState(!1),[_,w]=e.useState(""),[z,I]=e.useState(""),[p,M]=e.useState((s==null?void 0:s.photoCredit)||(s==null?void 0:s.displayName)||""),[y,Y]=e.useState(!1),D=dt(),b=e.useMemo(()=>[...x],[x]),H=ct().format("YYYYMMDD-HHMMss"),K=!!(n!=null&&n.lockFullName)&&!!(n!=null&&n.lockId)&&!!p&&r.length>0,A=`${n.lockName}_${n.lockId}_`.replace("/","+"),B=`${p}`.replace("/","+"),G=r.map(o=>o.name),q=e.useCallback((o,a)=>{f(o)},[]),J=r.length===1?"File":"Files",Q=async o=>{o.preventDefault(),j(!0);const a=`${H}_${A}_${B}`,i=new FormData;r.forEach(u=>{const{base:v,ext:lt}=zt(u.name);i.append("files",u,`${a}/${A}_${v}_${B}.${lt}`)}),i.append("droppedFileNames",G),i.append("lockFullName",n.lockFullName),i.append("lockName",n.lockName),i.append("lockId",n.lockId),i.append("photoCredit",p),i.append("displayName",s==null?void 0:s.displayName),i.append("uploadsDir",a),i.append("notes",z);const at=`${St}/upload`,it=!0,rt=3e4;try{N(await kt({user:d,url:at,formData:i,snackBars:it,timeoutDuration:rt})),X(p)}catch(u){F(Ct(u)),c([]),r.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{j(!1)}},V=e.useCallback(o=>{c(o),L(b.find(a=>a.id===o.lockId))},[b]),X=e.useCallback(o=>{h("photoCredit",o)},[h]),Z=e.useCallback(o=>{const{value:a}=o.target;M(a)},[]),tt=e.useCallback(o=>{const{value:a}=o.target;I(a)},[]),W=e.useCallback(()=>{c({}),L(void 0),r.forEach(o=>URL.revokeObjectURL(o.preview)),f([]),N(void 0),j(!1),F(void 0),P(!1),w(""),I(""),Y(!y)},[r,y]),et=e.useCallback(()=>{P(!m),c([])},[m]),ot=e.useCallback(o=>{const{value:a}=o.target;w(a),c({lockFullName:a,lockName:a,lockId:"NOTINLIST"})},[]),st=m?.5:1,{flexStyle:nt}=E(),T={color:"#bbb",textDecoration:"underline",cursor:"pointer",fontWeight:500,"&:hover":{color:"#fff"}};return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:600,marginBottom:20},children:["Pot ",t.jsx($,{onClick:()=>D("/rafl/contribute"),sx:T,children:"Info"})," |   Photos |  ",t.jsx($,{onClick:()=>D("/rafl/potpreview"),sx:T,children:"Preview"})]}),t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:Q,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"0px 0px 0px"},children:"Select Pot"}),t.jsx("div",{style:{opacity:st},children:t.jsx(jt,{handleChangeLock:V,allEntries:b,disabled:m,reset:y})}),t.jsxs("div",{style:{marginTop:0},children:[t.jsx(Lt,{onChange:et,color:"info",size:"small",id:"notInList",checked:m})," Submit photos for a pot not on the site."]}),t.jsxs(Nt,{in:m,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:_,style:{width:400},onChange:ot,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:nt},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(yt,{files:r||[],otherFiles:[],handleDroppedFiles:q,maxFiles:5,backgroundColor:"#333"}),g&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),g.media?t.jsx("div",{children:t.jsx(Rt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:g.media.map((o,a)=>t.jsx(Ft,{children:t.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},a))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),n.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx("div",{style:{display:"flex"},children:t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:n.lockFullName})}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:p,style:{width:350},onChange:Z,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:z,onChange:tt}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!K||R,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:R,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(bt,{})})}),t.jsx(S,{open:!!O&&!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:10,textAlign:"center"},children:[J," Uploaded Successfully!"]}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:60,textAlign:"center"},children:"Images will be added to the site shortly"}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:W,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[l==null?void 0:l.message,t.jsx("br",{}),"(Error code ",l==null?void 0:l.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:W,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(mt,{feature:"uploadPhotos"})]})}function zt(s){const d=s.lastIndexOf(".");return d===-1?{base:s,ext:""}:{base:s.substring(0,d),ext:s.substring(d)}}function re(){const{isMobile:s}=E(),{lockCollection:d}=e.useContext(U),{user:x}=e.useContext(pt);ft("RAFL Pot Photos");const h=t.jsxs(xt.Fragment,{children:[!s&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(Pt,{})]}),n=s?8:0,c={maxWidth:700,marginLeft:"auto",marginRight:"auto",paddingLeft:n,paddingRight:n};return t.jsx(ht,{children:t.jsxs("div",{style:c,children:[t.jsx(ut,{title:"RAFL Pot Photos",extras:h}),t.jsx(wt,{profile:d,user:x}),t.jsx(gt,{})]})})}export{re as default};
