import{r as s,ab as E,b8 as D,g as w,$ as T,j as y,d as r,aA as z,ap as B,R as U}from"./index-9a6ce20d.js";import{F as R,D as W,r as F,f as G}from"./filterFields-9dd8683f.js";function J({children:v,cardActivity:n,cardBBCount:o,cardDanPoints:c,cardEligibleDan:d,cardNextDanPoints:l,cardNextDanLocks:p,popularLocks:i}){const{filters:e}=s.useContext(R),{search:t,id:m,tab:b,name:f,sort:h,image:Y,locks:$,...k}=e,g=s.useMemo(()=>n.map(a=>{const u=E(a.matchId),O=D(a.matchId),I=w(a.matchId),L=I?"Belt":O?"Project":"Lock";return{...a,...u,...O,...I,id:a.id,type:L}}),[n]),C=s.useMemo(()=>g.reduce((a,u)=>(a[u.matchId]=u,a),{}),[g]),j=s.useMemo(()=>i.map(a=>({...E(a.lockID),...C[a.lockID],popularityRank:a.rank,userCount:a.count})),[i,C]),x=s.useMemo(()=>Object.keys(k).map(a=>{const u=k[a];return Array.isArray(u)?u.map(O=>({key:a,value:O})):{key:a,value:u}}).flat(),[k]),M=s.useMemo(()=>P(g,x,t,h),[g,x,t,h]),A=s.useMemo(()=>P(j,x.concat({key:"exceptionType",value:void 0}),t,"popular"),[j,x,t]),S=s.useMemo(()=>({allEntries:T,cardActivity:n,cardBBCount:o,cardDanPoints:c,cardEligibleDan:d,cardNextDanPoints:l,cardNextDanLocks:p,visibleEntries:M,popularEntries:A,getEntryFromId:E,getProjectEntryFromId:D,getAwardEntryFromId:w}),[n,o,c,d,l,p,M,A]);return y.jsx(W.Provider,{value:S,children:v})}function P(v,n,o,c){const l=v.map(e=>{var t,m,b;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:f})=>f),fuzzy:F(((m=e==null?void 0:e.makeModels)==null?void 0:m.map(({make:f,model:h})=>[f,h]).flat().filter(f=>f).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}return"Worth Points"})()],simpleBelt:(b=e==null?void 0:e.belt)==null?void 0:b.replace(/\s\d/g,"")}}).filter(e=>n.every(({key:t,value:m})=>Array.isArray(e[t])?e[t].includes(m):e[t]===m)),p=o?G.go(F(o),l,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):l,i=(()=>{switch(c){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||B(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"dateAscending":return(e,t)=>r(e.date).valueOf()-r(t.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>r(t.date).valueOf()-r(e.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>B(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"beltDescending":return(e,t)=>z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>r(t.date).valueOf()-r(e.date).valueOf()||z(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return p.sort(i)}const V=U.createContext({});function K({children:v}){const{filters:n,addFilters:o,removeFilters:c}=s.useContext(R),d=n.id,l=s.useCallback(i=>{i?o([{key:"id",value:i}],!0):c(["id"])},[o,c]),p=s.useMemo(()=>({expanded:d,setExpanded:l}),[d,l]);return y.jsx(V.Provider,{value:p,children:v})}export{V as S,J as a,K as b};
