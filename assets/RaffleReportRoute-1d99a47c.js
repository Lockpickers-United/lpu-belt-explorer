import{d as P,u as k,j as t,R as L,b as X,r as x,A as _,N as J,F as K,T as Q}from"./index-85dc9eb6.js";import{D as Z,a as tt,r as et}from"./filterFields-8f01ff5d.js";import{L as ot}from"./LoadingDisplay-a9c31b2f.js";import{u as H}from"./useData-578e045b.js";import{u as nt}from"./usePageTitle-7a266a23.js";import{i as it,s as st,g as rt}from"./dataUrls-d669a6b9.js";import{P as I}from"./nivo-line.es-803deaa4.js";import{p as N}from"./adminChartDefaults-e02caa29.js";import{A as at}from"./AdminStatsTable-09bb3846.js";import{A as O}from"./AdminStatsTableSort-b699680a.js";import{R as lt}from"./RaffleAutocompleteBox-354d86d7.js";import{L as ct}from"./Link-abbd6531.js";import{R as W,s as C,A as dt}from"./AdminRoleButton-b2260846.js";import{R as mt}from"./RaffleStatsHeader-c910a10d.js";import{C as ut}from"./ChoiceButtonGroup-4e6a4f41.js";import{B as xt}from"./nivo-bar.es-065b06ef.js";import{p as ft}from"./chartDefaults-9fc07b21.js";import{R as ht}from"./ReportButton-432387ad.js";import{R as pt}from"./RaffleDataProvider-a724c5a3.js";import"./LPU-c3fa7122.js";import"./LinearProgress-0093fd51.js";import"./useDocumentTitle-7405dffa.js";import"./nivo-legends.es-05db9663.js";import"./index-cc5d1771.js";import"./TableRow-3b7408c5.js";import"./Search-b884840c.js";import"./Autocomplete-6dd21388.js";import"./Select-7cadfd34.js";import"./Chip-214d3823.js";import"./TextField-2e3bab7d.js";import"./index-1222ffb9.js";import"./ToggleButtonGroup-a88b30b5.js";const gt=({lineData:o})=>{const l=[o.rafl28days.data],s=[],n=new Map,e=new Map,i=new Map;l.forEach(m=>{const g=[],j=[],T=[];for(let D=0;D<m.length;D++){let v=m[D].date;if(P(v)<P("2024-12-25"))continue;v=v+" 23:59:59";const f=new Map;f.x=v,f.y=m[D].potListViews,g.push(f);const h=new Map;h.x=v,h.y=m[D].potViews,j.push(h);const F=new Map;F.x=v,F.y=m[D].raflForm,T.push(F)}n.id="Pot List",n.data=g,e.id="Pot Views",e.data=j,i.id="Entry Form",i.data=T,s.push(e),s.push(n),s.push(i)});const{width:a}=k(),d=a<=360,u=a<=395,p=a<=428,b=a<=560,w=a<=820,y=d||u?200:p?210:w?230:350,R=b?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:y,width:"100%"},children:t.jsx(I,{theme:N,data:s,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:R,height:y,curve:"natural",yScale:{type:"linear",min:0,max:"5000",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function yt({data:o}){const{width:l}=k(),s=l<=560,i={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...s?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:i,children:t.jsx(gt,{lineData:o})})})})}const jt=({data:o})=>{const{rafl28days:l}=o,s=l.data.filter(m=>P(m.date)>P("2024-12-28")),n=s.reduce((m,g)=>(Object.keys(l.data[l.data.length-1]).map(j=>{["date","dateString"].includes(j)||(m[j]=m[j]?m[j]+g[j]:g[j])}),m),{});n.dateString="Total",s.push(n);const e=Object.keys(n).reduce((m,g)=>(m[g]=Math.floor(n[g]/s.length),m),{});e.dateString="Average",s.push(e);const i={columns:l.columns,data:s},{width:a}=k(),d=a<=360,u=a<=395,p=a<=428,b=a<=560,w=a<=820,y=d?".8rem":u?".85rem":p?".9rem":".95rem",R="100%";return t.jsx(at,{tableData:i,tableWidth:R,fontSize:y})},bt=({statsData:o})=>{const l=X(),{potViewsById:s}=o,{getPotFromId:n}=x.useContext(Z),{data:e}=H({url:it}),{potWatches:i}=e||{},a=[{name:"Pot #",align:"center",id:"potNumber"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"},{id:"watchlists",name:"Watchlists",align:"center"}],d=!0,[u,p]=x.useState("potNumber"),[b,w]=x.useState(!0),[y,R]=x.useState({}),m=s.data.map(r=>{var M,z;const c=n(r.id);if(!c)return null;let S=c!=null&&c.title?c.title.substring(0,32):`unknown (${r.id})`;S=((M=c==null?void 0:c.title)==null?void 0:M.length)<32||!(c!=null&&c.title)?S:S+"...";const B=(z=r==null?void 0:r.id)==null?void 0:z.replace("2025-","");return{...r,percentViews:Math.floor(r.percentViews*100)+"%",...c,title:S,id:B,watchlists:(i==null?void 0:i[r.id])||0}}).filter(r=>r).sort((r,c)=>{switch(u){case"potNumber":return r.potNumber-c.potNumber||r.title.localeCompare(c.title);case"id":return r[u].localeCompare(c[u]);case"title":return r[u].localeCompare(c[u]);case"donors":return parseInt(c[u])-parseInt(r[u])||r.title.localeCompare(c.title);case"percentViews":return parseInt(c[u])-parseInt(r[u])||r.views-c.views;default:return parseInt(c[u])-parseInt(r[u])||r.title.localeCompare(c.title)}}),g=b?m:m.reverse(),T=(Object.keys(y).length>0?[g==null?void 0:g.find(r=>r.title===y.itemTitle)]:g||[]).map(r=>r.donors&&r.donors>0?{...r}:{...r,donors:0,tickets:0}),D={columns:a,data:T},v=x.useCallback((r,c)=>{const S=m.find(M=>M.title===c),B=S==null?void 0:S.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return r==="title"?t.jsx(ct,{onClick:()=>l(`/rafl/?id=${S.id}&name=${B}`),style:{color:"#fff"},children:c}):c},[l,m]),f=x.useCallback(r=>r!=null&&r.title?r.title:"unknown",[]),{width:h}=k(),F=h<=360,Y=h<=395,q=h<=428,G=h<=560,U=h<=820,E=F?".8rem":Y?".85rem":q?".9rem":".95rem",$="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(lt,{allItems:m,setItemDetails:R,getOptionTitle:f,searchText:"Search Pots"})})}),t.jsx(O,{tableData:D,tableWidth:$,fontSize:E,sortable:d,sort:u,setSort:p,ascending:b,setAscending:w,linkFunction:v})]})},Dt=()=>{const{allCharities:o}=x.useContext(W),l=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],s=!0,[n,e]=x.useState("name"),[i,a]=x.useState(!0),d=o.sort((f,h)=>{switch(n){case"name":return f.name.localeCompare(h.name);case"donors":return h[n]-f[n];case"donations":return h[n]-f[n];default:return f.name.localeCompare(h.name)}}),p=(i?d:d.reverse()).map(f=>f.donations&&f.donations>0?{...f,donations:`$${f.donations}`}:{...f}),b={columns:l,data:p},w=x.useCallback((f,h)=>h,[]),{width:y}=k(),R=y<=360,m=y<=395,g=y<=428,j=y<=560,T=y<=820,D=R?".8rem":m?".85rem":g?".9rem":".95rem",v="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(O,{tableData:b,tableWidth:v,fontSize:D,sortable:s,sort:n,setSort:e,ascending:i,setAscending:a,linkFunction:w})]})};function A({chartHeight:o,chartdata:l,showAxisBottom:s,colors:n,tickValues:e,curve:i}){const a=s?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},d=s?"bottom":"top-left",u=s?70:20,p=s?0:20;return t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(I,{theme:N,data:l,enableGridX:!1,enableGridY:!1,colors:n,lineWidth:3,margin:a,height:o,curve:i??"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:e||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:s?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:s?[]:[{anchor:d,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:p,translateY:u,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const vt=({data:o})=>{const l=Object.keys(o).sort((e,i)=>e.localeCompare(i)).reduce((e,i)=>{const a=i+" 23:59:59";return e.donorsCum=e.donorsCum+o[i].totalDonors||o[i].totalDonors,C(e,["totalDonors"],{x:a,y:o[i].totalDonorCountUnique}),C(e,["cumulativeDonors"],{x:a,y:o[i].cumDonorsUnique}),e.donationsCum=e.donationsCum+o[i].totalDonations||o[i].totalDonations,C(e,["totalDonations"],{x:a,y:o[i].totalDonations}),C(e,["cumulativeDonations"],{x:a,y:e.donationsCum}),e},[]),s={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},n=120;return Object.keys(o).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:s,children:"Donations"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donations Cumulative",data:l.cumulativeDonations}],chartHeight:n,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donations",data:l.totalDonations}],chartHeight:n,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:s,children:"Unique Donors"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donors Cumulative",data:l.cumulativeDonors}],chartHeight:n,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donors",data:l.totalDonors}],chartHeight:n,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},wt=({beltDistribution:o})=>{const{width:l}=k(),s=l<500,n=250,e=s?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},i=s?-45:0,a=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:n},children:t.jsx(xt,{data:o,maxValue:"auto",margin:e,padding:.15,colors:d=>a[d.index%a.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:i},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:ft,isInteractive:!1})})};function St({data:o}){const l=x.useMemo(()=>V.map(d=>({value:o.beltDonations[d]?o.beltDonations[d]/o.totalDonations:0,id:d,label:d})),[o]),s=x.useMemo(()=>V.map(d=>({value:o.beltDonorCountUnique[d]?o.beltDonorCountUnique[d]/o.totalDonorCountUnique:0,id:d,label:d})),[o]),n=x.useMemo(()=>[{label:"Donations",data:l},{label:"Donors",data:s}],[l,s]),[e,i]=x.useState(n[0]),a=x.useCallback(d=>i(d),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ut,{options:n,onChange:a}),t.jsx(wt,{beltDistribution:e.data})]})}const V=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"],Ct=({data:o})=>{const l=Object.keys(o).sort((e,i)=>e.localeCompare(i)).reduce((e,i)=>{const a=i+" 23:59:59";return e.donorsCum=e.donorsCum+o[i].totalDonors||o[i].totalDonors,C(e,["totalDonors"],{x:a,y:o[i].totalDonorCountUnique}),C(e,["cumulativeDonors"],{x:a,y:o[i].cumDonorsUnique}),e.donationsCum=e.donationsCum+o[i].totalDonations||o[i].totalDonations,C(e,["totalDonations"],{x:a,y:o[i].totalDonations}),C(e,["cumulativeDonations"],{x:a,y:e.donationsCum}),e},[]),s={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},n=300;return Object.keys(o).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:s,children:"YOY Donations (cumulative)"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"2025",data:l.cumulativeDonations},{id:"2024",data:kt}],chartHeight:n,showAxisBottom:!0,colors:["#4fa720","#777"],tickValues:5})})]})},kt=[{x:"2025-01-01 23:59:59",y:901},{x:"2025-01-02 23:59:59",y:1336},{x:"2025-01-03 23:59:59",y:1536},{x:"2025-01-04 23:59:59",y:1798},{x:"2025-01-05 23:59:59",y:2948},{x:"2025-01-06 23:59:59",y:2948},{x:"2025-01-07 23:59:59",y:3766},{x:"2025-01-08 23:59:59",y:4446},{x:"2025-01-09 23:59:59",y:4846},{x:"2025-01-10 23:59:59",y:5230},{x:"2025-01-11 23:59:59",y:5480},{x:"2025-01-12 23:59:59",y:5681},{x:"2025-01-13 23:59:59",y:5952},{x:"2025-01-14 23:59:59",y:6157},{x:"2025-01-15 23:59:59",y:6217},{x:"2025-01-16 23:59:59",y:6283},{x:"2025-01-17 23:59:59",y:6288},{x:"2025-01-18 23:59:59",y:6848},{x:"2025-01-19 23:59:59",y:6998},{x:"2025-01-20 23:59:59",y:7201},{x:"2025-01-21 23:59:59",y:7975},{x:"2025-01-22 23:59:59",y:10897},{x:"2025-01-23 23:59:59",y:12055},{x:"2025-01-24 23:59:59",y:14413},{x:"2025-01-25 23:59:59",y:15133},{x:"2025-01-26 23:59:59",y:16728},{x:"2025-01-27 23:59:59",y:17209},{x:"2025-01-28 23:59:59",y:21677},{x:"2025-01-29 23:59:59",y:28598},{x:"2025-01-30 23:59:59",y:30012},{x:"2025-01-31 23:59:59",y:33701}];function Rt(){nt("RAFL Report");const{data:o,loading:l,error:s}=H({urls:Tt}),{siteFullNew:n,raflResponseDetails:e}=o||{},{width:i}=k(),d=i<560?"8px 8px 32px 8px":"24px 24px 32px 24px",u={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},p={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},b=u,w=l?"--":"(updated: "+P(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return l?t.jsx(ot,{}):s?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:d,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:b,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:w})]}),t.jsx(mt,{}),t.jsx("div",{style:{height:20}}),t.jsx(yt,{data:n}),t.jsx("div",{style:p,children:"Totals Over Time"}),t.jsx(Ct,{data:e==null?void 0:e.detailedData}),t.jsx(vt,{data:e==null?void 0:e.detailedData}),t.jsx("div",{style:p,children:"Belt Distribution"}),t.jsx(St,{data:e==null?void 0:e.summaryData}),t.jsx("div",{style:p,children:"Page Tracking"}),t.jsx(jt,{data:n}),t.jsx("div",{style:p,children:"Pot Details"}),t.jsx(bt,{statsData:n}),t.jsx("div",{style:p,children:"Charity Details"}),t.jsx(Dt,{data:n})]})}const Tt={siteFullNew:st,raflResponseDetails:rt};function ae(){const{authLoaded:o}=x.useContext(_),{isMobile:l}=k(),{allPots:s}=x.useContext(W),{raffleAdmin:n}=x.useContext(W),e=t.jsxs(L.Fragment,{children:[!l&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(ht,{active:!0}),t.jsx(dt,{})]});return t.jsx(tt,{filterFields:et,children:t.jsx(pt,{allEntries:s,children:t.jsxs(L.Fragment,{children:[t.jsx(J,{title:"RAFL Report",extras:e}),o&&n&&t.jsx(Rt,{}),t.jsx(K,{}),t.jsx(Q,{feature:"raflReport"})]})})})}export{ae as default};
