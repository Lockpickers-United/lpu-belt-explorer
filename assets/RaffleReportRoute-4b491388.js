import{d as F,u as k,j as t,R as W,b as G,r as x,A as X,N as $,F as q,T as U}from"./index-097d9393.js";import{D as _,a as J,r as K}from"./filterFields-db8522f0.js";import{L as Q}from"./LoadingDisplay-d36e568b.js";import{u as Z}from"./useData-d7a74e20.js";import{u as tt}from"./usePageTitle-fefdc98b.js";import{s as et,g as st}from"./dataUrls-f163a2c2.js";import{P as I}from"./nivo-line.es-95c39ad3.js";import{p as N}from"./adminChartDefaults-e02caa29.js";import{A as nt}from"./AdminStatsTable-5ee367cd.js";import{A as H}from"./AdminStatsTableSort-8551f680.js";import{R as it}from"./RaffleAutocompleteBox-a28da76b.js";import{L as ot}from"./Link-70162df9.js";import{R as V,s as P,A as at}from"./AdminRoleButton-9bf47e1d.js";import{R as rt}from"./RaffleStatsHeader-2394d15d.js";import{R as lt}from"./ReportButton-9be58d87.js";import{R as ct}from"./RaffleDataProvider-ef217a0e.js";import"./LPU-c3fa7122.js";import"./LinearProgress-b5c2a533.js";import"./useDocumentTitle-c21a610b.js";import"./nivo-legends.es-f637d652.js";import"./index-700e4ce1.js";import"./TableRow-56e84272.js";import"./Search-e9910b1e.js";import"./Autocomplete-28a15281.js";import"./Select-e4909bb0.js";import"./Chip-c5853a28.js";import"./TextField-ad0873da.js";import"./index-52b3ddf6.js";const dt=({lineData:l})=>{const c=[l.rafl28days.data],o=[],e=new Map,s=new Map,a=new Map;c.forEach(d=>{const y=[],p=[],C=[];for(let S=0;S<d.length;S++){let h=d[S].date;if(F(h)<F("2024-11-25"))continue;h=h+" 23:59:59";const m=new Map;m.x=h,m.y=d[S].potListViews,y.push(m);const j=new Map;j.x=h,j.y=d[S].potViews,p.push(j);const T=new Map;T.x=h,T.y=d[S].raflForm,C.push(T)}e.id="Pot List",e.data=y,s.id="Pot Views",s.data=p,a.id="Entry Form",a.data=C,o.push(s),o.push(e),o.push(a)});const{width:n}=k(),g=n<=360,w=n<=395,f=n<=428,b=n<=560,D=n<=820,u=g||w?200:f?210:D?230:350,v=b?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:u,width:"100%"},children:t.jsx(I,{theme:N,data:o,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:v,height:u,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function mt({data:l}){const{width:c}=k(),o=c<=560,a={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...o?{}:{display:"flex"}};return t.jsx(W.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:a,children:t.jsx(dt,{lineData:l})})})})}const ut=({data:l})=>{const{rafl28days:c}=l,o=c.data.filter(d=>F(d.date)>F("2024-11-27")),e=o.reduce((d,y)=>(Object.keys(c.data[c.data.length-1]).map(p=>{["date","dateString"].includes(p)||(d[p]=d[p]?d[p]+y[p]:y[p])}),d),{});e.dateString="Total",o.push(e);const s=Object.keys(e).reduce((d,y)=>(d[y]=Math.floor(e[y]/o.length),d),{});s.dateString="Average",o.push(s);const a={columns:c.columns,data:o},{width:n}=k(),g=n<=360,w=n<=395,f=n<=428,b=n<=560,D=n<=820,u=g?".8rem":w?".85rem":f?".9rem":".95rem",v="100%";return t.jsx(nt,{tableData:a,tableWidth:v,fontSize:u})},ft=({data:l})=>{const c=G(),{potViewsById:o}=l,{getPotFromId:e}=x.useContext(_),s=[{name:"Pot #",align:"center",id:"potNumber"},{name:"ID",align:"center",id:"id"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],a=!0,[n,g]=x.useState("potNumber"),[w,f]=x.useState(!0),[b,D]=x.useState({}),u=o.data.map(i=>{var A,z;const r=e(i.id);if(!r)return null;let R=r!=null&&r.title?r.title.substring(0,32):`unknown (${i.id})`;R=((A=r==null?void 0:r.title)==null?void 0:A.length)<32||!(r!=null&&r.title)?R:R+"...";const M=(z=i==null?void 0:i.id)==null?void 0:z.replace("2025-","");return{...i,percentViews:Math.floor(i.percentViews*100)+"%",...r,title:R,id:M}}).filter(i=>i).sort((i,r)=>{switch(n){case"potNumber":return i.potNumber-r.potNumber||i.title.localeCompare(r.title);case"id":return i[n].localeCompare(r[n]);case"title":return i[n].localeCompare(r[n]);case"donors":return parseInt(r[n])-parseInt(i[n])||i.title.localeCompare(r.title);case"percentViews":return parseInt(r[n])-parseInt(i[n])||i.views-r.views;default:return parseInt(r[n])-parseInt(i[n])||i.title.localeCompare(r.title)}}),v=w?u:u.reverse(),y=(Object.keys(b).length>0?[v==null?void 0:v.find(i=>i.title===b.itemTitle)]:v||[]).map(i=>i.donors&&i.donors>0?{...i}:{...i,donors:0,tickets:0}),p={columns:s,data:y},C=x.useCallback((i,r)=>{const R=u.find(A=>A.title===r),M=R==null?void 0:R.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return i==="title"?t.jsx(ot,{onClick:()=>c(`/rafl/?id=${R.id}&name=${M}`),style:{color:"#fff"},children:r}):r},[c,u]),S=x.useCallback(i=>i!=null&&i.title?i.title:"unknown",[]),{width:h}=k(),m=h<=360,j=h<=395,T=h<=428,O=h<=560,Y=h<=820,B=m?".8rem":j?".85rem":T?".9rem":".95rem",E="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(it,{allItems:u,setItemDetails:D,getOptionTitle:S,searchText:"Search Pots"})})}),t.jsx(H,{tableData:p,tableWidth:E,fontSize:B,sortable:a,sort:n,setSort:g,ascending:w,setAscending:f,linkFunction:C})]})},ht=()=>{const{allCharities:l}=x.useContext(V),c=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],o=!0,[e,s]=x.useState("name"),[a,n]=x.useState(!0),g=l.sort((m,j)=>{switch(e){case"name":return m.name.localeCompare(j.name);case"donors":return j[e]-m[e];case"donations":return j[e]-m[e];default:return m.name.localeCompare(j.name)}}),f=(a?g:g.reverse()).map(m=>m.donations&&m.donations>0?{...m,donations:`$${m.donations}`}:{...m}),b={columns:c,data:f},D=x.useCallback((m,j)=>j,[]),{width:u}=k(),v=u<=360,d=u<=395,y=u<=428,p=u<=560,C=u<=820,S=v?".8rem":d?".85rem":y?".9rem":".95rem",h="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(H,{tableData:b,tableWidth:h,fontSize:S,sortable:o,sort:e,setSort:s,ascending:a,setAscending:n,linkFunction:D})]})};function L({chartHeight:l,chartdata:c,showAxisBottom:o,colors:e,tickValues:s,curve:a}){const n=o?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},g=o?"bottom":"top-left",w=o?70:20,f=o?0:20;return t.jsx("div",{style:{height:l,width:"100%"},children:t.jsx(I,{theme:N,data:c,enableGridX:!1,enableGridY:!1,colors:e,lineWidth:3,margin:n,height:l,curve:a??"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:s||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:o?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:o?[]:[{anchor:g,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:f,translateY:w,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const pt=({data:l})=>{const c=Object.keys(l).sort((s,a)=>s.localeCompare(a)).reduce((s,a)=>{const n=a+" 23:59:59";return s.donorsCum=s.donorsCum+l[a].totalDonors||l[a].totalDonors,P(s,["totalDonors"],{x:n,y:l[a].totalDonors}),P(s,["cumulativeDonors"],{x:n,y:l[a].cumDonorsUnique}),s.donationsCum=s.donationsCum+l[a].totalDonations||l[a].totalDonations,P(s,["totalDonations"],{x:n,y:l[a].totalDonations}),P(s,["cumulativeDonations"],{x:n,y:s.donationsCum}),s},[]),o={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},e=120;return Object.keys(l).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(W.Fragment,{children:[t.jsx("div",{style:o,children:"Donations"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations Cumulative",data:c.cumulativeDonations}],chartHeight:e,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations",data:c.totalDonations}],chartHeight:e,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:o,children:"Unique Donors"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors Cumulative",data:c.cumulativeDonors}],chartHeight:e,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors",data:c.totalDonors}],chartHeight:e,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})};function xt(){tt("RAFL Report");const{data:l,loading:c,error:o}=Z({urls:gt}),{siteFullNew:e,raflResponseDetails:s}=l||{},{width:a}=k(),g=a<560?"8px 8px 32px 8px":"24px 24px 32px 24px",w={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},f={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},b=w,D=c?"--":"(updated: "+F(s==null?void 0:s.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return c?t.jsx(Q,{}):o?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:g,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:b,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:D})]}),t.jsx(rt,{}),t.jsx("div",{style:{height:20}}),t.jsx(mt,{data:e}),t.jsx("div",{style:f,children:"Totals Over Time"}),t.jsx(pt,{data:s==null?void 0:s.detailedData}),t.jsx("div",{style:f,children:"Page Tracking"}),t.jsx(ut,{data:e}),t.jsx("div",{style:f,children:"Pot Details"}),t.jsx(ft,{data:e}),t.jsx("div",{style:f,children:"Charity Details"}),t.jsx(ht,{data:e})]})}const gt={siteFullNew:et,raflResponseDetails:st};function $t(){const{authLoaded:l}=x.useContext(X),{isMobile:c}=k(),{allPots:o}=x.useContext(V),{raffleAdmin:e}=x.useContext(V),s=t.jsxs(W.Fragment,{children:[!c&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(lt,{active:!0}),t.jsx(at,{})]});return t.jsx(J,{filterFields:K,children:t.jsx(ct,{allEntries:o,children:t.jsxs(W.Fragment,{children:[t.jsx($,{title:"RAFL Report",extras:s}),l&&e&&t.jsx(xt,{}),t.jsx(q,{}),t.jsx(U,{feature:"raflReport"})]})})})}export{$t as default};
