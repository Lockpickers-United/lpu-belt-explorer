import{r as d,F as I,ax as S,am as j,d as i,aA as z,al as B,j as O}from"./index-DlU4pp1T.js";import{D as P,f as F}from"./DataContext-BUiQXDkT.js";import{r as y}from"./index-Dguw21GC.js";import{c as H}from"./collectionStatsById-DY1NVZ7h.js";import{u as R}from"./useData-CetmAo93.js";import{h as w}from"./dataUrls-DkJe4Pqg.js";import{f as E}from"./filterEntries-DC8IZ1Uf.js";function $({children:C,allEntries:n,profile:o}){const{filters:U}=d.useContext(I),{search:u,id:W,tab:K,name:q,sort:r,image:G,expandAll:k,...v}=U,{data:f,loading:b,error:p}=R({urls:V}),m=d.useMemo(()=>f&&!b&&!p?f.lockbazzarEntryIds:[],[f,p,b]),h=d.useMemo(()=>{const l=(o==null?void 0:o.userLockNotes)||{};return n.map(e=>{var c,t,s;return{...e,makes:e.makeModels[0].make?e.makeModels.map(({make:a})=>a):e.makeModels[0].model,fuzzy:y(e.makeModels.map(({make:a,model:N})=>[a,N]).flat().filter(a=>a).concat([e.version,e.notes,e.belt]).join(",")),content:[(c=e.media)!=null&&c.some(a=>!a.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(t=e.media)!=null&&t.some(a=>a.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((s=e.links)==null?void 0:s.length)>0?"Has Links":"No Links",j[e.belt].danPoints>0?"Worth Dan Points":void 0,i(e.lastUpdated).isAfter(i().subtract(1,"days"))?"Updated Recently":void 0,e.belt.startsWith("Black")?"Is Black":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,l[e.id]?"Has Personal Notes":void 0].flat().filter(a=>a),collection:S.locks.map.map(a=>o&&o[a.key]&&o[a.key].includes(e.id)?a.label:"Not "+a.label),collectionSaves:H[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),personalNotes:l[e.id]}})},[n,o]),M=d.useMemo(()=>{const l=E(v,h),e=u&&l.find(t=>t.id===u);let c=l;return e?c=[e]:u&&(c=F.go(y(u),l,{keys:L,threshold:-23e3}).map(t=>({...t.obj,score:t.score})).filter(t=>t.score>.23)),r?c.sort((t,s)=>{if(r==="popularity")return s.collectionSaves-t.collectionSaves||s.views-t.views||t.fuzzy.localeCompare(s.fuzzy);if(r==="beltAscending")return z(t.belt,s.belt);if(r==="beltDescending")return B(t.belt,s.belt);if(r==="alphaAscending")return t.fuzzy.localeCompare(s.fuzzy);if(r==="alphaDescending")return s.fuzzy.localeCompare(t.fuzzy);if(r==="recentlyUpdated")return Math.floor(i(s.lastUpdated).valueOf()/3600)-Math.floor(i(t.lastUpdated).valueOf()/3600)||z(t.belt,s.belt)||t.fuzzy.localeCompare(s.fuzzy);if(r==="dateAdded")return Math.floor(i(s.dateAdded).valueOf()/3600*24)-Math.floor(i(t.dateAdded).valueOf()/3600*24)||z(t.belt,s.belt)||t.fuzzy.localeCompare(s.fuzzy)}):c},[v,h,u,r]),g=d.useCallback(l=>n.find(e=>e.id===l),[n]),A=d.useCallback(l=>m==null?void 0:m.includes(l),[m]),x=d.useMemo(()=>(o==null?void 0:o.blackBeltAwardedAt)>0,[o]),D=d.useMemo(()=>({allEntries:n,visibleEntries:M,getEntryFromId:g,expandAll:k,profile:o,blackBeltUser:x,lockbazzarAvailable:A}),[n,M,g,k,o,x,A]);return O.jsx(P.Provider,{value:D,children:C})}const L=["fuzzy"],V={lockbazzarEntryIds:w};export{$ as D};
