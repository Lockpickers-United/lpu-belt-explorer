import{ad as me,r as s,j as e,Y,X as M,V as P,Z as re,$ as ae,a0 as ce,a1 as de,D as pe,u as V,R as E,B as H,F as ue,L as ge,A as je,bc as Ce,bd as we,Q as U,T as Se,d as ve,ak as be,al as q,au as _,a5 as $}from"./index-D2wWF4eV.js";import{E as ke}from"./ExpandMore-CiIEfGBL.js";import{C as ye}from"./CopyLinkToRaflPotButton-BYoYClA9.js";import{F as L}from"./FieldValue-azH8yRyu.js";import{F as G}from"./FilterChip-CixFsX_y.js";import{I as Ie}from"./ImageGallery-BY8icFVN.js";import{C as xe}from"./ContentCopy-DMeaJ_9D.js";import{R as Q}from"./RaffleContext-D97lD4zr.js";import{S as Re}from"./ScopedDialog-2i56Whu5.js";import{L as Te}from"./LoadingDisplaySmall-CNJDKXCE.js";import{D as he}from"./DataContext-9aEkd-m_.js";import{C as Be,L as We}from"./LogEntryButton-0ERFmdwX.js";import{A as Le,a as De,b as Fe}from"./AccordionSummary-CcHMyV03.js";import{C as Ee}from"./Collapse-DzHDVPD0.js";import{B as Ae}from"./Box-DNz0cYrI.js";import{M as J}from"./index-BVZyDk-M.js";import{r as K}from"./index-8QK8JElO.js";import{A as Ne}from"./AccordionActions-BUxuV10P.js";import{d as te,F as X,C as ze}from"./download-Cmm84ckB.js";import{L as Me}from"./List-D-F1Mgol.js";function Pe({entry:t}){const[n,o]=me(),c=n.get("image"),d=s.useCallback(S=>{n.set("image",S+1),o(n)},[n,o]),u=s.useCallback(()=>{n.delete("image"),o(n)},[n,o]),i=s.useCallback(()=>ne(c,t),[t,c]),l=s.useMemo(()=>c?+c-1:-1,[c]),x=ne(l,t);return e.jsx(Ie,{media:t.media,openIndex:l,initiallyOpen:x,onOpenImage:d,onCloseImage:u,onBackButton:i,shareParams:{id:t.id,name:n.get("name")},columns:2})}const ne=(t,n)=>/\d+/.test(t)&&!!n.media[t];function Oe({entry:t}){const n=s.useCallback(async()=>{const o=t.title;await navigator.clipboard.writeText(o),Y("Pot name copied to clipboard.")},[t]);return e.jsx(M,{title:"Copy RAFL pot name",arrow:!0,disableFocusListener:!0,children:e.jsx(P,{onClick:n,children:e.jsx(xe,{})})})}var N={},se;function Ue(){if(se)return N;se=1;var t=re();Object.defineProperty(N,"__esModule",{value:!0}),N.default=void 0;var n=t(ae()),o=ce();return N.default=(0,n.default)((0,o.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay"),N}var qe=Ue();const _e=de(qe);function fe(t=[],n=1){const o=(t||[]).map(i=>({...i,tickets:Number((i==null?void 0:i.potTickets)||0)})).filter(i=>i.potTickets>0);if(!o.length||n<=0)return[];const c=o.slice(),d=[],u=i=>{const l=i.reduce((f,g)=>f+g.tickets,0);if(l<=0)return null;const x=Math.random()*l;let S=0;for(let f=0;f<i.length;f++)if(S+=i[f].tickets,x<S)return{winner:i[f],index:f};return{winner:i[i.length-1],index:i.length-1}};for(;d.length<n&&c.length>0;){const i=u(c);if(!i)break;d.push(i.winner),c.splice(i.index,1)}return d}function $e(t){if(!t||!Array.isArray(t.entrants))return[];const n=Number((t==null?void 0:t.winnerCount)||1);return fe(t.entrants,Math.max(1,n))}function ie({entry:t,drawing:n=!1,redrawId:o,excessWinner:c,containerRef:d}){var k;const{updateRaffleWinners:u}=s.useContext(pe),[i,l]=s.useState(!1),x=s.useCallback(r=>{r.preventDefault(),r.stopPropagation(),l(!1)},[]),S=t.winnerCount>1?"WINNERS":"WINNER",f=s.useCallback(async r=>{r.preventDefault(),r.stopPropagation();const a=$e(t);await u(t.id,a),console.log("entry.winners",a)},[t,u]),g=s.useCallback(async(r,a)=>{r.preventDefault(),r.stopPropagation();try{const j=Array.isArray(t==null?void 0:t.winners)?t.winners.slice():[],B=Number((t==null?void 0:t.winnerCount)||1),I=new Set(j.map(h=>h.entryId));console.log("existingIds",I);const y=(Array.isArray(t==null?void 0:t.entrants)?t.entrants:[]).map(h=>({...h,tickets:Number((h==null?void 0:h.potTickets)||0)})).filter(h=>h.tickets>0&&(!h.entryId||!I.has(h.entryId)));if(console.log("eligible",y),!y.length){console.warn("No eligible entrants available for redraw for pot",t==null?void 0:t.id,"redrawId",a),l(!0);return}const[R]=fe(y,1);if(!R){console.warn("Redraw failed to pick a new winner for pot",t==null?void 0:t.id);return}let v;if(B>1&&j.length>0){let h=!1;if(v=j.map(W=>!h&&(W==null?void 0:W.entryId)===a?(h=!0,R):W),!h){console.warn("Redraw id not found among current winners for pot",t==null?void 0:t.id,"idToRedraw",a);return}}else v=[R];await u(t.id,v),console.log("Redraw complete. Updated winners:",v)}catch(j){console.error("Error during redraw:",j)}},[t,u]),{isMobile:p}=V(),m=e.jsxs("div",{style:{textAlign:"center",fontWeight:700,fontSize:"1.1rem",padding:40},children:["There are no other eligible entries.",e.jsx("br",{}),e.jsx("br",{}),e.jsx(H,{onClick:x,variant:"contained",children:"Sorry!"})," ",e.jsx("br",{}),e.jsx("br",{})]});return e.jsxs(E.Fragment,{children:[o&&n?e.jsx("div",{style:{marginLeft:2,color:"#f35454",fontWeight:"bold"},children:e.jsx(P,{onClick:r=>g(r,o),color:"secondary",variant:"contained",size:"small",style:{fontWeight:600,fontSize:"0.9rem",marginTop:p?0:-3,whiteSpace:"nowrap",color:c?"#f35454":"#666"},children:e.jsx(_e,{fontSize:"small"})})}):!t.winners||((k=t.winners)==null?void 0:k.length)===0?e.jsx("div",{style:{marginLeft:20,marginTop:p?8:0},children:e.jsxs(H,{onClick:f,color:"secondary",variant:"contained",size:"small",style:{fontWeight:600,fontSize:"0.9rem",marginTop:p?0:-3,whiteSpace:"nowrap",width:135},children:["DRAW ",S]})}):null,e.jsx(Re,{open:i,dialogContent:m,handleClose:x,containerRef:d,position:{top:80},centerX:!0,width:p?350:400})]})}function Ge({entry:t,drawing:n=!1}){var h,W,A;if(!t)return null;const{raflState:o,raffleAdminRole:c,excessWinners:d}=s.useContext(Q),u=["live","post"].includes(o)||c,{setFilters:i}=s.useContext(ue),{isMobile:l,flexStyle:x}=V();let S=t.displayName?t.displayName:t.title;const f=t.winnerCount>1&&((h=t.winners)==null?void 0:h.length)===0?` (${t.winnerCount} winners)`:"",g=t.winnerCount>1?"Winners":"Winner",p=s.useCallback((b,D)=>{b&&typeof b.preventDefault=="function"&&b.preventDefault(),b&&typeof b.stopPropagation=="function"&&b.stopPropagation(),console.log("openWinnerPots entryId:",D),i({winnerEntryIds:D.entryId})},[i]),m=l?"100%":"auto",k=n?15:0,r=l?28:30,a=l?"1.1rem":"1.3rem",j="1rem",B=0,I=l?"1.15rem":"1.3rem",C=l?"1.5rem":"1.7rem",y=l?"1.1rem":"1.2rem",R=l?"1.2rem":"1.3rem",v=Array.isArray(t.winners)?e.jsx(E.Fragment,{children:t.winners.map((b,D)=>e.jsxs("div",{style:{display:"flex",justifyContent:"right",marginBottom:4},children:[D===0&&e.jsxs("span",{style:{fontWeight:400,color:"#fff"},children:[g,": "]}),e.jsx(ge,{style:{color:d.includes(b.entryId)?"#f35454":"#fff",textAlign:"right"},onClick:O=>p(O,b),children:b.username}),e.jsx(ie,{entry:t,drawing:n,redrawId:b.entryId,excessWinner:d.includes(b.entryId)})]},D))}):void 0;return e.jsxs("div",{style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",marginBottom:k},children:[u&&e.jsx("div",{style:{borderRadius:"50%",backgroundColor:"#fff",color:"#000",height:r,width:r,minWidth:r,marginTop:0,marginBottom:4,marginRight:12,display:"flex"},children:e.jsx("div",{style:{margin:"auto",paddingTop:0,paddingLeft:B,paddingRight:1,fontWeight:700,fontSize:a,lineHeight:j},children:t.potNumber})}),e.jsxs("div",{style:{display:x,flexDirection:"row",flexGrow:1,alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",flexGrow:1,fontWeight:500,fontSize:I,lineHeight:C,marginTop:l?0:-3},children:[S,e.jsxs("div",{style:{whiteSpace:"nowrap",fontSize:I,lineHeight:C},children:[" ",f]})]}),n&&e.jsx("div",{style:{display:"flex",justifyContent:"right",width:m},children:e.jsx(ie,{entry:t,drawing:n})})]}),((W=t.winners)==null?void 0:W.length)>0&&!l&&e.jsx("div",{style:{display:"flex",flexGrow:1,fontSize:y,lineHeight:R,marginTop:l?8:0,marginBottom:8,marginRight:12,fontWeight:600,justifyItems:"right"},children:e.jsx("div",{style:{width:"100%"},children:v})})]}),((A=t.winners)==null?void 0:A.length)>0&&l&&e.jsx("div",{style:{display:"flex",flexGrow:1,fontSize:y,lineHeight:R,marginTop:l?8:0,marginBottom:8,marginRight:12,fontWeight:600,justifyItems:"right"},children:e.jsx("div",{style:{width:"100%"},children:v})})]})}var z={},oe;function Ye(){if(oe)return z;oe=1;var t=re();Object.defineProperty(z,"__esModule",{value:!0}),z.default=void 0;var n=t(ae()),o=ce();return z.default=(0,n.default)((0,o.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star"),z}var He=Ye();const le=de(He);function Ve({id:t}){const{isLoggedIn:n}=s.useContext(je),{lockCollection:o,addToLockCollection:c,removeFromLockCollection:d}=s.useContext(pe),[u,i]=s.useState(()=>{}),l=!!u,{isMobile:x}=V(),[S,f]=s.useState(null),g="raffleWatchlist",p=s.useCallback(()=>!!o[g]&&o[g].includes(t),[t,o]),m=p()?"Remove from Watchlist":"Add to Watchlist",k=s.useCallback((C,y)=>async(R,v)=>{R.preventDefault(),R.stopPropagation(),f(C),v||!y?await c(C,t):await d(C,t),f(null)},[t,c,d]),r=s.useCallback(C=>{C.preventDefault(),C.stopPropagation(),i(C.currentTarget)},[]),a=s.useCallback(C=>{C.preventDefault(),C.stopPropagation(),i(null)},[]),j=36,I={marginTop:-2,marginRight:x?4:8,width:j,minWidth:j,height:j};return e.jsxs("div",{style:I,children:[n&&e.jsx("div",{style:{display:"flex",justifyItems:"left"},children:e.jsx(E.Fragment,{children:S===g?e.jsx("div",{style:{marginTop:1},children:e.jsx(Te,{})}):e.jsx(M,{title:m,arrow:!0,disableFocusListener:!0,children:e.jsx(P,{onClick:k(g,p()),style:{color:p()?"#13e113":"#999",...I},children:e.jsx(le,{})},g)})},g)}),!n&&e.jsxs(E.Fragment,{children:[e.jsx(M,{title:m,arrow:!0,disableFocusListener:!0,children:e.jsx(P,{onClick:r,style:{color:p()?"#13e113":"#999",...I},children:e.jsx(le,{})},g)}),e.jsx(Ce,{open:l,anchorEl:u,onClose:a,anchorOrigin:{vertical:"top",horizontal:"left"},children:e.jsx("div",{style:{display:"flex",padding:30,width:300,placeItems:"center"},onClick:a,children:e.jsxs("div",{children:[e.jsx("strong",{children:"Log in to keep a RAFL Watchlist!"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(we,{})]})})})]})]})}function Je({entry:t,expanded:n,onExpand:o,drawing:c}){var A,b,D,O,Z,ee;if(!t)return null;const{raflState:d,raffleAdminRole:u}=s.useContext(Q),{expandAll:i}=s.useContext(he),l=["live","post"].includes(d)||u,{filters:x}=s.useContext(ue),S=!!x.shippingType||!!x.splitShipping||!!x.usShipText,[f,g]=s.useState(!1),p=s.useRef(null),m=t.totalTickets?new Intl.NumberFormat().format(t.totalTickets):"---";s.useEffect(()=>{if(n&&p&&!f&&!i){const w=window.innerWidth<=600?70:74;g(!0),setTimeout(()=>{window.scrollTo({left:0,top:p.current.offsetTop-w,behavior:n?"auto":"smooth"})},n?0:100)}else n||g(!1)},[n,t,f,i]);const k=s.useCallback((T,w)=>{o&&o(w?t.id:!1)},[t.id,o]),{isMobile:r,flexStyle:a}=V(),j={maxWidth:700,marginLeft:"auto",marginRight:"auto"},B=r?"12px 0px 8px 0px":"12px 0px 8px 8px",I=r?"0px 0px 0px 0px":"0px 0px 0px 8px",C=r?"12px 0px 0px 0px":"12px 0px 0px 8px",y=r?"1rem":"1.1rem",R=r?"0.95rem":"1.0rem",v=((A=t.winners)==null?void 0:A.length)>0&&!n?.5:1,h={Yes:"#50af53",No:"#ec5345",Split:"#e39a29","Winner pays fees":"#e39a29"},W={Yes:"",No:"Cannot ship to the US",Split:"US winner splits tariffs & fees","Winner pays fees":"US winner pays tariffs & fees"};return e.jsxs(Le,{expanded:n,onChange:k,style:j,ref:p,children:[e.jsx(De,{expandIcon:e.jsx(ke,{}),style:{marginBottom:10},children:e.jsx("div",{style:{width:"100%",marginBottom:0},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",flexGrow:1},children:[e.jsxs("div",{style:{display:"block",marginBottom:0,flexGrow:1},children:[e.jsx("div",{style:{display:"flex",width:"100%",alignItems:"center"},children:e.jsx("div",{style:{margin:B,display:"flex",flexGrow:1},children:e.jsx(Ge,{entry:t,drawing:c})})}),e.jsxs("div",{style:{margin:I,display:"flex"},children:[e.jsx("div",{style:{flexGrow:1,opacity:v},children:e.jsxs("div",{style:{marginRight:8,color:"#bbb",fontSize:"1.0rem"},children:["Contributed by  ",(b=t.contributedBy)==null?void 0:b.map((T,w)=>{const F=w<t.contributedBy.length-1?", ":"";return e.jsxs("span",{children:[e.jsx(G,{value:T,field:"contributedBy",mode:"text"}),F]},w)})]})}),l&&e.jsx(Ee,{in:t.uniqueDonorCount>0,children:e.jsxs("div",{style:{marginRight:10,fontSize:y,textAlign:"right",display:a,opacity:v},children:[e.jsx("div",{children:e.jsxs("nobr",{children:["Donors ",e.jsx("strong",{children:t.uniqueDonorCount||"--"})]})}),e.jsx("div",{style:{marginLeft:16},children:e.jsxs("nobr",{children:["Tickets ",e.jsx("strong",{children:m})]})})]})})]}),S&&e.jsxs("div",{style:{display:a,marginTop:6,opacity:v},children:[e.jsxs("div",{style:{display:"flex"},children:[t.country.length>0&&e.jsx("div",{style:{marginRight:10},children:e.jsx(L,{name:"Country",headerStyle:{marginBottom:4},value:t.country.map((T,w)=>{const F=w<t.country.length-1?", ":"";return e.jsxs("span",{children:[e.jsx(G,{value:T,field:"country",mode:"text"}),F]},w)})})}),t.shippingInfo&&e.jsx("div",{style:{marginRight:10},children:e.jsx(L,{name:"Shipping Info",headerStyle:{marginBottom:4},value:t.shippingInfo})})]}),t.shipsToUS&&t.shipsToUS!=="Yes"&&e.jsx(L,{name:"US Shipping Details",headerStyle:{marginBottom:4},textStyle:{color:h[t.shipsToUS]},value:W[t.shipsToUS]})]}),t.description&&e.jsx(Ae,{style:{margin:C,fontSize:y,opacity:v},children:e.jsx(J,{rehypePlugins:[[K,{target:"_blank"}]],components:{p:"div"},children:t.description})})]}),l&&!c&&e.jsx(Ve,{id:t.id})]})})}),n&&e.jsxs(E.Fragment,{children:[e.jsxs(Fe,{sx:{padding:"0px 16px 0px 16px"},children:[((D=t.descriptionContinued)==null?void 0:D.length)>0&&e.jsx("div",{style:{margin:r?"0px 0px 12px 0px":"0px 0px 12px 8px",fontSize:y,opacity:v},children:e.jsx(J,{rehypePlugins:[[K,{target:"_blank"}]],components:{p:"div"},children:t.descriptionContinued})}),e.jsx("div",{style:{display:a},children:e.jsx(U,{direction:"row",alignItems:"flex-start",style:{},children:!!((O=t.tags)!=null&&O.length)&&e.jsx(L,{name:"Tags",value:e.jsx(U,{direction:"row",spacing:0,sx:{flexWrap:"wrap"},children:t.tags.map((T,w)=>e.jsx(G,{value:T,field:"tags",mode:"simple"},w))}),headerStyle:{marginBottom:4}})})}),!S&&e.jsxs("div",{style:{display:a,marginTop:6},children:[e.jsxs("div",{style:{display:"flex"},children:[t.country.length>0&&e.jsx("div",{style:{marginRight:10},children:e.jsx(L,{name:"Country",headerStyle:{marginBottom:4},value:t.country.map((T,w)=>{const F=w<t.country.length-1?", ":"";return e.jsxs("span",{children:[e.jsx(G,{value:T,field:"country",mode:"text"}),F]},w)})})}),t.shippingInfo&&e.jsx("div",{style:{marginRight:10},children:e.jsx(L,{name:"Shipping Info",headerStyle:{marginBottom:4},value:t.shippingInfo})})]}),t.shipsToUS&&t.shipsToUS!=="Yes"&&e.jsx(L,{name:"US Shipping Details",headerStyle:{marginBottom:4},textStyle:{color:h[t.shipsToUS],fontWeight:t.shipsToUS==="No"?500:400},value:W[t.shipsToUS]})]}),t.potContents&&e.jsx(U,{direction:"row",spacing:1,sx:{width:"100%",flexWrap:"wrap",marginTop:"4px"},children:e.jsx(L,{name:"Contents",textStyle:{fontSize:R},value:e.jsx(J,{rehypePlugins:[[K,{target:"_blank",rel:["nofollow","noopener","noreferrer"]}]],children:t.potContents})})}),!!((Z=t.media)!=null&&Z.length)&&e.jsx(L,{value:e.jsx(Pe,{entry:t})}),!!((ee=t.links)!=null&&ee.length)&&e.jsx(L,{name:"Links",value:e.jsx(U,{direction:"row",spacing:1,sx:{flexWrap:"wrap"},children:t.links.map(({title:T,url:w},F)=>e.jsx(H,{href:w,target:"_blank",rel:"noopener noreferrer",color:"secondary",variant:"outlined",sx:{textTransform:"none"},style:{margin:4},children:T},F))})}),!i&&e.jsx(Se,{feature:"raflPot",id:t.id})]}),e.jsx(Ne,{disableSpacing:!0,children:e.jsxs("div",{style:{display:"flex",width:"100%"},children:[e.jsxs("div",{style:{flexGrow:1,justifyItems:"left"},children:[e.jsx(Be,{entry:t}),e.jsx(We,{entry:t})]}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx(Oe,{entry:t}),l&&e.jsx(ye,{entry:t})]})]})})]})]})}const mt=E.memo(Je,(t,n)=>{const o=Object.keys(t.entry),c=Object.keys(n.entry);if(o.length!==c.length)return!1;for(let d=0;d<o.length;d++)if(o[d]!==c[d]||t.entry[o[d]]!==n.entry[c[d]])return!1;return t.expanded===n.expanded&&t.onExpand===n.onExpand});function gt({text:t}){const[n,o]=s.useState(null),c=!!n,d=s.useCallback(p=>o(p.currentTarget),[]),u=s.useCallback(()=>o(null),[]),i=ve().format("YYYY-MM-DD"),{raffleAdminRole:l}=s.useContext(Q),{visibleEntries:x=[]}=s.useContext(he),S=s.useCallback(()=>{const p=JSON.stringify(x);u(),te(`rafflePots${i}.json`,p),Y("Current RAFL pots downloaded as rafflePots.json")},[i,u,x]),f=s.useCallback(()=>{const p=x.map(m=>{const k=m.winnerCount>1?`(${m.winnerCount} winners)`:"";let r=`Pot #${m.potNumber} - ${m.title} ${k}
  DONATIONS: ${m.totalTickets}
  DONORS: ${m.uniqueDonorCount}
`;return m.winnerFilterNames.length>0&&(r+=`  WINNERS: ${m.winnerFilterNames.join(", ")}
`),r}).join(`
`);u(),navigator.clipboard.writeText(p).then(()=>{Y("Current RAFL pots copied to clipboard.")})},[u,x]),g=s.useCallback(()=>{const p=x.map(a=>({id:a.id,potNumber:a.potNumber,title:a.title,contributedBy:a.contributedBy.join(", "),donors:a.uniqueDonorCount,tickets:a.totalTickets,winners:a.winnerFilterNames.join(", ")})),m=Object.keys(p[0]).join(","),k=p.map(a=>Object.keys(p[0]).map(j=>a[j]).map(j=>{const B=`${j??""}`.replace(/"/g,'""');return/(\s|,|")/.test(B)?`"${B}"`:B}).join(",")).join(`
`),r=`${m}
${k}`;u(),te("rafflePots.csv",r),Y("Current RAFL pots downloaded as rafflePots.csv")},[u,x]);return e.jsxs("div",{children:[t?e.jsx(M,{title:"Export",arrow:!0,disableFocusListener:!0,children:e.jsx(H,{variant:"outlined",size:"small",onClick:d,style:{color:"#ddd",borderColor:"#aaa"},startIcon:e.jsx(X,{}),children:"Export"})}):e.jsx(M,{title:"Export",arrow:!0,disableFocusListener:!0,children:e.jsx(P,{onClick:d,children:e.jsx(X,{})})}),e.jsxs(be,{anchorEl:n,open:c,onClose:u,children:[!t&&e.jsxs(q,{disabled:!0,children:[e.jsx(_,{children:e.jsx(X,{fontSize:"small"})}),e.jsx($,{children:"Export"})]}),e.jsxs(q,{onClick:f,children:[e.jsx(_,{children:e.jsx(xe,{fontSize:"small"})}),e.jsx($,{children:"Copy to clipboard"})]}),e.jsxs(q,{onClick:g,children:[e.jsx(_,{children:e.jsx(Me,{fontSize:"small"})}),e.jsx($,{children:"CSV"})]}),l&&e.jsxs(q,{onClick:S,children:[e.jsx(_,{children:e.jsx(ze,{fontSize:"small"})}),e.jsx($,{children:"JSON"})]})]})]})}export{mt as R,gt as a};
