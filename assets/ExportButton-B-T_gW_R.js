import{r as o,K as S,j as e,J as N,I as B,A as O,D as R,u as G,B as T,aI as $,R as W,ad as P,ae as y,ao as w,Y as L}from"./index-T3tny4A1.js";import{L as V}from"./Link-DIEjiy-y.js";import{e as z}from"./entryName-_qJ72bVA.js";import{C as J}from"./Cancel-DYZgcTzN.js";import{D as K}from"./Dialog-BDtMh1sf.js";import{s as U}from"./sanitizeValues-CMpieVGR.js";import{T as _}from"./TextField-B2acIc4M.js";import{L as I}from"./Link-DNs0XQoU.js";import{M as q}from"./index-CjNA_Glv.js";import{r as H}from"./index-DasSCeO0.js";import{r as Y}from"./index-CQX7e3DQ.js";import{d as M,F as D,C as Q}from"./download-DfRAxRyt.js";import{L as X}from"./List-ansEJ06Y.js";import{D as Z}from"./DataContext-BV7URSFQ.js";import"./index-DpKilmEF.js";import{C as ee}from"./ContentCopy-BdyLxMXf.js";function ge({entry:n,nameType:u}){const r=o.useCallback(async()=>{const t=z(n,u).replace(/[\s/]/g,"_").replace(/\W/g,""),a=`https://share.lpubelts.com/?id=${n.id}&name=${t}`;await navigator.clipboard.writeText(a),S("Link to entry copied to clipboard.")},[n,u]);return e.jsx(N,{title:"Copy Link to Entry",arrow:!0,disableFocusListener:!0,children:e.jsx(B,{onClick:r,children:e.jsx(V,{})})})}function oe({dialogContent:n,open:u,handleClose:r,width:h=350}){return e.jsxs(K,{open:u,onClose:r,sx:{".MuiDialog-paper":{backgroundColor:"transparent",backgroundImage:"none",padding:"12px",margin:"0px 0px 20px 0px",width:h}},children:[e.jsx("div",{style:{display:"flex",flexGrow:1,justifyContent:"flex-end",marginBottom:-15,marginRight:-10},children:e.jsx(B,{style:{padding:0,color:"#eee",backgroundColor:"#333"},onClick:r,children:e.jsx(J,{})})}),e.jsx("div",{style:{backgroundColor:"#666",borderRadius:4,boxShadow:"0px 11px 15px -7px rgba(0,0,0,0.2),0px 24px 38px 3px rgba(0,0,0,0.14),0px 9px 46px 8px rgba(0,0,0,0.12)"},children:n})]})}function Ce({entry:n}){const{isLoggedIn:u}=o.useContext(O),{userLockNotes:r,updateProfileField:h}=o.useContext(R),t=r[n.id]||"",a=o.useCallback(async j=>{await h("userLockNotes",j),C(!1)},[h]),[c,C]=o.useState(!1),d=o.useCallback(()=>{C(!0)},[]),p=o.useCallback(()=>{C(!1),k(t)},[t]),[f,k]=o.useState(t);o.useEffect(()=>{k(t||"")},[t]);const x=j=>{k(U(j.target.value,{urlsOK:!0}))},b=o.useCallback(async()=>{const j={...r,[n.id]:f||""};await a(j).catch(E=>{console.error("Error updating notes:",E)}),p()},[r,n.id,f,a,p]),s=o.useCallback(async()=>{const j={...r};delete j[n.id],await a(j).catch(E=>{console.error("Error removing notes:",E)}),p()},[n.id,p,a,r]),{isMobile:m}=G(),v={fontSize:"1.0rem",fontWeight:400,marginBottom:5,paddingLeft:2,color:"#fff"},l=m?"0.95rem":"1.0rem",i=m?5:3,g=t.split(`
`).length,F=g>i?Math.min(g,12):i,A=e.jsx("div",{style:{display:"flex"},children:u?e.jsxs("div",{style:{flexGrow:1,maxWidth:550,padding:10},children:[e.jsxs("div",{style:{marginTop:10,display:"flex"},children:[e.jsx("div",{style:{...v,flexGrow:1,fontWeight:700},children:"My Notes"}),e.jsxs("div",{style:{...v,color:"#aaa",fontSize:"0.85rem"},children:[f.length||0,"/1200"]})]}),e.jsx(_,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:F,value:f,onChange:x,id:"notes",color:"info",style:{},placeholder:"Add your personal notes about this lock",variant:"outlined",autoFocus:!0,inputProps:{maxLength:1200,style:{fontSize:l}}}),e.jsxs("div",{style:{flexGrow:1,textAlign:"right",marginTop:8},children:[e.jsx(T,{variant:"text",size:"small",onClick:p,children:"Cancel"}),e.jsx(T,{variant:"text",size:"small",onClick:b,color:"success",children:"Save"})]})]}):e.jsxs("div",{style:{flexGrow:1,padding:"40px 20px",placeItems:"center"},children:[e.jsxs("div",{style:{...v,marginBottom:15,fontWeight:700,textAlign:"center"},children:["Please sign in to add your",e.jsx("br",{}),"own notes for locks."]}),e.jsx("div",{style:{width:210},children:e.jsx($,{onClick:p})})]})});return e.jsxs(W.Fragment,{children:[(t==null?void 0:t.length)>0?e.jsxs("div",{style:{fontWeight:700,marginTop:15},children:[e.jsxs("div",{style:{display:"flex"},children:[e.jsx("span",{style:{marginTop:-.6},children:"My notes  "}),e.jsx(I,{style:{fontWeight:400,color:"#2bb259"},onClick:d,children:"edit"})," • ",e.jsx(I,{style:{fontWeight:400,color:"#2bb259"},onClick:s,children:"remove"})]}),e.jsx("div",{style:{fontSize:l,marginLeft:10,fontWeight:400,fontStyle:"italic"},children:e.jsx(q,{remarkPlugins:[Y],rehypePlugins:[[H,{target:"_blank",rel:["nofollow","noopener","noreferrer"]}]],children:t})})]}):e.jsx("div",{style:{fontWeight:700,marginTop:15},children:e.jsx(I,{style:{fontWeight:600,color:"#2bb259",textDecoration:"none",cursor:"pointer"},onClick:d,children:"Add your personal notes"})}),e.jsx(oe,{dialogContent:A,open:c,handleClose:p,width:m?350:550})]})}function ke({text:n,entries:u}){const[r,h]=o.useState(null),t=!!r,a=o.useCallback(x=>h(x.currentTarget),[]),c=o.useCallback(()=>h(null),[]),{visibleEntries:C}=o.useContext(Z),d=u||C,p=o.useCallback(()=>{const x=JSON.stringify(d);c(),M("lpubeltsData.json",x),S("Current lock entries downloaded as lpubeltsData.json")},[c,d]),f=o.useCallback(()=>{const b=d.map(s=>({id:s.id,make:s.makeModels.map(m=>m.make).join(","),model:s.makeModels.map(m=>m.model).join(","),version:s.version,belt:s.belt,name:z(s),versionText:s.version?" ("+s.version+")":""})).map(s=>"* "+s.name+s.versionText).join(`
`);c(),navigator.clipboard.writeText(b).then(),S("Current lock entries copied to clipboard.")},[c,d]),k=o.useCallback(()=>{const x=["id","name","version","belt","notes"],b=d.map(l=>({id:l.id,make:l.makeModels.map(i=>i.make).join(","),model:l.makeModels.map(i=>i.model).join(","),version:l.version,belt:l.belt,name:z(l),notes:l.personalNotes})),s=x.join(","),m=b.map(l=>x.map(i=>l[i]).map(i=>{const g=`${i??""}`.replace(/"/g,'""');return/(\s|,|")/.test(g)?`"${g}"`:g}).join(",")).join(`
`),v=`${s}
${m}`;c(),M("lpubeltsData.csv",v),S("Current lock entries downloaded as lpubeltsData.csv")},[c,d]);return e.jsxs(W.Fragment,{children:[n?e.jsx(N,{title:"Export",arrow:!0,disableFocusListener:!0,children:e.jsx(T,{variant:"outlined",size:"small",onClick:a,style:{color:"#ddd",borderColor:"#aaa"},startIcon:e.jsx(D,{}),children:"Export"})}):e.jsx(N,{title:"Export",arrow:!0,disableFocusListener:!0,children:e.jsx(B,{onClick:a,children:e.jsx(D,{})})}),e.jsxs(P,{anchorEl:r,open:t,onClose:c,children:[!n&&e.jsxs(y,{disabled:!0,children:[e.jsx(w,{children:e.jsx(D,{fontSize:"small"})}),e.jsx(L,{children:"Export"})]}),e.jsxs(y,{onClick:f,children:[e.jsx(w,{children:e.jsx(ee,{fontSize:"small"})}),e.jsx(L,{children:"Copy to clipboard"})]}),e.jsxs(y,{onClick:k,children:[e.jsx(w,{children:e.jsx(X,{fontSize:"small"})}),e.jsx(L,{children:"CSV"})]}),e.jsxs(y,{onClick:p,children:[e.jsx(w,{children:e.jsx(Q,{fontSize:"small"})}),e.jsx(L,{children:"JSON"})]})]})]})}export{ge as C,ke as E,Ce as a};
