import{r as u,F as g,aj as x,d,as as C,au as p,ai as j,j as U}from"./index-a3fc240a.js";import{D,f as S}from"./DataContext-d6ec691c.js";import{r as k}from"./index-17bd2c7d.js";import{c as I}from"./collectionStatsById-8def94ca.js";function V({children:y,allEntries:r,profile:i}){const{filters:A}=u.useContext(g),{search:c,id:B,tab:F,name:N,sort:a,image:P,expandAll:z,...m}=A,v=u.useMemo(()=>r.map(s=>{var o,n,l;return{...s,makes:s.makeModels[0].make?s.makeModels.map(({make:e})=>e):s.makeModels[0].model,fuzzy:k(s.makeModels.map(({make:e,model:t})=>[e,t]).flat().filter(e=>e).concat([s.version,s.notes,s.belt]).join(",")),content:[(o=s.media)!=null&&o.some(e=>!e.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(n=s.media)!=null&&n.some(e=>e.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((l=s.links)==null?void 0:l.length)>0?"Has Links":"No Links",x[s.belt].danPoints>0?"Worth Dan Points":void 0,d(s.lastUpdated).isAfter(d().subtract(1,"days"))?"Updated Recently":void 0,s.belt.startsWith("Black")?"Is Black":void 0,s.belt!=="Unranked"?"Is Ranked":void 0].flat().filter(e=>e),collection:C.locks.map.map(e=>i&&i[e.key]&&i[e.key].includes(s.id)?e.label:"Not "+e.label),collectionSaves:I[s.id]||0,simpleBelt:s.belt.replace(/\s\d/g,"")}}),[r,i]),b=u.useMemo(()=>{const s=Object.keys(m).map(e=>{const t=m[e];return Array.isArray(t)?t.map(f=>({key:e,value:f})):{key:e,value:t}}).flat(),o=v.filter(e=>s.every(({key:t,value:f})=>Array.isArray(e[t])?e[t].includes(f):e[t]===f)),n=c&&o.find(e=>e.id===c);let l=o;return n?l=[n]:c&&(l=S.go(k(c),o,{keys:O,threshold:-25e3}).map(e=>({...e.obj,score:e.score}))),a?l.sort((e,t)=>{if(a==="popularity")return t.collectionSaves-e.collectionSaves||t.views-e.views||e.fuzzy.localeCompare(t.fuzzy);if(a==="beltAscending")return p(e.belt,t.belt);if(a==="beltDescending")return j(e.belt,t.belt);if(a==="alphaAscending")return e.fuzzy.localeCompare(t.fuzzy);if(a==="alphaDescending")return t.fuzzy.localeCompare(e.fuzzy);if(a==="recentlyUpdated")return Math.floor(d(t.lastUpdated).valueOf()/3600)-Math.floor(d(e.lastUpdated).valueOf()/3600)||p(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy);if(a==="dateAdded")return Math.floor(d(t.dateAdded).valueOf()/3600*24)-Math.floor(d(e.dateAdded).valueOf()/3600*24)||p(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}):l},[m,v,c,a]),h=u.useCallback(s=>r.find(o=>o.id===s),[r]),M=u.useMemo(()=>({allEntries:r,visibleEntries:b,getEntryFromId:h,expandAll:z,profile:i}),[r,h,b,z,i]);return U.jsx(D.Provider,{value:M,children:y})}const O=["fuzzy"];export{V as D};
