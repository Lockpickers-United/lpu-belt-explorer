import{r as s,D as ct,d as mt,u as _,j as t,B as k,T as pt,bE as xt,R as ht,e as ut,a0 as gt,N as jt}from"./index-62bbbc8c.js";import{I as ft}from"./IntroCopy-2847dd8a.js";import{u as bt}from"./usePageTitle-d303e245.js";import{L as yt}from"./LockEntrySearchBox-08c3595f.js";import{B as vt}from"./BeltIcon-5ac7d0f7.js";import{D as kt}from"./Dropzone-a1b56c0e.js";import{L as Ct}from"./LoadingDisplay-28f67238.js";import{D as St}from"./DataContext-5ea1ba4d.js";import"./index-7a2358c1.js";import{p as Lt,c as Nt}from"./postData-072ea8b3.js";import{C as It}from"./Checkbox-dfb3e7d7.js";import{C as wt}from"./Collapse-e040483d.js";import{T as C}from"./TextField-3adba7ee.js";import{I as Bt,a as Dt}from"./ImageListItem-dbe1d471.js";import{D as S}from"./Dialog-bfd2e8a0.js";import{D as Ft}from"./LockDataProvider-83fde683.js";import"./index-dd395bbe.js";import"./index-32b36bb2.js";import"./index-c15550d6.js";import"./Link-14693836.js";import"./useDocumentTitle-b3f366f8.js";import"./Search-c9b47f46.js";import"./Select-c127f91e.js";import"./entryName-3dd84e88.js";import"./BeltStripeMini-08961ae1.js";import"./Autocomplete-a698855f.js";import"./Chip-ee8ea248.js";import"./index-44a45e76.js";import"./Cancel-150ff05e.js";import"./Box-c965ca40.js";import"./CircularProgress-4eab50fc.js";import"./axios-439bb627.js";import"./collectionStatsById-8def94ca.js";function Rt({profile:a,user:l}){var U,W,$,A,O,E;const{allEntries:m}=s.useContext(St),{updateProfileField:u}=s.useContext(ct),[o,x]=s.useState({}),[j,L]=s.useState(void 0),[c,f]=s.useState([]),[M,N]=s.useState(void 0),[I,b]=s.useState(!1),[n,w]=s.useState(void 0),[p,B]=s.useState(!1),[Y,D]=s.useState(""),[F,R]=s.useState(""),[h,H]=s.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)||""),[y,G]=s.useState(!1),K=mt().format("YYYYMMDD-HHMMss"),d=m.find(e=>e.id===(o==null?void 0:o.lockId)),q=!!(o!=null&&o.lockName)&&!!(o!=null&&o.lockId)&&!!h&&c.length>0,z=`${o.lockName}_${o.lockId}_`.replace("/","+"),P=`${h}`.replace("/","+"),J=c.map(e=>e.name),Q=c.length===1?"File":"Files",V=async e=>{e.preventDefault(),b(!0);const i=`${K}_${z}_${P}`,r=new FormData;c.forEach(g=>{const{base:v,ext:dt}=zt(g.name);r.append("files",g,`${i}/${z}_${v}_${P}.${dt}`)}),r.append("droppedFileNames",J),r.append("lockFullName",o.lockFullName),r.append("lockName",o.lockName),r.append("version",d==null?void 0:d.version),r.append("belt",d==null?void 0:d.belt),r.append("lockId",o.lockId),r.append("photoCredit",h),r.append("displayName",a==null?void 0:a.displayName),r.append("uploadsDir",i),r.append("notes",F);const it="https://explore.lpubelts.com:8443/upload",rt=!1,lt=15e3;try{N(await Lt({user:l,url:it,formData:r,snackBars:rt,timeoutDuration:lt})),Z(h)}catch(g){w(Nt(g)),x([]),c.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{b(!1)}},X=s.useCallback(e=>{x(e),L(m.find(i=>i.id===e.lockId))},[m]),Z=s.useCallback(e=>{u("photoCredit",e)},[u]),tt=s.useCallback(e=>{const{value:i}=e.target;H(i)},[]),et=s.useCallback(e=>{const{value:i}=e.target;R(i)},[]),T=s.useCallback(()=>{x({}),L(void 0),c.forEach(e=>URL.revokeObjectURL(e.preview)),f([]),N(void 0),b(!1),w(void 0),B(!1),D(""),R(""),G(!y)},[c,y]),st=s.useCallback(()=>{B(!p),x([])},[p]),ot=s.useCallback(e=>{const{value:i}=e.target;D(i),x({lockFullName:i,lockName:i,lockId:"NOTINLIST"})},[]),at=p?.5:1,{flexStyle:nt}=_();return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:V,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:"Select Lock"}),t.jsx("div",{style:{opacity:at},children:t.jsx(yt,{handleChangeLock:X,allEntries:m,disabled:p,reset:y})}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx(It,{onChange:st,color:"info",size:"small",id:"notInList",checked:p})," Submit photos for a lock not on the site."]}),t.jsxs(wt,{in:p,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:Y,style:{width:400},onChange:ot,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:nt},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(kt,{files:c,setFiles:f}),j&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),j.media?t.jsx("div",{children:t.jsx(Bt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:j.media.map(e=>t.jsx(Dt,{children:t.jsx("img",{srcSet:`${e.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${e.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:e.title,loading:"lazy"})},e.thumbnailUrl))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),o.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex"},children:[o.lockId!=="NOTINLIST"&&t.jsx(vt,{value:d==null?void 0:d.belt,style:{marginBottom:-10}}),t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:o.lockFullName})]}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:h,style:{width:350},onChange:tt,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:F,onChange:et}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!q||I,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:I,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(Ct,{})})}),t.jsx(S,{open:!!M&&!n,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[Q," Uploaded Succesfully!"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:T,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"Submit more photos"})})]})})}),t.jsx(S,{open:!!n,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",((W=(U=n==null?void 0:n.response)==null?void 0:U.data)==null?void 0:W.message)||(n==null?void 0:n.message),((A=($=n==null?void 0:n.response)==null?void 0:$.data)==null?void 0:A.status)&&t.jsxs("span",{children:[" (",(E=(O=n==null?void 0:n.response)==null?void 0:O.data)==null?void 0:E.status,")"]})]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:T,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(pt,{feature:"uploadPhotos"})]})}function zt(a){const l=a.lastIndexOf(".");return l===-1?{base:a,ext:""}:{base:a.substring(0,l),ext:a.substring(l)}}function xe(){const{isMobile:a}=_(),{profile:l,user:m}=xt();bt("LPU Belt Explorer - Submit Photos");const u=t.jsx(ht.Fragment,{children:!a&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return t.jsx(ut,{children:t.jsxs(Ft,{allEntries:gt,profile:l,children:[t.jsx(jt,{title:"Submit Photos",extras:u}),l&&!l.photoCredit&&t.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:t.jsx(ft,{pageName:"photoUpload",maxWidth:820})}),t.jsx(Rt,{profile:l,user:m})]})})}export{xe as default};
