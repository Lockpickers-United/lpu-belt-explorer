import{r as e,D as W,d as lt,u as $,b as ct,j as t,L as dt,B as k,T as mt,A as pt,R as xt,e as ht,N as ut}from"./index-HTC1xzYF.js";import{u as gt}from"./usePageTitle-CfYtZa84.js";import{R as ft}from"./RaflPotSearchBox-t3ZslEbM.js";import{D as jt}from"./Dropzone-D4J7mgAz.js";import{L as yt}from"./LoadingDisplay-gS2LKbsf.js";import{R as bt}from"./RaffleContext-BMn8S4Ac.js";import{p as vt,c as kt}from"./postData-H9RTHzYH.js";import{n as Ct}from"./dataUrls-CThgH6Wi.js";import{C as St}from"./Checkbox-BPjIG-fX.js";import{C as Lt}from"./Collapse-BwnoheAe.js";import{T as C}from"./TextField-CPNU6IFb.js";import{I as Nt,a as Rt}from"./ImageListItem-DV2KZ0b2.js";import{D as S}from"./Dialog-D4hYU5VX.js";import"./Search-BTqLXkXJ.js";import"./useFormControl-C4KXRRRS.js";import"./Select-CVJ1br2t.js";import"./index-D90N7XjJ.js";import"./Cancel-CSP0lW_W.js";import"./LoadingDisplaySmall-CpWsWQ3s.js";import"./Box-BFx6uxMw.js";import"./CircularProgress-ufc04rer.js";import"./useData-Bbr5SiHh.js";import"./index-BTOWoS5N.js";import"./setDeep-J6HEwWhX.js";import"./index-xsH4HHeE.js";import"./SwitchBase-DgXGBy2r.js";function Ft({profile:s,user:c}){const{allPots:x=[]}=e.useContext(bt),{updateProfileField:h}=e.useContext(W),[a,m]=e.useState({}),[g,L]=e.useState(void 0),[r,f]=e.useState([]),[T,N]=e.useState(void 0),[R,j]=e.useState(!1),[l,F]=e.useState(void 0),[d,P]=e.useState(!1),[U,w]=e.useState(""),[z,I]=e.useState(""),[p,E]=e.useState((s==null?void 0:s.photoCredit)||(s==null?void 0:s.displayName)||""),[y,O]=e.useState(!1),b=e.useMemo(()=>[...x],[x]),_=lt().format("YYYYMMDD-HHMMss"),M=!!(a!=null&&a.lockFullName)&&!!(a!=null&&a.lockId)&&!!p&&r.length>0,D=`${a.lockName}_${a.lockId}_`.replace("/","+"),B=`${p}`.replace("/","+"),Y=r.map(o=>o.name),H=e.useCallback((o,n)=>{f(o)},[]),K=r.length===1?"File":"Files",G=async o=>{o.preventDefault(),j(!0);const n=`${_}_${D}_${B}`,i=new FormData;r.forEach(u=>{const{base:v,ext:rt}=Pt(u.name);i.append("files",u,`${n}/${D}_${v}_${B}.${rt}`)}),i.append("droppedFileNames",Y),i.append("lockFullName",a.lockFullName),i.append("lockName",a.lockName),i.append("lockId",a.lockId),i.append("photoCredit",p),i.append("displayName",s==null?void 0:s.displayName),i.append("uploadsDir",n),i.append("notes",z);const nt=`${Ct}/upload`,at=!0,it=3e4;try{N(await vt({user:c,url:nt,formData:i,snackBars:at,timeoutDuration:it})),J(p)}catch(u){F(kt(u)),m([]),r.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{j(!1)}},q=e.useCallback(o=>{m(o),L(b.find(n=>n.id===o.lockId))},[b]),J=e.useCallback(o=>{h("photoCredit",o)},[h]),Q=e.useCallback(o=>{const{value:n}=o.target;E(n)},[]),V=e.useCallback(o=>{const{value:n}=o.target;I(n)},[]),A=e.useCallback(()=>{m({}),L(void 0),r.forEach(o=>URL.revokeObjectURL(o.preview)),f([]),N(void 0),j(!1),F(void 0),P(!1),w(""),I(""),O(!y)},[r,y]),X=e.useCallback(()=>{P(!d),m([])},[d]),Z=e.useCallback(o=>{const{value:n}=o.target;w(n),m({lockFullName:n,lockName:n,lockId:"NOTINLIST"})},[]),tt=d?.5:1,{flexStyle:et}=$(),ot={color:"#bbb",textDecoration:"underline",cursor:"pointer",fontWeight:500,"&:hover":{color:"#fff"}},st=ct();return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:600,marginBottom:20},children:["Pot Photos  | ",t.jsx(dt,{onClick:()=>st("/rafl/contribute"),sx:ot,children:"Info"})]}),t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:G,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"0px 0px 0px"},children:"Select Pot"}),t.jsx("div",{style:{opacity:tt},children:t.jsx(ft,{handleChangeLock:q,allEntries:b,disabled:d,reset:y})}),t.jsxs("div",{style:{marginTop:0},children:[t.jsx(St,{onChange:X,color:"info",size:"small",id:"notInList",checked:d})," Submit photos for a pot not on the site."]}),t.jsxs(Lt,{in:d,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:U,style:{width:400},onChange:Z,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:et},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(jt,{files:r||[],otherFiles:[],handleDroppedFiles:H,maxFiles:5,backgroundColor:"#333"}),g&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),g.media?t.jsx("div",{children:t.jsx(Nt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:g.media.map((o,n)=>t.jsx(Rt,{children:t.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},n))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),a.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx("div",{style:{display:"flex"},children:t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:a.lockFullName})}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:p,style:{width:350},onChange:Q,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:z,onChange:V}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!M||R,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:R,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(yt,{})})}),t.jsx(S,{open:!!T&&!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:10,textAlign:"center"},children:[K," Uploaded Successfully!"]}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:60,textAlign:"center"},children:"Images will be added to the site shortly"}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:A,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[l==null?void 0:l.message,t.jsx("br",{}),"(Error code ",l==null?void 0:l.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:A,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(mt,{feature:"uploadPhotos"})]})}function Pt(s){const c=s.lastIndexOf(".");return c===-1?{base:s,ext:""}:{base:s.substring(0,c),ext:s.substring(c)}}function oe(){const{isMobile:s}=$(),{lockCollection:c}=e.useContext(W),{user:x}=e.useContext(pt);gt("RAFL Pot Photos");const h=t.jsx(xt.Fragment,{children:!s&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return t.jsxs(ht,{children:[t.jsx(ut,{title:"RAFL Pot Photos",extras:h}),t.jsx(Ft,{profile:c,user:x})]})}export{oe as default};
