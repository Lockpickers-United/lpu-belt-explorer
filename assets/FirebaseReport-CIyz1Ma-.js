import{b as k,r as f,d as W,j as s,L as _,u as g}from"./index-9hDDQWJy.js";import{L as A}from"./LoadingDisplay-D2eWIyyl.js";import{u as T}from"./usePageTitle-Pr1NqIG_.js";import{u as F}from"./useData-Dc0ifJ2x.js";import{n as H}from"./dataUrls-DkJe4Pqg.js";import{A as L}from"./AdminStatsTableSort-BKQBBPi9.js";import{y as Y}from"./nivo-line-BL6QVZHm.js";import{p as z}from"./chartDefaults-pV7GKcxU.js";import{A as M}from"./AdminStatsTable-DJAlRmDG.js";import"./LPU-DltM2OBF.js";import"./LinearProgress-BFatAjOf.js";import"./TableRow-B5cC6mtj.js";import"./nivo-legends-BrEd73Vb.js";import"./nivo-axes-Chk8SBqG.js";import"./uniq-CCbvriOk.js";import"./line-DqZfwfbi.js";const C=({data:n})=>{const a=k(),{dailyTotals:t,requestSubscriptions:l}=n,d=[{name:"Date",align:"left",id:"date"},{name:"Total Reads",align:"left",id:"reads"},{name:"Writes",align:"left",id:"writes"},{name:"",align:"left",id:"spacer"},{name:"Subscription Reads",align:"left",id:"subscriptionReads"},{name:"Subscription Refresh Reads",align:"left",id:"subscriptionRefreshes"}],i=!0,[o,m]=f.useState("date"),[p,u]=f.useState(!0),h=Object.keys(t).map(e=>{var b,x;const c=W(e)||0,j=t[e].READ||0,w=t[e].WRITE||0,E=((b=l[e])==null?void 0:b.READ)||0,q=((x=l[e])==null?void 0:x.REFRESH)||0;return{date:c.format("MM/DD/YYYY"),reads:j,writes:w,spacer:"|",subscriptionReads:E,subscriptionRefreshes:q}}).filter(e=>e).sort((e,c)=>{switch(o){case"reads":return e.reads-c.reads;default:return parseInt(c[o])-parseInt(e[o])}}),S=p?h:h.reverse(),v={columns:d,data:S},y=f.useCallback((e,c)=>e==="title"?s.jsx(_,{onClick:()=>a(`/foobar/${c}`),style:{color:"#fff"},children:c}):c,[a]),{isMobile:R}=g(),D=R?".8rem":".95rem";return s.jsx("div",{children:s.jsx(L,{tableData:v,tableWidth:"100%",fontSize:D,sortable:i,sort:o,setSort:m,ascending:p,setAscending:u,linkFunction:y})})};function I({data:n}){const{width:a}=g(),t=a<=360,l=a<=395,d=a<=560,i=t?230:l?270:d?290:350,o=d?["midnight","2 am","4 am","6 am","8 am","10 am","noon","2 pm","4 pm","6 pm","8 pm","10 pm"]:["midnight","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","noon","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"];return s.jsx("div",{style:{height:i},children:s.jsx(Y,{theme:P,data:n,colors:["#007de2","#16325d"],lineWidth:3,margin:{top:10,right:20,bottom:70,left:58},curve:"natural",xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},axisBottom:{tickValues:o,tickSize:5,tickPadding:5,tickRotation:-45,direction:"row"},legends:[{anchor:"bottom",itemTextColor:"#ddd",text:{fontSize:18},direction:"row",justify:!1,translateX:0,translateY:75,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const O={grid:{line:{stroke:"#333",strokeWidth:1}}},P={...z,...O},V=({data:n})=>{const{hourly:a}=n,t=["midnight","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","noon","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"],d=[{id:"Hourly Requests",data:Object.keys(a).map(i=>{const o=t[parseInt(i)],m=Object.keys(a[i]).reduce((p,u)=>p+a[i][u],0);return{x:o,y:m}}).sort((i,o)=>t.indexOf(i.x)-t.indexOf(o.x))}];return s.jsx("div",{children:s.jsx(I,{data:d})})},$=({data:n})=>{const a=k(),{bySource:t}=n,l=[{name:"Date",align:"left",id:"date"},{name:"Export Collections",align:"left",id:"collectionsExport_lockcollections"},{name:"Export Evidence",align:"left",id:"awardsEvidenceExport_evidence"},{name:"Export Awards",align:"left",id:"awardsEvidenceExport_awards"},{name:"Requests Subscriptions",align:"left",id:"request_subscription"},{name:"Request Votes",align:"left",id:"request_upvote"},{name:"Request Updates",align:"left",id:"request_update"}],d=!0,[i,o]=f.useState("date"),[m,p]=f.useState(!0),u=Object.keys(t).map(r=>{var x;const e=W(r),c=t[r].collectionsExport_lockcollections,j=t[r].awardsEvidenceExport_evidence,w=((x=t[r])==null?void 0:x.awardsEvidenceExport_awards)||0,E=t[r]["request-subscription"]||0,q=t[r]["request-upvote"]||0,b=t[r]["request-update"]||0;return{date:e.format("MM/DD/YYYY"),collectionsExport_lockcollections:c,awardsEvidenceExport_evidence:j,awardsEvidenceExport_awards:w,request_subscription:E,request_upvote:q,request_update:b}}).filter(r=>r).sort((r,e)=>{switch(i){case"reads":return r.reads-e.reads;default:return parseInt(e[i])-parseInt(r[i])}}),h=m?u:u.reverse(),S={columns:l,data:h},v=f.useCallback((r,e)=>r==="title"?s.jsx(_,{onClick:()=>a(`/foobar/${e}`),style:{color:"#fff"},children:e}):e,[a]),{isMobile:y}=g(),R=y?".8rem":".95rem";return s.jsx("div",{children:s.jsx(M,{tableData:S,tableWidth:"100%",fontSize:R,sortable:d,sort:i,setSort:o,ascending:m,setAscending:p,linkFunction:v})})};function nt(){T("Firebase Activity Report");const{data:n,loading:a,error:t}=F({url:`${H}/process-firebase-log`}),{width:l}=g(),i=l<560?"8px 8px 32px 8px":"24px 24px 32px 24px",o={margin:"56px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff"},m={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff"};return a?s.jsx(A,{}):t?null:s.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:i,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[s.jsxs("div",{style:m,children:["Firebase Activity Report",s.jsx("br",{})]}),s.jsx(C,{data:n,loading:a,error:t}),s.jsx("div",{style:o,children:"Hourly Requests"}),s.jsx(V,{data:n,loading:a,error:t}),s.jsx("div",{style:o,children:"Requests by Source"}),s.jsx($,{data:n})]})}export{nt as default};
