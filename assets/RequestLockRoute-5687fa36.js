import{r as n,u as I,j as e,R as F,aa as ce,B as U,A as me,b as he,$ as J,T as ue,K as Q,D as pe,bA as ge,a0 as fe,e as xe,N as ye}from"./index-4915156c.js";import{u as je}from"./usePageTitle-d017f15c.js";import{S as z,D as ve}from"./SelectBox-696d153a.js";import{a as ke}from"./filterFields-1fcecfad.js";import{D as be}from"./Dropzone-10ec89b7.js";import{L as Ce}from"./LoadingDisplay-9d9cd058.js";import{e as X}from"./entryName-eaa98552.js";import{s as Be,a as we,b as Se}from"./setDeep-8470365e.js";import{I as Re,d as Le}from"./Search-f77c3625.js";import{A as Me}from"./Autocomplete-5b240839.js";import{T as v}from"./TextField-8f6823c0.js";import{C as ze}from"./ChoiceButtonGroup-c772554d.js";import{D as Z}from"./DataContext-d514681b.js";import{a as Ue}from"./rankingRequestData-d3ef79e5.js";import{p as De}from"./postData-081aa2f5.js";import{L as ee}from"./Link-3cbec5a8.js";import{C as te}from"./Collapse-12c2b111.js";import{C as Te}from"./Checkbox-a25ab016.js";import{D as q}from"./Dialog-ed896a3d.js";import"./useDocumentTitle-b816209b.js";import"./index-ea4c3fed.js";import"./Select-b79afc09.js";import"./index-832c8bed.js";import"./Cancel-72e82b42.js";import"./Box-7547bb0b.js";import"./CircularProgress-64aa2e5e.js";import"./Chip-3b9a7817.js";import"./ToggleButtonGroup-b2228840.js";import"./axios-3a665b0f.js";function Ae({name:o,changeHandler:l,options:c,style:d,disabled:u=!1,reset:D,placeholder:k="Search...",noOptionsMessage:b,noOptionsHandler:p,inputValueHandler:r}){const C=n.useRef(),[g,S]=n.useState(!1),t=n.useCallback(()=>S(!1),[]),{isMobile:y}=I(),[R,T]=n.useState(""),m=b&&p?e.jsx(U,{onClick:p,variant:"contained",color:"success",children:b}):null,B=n.useCallback((j,f)=>{c.includes(f)?l({target:{name:o,value:f}}):l({target:{name:o,value:void 0}})},[c,l,o]),w=(j,f)=>{r&&r(f),T(f)};return e.jsxs(F.Fragment,{children:[e.jsx(Me,{disabled:u,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,autoHighlight:!0,fullWidth:!0,style:d,options:c,name:o,onChange:B,inputValue:R,onInputChange:w,renderInput:j=>e.jsx(v,{...j,placeholder:k,variant:"outlined",color:"info",inputRef:C,InputProps:{...j.InputProps,startAdornment:e.jsx(Re,{position:"start",children:e.jsx(Le,{})})}}),noOptionsText:m},D||u),e.jsx(ce,{invisible:!0,open:g&&y,onClick:t})]})}function We(){var V,H,_,K,G,Y;const{allEntries:o}=n.useContext(Z),{user:l}=n.useContext(me),{profile:c}=n.useContext(Z),[d,u]=n.useState([]),[D,k]=n.useState(void 0),[b,p]=n.useState(!1),[r,C]=n.useState(void 0),[g,S]=n.useState(!1),[t,y]=n.useState({id:se(8)}),[R,T]=n.useState(""),m=n.useCallback(s=>{const{name:i,value:h}=s.target;y({...t,[i]:h})},[t]),B=n.useCallback(()=>{S(!g);const s={...t};s.altBrand=!s.altBrand,s.altBrand?(s.newBrand=R,delete s.make):delete s.newBrand,setTimeout(()=>{y(s)},10),setTimeout(()=>{s.altBrand&&(document.getElementById("newBrand").focus(),document.getElementById("newBrand").select())},100)},[g,t,R]),w=n.useMemo(()=>o==null?void 0:o.sort((s,i)=>X(s,"short").localeCompare(X(i,"short"))).reduce((s,i)=>{const h=i.version?i.version:void 0;return i.makeModels.map(x=>{const M=x.make?x.make:x.model;Be(s,["allMakes"],M.trim());const a=x.make?x.model.trim():"Any";we(s,["makeModels",M],{model:a,versionText:h})}),s.lockingMechanisms=s.lockingMechanisms||[],Se(s,["lockingMechanisms"],i.lockingMechanisms?[...new Set([...s.lockingMechanisms,...i.lockingMechanisms,"Multiple"])].sort():s.lockingMechanisms),s},{}),[o]),j=n.useMemo(()=>{var s;return(s=w.allMakes)==null?void 0:s.sort((i,h)=>i.localeCompare(h))},[w]),f=(t.make||t.newBrand)&&t.model&&t.lockingMechanisms&&t.lockingMechanisms.length>0&&(t.redditUsername||t.discordUsername)&&d.length>0,P=`${t.make||t.newBrand}_${t.model}`.replace("/","+"),$=t.redditUsername&&t.discordUsername?[t.redditUsername,t.discordUsername].join("_").replace("/","+"):`${t.redditUsername||t.discordUsername}`.replace("/","+"),ne=async s=>{s.preventDefault(),p(!0);const i={...t,displayName:(c==null?void 0:c.displayName)||"no display name",make:t.make||t.newBrand,droppedFileNames:d.map(a=>a.name),requestStatus:"Submitted"};delete i.altBrand,delete i.newBrand;const h=new FormData;Object.keys(i).forEach(a=>{h.append(a,i[a])});const x=`${P}-${$}`.toLowerCase();d.forEach(a=>{const{base:le,ext:de}=qe(a.name);h.append("files",a,`${x}/${P}_${le}_${$}.${de}`.toLowerCase())});const M=`${Ue}/request-lock`;try{const a=await De({user:l,url:M,formData:h,snackBars:!1});Q("Upload successful",{variant:"success"}),k(a)}catch(a){throw C(`${a}`.replace("Error: ","")),Q(`Error creating request: ${a}`,{variant:"error",autoHideDuration:3e3}),a}finally{d.forEach(a=>URL.revokeObjectURL(a.preview)),u([]),p(!1),y(i)}},oe=n.useCallback(()=>{d.forEach(s=>URL.revokeObjectURL(s.preview)),u([]),S(!g),y({id:se(8)}),k(void 0),p(!1),C(void 0),setTimeout(()=>{window.scrollTo({left:0,top:0,behavior:"smooth"})},100)},[g,d]),ie=n.useCallback(()=>{k(void 0),p(!1),C(void 0)},[]),E=n.useMemo(()=>[{label:"Request a Lock",page:"/rankingrequests/submit"},{label:"View Requests",page:"/rankingrequests/view"}],[]),A=he(),ae=n.useCallback(s=>{A(s.page)},[A]),re=t.altBrand>0?.5:1,{isMobile:O,flexStyle:L}=I(),N=O?300:660,W=O?8:16;return e.jsxs(F.Fragment,{children:[e.jsx("div",{style:{marginBottom:20,marginTop:1},children:e.jsx(ze,{options:E,onChange:ae,defaultValue:E[0].label})}),e.jsxs("div",{style:{maxWidth:720,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[e.jsxs("div",{style:{marginBottom:30,marginRight:W,lineHeight:"1.5rem"},children:[e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:700,marginBottom:10},children:"Suggest a Lock"}),"The lock ranking process for Lockpickers United is a detailed one. It's a community process and identifying new locks for ranking is a big part of it. Use the form below to submit a lock for ranking. A lot of work goes into adding a new lock to the belt rankings, please provide as much information as possible to do your part in the process.",e.jsx("br",{}),e.jsx("br",{}),"Please note that while all requests will be considered, not all locks can be put into the ranking process. Factors include the availability of locks to review, general availability of locks to the community, access to photos and detailed lock information, and the projected value to the community of adding them to the list. Yellow & Orange locks are not added frequently. Â ",e.jsx(ee,{onClick:()=>A("/view?pageId=classificationProcess"),style:{color:"#aaa",cursor:"pointer",fontWeight:700},children:"Click here to learn more"})]}),e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,padding:`10px ${W}px`,backgroundColor:"#222",marginBottom:20},children:"Lock Request Info"}),e.jsxs("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:ne,children:[e.jsxs("div",{style:{paddingLeft:W},children:[e.jsxs("div",{style:{display:L,marginBottom:30},children:[e.jsxs("div",{children:[e.jsx(te,{in:!t.altBrand,children:e.jsxs("div",{style:{marginRight:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Choose Brand"}),e.jsx(Ae,{changeHandler:m,options:j,name:"make",style:{width:300,opacity:re},reset:g,disabled:t.altBrand,inputValueHandler:T,noOptionsMessage:"Add a brand",noOptionsHandler:B})]})}),e.jsxs(te,{in:t.altBrand,children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Enter New Brand"}),e.jsx(v,{type:"text",id:"newBrand",name:"newBrand",value:t.newBrand||"",style:{width:300,marginBottom:0},onChange:m,color:"info"})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(Te,{onChange:B,id:"altBrand",name:"altBrand",checked:t.altBrand||!1,color:"info",size:"small",inputProps:{tabIndex:-1}}),e.jsx(ee,{onClick:B,style:{color:"#fff"},children:"Submit a lock for a new brand."})]})]}),e.jsxs("div",{style:{marginTop:0},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Model Name"}),e.jsx(v,{type:"text",name:"model",style:{width:300},onChange:m,value:t.model||"",color:"info"})]})]}),e.jsxs("div",{style:{display:L,marginTop:20},children:[e.jsxs("div",{style:{marginRight:20},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:"Locking Mechanism"}),e.jsx(z,{changeHandler:m,name:"lockingMechanisms",form:t,optionsList:w.lockingMechanisms,size:"large",width:200,multiple:!1,defaultValue:""})]}),e.jsxs("div",{style:{flexGrow:1,maxWidth:440},children:[e.jsxs("div",{style:{fontSize:"1.1rem"},children:["Notes ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(v,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:4,color:"info",style:{},value:t.notes||"",maxLength:1200,id:"notes",onChange:m})]})]}),e.jsxs("div",{style:{width:N,marginTop:30},children:[e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:500,marginBottom:5},children:["Lock Photos (at least 1 required)",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"1.0rem",fontWeight:400},children:"Please include body, key, keyway, and if guttable, pictures of all relevant features"})]}),e.jsx(be,{files:d,setFiles:u})]}),e.jsxs("div",{style:{display:L,marginTop:30,width:N},children:[e.jsxs("div",{style:{marginRight:20},children:[e.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:5},children:["Approximate Belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(z,{changeHandler:m,name:"approxBelt",form:t,optionsList:J,multiple:!1,defaultValue:"",size:"large",width:300})]}),e.jsxs("div",{style:{marginTop:0,width:300},children:[e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:5},children:"Can you provide locks for review?"}),e.jsx(z,{changeHandler:m,name:"hazLocc",form:t,optionsList:["Yes","No"],multiple:!1,defaultValue:"",size:"large",width:300})]})]}),e.jsxs("div",{style:{marginTop:30},children:[e.jsx("div",{style:{marginRight:50,width:300},children:e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:500},children:"Contact Info"})}),e.jsxs("div",{style:{display:L},children:[e.jsxs("div",{style:{marginRight:20},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"Discord Username"}),e.jsx(v,{type:"text",name:"discordUsername",style:{width:200},onChange:m,value:t.discordUsername||"",color:"info"})]}),e.jsxs("div",{style:{marginRight:40},children:[e.jsx("div",{style:{fontSize:"1rem"},children:"AND/OR Reddit Username"}),e.jsx(v,{type:"text",name:"redditUsername",style:{width:200},onChange:m,value:t.redditUsername||"",color:"info"})]}),e.jsxs("div",{style:{marginTop:0},children:[e.jsxs("div",{style:{fontSize:"1rem"},children:["Your current belt ",e.jsx("span",{style:{color:"#aaa"},children:"(optional)"})]}),e.jsx(z,{changeHandler:m,name:"userBelt",form:t,optionsList:["Unranked",...J],multiple:!1,defaultValue:"",size:"large",width:200})]})]})]})]}),e.jsx("div",{style:{marginTop:30,width:"100%",display:"flex",justifyContent:"center"},children:e.jsx(U,{type:"submit",variant:"contained",color:"info",disabled:!f||b,children:"Submit"})})]}),e.jsx(q,{open:b,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:e.jsx(Ce,{})})}),e.jsx(q,{open:!!D&&!r,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsx("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:"Lock request submitted!"}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(U,{onClick:oe,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(q,{open:!!r,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",e.jsx("br",{}),"Please try again later.",e.jsx("br",{})]}),e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",(H=(V=r==null?void 0:r.response)==null?void 0:V.data)!=null&&H.message?e.jsxs("span",{children:[(K=(_=r==null?void 0:r.response)==null?void 0:_.data)==null?void 0:K.message," (",(Y=(G=r==null?void 0:r.response)==null?void 0:G.data)==null?void 0:Y.status,")"]}):e.jsx("span",{children:""+r})]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(U,{onClick:ie,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(ue,{feature:"uploadPhotos"})]})]})}function qe(o){const l=o.lastIndexOf(".");return l===-1?{base:o,ext:""}:{base:o.substring(0,l),ext:o.substring(l)}}function se(o){const l="0123456789ABCDEF";let c="";for(let d=0;d<o;++d)c+=l.charAt(Math.floor(Math.random()*l.length));return c.toLowerCase()}function ht(){je("Lock Ranking Request");const{lockCollection:o}=n.useContext(pe),{isMobile:l}=I(),c=ge(),d=fe.concat(c),u=e.jsx(F.Fragment,{children:!l&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(xe,{filterFields:ke,children:e.jsxs(ve,{allEntries:d,profile:o,children:[e.jsx(ye,{title:"Lock Ranking Request",extras:u}),e.jsx(We,{})]})})}export{ht as default};
