import{K as le,M as ae,j as e,u as U,r,R as L,G as he,I as se,a8 as fe,B as H,b as je,a$ as ye,aa as ne,D as ge,N as ve,F as be,T as Ce}from"./index-11d041f4.js";import{u as ke}from"./usePageTitle-1eabeccb.js";import{R as Re}from"./RaffleHeader-368d2486.js";import{R as Fe}from"./RaffleAutocompleteBox-ee4e3088.js";import{b as Ie,a as ie,c as Se}from"./RaffleContext-2c70e7b6.js";import{R as Te}from"./RaffleSubHead-597008a2.js";import{d as oe}from"./Search-b5cd9067.js";import{A as Ae}from"./Autocomplete-3c42b1f7.js";import{T as E,F as Pe}from"./TextField-1fc4c915.js";import{I as we}from"./Chip-629a696f.js";import{F as B,I as $e,S as ze}from"./Select-e42ab831.js";import{L as V}from"./Link-b91a2de8.js";import{D as Me}from"./Dialog-4e19b3db.js";import{R as Be,A as Ee}from"./AdminRoleButton-70006e9d.js";import{R as Le}from"./RaffleComingSoon-8559d103.js";import"./useDocumentTitle-1340fd99.js";import"./useData-f4514d82.js";import"./dataUrls-d878baa3.js";import"./index-57146f77.js";var Q={},We=ae;Object.defineProperty(Q,"__esModule",{value:!0});var ce=Q.default=void 0,_e=We(le()),Ne=e;ce=Q.default=(0,_e.default)((0,Ne.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function De({questionStyle:o,index:u,potData:n,handlePotChange:C,showIssues:t,removePot:j}){const{isMobile:a,flexStyle:S}=U(),l=!1,w={maxWidth:700},v=r.useRef(),[i,T]=r.useState(n[u]),M=Array.from(Object.keys(n)).length>1;if(n[u].tickets!==i.tickets||n[u].itemFullTitle!==i.itemFullTitle){const d=i.itemFullTitle&&i.tickets;C(u,i,d)}const k=r.useMemo(()=>{let d=[],p={},g={},_={},Y={};return Ie.sort((x,b)=>parseInt(x.potNumber)-parseInt(b.potNumber)||x.title.localeCompare(b.title)).map(x=>{const b=`Pot ${x.potNumber} - ${x.title}`;g[b]=x.title,p[b]=x.id,_[b]=x.potNumber,d.push(b)}).filter(x=>x),{options:d,itemIds:p,itemTitles:g,itemPotNumbers:_,itemFormIds:Y}},[]),{options:R,itemIds:c,itemTitles:h,itemPotNumbers:f}=k,F=r.useCallback(d=>{const p=d.target.value.replace(/[^0-9]/,""),g={...i,tickets:p};T(g)},[i]),I=r.useCallback((d,p)=>{let g;R.includes(p)?g={itemFullTitle:p,itemTitle:h[p],itemId:c[p],itemPotNumber:f[p],itemIndex:R.indexOf(p)}:g={},T({...i,...g})},[R,i,h,c,f]),[A,W]=r.useState(!1),q=r.useCallback(()=>{W(!0),setTimeout(()=>v.current.focus(),15)},[]),y=r.useCallback(()=>W(!1),[]),O=A&&l?{width:"auto",position:"fixed",left:60,right:0,paddingRight:16,maxWidth:"unset",zIndex:9999999,backgroundColor:"#272727"}:{},G=t&&!i.itemFullTitle?{borderBottom:"#b00 solid 4px"}:{};return e.jsxs("div",{style:{display:S,margin:12},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100,minWidth:280},children:[e.jsx("div",{style:{...o},children:"Selected Pot"}),e.jsx("div",{style:{height:4}}),e.jsxs(L.Fragment,{children:[!A&&l&&e.jsx(he,{title:"Search",arrow:!0,disableFocusListener:!0,children:e.jsx(se,{color:"inherit",onClick:q,children:e.jsx(oe,{})})}),(A||!l)&&e.jsx(Ae,{selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:{...w,...O},options:R,onChange:I,renderInput:d=>e.jsx(E,{...d,style:G,placeholder:"Search Pots",variant:"standard",color:"info",inputRef:v,InputProps:{...d.InputProps,startAdornment:e.jsx(we,{position:"start",children:e.jsx(oe,{})})}})}),e.jsx(fe,{invisible:!0,open:A&&l,onClick:y})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:t&&!i.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsxs(B,{children:[!a&&e.jsx("div",{style:o,children:" "}),e.jsx(E,{type:"text",name:"tickets",label:"Tickets",value:n[u].tickets?n[u].tickets:"",error:t&&!i.tickets,helperText:t&&!n[u].tickets?"Required Field":" ",onChange:F,color:"info",size:"small",style:{width:120}})]}),M&&e.jsxs("div",{style:{marginLeft:10},children:[!a&&e.jsx("div",{style:o,children:" "}),e.jsx(se,{color:"warning",onClick:()=>j(u),children:e.jsx(ce,{})})]})]})]})}var J={},He=ae;Object.defineProperty(J,"__esModule",{value:!0});var de=J.default=void 0,Ue=He(le()),qe=e;de=J.default=(0,Ue.default)((0,qe.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");function Oe({donation:o,questionStyle:u,potData:n,showIssues:C,setPotData:t,allocated:j}){const a=Array.from(Object.keys(n)),S=o?parseInt(o)-j:0-j,l=r.useCallback(()=>{const c=a[a.length-1]+1e3,h={...n};h[c]={tickets:0},t(h)},[n,a,t]),w=r.useCallback(c=>{const h={...n};delete h[c],t(h)},[n,t]),v=r.useCallback(()=>{const c=Math.floor(o/a.length),h=o%a.length;a.map((f,F)=>{const I={...n};F===0&&o?I[f].tickets=c+h:o?I[f].tickets=c:I[f].tickets=0,t(I)})},[o,n,a,t]),i=r.useCallback((c,h)=>{const f={...n};f[c]=h,t(f)},[n,t]),T=S>0?{color:"#0b0",fontWeight:700}:S<0?{color:"#b00",fontWeight:700}:{},{isMobile:M,flexStyle:k}=U(),R=M?"1.0rem":"1.2rem";return e.jsxs(L.Fragment,{children:[a.map(c=>e.jsx(De,{questionStyle:u,index:c,potData:n,handlePotChange:i,showIssues:C,removePot:w},c)),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(H,{variant:"outlined",onClick:()=>{l()},size:"small",color:"info",startIcon:e.jsx(de,{}),children:"Add Pot"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",fontSize:R,marginTop:15},children:[e.jsxs("div",{style:{display:k,padding:8},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Total tickets"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:o||0})]})]}),e.jsxs("div",{style:{display:k,padding:8,margin:"0px 10px"},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Allocated"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:j})]})]}),e.jsxs("div",{style:{display:k,padding:8},children:[e.jsx("div",{style:{...T},children:e.jsx("nobr",{children:"Remaining"})}),e.jsxs("div",{style:{...T},children:[" ",e.jsx("strong",{children:o||j?S:0})]})]}),o&&e.jsx("div",{style:{display:k,padding:8,marginLeft:10,alignContent:"center"},children:e.jsx(V,{onClick:()=>{v()},style:{color:"#417ee6",fontWeight:700},children:"Auto"})})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",textAlign:"center"},children:C&&o>j?e.jsx("span",{children:"All tickets must be assigned to a pot"}):C&&o<j?e.jsx("span",{children:"You have too many tickets allocated"}):e.jsx("span",{children:" "})})]})}function Ge(){const o=je(),{raffleAdminRole:u}=r.useContext(ie),[n,C]=r.useState(!1),[t,j]=r.useState({}),[a,S]=r.useState({}),[l,w]=r.useState({0:{tickets:0}}),v=Array.from(Object.keys(l)),{raflQuestionMap:i,displayStats:T,setDisplayStats:M}=r.useContext(ie),[k,R]=r.useState(!0);k&&T&&(M(!1),R(!1));const c=r.useMemo(()=>v.reduce((s,m)=>{const P=parseInt(l[m].tickets)?parseInt(l[m].tickets):0;return s=s?s+P:P,s},0),[l,v]),h=r.useMemo(()=>v.reduce((s,m)=>!(l[m].tickets&&l[m].tickets),!1),[l,v]),f=r.useCallback(s=>{const m=window.open(s,"_blank","noopener,noreferrer");m&&(m.opener=null)},[]),F=r.useCallback(s=>{const m={...t};s.target.name==="donation"?m[s.target.name]=s.target.value.replace(/[^0-9]/,""):m[s.target.name]=s.target.value,j(m)},[t]),I=r.useCallback((s,m)=>{const P={...l};P[s]=m,w(P)},[l]),A=r.useCallback(()=>{const s="https://docs.google.com/forms/d/e/1FAIpQLSe0Rr8mykkE5FAgzUACzGsGYq_mN-vS34arr2uL0QDEFHBSNQ/viewform?usp=pp_url",m=`&entry.${i[0].formId}=${encodeURIComponent(t.platform)}`,P=`&entry.${i[1].formId}=${encodeURIComponent(t.username)}`,me=`&entry.${i[2].formId}=${encodeURIComponent(a.itemTitle)}`,pe=`&entry.${i[3].formId}=${encodeURIComponent(t.receipt)}`,xe=`&entry.${i[4].formId}=${encodeURIComponent(t.donation)}`,Z=[m,P,me,pe,xe],ee=Object.keys(l).reduce((z,te)=>{const K=i.find(ue=>ue.text===l[te].itemFullTitle),re=`&entry.${(K==null?void 0:K.formId)||"undefined"}=${l[te].tickets}`;return z=(z==null?void 0:z.length)>0?`${z}${re}`:re,z},"");console.log("url",`${Z.join("")}${ee}`),C(!0),f(`${s}${Z.join("")}${ee}`)},[a,t,f,l,i]),W=Se.map(s=>({...s,title:s.name})),q=r.useCallback(s=>s.name,[]),[y,O]=r.useState(!1),G=["platform","username","charity","donation"],d=s=>G.includes(s)&&!t[s]&&y,p=(t.receipt||y)&&!ye(t.receipt),g=p?"Receipt link is not a valid URL":" ",_=y&&!a.itemFullTitle,Y=parseInt(t.donation)!==parseInt(c),x=!t.platform||!t.username||!a.itemFullTitle||!t.donation||!t.receipt||p||!!h||Y,b=x?"#666":"#4dd04d",{flexStyle:X}=U(),$={maxWidth:700,marginLeft:"auto",marginRight:"auto"},N={fontSize:"1.5rem",fontWeight:700,marginBottom:8},D={fontSize:"1.1rem",fontWeight:400,marginBottom:8};return e.jsxs(L.Fragment,{children:[e.jsxs("div",{style:{paddingBottom:32},children:[e.jsx(Te,{text:"ENTRY FORM"}),e.jsxs("div",{style:{...$,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:N,children:"About You"}),e.jsxs("div",{style:{display:X,margin:"12px 12px 0px 12px"},children:[e.jsxs(B,{style:{width:250,marginRight:16},size:"small",error:d("platform"),children:[e.jsx($e,{color:"info",children:"Preferred Platform"}),e.jsxs(ze,{value:t.platform?t.platform:"",label:"Preferred Platform",onChange:F,color:"info",name:"platform",children:[e.jsx(ne,{value:"Discord",children:"Discord"}),e.jsx(ne,{value:"Reddit",children:"Reddit"})]}),e.jsx(Pe,{children:d("platform")?"Required Field":" "})]}),e.jsx(B,{style:{width:250},size:"small",children:e.jsx(E,{type:"text",name:"username",label:"Username",value:t.username?t.username:"",error:d("username"),helperText:d("username")?"Required Field":" ",onChange:F,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{...$,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:N,children:"Your Donation"}),e.jsxs("div",{style:{display:X,margin:"12px 12px 0px 12px"},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100},children:[e.jsx("div",{style:D,children:"Selected Charity"}),e.jsx("div",{style:{height:6}}),e.jsx(Fe,{allItems:W,setItemDetails:S,getOptionTitle:q,searchText:"Search Charities",error:_}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:y&&!a.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...D},children:"Total donation in USD"}),e.jsx(B,{children:e.jsx(E,{type:"text",name:"donation",label:"Donation Amount",value:t.donation?t.donation:"",error:d("donation"),helperText:d("donation")?"Required Field":" ",onChange:F,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{margin:"6px 12px 0px 12px"},children:[e.jsxs("div",{style:D,children:["Receipt from approved charity ",e.jsx("span",{style:{fontWeight:400},children:"(hosted image link, must contain a visible date)"})]}),e.jsx(B,{fullWidth:!0,children:e.jsx(E,{type:"text",name:"receipt",label:"Receipt Link",error:p,helperText:g,value:t.receipt?t.receipt:"",onChange:F,color:"info",size:"small",fullWidth:!0})})]})]}),e.jsxs("div",{style:{...$,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:N,children:"Your Pots"}),e.jsx(Oe,{donation:t.donation,potData:l,handlePotChange:I,questionStyle:D,showIssues:y,setPotData:w,allocated:c})]}),e.jsxs("div",{style:{...$,padding:"20px 20px 20px 20px"},children:[e.jsx("div",{style:{...N,textAlign:"center"},children:"All Done?"}),e.jsxs("div",{style:{...$,justifyContent:"center",marginTop:0,display:"flex"},children:[e.jsx("div",{style:{display:x?"flex":"none"},children:e.jsx(H,{variant:"outlined",onClick:()=>{O(!y)},style:{marginRight:20,color:y?"#de2323":"#bbb",borderColor:y?"#de2323":"#bbb"},children:"Show Issues"})}),e.jsx(H,{style:{backgroundColor:b,color:"#000"},variant:"contained",disabled:x,onClick:A,children:"Review Entry on Google"})]}),u&&e.jsx("div",{style:{...$,justifyContent:"center",marginTop:16,color:"#de2323",display:x?"flex":"none"},children:e.jsx(H,{style:{color:"#b00"},variant:"text",onClick:A,children:"Test Send Incomplete"})})]})]}),e.jsx(Me,{open:n,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.9}}},children:e.jsxs("div",{style:{width:320,textAlign:"center",padding:30,fontSize:"1.1rem"},children:[e.jsx("span",{style:{fontSize:"1.3rem",fontWeight:700},children:"Thanks for entering!"}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("span",{style:{fontSize:"1.2rem",lineHeight:"1.2rem"},children:["Make sure you hit ",e.jsx("strong",{children:"SUBMIT"})," on the google review form or your entry will not be counted.",e.jsx("br",{}),e.jsx("br",{})]}),"You can always make another donation and submit again... ",e.jsx(V,{onClick:()=>o("/rafl"),style:{color:"#ddd",textDecorationColor:"#888",cursor:"pointer"},children:"Take another look at the pots!"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(V,{onClick:()=>C(!1),children:"(close)"})]})})]})}function xt(){const{lockCollection:o}=r.useContext(ge),{isMobile:u}=U();ke("RAFL Entry Form");const n=e.jsxs(L.Fragment,{children:[!u&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),e.jsx(Be,{}),e.jsx(Ee,{})]});return e.jsxs(L.Fragment,{children:[e.jsx(ve,{title:"RAFL Entry Form",extras:n}),e.jsx(Re,{page:"entryform"}),e.jsx(Ge,{profile:o}),e.jsx(be,{}),e.jsx(Ce,{feature:"raflForm"}),e.jsx(Le,{})]})}export{xt as default};
