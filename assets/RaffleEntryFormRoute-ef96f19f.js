import{K as Z,M as ee,j as e,u as O,r as n,R as _,G as ie,I as V,a8 as le,B as W,a$ as ne,aa as Q,D as oe,N as ae,F as de,T as ce}from"./index-b0aa62ae.js";import{u as me}from"./usePageTitle-dff7498a.js";import{R as pe}from"./RaffleHeader-7180f791.js";import{R as xe}from"./RaffleAutocompleteBox-715a086f.js";import{a as ue}from"./raflCharities-941be44c.js";import{R as he}from"./RaffleSubHead-148df89c.js";import{r as fe}from"./rafl-31dfda29.js";import{d as X}from"./Search-8d71c3e4.js";import{A as je}from"./Autocomplete-e037f0ea.js";import{T as E,F as ye}from"./TextField-9c532ed5.js";import{I as ge}from"./Chip-73cc8225.js";import{F as B,I as ve,S as be}from"./Select-3e42ec96.js";import{L as Ce}from"./Link-8c5740ec.js";import{a as ke}from"./RaffleContext-bb213d46.js";import{R as Re,A as Fe}from"./AdminRoleButton-8b99f55f.js";import{R as Se}from"./RaffleComingSoon-8426f828.js";import"./useDocumentTitle-85836e02.js";import"./Collapse-8d024309.js";import"./useData-f0fdd365.js";import"./dataUrls-02b67476.js";import"./Dialog-b8cd1a10.js";const J={platform:461883484,username:1438374007,charity:1324990870,receipt:657522471,donation:716292311,pot1:991079714,pot2:878340115,pot3:575730469,pot4:1347753646,pot5:913345405,pot6:1773429951};var G={},Te=ee;Object.defineProperty(G,"__esModule",{value:!0});var te=G.default=void 0,Ie=Te(Z()),Pe=e;te=G.default=(0,Ie.default)((0,Pe.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function Ae({questionStyle:t,index:p,potData:l,handlePotChange:R,showIssues:r,removePot:y}){const{isMobile:d,flexStyle:F}=O(),C=!1,L={maxWidth:700},A=n.useRef(),[o,S]=n.useState(l[p]),w=Array.from(Object.keys(l)).length>1;if(l[p].tickets!==o.tickets||l[p].itemFullTitle!==o.itemFullTitle){const j=o.itemFullTitle&&o.tickets;R(p,o,j)}const g=n.useMemo(()=>{var s;let j=[],u={},c={},I={},P={};return(s=fe)==null||s.sort((i,m)=>{i.title.localeCompare(m.title)}).map(i=>{const m=`Pot ${i.potNumber} - ${i.title}`;c[m]=i.title,u[m]=i.id,I[m]=i.potNumber,P[m]=i.formId,j.push(m)}).filter(i=>i),{options:j,itemIds:u,itemTitles:c,itemPotNumbers:I,itemFormIds:P}},[]),{options:T,itemIds:a,itemTitles:x,itemPotNumbers:v,itemFormIds:h}=g,k=n.useCallback(j=>{const u=j.target.value.replace(/[^0-9]/,""),c={...o,tickets:u};S(c)},[o]),H=n.useCallback((j,u)=>{let c;T.includes(u)?c={itemFullTitle:u,itemTitle:x[u],itemId:a[u],itemPotNumber:v[u],itemFormId:h[u]}:c={},S({...o,...c})},[T,o,x,a,v,h]),[b,$]=n.useState(!1),N=n.useCallback(()=>{$(!0),setTimeout(()=>A.current.focus(),15)},[]),q=n.useCallback(()=>$(!1),[]),D=b&&C?{width:"auto",position:"fixed",left:60,right:0,paddingRight:16,maxWidth:"unset",zIndex:9999999,backgroundColor:"#272727"}:{},z=r&&!o.itemFullTitle?{borderBottom:"#b00 solid 4px"}:{};return e.jsxs("div",{style:{display:F,margin:12},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100,minWidth:280},children:[e.jsx("div",{style:{...t},children:"Selected Pot"}),e.jsx("div",{style:{height:4}}),e.jsxs(_.Fragment,{children:[!b&&C&&e.jsx(ie,{title:"Search",arrow:!0,disableFocusListener:!0,children:e.jsx(V,{color:"inherit",onClick:N,children:e.jsx(X,{})})}),(b||!C)&&e.jsx(je,{selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:{...L,...D},options:T,onChange:H,renderInput:j=>e.jsx(E,{...j,style:z,placeholder:"Search Pots",variant:"standard",color:"info",inputRef:A,InputProps:{...j.InputProps,startAdornment:e.jsx(ge,{position:"start",children:e.jsx(X,{})})}})}),e.jsx(le,{invisible:!0,open:b&&C,onClick:q})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:r&&!o.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsxs(B,{children:[!d&&e.jsx("div",{style:t,children:" "}),e.jsx(E,{type:"text",name:"tickets",label:"Tickets",value:l[p].tickets?l[p].tickets:"",error:r&&!o.tickets,helperText:r&&!l[p].tickets?"Required Field":" ",onChange:k,color:"info",size:"small",style:{width:120}})]}),w&&e.jsxs("div",{style:{marginLeft:10},children:[!d&&e.jsx("div",{style:t,children:" "}),e.jsx(V,{color:"warning",onClick:()=>y(p),children:e.jsx(te,{})})]})]})]})}var Y={},we=ee;Object.defineProperty(Y,"__esModule",{value:!0});var re=Y.default=void 0,$e=we(Z()),ze=e;re=Y.default=(0,$e.default)((0,ze.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");function Le({donation:t,questionStyle:p,potData:l,showIssues:R,setPotData:r,allocated:y}){const d=Array.from(Object.keys(l)),F=t?parseInt(t)-y:0-y,C=n.useCallback(()=>{const a=d[d.length-1]+1e3,x={...l};x[a]={tickets:0},r(x)},[l,d,r]),L=n.useCallback(a=>{const x={...l};delete x[a],r(x)},[l,r]),A=n.useCallback(()=>{const a=Math.floor(t/d.length),x=t%d.length;d.map((v,h)=>{const k={...l};h===0&&t?k[v].tickets=a+x:t?k[v].tickets=a:k[v].tickets=0,r(k)})},[t,l,d,r]),o=n.useCallback((a,x)=>{const v={...l};v[a]=x,r(v)},[l,r]),S=F>0?{color:"#0b0",fontWeight:700}:F<0?{color:"#b00",fontWeight:700}:{},{isMobile:w,flexStyle:g}=O(),T=w?"1.0rem":"1.2rem";return e.jsxs(_.Fragment,{children:[d.map(a=>e.jsx(Ae,{questionStyle:p,index:a,potData:l,handlePotChange:o,showIssues:R,removePot:L},a)),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(W,{variant:"outlined",onClick:()=>{C()},size:"small",color:"info",startIcon:e.jsx(re,{}),children:"Add Pot"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",fontSize:T,marginTop:15},children:[e.jsxs("div",{style:{display:g,padding:8},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Total tickets"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:t||0})]})]}),e.jsxs("div",{style:{display:g,padding:8,margin:"0px 10px"},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Allocated"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:y})]})]}),e.jsxs("div",{style:{display:g,padding:8},children:[e.jsx("div",{style:{...S},children:e.jsx("nobr",{children:"Remaining"})}),e.jsxs("div",{style:{...S},children:[" ",e.jsx("strong",{children:t||y?F:0})]})]}),t&&e.jsx("div",{style:{display:g,padding:8,marginLeft:10,alignContent:"center"},children:e.jsx(Ce,{onClick:()=>{A()},style:{color:"#417ee6",fontWeight:700},children:"Auto"})})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",textAlign:"center"},children:R&&t>y?e.jsx("span",{children:"All tickets must be assigned to a pot"}):R&&t<y?e.jsx("span",{children:"You have too many tickets allocated"}):e.jsx("span",{children:" "})})]})}function Me(){const[t,p]=n.useState({}),[l,R]=n.useState({}),[r,y]=n.useState({0:{tickets:0}}),d=Array.from(Object.keys(r)),{displayStats:F,setDisplayStats:C}=n.useContext(ke),[L,A]=n.useState(!0);L&&F&&(C(!1),A(!1));const o=n.useMemo(()=>d.reduce((s,i)=>{const m=parseInt(r[i].tickets)?parseInt(r[i].tickets):0;return s=s?s+m:m,s},0),[r,d]),S=n.useMemo(()=>d.reduce((s,i)=>!(r[i].tickets&&r[i].tickets),!1),[r,d]),w=n.useCallback(s=>{const i=window.open(s,"_blank","noopener,noreferrer");i&&(i.opener=null)},[]),g=n.useCallback(s=>{const i={...t};s.target.name==="donation"?i[s.target.name]=s.target.value.replace(/[^0-9]/,""):i[s.target.name]=s.target.value,p(i)},[t]),T=n.useCallback((s,i)=>{const m={...r};m[s]=i,y(m)},[r]),a=n.useCallback(()=>{const s="https://docs.google.com/forms/d/e/1FAIpQLScNaJioyXOUkd-JSLuiH-RX18N-bQPodTrhwSgtjlQIaXaxBA/viewform?usp=pp_url",i=Object.keys(t).reduce((f,M)=>{const U=`&entry.${J[M]}=${encodeURIComponent(t[M])}`;return f=(f==null?void 0:f.length)>0?`${f}${U}`:U,f},""),m=`&entry.${J.charity}=${encodeURIComponent(l.itemTitle)}`,se=Object.keys(r).reduce((f,M)=>{const K=`&entry.${r[M].itemFormId}=${r[M].tickets}`;return f=(f==null?void 0:f.length)>0?`${f}${K}`:K,f},"");w(`${s}${m}${i}${se}`)},[l.itemTitle,t,w,r]),x=ue.map(s=>({...s,title:s.name})),v=n.useCallback(s=>s.name,[]),[h,k]=n.useState(!1),H=["platform","username","charity","donation"],b=s=>H.includes(s)&&!t[s]&&h,$=(t.receipt||h)&&!ne(t.receipt),N=$?"Receipt link is not a valid URL":" ",q=h&&!l.itemFullTitle,D=parseInt(t.donation)!==parseInt(o),z=!t.platform||!t.username||!l.itemFullTitle||!t.donation||!t.receipt||$||!!S||D,j=z?"#666":"#4dd04d",{flexStyle:u}=O(),c={maxWidth:700,marginLeft:"auto",marginRight:"auto"},I={fontSize:"1.5rem",fontWeight:700,marginBottom:8},P={fontSize:"1.1rem",fontWeight:400,marginBottom:8};return e.jsxs("div",{style:{paddingBottom:32},children:[e.jsx(he,{text:"ENTRY FORM"}),e.jsxs("div",{style:{...c,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:I,children:"About You"}),e.jsxs("div",{style:{display:u,margin:"12px 12px 0px 12px"},children:[e.jsxs(B,{style:{width:250,marginRight:16},size:"small",error:b("platform"),children:[e.jsx(ve,{color:"info",children:"Preferred Platform"}),e.jsxs(be,{value:t.platform?t.platform:"",label:"Preferred Platform",onChange:g,color:"info",name:"platform",children:[e.jsx(Q,{value:"Discord",children:"Discord"}),e.jsx(Q,{value:"Reddit",children:"Reddit"})]}),e.jsx(ye,{children:b("platform")?"Required Field":" "})]}),e.jsx(B,{style:{width:250},size:"small",children:e.jsx(E,{type:"text",name:"username",label:"Username",value:t.username?t.username:"",error:b("username"),helperText:b("username")?"Required Field":" ",onChange:g,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{...c,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:I,children:"Your Donation"}),e.jsxs("div",{style:{display:u,margin:"12px 12px 0px 12px"},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100},children:[e.jsx("div",{style:P,children:"Selected Charity"}),e.jsx("div",{style:{height:6}}),e.jsx(xe,{allItems:x,setItemDetails:R,getOptionTitle:v,searchText:"Search Charities",error:q}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:h&&!l.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...P},children:"Total donation in USD"}),e.jsx(B,{children:e.jsx(E,{type:"text",name:"donation",label:"Donation Amount",value:t.donation?t.donation:"",error:b("donation"),helperText:b("donation")?"Required Field":" ",onChange:g,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{margin:"6px 12px 0px 12px"},children:[e.jsxs("div",{style:P,children:["Receipt from approved charity ",e.jsx("span",{style:{fontWeight:400},children:"(hosted image link, must contain a visible date)"})]}),e.jsx(B,{fullWidth:!0,children:e.jsx(E,{type:"text",name:"receipt",label:"Receipt Link",error:$,helperText:N,value:t.receipt?t.receipt:"",onChange:g,color:"info",size:"small",fullWidth:!0})})]})]}),e.jsxs("div",{style:{...c,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:I,children:"Your Pots"}),e.jsx(Le,{donation:t.donation,potData:r,handlePotChange:T,questionStyle:P,showIssues:h,setPotData:y,allocated:o})]}),e.jsxs("div",{style:{...c,padding:"20px 20px 20px 20px"},children:[e.jsx("div",{style:{...I,textAlign:"center"},children:"All Done?"}),e.jsxs("div",{style:{...c,justifyContent:"center",marginTop:0,display:"flex"},children:[e.jsx("div",{style:{display:z?"flex":"none"},children:e.jsx(W,{variant:"outlined",onClick:()=>{k(!h)},style:{marginRight:20,color:h?"#de2323":"#bbb",borderColor:h?"#de2323":"#bbb"},children:"Show Issues"})}),e.jsx(W,{style:{backgroundColor:j,color:"#000"},variant:"contained",disabled:z,onClick:a,children:"Review Entry on Google"})]}),e.jsx("div",{style:{...c,justifyContent:"center",marginTop:16,color:"#de2323",display:z?"flex":"none"},children:e.jsx(W,{style:{color:"#b00"},variant:"text",onClick:a,children:"Test Send Incomplete"})})]})]})}function st(){const{lockCollection:t}=n.useContext(oe),{isMobile:p}=O();me("RAFL Entry Form");const l=e.jsxs(_.Fragment,{children:[!p&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),e.jsx(Re,{}),e.jsx(Fe,{})]});return e.jsxs(_.Fragment,{children:[e.jsx(ae,{title:"RAFL Entry Form",extras:l}),e.jsx(pe,{page:"entryform"}),e.jsx(Me,{profile:t}),e.jsx(de,{}),e.jsx(ce,{feature:"raflForm"}),e.jsx(Se,{})]})}export{st as default};
