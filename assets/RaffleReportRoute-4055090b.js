import{d as F,u as k,j as t,R as W,b as G,r as x,A as X,D as _,N as q,F as J,T as K}from"./index-a77f1c32.js";import{D as Q,a as U,r as Z}from"./filterFields-d3ccae1d.js";import{L as tt}from"./LoadingDisplay-85d9ef67.js";import{u as et}from"./useData-44db4cd6.js";import{u as st}from"./usePageTitle-fa6eb391.js";import{s as nt,i as it}from"./dataUrls-b0d1ea1b.js";import{P as z}from"./nivo-line.es-ae83593e.js";import{p as I}from"./adminChartDefaults-e02caa29.js";import{A as ot}from"./AdminStatsTable-93c0e1b7.js";import{A as H}from"./AdminStatsTableSort-1b4256a8.js";import{R as at}from"./RaffleAutocompleteBox-ef0bf286.js";import{L as rt}from"./Link-b4916cf0.js";import{a as B}from"./RaffleContext-832e236e.js";import{R as lt}from"./RaffleStatsHeader-8a15a94b.js";import{R as ct,A as dt}from"./AdminRoleButton-a8093853.js";import{R as mt}from"./RaffleDataProvider-ddf69eaa.js";import"./LPU-c3fa7122.js";import"./LinearProgress-08d29535.js";import"./useDocumentTitle-492c5f2d.js";import"./nivo-legends.es-d12e1c4b.js";import"./index-09d5ce77.js";import"./TableRow-33efe7de.js";import"./Search-4b7f3d2e.js";import"./Autocomplete-4519ddf5.js";import"./Select-5d070861.js";import"./Chip-670499c8.js";import"./TextField-37c1a2a8.js";import"./index-7537a5ef.js";const ft=({lineData:n})=>{const s=[n.rafl28days.data],i=[],e=new Map,r=new Map,c=new Map;s.forEach(d=>{const y=[],p=[],C=[];for(let S=0;S<d.length;S++){let h=d[S].date;if(F(h)<F("2024-11-25"))continue;h=h+" 23:59:59";const m=new Map;m.x=h,m.y=d[S].potListViews,y.push(m);const w=new Map;w.x=h,w.y=d[S].potViews,p.push(w);const T=new Map;T.x=h,T.y=d[S].raflForm,C.push(T)}e.id="Pot List",e.data=y,r.id="Pot Views",r.data=p,c.id="Entry Form",c.data=C,i.push(r),i.push(e),i.push(c)});const{width:o}=k(),g=o<=360,j=o<=395,u=o<=428,D=o<=560,R=o<=820,f=g||j?200:u?210:R?230:350,v=D?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:f,width:"100%"},children:t.jsx(z,{theme:I,data:i,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:v,height:f,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function ut({data:n}){const{width:s}=k(),i=s<=560,c={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...i?{}:{display:"flex"}};return t.jsx(W.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:c,children:t.jsx(ft,{lineData:n})})})})}const ht=({data:n})=>{const{rafl28days:s}=n,i=s.data.filter(d=>F(d.date)>F("2024-11-27")),e=i.reduce((d,y)=>(Object.keys(s.data[s.data.length-1]).map(p=>{["date","dateString"].includes(p)||(d[p]=d[p]?d[p]+y[p]:y[p])}),d),{});e.dateString="Total",i.push(e);const r=Object.keys(e).reduce((d,y)=>(d[y]=Math.floor(e[y]/i.length),d),{});r.dateString="Average",i.push(r);const c={columns:s.columns,data:i},{width:o}=k(),g=o<=360,j=o<=395,u=o<=428,D=o<=560,R=o<=820,f=g?".8rem":j?".85rem":u?".9rem":".95rem",v="100%";return t.jsx(ot,{tableData:c,tableWidth:v,fontSize:f})},pt=({data:n})=>{const s=G(),{potViewsById:i}=n,{getPotFromId:e}=x.useContext(Q),r=[{name:"Pot #",align:"center",id:"potNumber"},{name:"ID",align:"center",id:"id"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],c=!0,[o,g]=x.useState("potNumber"),[j,u]=x.useState(!0),[D,R]=x.useState({}),f=i.data.map(a=>{var P,V;const l=e(a.id);if(!l)return null;let b=l!=null&&l.title?l.title.substring(0,32):`unknown (${a.id})`;b=((P=l==null?void 0:l.title)==null?void 0:P.length)<32||!(l!=null&&l.title)?b:b+"...";const M=(V=a==null?void 0:a.id)==null?void 0:V.replace("2025-","");return{...a,percentViews:Math.floor(a.percentViews*100)+"%",...l,title:b,id:M}}).filter(a=>a).sort((a,l)=>{switch(o){case"potNumber":return a.potNumber-l.potNumber||a.title.localeCompare(l.title);case"id":return a[o].localeCompare(l[o]);case"title":return a[o].localeCompare(l[o]);case"donors":return parseInt(l[o])-parseInt(a[o])||a.title.localeCompare(l.title);case"percentViews":return parseInt(l[o])-parseInt(a[o])||a.views-l.views;default:return parseInt(l[o])-parseInt(a[o])||a.title.localeCompare(l.title)}}),v=j?f:f.reverse(),y=(Object.keys(D).length>0?[v==null?void 0:v.find(a=>a.title===D.itemTitle)]:v||[]).map(a=>a.donors&&a.donors>0?{...a}:{...a,donors:0,tickets:0}),p={columns:r,data:y},C=x.useCallback((a,l)=>{const b=f.find(P=>P.title===l),M=b==null?void 0:b.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return a==="title"?t.jsx(rt,{onClick:()=>s(`/rafl/?id=${b.id}&name=${M}`),style:{color:"#fff"},children:l}):l},[s,f]),S=x.useCallback(a=>a!=null&&a.title?a.title:"unknown",[]),{width:h}=k(),m=h<=360,w=h<=395,T=h<=428,O=h<=560,Y=h<=820,E=m?".8rem":w?".85rem":T?".9rem":".95rem",$="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(at,{allItems:f,setItemDetails:R,getOptionTitle:S,searchText:"Search Pots"})})}),t.jsx(H,{tableData:p,tableWidth:$,fontSize:E,sortable:c,sort:o,setSort:g,ascending:j,setAscending:u,linkFunction:C})]})},xt=()=>{const{allCharities:n}=x.useContext(B),s=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],i=!0,[e,r]=x.useState("name"),[c,o]=x.useState(!0),g=n.sort((m,w)=>{switch(e){case"name":return m.name.localeCompare(w.name);case"donors":return w[e]-m[e];case"donations":return w[e]-m[e];default:return m.name.localeCompare(w.name)}}),u=(c?g:g.reverse()).map(m=>m.donations&&m.donations>0?{...m,donations:`$${m.donations}`}:{...m}),D={columns:s,data:u},R=x.useCallback((m,w)=>w,[]),{width:f}=k(),v=f<=360,d=f<=395,y=f<=428,p=f<=560,C=f<=820,S=v?".8rem":d?".85rem":y?".9rem":".95rem",h="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(H,{tableData:D,tableWidth:h,fontSize:S,sortable:i,sort:e,setSort:r,ascending:c,setAscending:o,linkFunction:R})]})};function A({chartHeight:n,chartdata:s,showAxisBottom:i,colors:e,tickValues:r,curve:c}){const o=i?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},g=i?"bottom":"top-left",j=i?70:20,u=i?0:20;return t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(z,{theme:I,data:s,enableGridX:!1,enableGridY:!1,colors:e,lineWidth:3,margin:o,height:n,curve:c??"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:r||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:i?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:i?[]:[{anchor:g,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:u,translateY:j,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}function N(n,s,i){if(s.length===1){n[s[0]]=n[s[0]]?n[s[0]]+i:i;return}const e=s[0];n[e]||(n[e]={}),N(n[e],s.slice(1),i)}function L(n,s,i){if(s.length===1){n[s[0]]=n[s[0]]?[...n[s[0]],i]:[i];return}const e=s[0];n[e]||(n[e]={}),N(n[e],s.slice(1),i)}const gt=({data:n})=>{const s=Object.keys(n).sort((r,c)=>r.localeCompare(c)).reduce((r,c)=>{const o=c+" 23:59:59";return r.donorsCum=r.donorsCum+n[c].totalDonors||n[c].totalDonors,L(r,["totalDonors"],{x:o,y:n[c].totalDonors}),L(r,["cumulativeDonors"],{x:o,y:r.donorsCum}),r.donationsCum=r.donationsCum+n[c].totalDonations||n[c].totalDonations,L(r,["totalDonations"],{x:o,y:n[c].totalDonations}),L(r,["cumulativeDonations"],{x:o,y:r.donationsCum}),r},[]),i={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},e=120;return t.jsxs(W.Fragment,{children:[t.jsx("div",{style:i,children:"Donations"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donations Cumulative",data:s.cumulativeDonations}],chartHeight:e,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donations",data:s.totalDonations}],chartHeight:e,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:i,children:"Donors"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donors Cumulative",data:s.cumulativeDonors}],chartHeight:e,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donors",data:s.totalDonors}],chartHeight:e,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})};function yt(){st("RAFL Report");const{data:n,loading:s,error:i}=et({urls:wt}),{siteFullNew:e,raflResponseDetails:r}=n||{},{width:c}=k(),g=c<560?"8px 8px 32px 8px":"24px 24px 32px 24px",j={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},u={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},D=j,R=s?"--":"(updated: "+F(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+` ${e==null?void 0:e.metadata.timezone})`;return s?t.jsx(tt,{}):i?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:g,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:D,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:R})]}),t.jsx(lt,{}),t.jsx("div",{style:{height:20}}),t.jsx(ut,{data:e}),t.jsx("div",{style:u,children:"Totals Over Time"}),t.jsx(gt,{data:r}),t.jsx("div",{style:u,children:"Page Tracking"}),t.jsx(ht,{data:e}),t.jsx("div",{style:u,children:"Pot Details"}),t.jsx(pt,{data:e}),t.jsx("div",{style:u,children:"Charity Details"}),t.jsx(xt,{data:e})]})}const wt={siteFullNew:nt,raflResponseDetails:it};function qt(){const{authLoaded:n}=x.useContext(X),{adminRole:s}=x.useContext(_),{isMobile:i}=k(),{allPots:e}=x.useContext(B),r=t.jsxs(W.Fragment,{children:[!i&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(ct,{active:!0}),t.jsx(dt,{})]});return t.jsx(U,{filterFields:Z,children:t.jsx(mt,{allEntries:e,children:t.jsxs(W.Fragment,{children:[t.jsx(q,{title:"RAFL Report",extras:r}),n&&s&&t.jsx(yt,{}),t.jsx(J,{}),t.jsx(K,{feature:"raflReport"})]})})})}export{qt as default};
