import{r,F as H,aA as R,aq as L,d as u,K as v,ap as _,j as q}from"./index-DETiQmMN.js";import{D as G,f as K}from"./DataContext-vD7Qr_bL.js";import{r as E}from"./index-HY9UonWN.js";import{c as V}from"./collectionStatsById-DY1NVZ7h.js";import{u as W}from"./useData-DhlpQkHb.js";import{h as T}from"./dataUrls-DkJe4Pqg.js";import{f as J}from"./filterEntriesAdvanced-B_LinbMH.js";import{s as Q}from"./setDeep-J6HEwWhX.js";function re({children:I,allEntries:d,profile:l}){const{filters:O,advancedFilterGroups:M}=r.useContext(H),{search:m,tab:i,sort:c,expandAll:U}=O,{data:k,loading:g,error:A}=W({urls:Y}),z=r.useMemo(()=>k&&!g&&!A?k.lockbazzarEntryIds:[],[k,A,g]),[b,B]=r.useState(.3),n=r.useMemo(()=>{const s=(l==null?void 0:l.userLockNotes)||{};let o=[];return d.map(e=>{var y,N,F,w;const a=(y=e.media)==null?void 0:y.map(t=>{var h;return t&&t.title&&((h=t.title)!=null&&h.includes("By:"))&&Q(o,[""],t.title.replace("By: ","").trim()),e.belt==="Unranked"&&t.thumbnailUrl&&t.thumbnailUrl.includes("flickr.com")&&(t.thumbnailUrl=t.thumbnailUrl.replace("_w_d.jpg","_w.jpg")),t});return{...e,media:a,makes:e.makeModels[0].make?e.makeModels.map(({make:t})=>t):e.makeModels[0].model,fuzzy:E(e.makeModels.map(({make:t,model:h})=>[t,h]).flat().filter(t=>t).concat([e.version,e.notes,e.belt]).join(",")),content:[(N=e.media)!=null&&N.some(t=>!t.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(F=e.media)!=null&&F.some(t=>t.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((w=e.links)==null?void 0:w.length)>0?"Has Links":"No Links",L[e.belt].danPoints>0?"Worth Dan Points":void 0,u(e.lastUpdated).isAfter(u().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,s[e.id]?"Has Personal Notes":void 0].flat().filter(t=>t),collection:R.locks.map.map(t=>l&&l[t.key]&&l[t.key].includes(e.id)?t.label:"Not "+t.label),collectionSaves:V[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:s[e.id],photographers:o==null?void 0:o.names}})},[d,l]),f=r.useCallback(s=>{const o=m&&s.find(e=>e.id===m);return o?[o]:m?K.go(E(m),s,{keys:X,threshold:-23e3}).map(e=>({...e.obj,score:e.score})).filter(e=>e.score>b):s},[m,b]),C=r.useMemo(()=>i==="search"||!i?f(n):f(n).filter(s=>s.simpleBelt===i),[n,f,i]),p=r.useMemo(()=>{const s=J({advancedFilterGroups:M(),entries:n}),o=f([...s]);return c?o.sort((e,a)=>{if(c==="popularity")return a.collectionSaves-e.collectionSaves||a.views-e.views||e.fuzzy.localeCompare(a.fuzzy);if(c==="beltAscending")return v(e.belt,a.belt);if(c==="beltDescending")return _(e.belt,a.belt);if(c==="alphaAscending")return e.fuzzy.localeCompare(a.fuzzy);if(c==="alphaDescending")return a.fuzzy.localeCompare(e.fuzzy);if(c==="recentlyUpdated")return Math.floor(u(a.lastUpdated).valueOf()/3600)-Math.floor(u(e.lastUpdated).valueOf()/3600)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy);if(c==="dateAdded")return Math.floor(u(a.dateAdded).valueOf()/3600*24)-Math.floor(u(e.dateAdded).valueOf()/3600*24)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy)}):o},[M,n,f,c]),x=r.useCallback(s=>d.find(o=>o.id===s),[d]),D=r.useMemo(()=>i==="search"||!i?p:p.filter(s=>s.simpleBelt===i),[i,p]),S=r.useCallback(s=>z==null?void 0:z.includes(s),[z]),j=r.useMemo(()=>(l==null?void 0:l.blackBeltAwardedAt)>0,[l]),P=r.useMemo(()=>({allEntries:d,mappedEntries:n,searchedBeltEntries:C,visibleEntries:p,visibleBeltEntries:D,getEntryFromId:x,expandAll:U,profile:l,blackBeltUser:j,lockbazzarAvailable:S,searchCutoff:b,setSearchCutoff:B}),[d,n,C,p,D,x,U,l,j,S,b,B]);return q.jsx(G.Provider,{value:P,children:I})}const X=["fuzzy"],Y={lockbazzarEntryIds:T};export{re as D};
