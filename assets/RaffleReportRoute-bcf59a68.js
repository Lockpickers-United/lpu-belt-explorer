import{d as k,u as v,j as t,R as P,b as N,r as g,A as z,D as B,N as H,F as I,T as E}from"./index-378eac39.js";import{D as O,a as Y,r as $}from"./filterFields-64a5b02b.js";import{L as G}from"./LoadingDisplay-bfd8af8f.js";import{u as X}from"./useData-c6993866.js";import{u as _}from"./usePageTitle-31e190be.js";import{s as q}from"./dataUrls-4eb203c4.js";import"./LockViewsLine-e68548df.js";import{P as J}from"./nivo-line.es-9a11d7e1.js";import{p as K}from"./adminChartDefaults-e02caa29.js";import{A as Q}from"./AdminStatsTable-ccce8c46.js";import{A as U}from"./AdminStatsTableSort-41354bdc.js";import{R as Z}from"./RaffleAutocompleteBox-d4c9774b.js";import{L as tt}from"./Link-a911d67c.js";import{R as et,A as it}from"./AdminRoleButton-6c1ca270.js";import{R as ot}from"./RaffleDataProvider-3f1646fd.js";import{a as at}from"./RaffleContext-285317b0.js";import"./LPU-c3fa7122.js";import"./LinearProgress-aacede7d.js";import"./useDocumentTitle-3fc53fac.js";import"./chartDefaults-9fc07b21.js";import"./nivo-legends.es-c9adcdbc.js";import"./index-c64c72a3.js";import"./TableRow-86a5ae92.js";import"./Search-b68a6bc8.js";import"./Autocomplete-afe34f4c.js";import"./Select-3d9fa2c6.js";import"./Chip-803d6e2d.js";import"./TextField-6f0a74e1.js";import"./index-b6cb232c.js";const st=({lineData:m})=>{const n=[m.rafl28days.data],s=[],e=new Map,l=new Map,p=new Map;n.forEach(r=>{const x=[],d=[],F=[];for(let c=0;c<r.length;c++){const R=r[c].date;if(k(R)<k("2024-11-25"))continue;const D=new Map;D.x=R,D.y=r[c].potListViews,x.push(D);const T=new Map;T.x=R,T.y=r[c].potViews,d.push(T);const A=new Map;A.x=R,A.y=r[c].raflForm,F.push(A)}e.id="Pot List",e.data=x,l.id="Pot Views",l.data=d,p.id="Entry Form",p.data=F,s.push(l),s.push(e),s.push(p)});const{width:o}=v(),j=o<=360,f=o<=395,S=o<=428,y=o<=560,b=o<=820,u=j||f?200:S?210:b?230:350,w=y?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:u,width:"100%"},children:t.jsx(J,{theme:K,data:s,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:w,height:u,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.2f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function rt({data:m}){const{width:n}=v(),s=n<=560,p={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...s?{}:{display:"flex"}};return t.jsx(P.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:p,children:t.jsx(st,{lineData:m})})})})}const nt=({data:m})=>{const{rafl28days:n}=m,s=n.data.filter(r=>k(r.date)>k("2024-11-27")),e=s.reduce((r,x)=>(Object.keys(n.data[n.data.length-1]).map(d=>{["date","dateString"].includes(d)||(r[d]=r[d]?r[d]+x[d]:x[d])}),r),{});e.dateString="Total",s.push(e);const l=Object.keys(e).reduce((r,x)=>(r[x]=Math.floor(e[x]/s.length),r),{});l.dateString="Average",s.push(l);const p={columns:n.columns,data:s},{width:o}=v(),j=o<=360,f=o<=395,S=o<=428,y=o<=560,b=o<=820,u=j?".8rem":f?".85rem":S?".9rem":".95rem",w="100%";return t.jsx(Q,{tableData:p,tableWidth:w,fontSize:u})},lt=({data:m})=>{const n=N(),{potViewsById:s}=m,{getPotFromId:e}=g.useContext(O),l=[{name:"Pot #",align:"center",id:"potNumber"},{name:"Pot ID",align:"left",id:"id"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],p=!0,[o,j]=g.useState("potNumber"),[f,S]=g.useState(!0),[y,b]=g.useState({}),u=s.data.map(a=>{var C;const i=e(a.id);let h=i!=null&&i.title?i.title.substring(0,32):`unknown (${a.id})`;return h=((C=i==null?void 0:i.title)==null?void 0:C.length)<32||!(i!=null&&i.title)?h:h+"...",{potNumber:i?i.potNumber:999,...a,percentViews:Math.floor(a.percentViews*100)+"%",...i,title:h}}).sort((a,i)=>{switch(o){case"potNumber":return a.potNumber-i.potNumber||a.title.localeCompare(i.title);case"id":return a[o].localeCompare(i[o]);case"title":return a[o].localeCompare(i[o]);default:return a.potNumber.localeCompare(i.potNumber)||a.title.localeCompare(i.title)}}),w=f?u:u.reverse(),r=Object.keys(y).length>0?[w==null?void 0:w.find(a=>a.title===y.itemTitle)]:w||[],x={columns:l,data:r},d=g.useCallback((a,i)=>{const h=u.find(C=>C.title===i),L=h==null?void 0:h.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return a==="title"?t.jsx(tt,{onClick:()=>n(`/rafl/?id=${h.id}&name=${L}`),style:{color:"#fff"},children:i}):i},[n,u]),F=g.useCallback(a=>a!=null&&a.title?a.title:"unknown",[]),{width:c}=v(),R=c<=360,D=c<=395,T=c<=428,A=c<=560,M=c<=820,W=R?".8rem":D?".85rem":T?".9rem":".95rem",V="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(Z,{allItems:u,setItemDetails:b,getOptionTitle:F,searchText:"Search Pots"})})}),t.jsx(U,{tableData:x,tableWidth:V,fontSize:W,sortable:p,sort:o,setSort:j,ascending:f,setAscending:S,linkFunction:d})]})};function ct(){var b;_("RAFL Report");const{data:m,loading:n,error:s}=X({urls:mt}),{siteFullNew:e}=m||{},{width:l}=v(),o=l<560?"8px 8px 32px 8px":"24px 24px 32px 24px",j={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff"},f={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff"},S=(b=e==null?void 0:e.firstVistsLastSevenDays)!=null&&b.countryCount?f:j,y=n?"--":"(updated: "+k(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+` ${e==null?void 0:e.metadata.timezone})`;return n?t.jsx(G,{}):s?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:o,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[t.jsxs("div",{style:S,children:["RAFL Summary",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:y})]}),t.jsx(rt,{data:e}),t.jsx("div",{style:f,children:"Page Tracking"}),t.jsx(nt,{data:e}),t.jsx("div",{style:f,children:"Pot Details"}),t.jsx(lt,{data:e}),t.jsx(P.Fragment,{children:!1})]})}const mt={siteFullNew:q};function It(){const{authLoaded:m}=g.useContext(z),{adminRole:n}=g.useContext(B),{isMobile:s}=v(),{allPots:e}=g.useContext(at),l=t.jsxs(P.Fragment,{children:[!s&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(et,{active:!0}),t.jsx(it,{})]});return t.jsx(Y,{filterFields:$,children:t.jsx(ot,{allEntries:e,children:t.jsxs(P.Fragment,{children:[t.jsx(H,{title:"RAFL Report",extras:l}),m&&n&&t.jsx(ct,{}),t.jsx(I,{}),t.jsx(E,{feature:"raflReport"})]})})})}export{It as default};
