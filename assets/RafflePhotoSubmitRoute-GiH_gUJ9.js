import{r as e,D as W,b as lt,d as ct,u as T,j as t,L as dt,B as k,T as mt,A as pt,R as xt,e as ht,N as ut}from"./index-Cw6y4sAC.js";import{u as gt}from"./usePageTitle-CfFNdpR1.js";import{R as ft}from"./RaflPotSearchBox-DGxeClc4.js";import{D as jt}from"./Dropzone-DJtzqcvX.js";import{L as yt}from"./LoadingDisplay-BFA04bV-.js";import{R as bt}from"./RaffleContext-CuJwdhk7.js";import{p as vt,c as kt}from"./postData-C4IsH99f.js";import{n as Ct}from"./dataUrls-CThgH6Wi.js";import{C as St}from"./Checkbox-BOJFa5Xr.js";import{C as Lt}from"./Collapse-Cda9o7oa.js";import{T as C}from"./TextField-CtdlVtME.js";import{I as Nt,a as Rt}from"./ImageListItem-BCpOTA2-.js";import{D as S}from"./Dialog-C5JMRIOT.js";import{A as Ft}from"./AdminToolsButton-CmAchxEv.js";import"./Search-eBBAFJqi.js";import"./useFormControl-YXjdxpfL.js";import"./Select-BNl036N-.js";import"./index-B2lJKBUN.js";import"./Cancel-C9ZmALIL.js";import"./LoadingDisplaySmall-e_CXm8IV.js";import"./Box-pcpQNukJ.js";import"./CircularProgress-tev0wROr.js";import"./useData-DnlI1cL_.js";import"./index-BQQNb0Mv.js";import"./setDeep-J6HEwWhX.js";import"./index-xsH4HHeE.js";import"./SwitchBase-DzlGRTIS.js";import"./EmojiEvents-BNzY51bl.js";function Pt({profile:s,user:c}){const{allPots:x=[]}=e.useContext(bt),{updateProfileField:h}=e.useContext(W),[a,m]=e.useState({}),[g,L]=e.useState(void 0),[r,f]=e.useState([]),[$,N]=e.useState(void 0),[R,j]=e.useState(!1),[l,F]=e.useState(void 0),[d,P]=e.useState(!1),[U,w]=e.useState(""),[z,I]=e.useState(""),[p,E]=e.useState((s==null?void 0:s.photoCredit)||(s==null?void 0:s.displayName)||""),[y,O]=e.useState(!1),_=lt(),b=e.useMemo(()=>[...x],[x]),M=ct().format("YYYYMMDD-HHMMss"),Y=!!(a!=null&&a.lockFullName)&&!!(a!=null&&a.lockId)&&!!p&&r.length>0,D=`${a.lockName}_${a.lockId}_`.replace("/","+"),A=`${p}`.replace("/","+"),H=r.map(o=>o.name),K=e.useCallback((o,n)=>{f(o)},[]),G=r.length===1?"File":"Files",q=async o=>{o.preventDefault(),j(!0);const n=`${M}_${D}_${A}`,i=new FormData;r.forEach(u=>{const{base:v,ext:rt}=wt(u.name);i.append("files",u,`${n}/${D}_${v}_${A}.${rt}`)}),i.append("droppedFileNames",H),i.append("lockFullName",a.lockFullName),i.append("lockName",a.lockName),i.append("lockId",a.lockId),i.append("photoCredit",p),i.append("displayName",s==null?void 0:s.displayName),i.append("uploadsDir",n),i.append("notes",z);const nt=`${Ct}/upload`,at=!0,it=3e4;try{N(await vt({user:c,url:nt,formData:i,snackBars:at,timeoutDuration:it})),Q(p)}catch(u){F(kt(u)),m([]),r.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{j(!1)}},J=e.useCallback(o=>{m(o),L(b.find(n=>n.id===o.lockId))},[b]),Q=e.useCallback(o=>{h("photoCredit",o)},[h]),V=e.useCallback(o=>{const{value:n}=o.target;E(n)},[]),X=e.useCallback(o=>{const{value:n}=o.target;I(n)},[]),B=e.useCallback(()=>{m({}),L(void 0),r.forEach(o=>URL.revokeObjectURL(o.preview)),f([]),N(void 0),j(!1),F(void 0),P(!1),w(""),I(""),O(!y)},[r,y]),Z=e.useCallback(()=>{P(!d),m([])},[d]),tt=e.useCallback(o=>{const{value:n}=o.target;w(n),m({lockFullName:n,lockName:n,lockId:"NOTINLIST"})},[]),et=d?.5:1,{flexStyle:ot}=T(),st={color:"#bbb",textDecoration:"underline",cursor:"pointer",fontWeight:500,"&:hover":{color:"#fff"}};return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:600,marginBottom:20},children:["Pot Photos  | ",t.jsx(dt,{onClick:()=>_("/rafl/contribute"),sx:st,children:"Info"})]}),t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:q,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"0px 0px 0px"},children:"Select Pot"}),t.jsx("div",{style:{opacity:et},children:t.jsx(ft,{handleChangeLock:J,allEntries:b,disabled:d,reset:y})}),t.jsxs("div",{style:{marginTop:0},children:[t.jsx(St,{onChange:Z,color:"info",size:"small",id:"notInList",checked:d})," Submit photos for a pot not on the site."]}),t.jsxs(Lt,{in:d,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:U,style:{width:400},onChange:tt,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:ot},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(jt,{files:r||[],otherFiles:[],handleDroppedFiles:K,maxFiles:5,backgroundColor:"#333"}),g&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),g.media?t.jsx("div",{children:t.jsx(Nt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:g.media.map((o,n)=>t.jsx(Rt,{children:t.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},n))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),a.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx("div",{style:{display:"flex"},children:t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:a.lockFullName})}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:p,style:{width:350},onChange:V,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:z,onChange:X}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!Y||R,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:R,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(yt,{})})}),t.jsx(S,{open:!!$&&!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:10,textAlign:"center"},children:[G," Uploaded Successfully!"]}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:60,textAlign:"center"},children:"Images will be added to the site shortly"}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:B,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[l==null?void 0:l.message,t.jsx("br",{}),"(Error code ",l==null?void 0:l.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:B,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(mt,{feature:"uploadPhotos"})]})}function wt(s){const c=s.lastIndexOf(".");return c===-1?{base:s,ext:""}:{base:s.substring(0,c),ext:s.substring(c)}}function ae(){const{isMobile:s}=T(),{lockCollection:c}=e.useContext(W),{user:x}=e.useContext(pt);gt("RAFL Pot Photos");const h=t.jsxs(xt.Fragment,{children:[!s&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(Ft,{})]});return t.jsxs(ht,{children:[t.jsx(ut,{title:"RAFL Pot Photos",extras:h}),t.jsx(Pt,{profile:c,user:x})]})}export{ae as default};
