import{j as e,X as I,r as i,a6 as W,ad as F,d as z,a5 as D,R as E,U as b,W as A,bs as O,B as y,b as L,u as M,bL as N}from"./index-BZbo2eJH.js";import{R as P}from"./RaffleContext-CF_-pAhQ.js";import{C as $}from"./Cached-DL5F6HJy.js";import{E as q}from"./ExpandMore-VZE67nLM.js";import{V as k}from"./AdminToolButtons-D37JTAtz.js";import{C as H,c as V}from"./CircularProgress-B2cQZ_g7.js";import{n as G}from"./dataUrls-1xDVM400.js";import{a as U}from"./index-C0RmN517.js";import{B}from"./Box-BOjhuNCn.js";import{A as Z,a as J,b as _}from"./AccordionSummary-BAJrCH_D.js";function X({diameter:t=40}){return e.jsx("div",{style:{display:"flex",placeItems:"center",justifyContent:"center",width:t,height:t},children:e.jsx(H,{variant:"indeterminate",disableShrink:!0,sx:{color:c=>(c.palette.mode==="light","#fff"),animationDuration:"550ms",[`& .${V.circle}`]:{strokeLinecap:"round"}},size:18,thickness:5})})}const K=(t,c)=>{const[r,s]=t.split("#"),a=r.includes("?")?"&":"?";return`${r}${a}${c}${s?"#"+s:""}`},Q=async({user:t,url:c,formData:r,json:s,snackBars:a,timeoutDuration:h=15e3})=>{var p,g,S,w,R,j;const n=new AbortController,u=setTimeout(()=>{n.abort()},h),v=Math.floor(Math.random()*1e6),m=t?await t.getIdToken():null,d=s!==void 0&&r===void 0,x={...m&&{Authorization:`Bearer ${m}`}},f=d?s:r;let l=f;try{typeof FormData<"u"&&f instanceof FormData&&(l=Object.fromEntries(f.entries()))}catch{}try{const o=await U.get(K(c,v),{headers:x,signal:n.signal,params:l});return clearTimeout(u),o.data}catch(o){clearTimeout(u);const C=o.name==="CanceledError"||o.code==="ERR_CANCELED"||((p=o.message)==null?void 0:p.includes("aborted"))?"Request timed out. Please try again.":((w=(S=(g=o.response)==null?void 0:g.data)==null?void 0:S.error)==null?void 0:w.message)||((j=(R=o.response)==null?void 0:R.data)==null?void 0:j.message)||o.message||"Error during authentication or server request";throw{...o,message:C}}};function Y({refresh:t,page:c}){const[r,s]=i.useState(!1),[a,h]=i.useState(""),[n,u]=i.useState(!1),{preview:v,setPreview:m,raflPreviewVersion:d}=i.useContext(P),{version:x}=i.useContext(W),[f,l]=F(),p=f.has("preview"),g=v||p,S=z(x).valueOf()>z(d.version).valueOf(),w=i.useCallback(async()=>{const T=`${G}/refresh-preview`;try{s(!0);const C=await Q({url:T,snackBars:!1,timeoutDuration:3e4});I("Request successful",{variant:"success"}),h(C)}catch(C){I(`Error creating request: ${C.message}`,{variant:"error",autoHideDuration:3e3})}finally{s(!1)}await t()},[t]),R=i.useRef(null),j=i.useCallback(()=>{p?(f.delete("preview"),l(f),m(!1)):m(!v)},[v,p,f,m,l]);D("p",()=>j(),{preventDefault:!0});const o=g?"#983de6":"#fff";return e.jsxs(E.Fragment,{children:[c!=="pots"?e.jsx(B,{ref:R,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:e.jsx(b,{style:{padding:8},disabled:!0,children:e.jsx(k,{style:{color:o,opacity:.5},fontSize:"small"})})}):e.jsxs("div",{children:[e.jsx(B,{ref:R,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:g?e.jsx(O,{in:g,direction:"left",appear:!1,children:e.jsxs("div",{style:{display:"flex",flexGrow:1,marginRight:0},children:[e.jsx(y,{onClick:j,style:{padding:"0px 8px 0px 0px",marginRight:0,color:"#8830d3",fontSize:"1.0rem",lineHeight:"1.2rem",whiteSpace:"nowrap"},children:"PREVIEW MODE ON"}),r?e.jsx("div",{style:{marginRight:0},children:e.jsx(X,{diameter:36})}):e.jsx(A,{title:"Refresh From Sheet",arrow:!0,disableFocusListener:!0,children:e.jsx(b,{onClick:w,style:{marginRight:0},children:e.jsx($,{fontSize:"small"})})}),e.jsx(b,{onClick:j,style:{padding:8},children:e.jsx(k,{style:{color:o},fontSize:"small"})})]})}):e.jsx(A,{title:"Toggle Preview Mode",arrow:!0,disableFocusListener:!0,children:e.jsx(b,{onClick:j,style:{padding:8},children:e.jsx(k,{style:{color:o},fontSize:"small"})})})}),S&&g&&e.jsx("div",{style:{fontSize:"0.8rem",color:"#d33030"},children:"Preview version is older than latest import."})]}),(a==null?void 0:a.status)==="Errors"&&e.jsxs(Z,{expanded:n,onChange:()=>u(!n),sx:{".MuiAccordionSummary-content":{margin:0}},children:[e.jsx(J,{expandIcon:e.jsx(q,{}),style:{maxWidth:700,margin:"0px auto 10px auto",paddingLeft:20,fontWeight:700,fontSize:"1rem",backgroundColor:"#e34141"},children:"There were errors trying to import"}),e.jsx(_,{style:{maxWidth:700,margin:"20px auto 10px auto",padding:10,fontWeight:400,fontSize:"0.8rem",backgroundColor:"#e34141",display:"flex",alignItems:"center"},children:e.jsx("pre",{children:JSON.stringify(a,null,2)})})]})]})}function ee({page:t,width:c=700}){const{preview:r,setPreview:s,refresh:a}=i.useContext(P),[h,n]=F(),u=h.has("preview"),v=r||u,m=L(),{setAnimateTotal:d}=i.useContext(P),x=i.useCallback(w=>{m(w),d(!1)},[m,d]),f=i.useCallback(()=>{v&&t==="pots"&&(h.delete("preview"),n(h),s(!1))},[t,h,s,n,v]),{isMobile:l}=M(),p=l?"1.0rem":"1.03rem",g=!r||t!=="pots"||!l,S={maxWidth:c,marginLeft:"auto",marginRight:"auto",display:"flex",alignItems:"center",height:40};return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:S,children:[e.jsx(b,{style:{padding:4},onClick:f,disabled:t!=="pots",children:e.jsx(N,{fontSize:"medium",style:{color:"#4c82fd"}})}),g&&e.jsxs(E.Fragment,{children:[e.jsx(y,{onClick:()=>x("/rafl/admin"),style:{padding:"0px 8px",marginRight:10,marginLeft:10,color:t==="entries"?"#48adf1":"#ccc",fontSize:p},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="entries",children:"ENTRIES"}),e.jsx(y,{onClick:()=>x("/rafl/reports"),style:{padding:"0px 8px",marginRight:10,color:t==="reports"?"#48adf1":"#ccc",fontSize:p},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="reports",children:"REPORTS"})]}),e.jsx("div",{style:{display:"flex",flexGrow:1,justifyContent:"right"},children:e.jsx(Y,{page:t,refresh:a})})]}),e.jsx("div",{style:{height:2}})]})}function fe({page:t,width:c=700}){const{raflState:r,raffleAdminRole:s}=i.useContext(P),a=L(),{setAnimateTotal:h}=i.useContext(P),n=i.useCallback(g=>{a(g),h(!1)},[a,h]),{isMobile:u,flexStyle:v}=M(),m=u?0:4,d=u?"1.0rem":"1.03rem",x=u?3:10,f={maxWidth:c,marginLeft:"auto",marginRight:"auto",marginTop:10,padding:"0px 0px 0px 0px",fontWeight:700,display:v};let l=r!=="preview"||s||u?"PRIZES":"PRIZE PREVIEW";l=["hidden","post"].includes(r)?l.replace("PRIZES","2026 PRIZES"):l;const p=r==="live"||s?"ENTER":"INFO";return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:f,children:[e.jsx("div",{style:{flexGrow:1,fontSize:"1.7rem",marginTop:0},children:"LPU Annual Raffle"}),e.jsxs("div",{style:{marginTop:m,justifyItems:"right"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(y,{onClick:()=>n("/rafl"),style:{marginRight:x,color:t==="pots"?"#fff":"#ccc",fontSize:d},disabled:t==="pots",children:l}),r==="preview"&&!s&&e.jsx(y,{onClick:()=>n("/rafl/announce"),style:{marginRight:x,color:t==="announce"?"#fff":"#ccc",fontSize:d},disabled:t==="announce",children:"CONTRIBUTE"}),(r!=="hidden"||s)&&e.jsx(y,{onClick:()=>n("/rafl/charities"),style:{marginRight:x,color:t==="charities"?"#fff":"#ccc",fontSize:d},disabled:t==="charities",children:"CHARITIES"}),(["preview","live","post"].includes(r)||s)&&e.jsx(y,{onClick:()=>n("/rafl/enter"),style:{marginRight:0,color:t==="enter"?"#fff":"#ccc",fontSize:d},children:p}),(["live","post"].includes(r)||s)&&e.jsx(y,{onClick:()=>n("/rafl/stats"),style:{marginLeft:x,color:t==="stats"?"#fff":"#ccc",fontSize:d},children:"STATS"})]})]}),s&&e.jsx(ee,{page:t,width:c}),e.jsx("div",{style:{height:8}})]})}export{fe as R};
