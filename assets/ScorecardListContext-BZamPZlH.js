import{r as n,F as N,am as D,aK as k,g as A,a8 as $,j as U,ap as g,d as a,K as S,R as y}from"./index-DPWqEAft.js";import{D as H,f as L}from"./DataContext-h2GdFepW.js";import{r as T}from"./index-X42IpUmk.js";import{f as V}from"./filterEntriesAdvanced-B_LinbMH.js";function q({children:z,cardActivity:o,cardBBCount:p,cardDanPoints:d,cardEligibleDan:c,cardNextDanPoints:f,cardNextDanLocks:l,cardUniqueLocks:m,cardMaxBelt:E,popularLocks:x,popularLocksBB:v,profile:u,blackBeltScorecard:M}){const{filters:w,advancedFilterGroups:C}=n.useContext(N),{search:e,sort:t}=w,r=n.useMemo(()=>o.map(s=>{const b=D(s.matchId),R=k(s.matchId),Y=A(s.matchId),W=Y?"Belt":R?"Project":"Lock";return{...s,...b,...R,...Y,id:s.id,type:W}}),[o]),h=n.useMemo(()=>r.reduce((s,b)=>(s[b.matchId]=b,s),{}),[r]),i=n.useMemo(()=>x.map(s=>({...D(s.id),...h[s.id],popularityRank:s.rank,userCount:s.saveCount})),[x,h]),O=n.useMemo(()=>v==null?void 0:v.map(s=>({...D(s.id),...h[s.id],popularityRank:s.rank,userCount:s.saveCount})),[v,h]),{visibleEntries:I,searchedEntries:j}=n.useMemo(()=>G(r,e,t,u,C()),[r,e,t,u,C]),{visibleEntries:F}=n.useMemo(()=>G(i,e,"popular",u,!0),[i,u,e]),P=n.useMemo(()=>(u==null?void 0:u.blackBeltAwardedAt)>0,[u]),K=n.useMemo(()=>({allEntries:$,cardActivity:o,cardBBCount:p,cardDanPoints:d,cardEligibleDan:c,cardNextDanPoints:f,cardNextDanLocks:l,searchedEntries:j,visibleEntries:I,popularEntries:F,bbPopularEntries:O,cardUniqueLocks:m,cardMaxBelt:E,blackBeltUser:P,blackBeltScorecard:M,getEntryFromId:D,getProjectEntryFromId:k,getAwardEntryFromId:A}),[o,p,d,c,f,l,j,I,F,O,m,E,P,M]);return U.jsx(H.Provider,{value:K,children:z})}function G(z,o,p,d={},c,f=!1){const l=(d==null?void 0:d.userLockNotes)||{};let m=c;if(f){const e={_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"exceptionType",matchType:"Is",operator:"OR",values:[void 0]};m=[...c,e]}const E=z.map(e=>{var t,r,h;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:i})=>i),fuzzy:T(((r=e==null?void 0:e.makeModels)==null?void 0:r.map(({make:i,model:O})=>[i,O]).flat().filter(i=>i).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],content:[l[e.id]||l[e.matchId]?"Has Personal Notes":void 0].flat().filter(i=>i),scoring:[(()=>{switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}return"Worth Points"})()],simpleBelt:(h=e==null?void 0:e.belt)==null?void 0:h.replace(/\s\d/g,""),personalNotes:l[e.id]||l[e.matchId]}}),x=.3,v=e=>{const t=o&&e.find(r=>r.id===o);return t?[t]:o?L.go(T(o),e,{keys:["fuzzy"],threshold:-23e3}).map(r=>({...r.obj,score:r.score})).filter(r=>r.score>x):e},u=v(E),M=V({advancedFilterGroups:m,entries:E}),w=v([...M]),C=(()=>{switch(p){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||S(e.belt,t.belt)||a(t.date).valueOf()-a(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||g(e.belt,t.belt)||a(t.date).valueOf()-a(e.date).valueOf();case"dateAscending":return(e,t)=>a(e.date).valueOf()-a(t.date).valueOf()||g(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>a(t.date).valueOf()-a(e.date).valueOf()||g(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>S(e.belt,t.belt)||a(t.date).valueOf()-a(e.date).valueOf();case"beltDescending":return(e,t)=>g(e.belt,t.belt)||a(t.date).valueOf()-a(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>a(a(t.date).format("YYYY-MM-DD")).valueOf()-a(a(e.date).format("YYYY-MM-DD")).valueOf()||g(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return{visibleEntries:w.sort(C),searchedEntries:u}}const _=y.createContext({});function B({children:z}){const{filters:o,addFilters:p,removeFilters:d}=n.useContext(N),c=o.id,f=n.useCallback(m=>{m?p([{key:"id",value:m}],!0):d(["id"])},[p,d]),l=n.useMemo(()=>({expanded:c,setExpanded:f}),[c,f]);return U.jsx(_.Provider,{value:l,children:z})}export{_ as S,q as a,B as b};
