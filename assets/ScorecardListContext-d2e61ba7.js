import{r,aR as k,a$ as j,K as B,j as R,a1 as s,au as x,ag as L,R as w}from"./index-8cbae00a.js";import{F,D as T,r as D,f as y}from"./index-85fe30bf.js";function Y({children:v,cardEvidence:o,cardBBCount:n,cardDanPoints:u,cardEligibleDan:c,cardNextDanPoints:l,cardNextDanLocks:d,popularLocks:i}){const{filters:e}=r.useContext(F),{search:t,id:p,tab:O,name:m,sort:z,image:W,locks:G,...C}=e,g=r.useMemo(()=>o.map(a=>({...k(a.matchId),...a,...j(a.matchId),id:a.id})),[o]),E=r.useMemo(()=>g.reduce((a,f)=>(a[f.matchId]=f,a),{}),[g]),M=r.useMemo(()=>i.map(a=>({...k(a.lockID),...E[a.lockID],popularityRank:a.rank,userCount:a.count})),[i,E]),h=r.useMemo(()=>Object.keys(C).map(a=>{const f=C[a];return Array.isArray(f)?f.map(S=>({key:a,value:S})):{key:a,value:f}}).flat(),[C]),A=r.useMemo(()=>I(g,h,t,z),[g,h,t,z]),b=r.useMemo(()=>I(M,h.concat({key:"exceptionType",value:void 0}),t,"popular"),[M,h,t]),P=r.useMemo(()=>({allEntries:B,cardEvidence:o,cardBBCount:n,cardDanPoints:u,cardEligibleDan:c,cardNextDanPoints:l,cardNextDanLocks:d,visibleEntries:A,popularEntries:b,getEntryFromId:k,getProjectEntryFromId:j}),[o,n,u,c,l,d,A,b]);return R.jsx(T.Provider,{value:P,children:v})}function I(v,o,n,u){const l=v.map(e=>{var t,p,O;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:m})=>m),fuzzy:D(((p=e==null?void 0:e.makeModels)==null?void 0:p.map(({make:m,model:z})=>[m,z]).flat().filter(m=>m).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded";default:return["White","Yellow","Orange","Green"].includes(e.belt)?"Low Level":"Worth Points"}})()],simpleBelt:(O=e==null?void 0:e.belt)==null?void 0:O.replace(/\s\d/g,"")}}).filter(e=>o.every(({key:t,value:p})=>Array.isArray(e[t])?e[t].includes(p):e[t]===p)),d=n?y.go(D(n),l,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):l,i=(()=>{switch(u){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||s(t.date).valueOf()-s(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||s(t.date).valueOf()-s(e.date).valueOf();case"dateAscending":return(e,t)=>s(e.date).valueOf()-s(t.date).valueOf()||x(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>s(t.date).valueOf()-s(e.date).valueOf()||x(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>L(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"beltDescending":return(e,t)=>x(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>s(t.date).valueOf()-s(e.date).valueOf()||x(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return d.sort(i)}const U=w.createContext({});function $({children:v}){const{filters:o,addFilters:n,removeFilters:u}=r.useContext(F),c=o.id,l=r.useCallback(i=>{i?n([{key:"id",value:i}],!0):u(["id"])},[n,u]),d=r.useMemo(()=>({expanded:c,setExpanded:l}),[c,l]);return R.jsx(U.Provider,{value:d,children:v})}export{U as S,Y as a,$ as b};
