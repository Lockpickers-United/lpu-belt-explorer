import{j as e,X as I,r as i,a6 as W,ac as F,d as z,a5 as D,R as E,U as b,W as A,bs as O,B as v,b as L,u as M,bL as N}from"./index-Bi0D-MGF.js";import{R as P}from"./RaffleContext-Be4tPM1j.js";import{C as $}from"./Cached-2PHOgMa_.js";import{E as q}from"./ExpandMore-CduXgW6g.js";import{V as k}from"./AdminToolButtons-Dbb8wMsC.js";import{C as H,c as G}from"./CircularProgress-Dvc7iBgv.js";import{n as U}from"./dataUrls-DVxTtpO-.js";import{a as Z}from"./index-B9ygI19o.js";import{B}from"./Box-BNVWx4yu.js";import{A as V,a as J,b as _}from"./AccordionSummary-BpPJaGiQ.js";function X({diameter:t=40}){return e.jsx("div",{style:{display:"flex",placeItems:"center",justifyContent:"center",width:t,height:t},children:e.jsx(H,{variant:"indeterminate",disableShrink:!0,sx:{color:d=>(d.palette.mode==="light","#fff"),animationDuration:"550ms",[`& .${G.circle}`]:{strokeLinecap:"round"}},size:18,thickness:5})})}const K=(t,d)=>{const[r,s]=t.split("#"),l=r.includes("?")?"&":"?";return`${r}${l}${d}${s?"#"+s:""}`},Q=async({user:t,url:d,formData:r,json:s,snackBars:l,timeoutDuration:h=15e3})=>{var p,g,S,w,R,j;const n=new AbortController,u=setTimeout(()=>{n.abort()},h),y=Math.floor(Math.random()*1e6),m=t?await t.getIdToken():null,o=s!==void 0&&r===void 0,x={...m&&{Authorization:`Bearer ${m}`}},f=o?s:r;let c=f;try{typeof FormData<"u"&&f instanceof FormData&&(c=Object.fromEntries(f.entries()))}catch{}try{const a=await Z.get(K(d,y),{headers:x,signal:n.signal,params:c});return clearTimeout(u),a.data}catch(a){clearTimeout(u);const C=a.name==="CanceledError"||a.code==="ERR_CANCELED"||((p=a.message)==null?void 0:p.includes("aborted"))?"Request timed out. Please try again.":((w=(S=(g=a.response)==null?void 0:g.data)==null?void 0:S.error)==null?void 0:w.message)||((j=(R=a.response)==null?void 0:R.data)==null?void 0:j.message)||a.message||"Error during authentication or server request";throw{...a,message:C}}};function Y({refresh:t,page:d}){const[r,s]=i.useState(!1),[l,h]=i.useState(""),[n,u]=i.useState(!1),{preview:y,setPreview:m,raflPreviewVersion:o}=i.useContext(P),{version:x}=i.useContext(W),[f,c]=F(),p=f.has("preview"),g=y||p,S=z(x).valueOf()>z(o==null?void 0:o.version).valueOf(),w=i.useCallback(async()=>{const T=`${U}/refresh-preview`;try{s(!0);const C=await Q({url:T,snackBars:!1,timeoutDuration:3e4});I("Request successful",{variant:"success"}),h(C)}catch(C){I(`Error creating request: ${C.message}`,{variant:"error",autoHideDuration:3e3})}finally{s(!1)}await t()},[t]),R=i.useRef(null),j=i.useCallback(()=>{p?(f.delete("preview"),c(f),m(!1)):m(!y)},[y,p,f,m,c]);D("p",()=>j(),{preventDefault:!0});const a=g?"#983de6":"#fff";return e.jsxs(E.Fragment,{children:[d!=="pots"?e.jsx(B,{ref:R,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:e.jsx(b,{style:{padding:8},disabled:!0,children:e.jsx(k,{style:{color:a,opacity:.5},fontSize:"small"})})}):e.jsxs("div",{children:[e.jsx(B,{ref:R,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:g?e.jsx(O,{in:g,direction:"left",appear:!1,children:e.jsxs("div",{style:{display:"flex",flexGrow:1,marginRight:0},children:[e.jsx(v,{onClick:j,style:{padding:"0px 8px 0px 0px",marginRight:0,color:"#8830d3",fontSize:"1.0rem",lineHeight:"1.2rem",whiteSpace:"nowrap"},children:"PREVIEW MODE ON"}),r?e.jsx("div",{style:{marginRight:0},children:e.jsx(X,{diameter:36})}):e.jsx(A,{title:"Refresh From Sheet",arrow:!0,disableFocusListener:!0,children:e.jsx(b,{onClick:w,style:{marginRight:0},children:e.jsx($,{fontSize:"small"})})}),e.jsx(b,{onClick:j,style:{padding:8},children:e.jsx(k,{style:{color:a},fontSize:"small"})})]})}):e.jsx(A,{title:"Toggle Preview Mode",arrow:!0,disableFocusListener:!0,children:e.jsx(b,{onClick:j,style:{padding:8},children:e.jsx(k,{style:{color:a},fontSize:"small"})})})}),S&&g&&e.jsx("div",{style:{fontSize:"0.8rem",color:"#d33030"},children:"Preview version is older than latest import."})]}),(l==null?void 0:l.status)==="Errors"&&e.jsxs(V,{expanded:n,onChange:()=>u(!n),sx:{".MuiAccordionSummary-content":{margin:0}},children:[e.jsx(J,{expandIcon:e.jsx(q,{}),style:{maxWidth:700,margin:"0px auto 10px auto",paddingLeft:20,fontWeight:700,fontSize:"1rem",backgroundColor:"#e34141"},children:"There were errors trying to import"}),e.jsx(_,{style:{maxWidth:700,margin:"20px auto 10px auto",padding:10,fontWeight:400,fontSize:"0.8rem",backgroundColor:"#e34141",display:"flex",alignItems:"center"},children:e.jsx("pre",{children:JSON.stringify(l,null,2)})})]})]})}function ee({page:t,width:d=700}){const{preview:r,setPreview:s,refresh:l}=i.useContext(P),[h,n]=F(),u=h.has("preview"),y=r||u,m=L(),{setAnimateTotal:o}=i.useContext(P),x=i.useCallback(w=>{m(w),o(!1)},[m,o]),f=i.useCallback(()=>{y&&t==="pots"&&(h.delete("preview"),n(h),s(!1))},[t,h,s,n,y]),{isMobile:c}=M(),p=c?"1.0rem":"1.03rem",g=!r||t!=="pots"||!c,S={maxWidth:d,marginLeft:"auto",marginRight:"auto",display:"flex",alignItems:"center",height:40};return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:S,children:[e.jsx(b,{style:{padding:4},onClick:f,disabled:t!=="pots",children:e.jsx(N,{fontSize:"medium",style:{color:"#4c82fd"}})}),g&&e.jsxs(E.Fragment,{children:[e.jsx(v,{onClick:()=>x("/rafl/admin"),style:{padding:"0px 8px",marginRight:10,marginLeft:10,color:t==="entries"?"#48adf1":"#ccc",fontSize:p},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="entries",children:"ENTRIES"}),e.jsx(v,{onClick:()=>x("/rafl/reports"),style:{padding:"0px 8px",marginRight:10,color:t==="reports"?"#48adf1":"#ccc",fontSize:p},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="reports",children:"REPORTS"})]}),e.jsx("div",{style:{display:"flex",flexGrow:1,justifyContent:"right"},children:e.jsx(Y,{page:t,refresh:l})})]}),e.jsx("div",{style:{height:2}})]})}function fe({page:t,width:d=700}){const{raflState:r,raffleAdminRole:s}=i.useContext(P),l=L(),{setAnimateTotal:h}=i.useContext(P),n=i.useCallback(g=>{l(g),h(!1)},[l,h]),{isMobile:u,flexStyle:y}=M(),m=u?0:4,o=u?"1.0rem":"1.03rem",x=u?3:10,f={maxWidth:d,marginLeft:"auto",marginRight:"auto",marginTop:10,padding:"0px 0px 0px 0px",fontWeight:700,display:y};let c=r!=="preview"||s||u?"PRIZES":"PRIZE PREVIEW";c=["hidden","post"].includes(r)?c.replace("PRIZES","2026 PRIZES"):c;const p=r==="live"||s?"ENTER":"INFO";return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:f,children:[e.jsx("div",{style:{flexGrow:1,fontSize:"1.7rem",marginTop:0},children:"LPU Annual Raffle"}),e.jsxs("div",{style:{marginTop:m,justifyItems:"right"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(v,{onClick:()=>n("/rafl"),style:{marginRight:x,color:t==="pots"?"#fff":"#ccc",fontSize:o},disabled:t==="pots",children:c}),r==="preview"&&!s&&e.jsx(v,{onClick:()=>n("/rafl/announce"),style:{marginRight:x,color:t==="announce"?"#fff":"#ccc",fontSize:o},disabled:t==="announce",children:"CONTRIBUTE"}),(r!=="hidden"||s)&&e.jsx(v,{onClick:()=>n("/rafl/charities"),style:{marginRight:x,color:t==="charities"?"#fff":"#ccc",fontSize:o},disabled:t==="charities",children:"CHARITIES"}),(["preview","live","post"].includes(r)||s)&&e.jsx(v,{onClick:()=>n("/rafl/enter"),style:{marginRight:0,color:t==="enter"?"#fff":"#ccc",fontSize:o},children:p}),(["live","post"].includes(r)||s)&&e.jsx(v,{onClick:()=>n("/rafl/stats"),style:{marginLeft:x,color:t==="stats"?"#fff":"#ccc",fontSize:o},children:"STATS"})]})]}),s&&e.jsx(ee,{page:t,width:d}),e.jsx("div",{style:{height:8}})]})}export{fe as R};
