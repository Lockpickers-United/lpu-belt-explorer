import{r as c,F as O,aA as P,aq as F,d as u,K as k,ap as H,j as R}from"./index-CosfVxRU.js";import{D as w,f as L}from"./DataContext-uUSG9Nz8.js";import{r as N}from"./index-D5S-eh1o.js";import{c as K}from"./collectionStatsById-DY1NVZ7h.js";import{u as V}from"./useData-BLNLoEWB.js";import{h as W}from"./dataUrls-DkJe4Pqg.js";import{f as q}from"./filterEntries-BBFZIbGW.js";function ae({children:E,allEntries:i,profile:l}){const{filters:S}=c.useContext(O),{search:m,id:Q,tab:r,name:T,sort:d,image:X,expandAll:h,...v}=S,{data:b,loading:M,error:B}=V({urls:J}),p=c.useMemo(()=>b&&!M&&!B?b.lockbazzarEntryIds:[],[b,B,M]),n=c.useMemo(()=>{const s=(l==null?void 0:l.userLockNotes)||{};return i.map(e=>{var t,a,D;return{...e,makes:e.makeModels[0].make?e.makeModels.map(({make:o})=>o):e.makeModels[0].model,fuzzy:N(e.makeModels.map(({make:o,model:I})=>[o,I]).flat().filter(o=>o).concat([e.version,e.notes,e.belt]).join(",")),content:[(t=e.media)!=null&&t.some(o=>!o.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(a=e.media)!=null&&a.some(o=>o.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((D=e.links)==null?void 0:D.length)>0?"Has Links":"No Links",F[e.belt].danPoints>0?"Worth Dan Points":void 0,u(e.lastUpdated).isAfter(u().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,s[e.id]?"Has Personal Notes":void 0].flat().filter(o=>o),collection:P.locks.map.map(o=>l&&l[o.key]&&l[o.key].includes(e.id)?o.label:"Not "+o.label),collectionSaves:K[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:s[e.id]}})},[i,l]),f=c.useCallback(s=>{const e=m&&s.find(t=>t.id===m);return e?[e]:m?L.go(N(m),s,{keys:G,threshold:-23e3}).map(t=>({...t.obj,score:t.score})).filter(t=>t.score>.23):s},[m]),g=c.useMemo(()=>r==="search"||!r?f(n):f(n).filter(s=>s.simpleBelt===r),[n,f,r]),z=c.useMemo(()=>{const s=q(v,n),e=f([...s]);return d?e.sort((t,a)=>{if(d==="popularity")return a.collectionSaves-t.collectionSaves||a.views-t.views||t.fuzzy.localeCompare(a.fuzzy);if(d==="beltAscending")return k(t.belt,a.belt);if(d==="beltDescending")return H(t.belt,a.belt);if(d==="alphaAscending")return t.fuzzy.localeCompare(a.fuzzy);if(d==="alphaDescending")return a.fuzzy.localeCompare(t.fuzzy);if(d==="recentlyUpdated")return Math.floor(u(a.lastUpdated).valueOf()/3600)-Math.floor(u(t.lastUpdated).valueOf()/3600)||k(t.belt,a.belt)||t.fuzzy.localeCompare(a.fuzzy);if(d==="dateAdded")return Math.floor(u(a.dateAdded).valueOf()/3600*24)-Math.floor(u(t.dateAdded).valueOf()/3600*24)||k(t.belt,a.belt)||t.fuzzy.localeCompare(a.fuzzy)}):e},[v,n,f,d]),A=c.useCallback(s=>i.find(e=>e.id===s),[i]),C=c.useMemo(()=>r==="search"||!r?n:n.filter(s=>s.simpleBelt===r),[r,n]),x=c.useMemo(()=>r==="search"||!r?z:z.filter(s=>s.simpleBelt===r),[r,z]),U=c.useCallback(s=>p==null?void 0:p.includes(s),[p]),y=c.useMemo(()=>(l==null?void 0:l.blackBeltAwardedAt)>0,[l]),j=c.useMemo(()=>({allEntries:i,mappedEntries:n,searchedBeltEntries:g,visibleEntries:z,mappedBeltEntries:C,visibleBeltEntries:x,getEntryFromId:A,expandAll:h,profile:l,blackBeltUser:y,lockbazzarAvailable:U}),[i,n,g,z,C,x,A,h,l,y,U]);return R.jsx(w.Provider,{value:j,children:E})}const G=["fuzzy"],J={lockbazzarEntryIds:W};export{ae as D};
