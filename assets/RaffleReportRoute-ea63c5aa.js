import{d as P,u as R,j as t,R as L,b as U,r as u,A as E,N as $,F as X,T as _}from"./index-0afbd37d.js";import{D as J,a as K,r as Q}from"./filterFields-906b4a0b.js";import{L as Z}from"./LoadingDisplay-d561350b.js";import{u as tt}from"./useData-9b9fa331.js";import{u as et}from"./usePageTitle-218beea3.js";import{s as ot,g as nt}from"./dataUrls-f163a2c2.js";import{P as I}from"./nivo-line.es-37246e95.js";import{p as H}from"./adminChartDefaults-e02caa29.js";import{A as it}from"./AdminStatsTable-1f734823.js";import{A as N}from"./AdminStatsTableSort-0b4aad69.js";import{R as st}from"./RaffleAutocompleteBox-9326cdda.js";import{L as rt}from"./Link-2fc13bbd.js";import{R as W,s as k,A as at}from"./AdminRoleButton-efd574c8.js";import{R as lt}from"./RaffleStatsHeader-69d3d88d.js";import{C as ct}from"./ChoiceButtonGroup-81ba50d9.js";import{B as dt}from"./nivo-bar.es-3dec16b8.js";import{p as mt}from"./chartDefaults-9fc07b21.js";import{R as ut}from"./ReportButton-97e49828.js";import{R as xt}from"./RaffleDataProvider-1efce2f8.js";import"./LPU-c3fa7122.js";import"./LinearProgress-a3333e79.js";import"./useDocumentTitle-ca292ca6.js";import"./nivo-legends.es-a1f80b78.js";import"./index-7e0801f5.js";import"./TableRow-07d064f6.js";import"./Search-d6db6ab3.js";import"./Autocomplete-8fb8bf7f.js";import"./Select-e53a9a4b.js";import"./Chip-00d4fb0f.js";import"./TextField-d89de1dc.js";import"./index-37a4e525.js";import"./ToggleButtonGroup-02cb2311.js";const ft=({lineData:o})=>{const l=[o.rafl28days.data],r=[],n=new Map,e=new Map,s=new Map;l.forEach(m=>{const y=[],g=[],T=[];for(let w=0;w<m.length;w++){let p=m[w].date;if(P(p)<P("2024-11-25"))continue;p=p+" 23:59:59";const x=new Map;x.x=p,x.y=m[w].potListViews,y.push(x);const j=new Map;j.x=p,j.y=m[w].potViews,g.push(j);const F=new Map;F.x=p,F.y=m[w].raflForm,T.push(F)}n.id="Pot List",n.data=y,e.id="Pot Views",e.data=g,s.id="Entry Form",s.data=T,r.push(e),r.push(n),r.push(s)});const{width:i}=R(),d=i<=360,b=i<=395,h=i<=428,D=i<=560,S=i<=820,f=d||b?200:h?210:S?230:350,v=D?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:f,width:"100%"},children:t.jsx(I,{theme:H,data:r,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:v,height:f,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function ht({data:o}){const{width:l}=R(),r=l<=560,s={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...r?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:s,children:t.jsx(ft,{lineData:o})})})})}const pt=({data:o})=>{const{rafl28days:l}=o,r=l.data.filter(m=>P(m.date)>P("2024-11-27")),n=r.reduce((m,y)=>(Object.keys(l.data[l.data.length-1]).map(g=>{["date","dateString"].includes(g)||(m[g]=m[g]?m[g]+y[g]:y[g])}),m),{});n.dateString="Total",r.push(n);const e=Object.keys(n).reduce((m,y)=>(m[y]=Math.floor(n[y]/r.length),m),{});e.dateString="Average",r.push(e);const s={columns:l.columns,data:r},{width:i}=R(),d=i<=360,b=i<=395,h=i<=428,D=i<=560,S=i<=820,f=d?".8rem":b?".85rem":h?".9rem":".95rem",v="100%";return t.jsx(it,{tableData:s,tableWidth:v,fontSize:f})},gt=({data:o})=>{const l=U(),{potViewsById:r}=o,{getPotFromId:n}=u.useContext(J),e=[{name:"Pot #",align:"center",id:"potNumber"},{name:"ID",align:"center",id:"id"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],s=!0,[i,d]=u.useState("potNumber"),[b,h]=u.useState(!0),[D,S]=u.useState({}),f=r.data.map(a=>{var M,z;const c=n(a.id);if(!c)return null;let C=c!=null&&c.title?c.title.substring(0,32):`unknown (${a.id})`;C=((M=c==null?void 0:c.title)==null?void 0:M.length)<32||!(c!=null&&c.title)?C:C+"...";const B=(z=a==null?void 0:a.id)==null?void 0:z.replace("2025-","");return{...a,percentViews:Math.floor(a.percentViews*100)+"%",...c,title:C,id:B}}).filter(a=>a).sort((a,c)=>{switch(i){case"potNumber":return a.potNumber-c.potNumber||a.title.localeCompare(c.title);case"id":return a[i].localeCompare(c[i]);case"title":return a[i].localeCompare(c[i]);case"donors":return parseInt(c[i])-parseInt(a[i])||a.title.localeCompare(c.title);case"percentViews":return parseInt(c[i])-parseInt(a[i])||a.views-c.views;default:return parseInt(c[i])-parseInt(a[i])||a.title.localeCompare(c.title)}}),v=b?f:f.reverse(),y=(Object.keys(D).length>0?[v==null?void 0:v.find(a=>a.title===D.itemTitle)]:v||[]).map(a=>a.donors&&a.donors>0?{...a}:{...a,donors:0,tickets:0}),g={columns:e,data:y},T=u.useCallback((a,c)=>{const C=f.find(M=>M.title===c),B=C==null?void 0:C.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return a==="title"?t.jsx(rt,{onClick:()=>l(`/rafl/?id=${C.id}&name=${B}`),style:{color:"#fff"},children:c}):c},[l,f]),w=u.useCallback(a=>a!=null&&a.title?a.title:"unknown",[]),{width:p}=R(),x=p<=360,j=p<=395,F=p<=428,O=p<=560,Y=p<=820,q=x?".8rem":j?".85rem":F?".9rem":".95rem",G="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(st,{allItems:f,setItemDetails:S,getOptionTitle:w,searchText:"Search Pots"})})}),t.jsx(N,{tableData:g,tableWidth:G,fontSize:q,sortable:s,sort:i,setSort:d,ascending:b,setAscending:h,linkFunction:T})]})},yt=()=>{const{allCharities:o}=u.useContext(W),l=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],r=!0,[n,e]=u.useState("name"),[s,i]=u.useState(!0),d=o.sort((x,j)=>{switch(n){case"name":return x.name.localeCompare(j.name);case"donors":return j[n]-x[n];case"donations":return j[n]-x[n];default:return x.name.localeCompare(j.name)}}),h=(s?d:d.reverse()).map(x=>x.donations&&x.donations>0?{...x,donations:`$${x.donations}`}:{...x}),D={columns:l,data:h},S=u.useCallback((x,j)=>j,[]),{width:f}=R(),v=f<=360,m=f<=395,y=f<=428,g=f<=560,T=f<=820,w=v?".8rem":m?".85rem":y?".9rem":".95rem",p="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(N,{tableData:D,tableWidth:p,fontSize:w,sortable:r,sort:n,setSort:e,ascending:s,setAscending:i,linkFunction:S})]})};function A({chartHeight:o,chartdata:l,showAxisBottom:r,colors:n,tickValues:e,curve:s}){const i=r?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},d=r?"bottom":"top-left",b=r?70:20,h=r?0:20;return t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(I,{theme:H,data:l,enableGridX:!1,enableGridY:!1,colors:n,lineWidth:3,margin:i,height:o,curve:s??"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:e||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:r?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:r?[]:[{anchor:d,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:h,translateY:b,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const jt=({data:o})=>{const l=Object.keys(o).sort((e,s)=>e.localeCompare(s)).reduce((e,s)=>{const i=s+" 23:59:59";return e.donorsCum=e.donorsCum+o[s].totalDonors||o[s].totalDonors,k(e,["totalDonors"],{x:i,y:o[s].totalDonorCountUnique}),k(e,["cumulativeDonors"],{x:i,y:o[s].cumDonorsUnique}),e.donationsCum=e.donationsCum+o[s].totalDonations||o[s].totalDonations,k(e,["totalDonations"],{x:i,y:o[s].totalDonations}),k(e,["cumulativeDonations"],{x:i,y:e.donationsCum}),e},[]),r={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},n=120;return Object.keys(o).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:r,children:"Donations"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donations Cumulative",data:l.cumulativeDonations}],chartHeight:n,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donations",data:l.totalDonations}],chartHeight:n,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:r,children:"Unique Donors"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donors Cumulative",data:l.cumulativeDonors}],chartHeight:n,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"Donors",data:l.totalDonors}],chartHeight:n,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},bt=({beltDistribution:o})=>{const{width:l}=R(),r=l<500,n=250,e=r?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},s=r?-45:0,i=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:n},children:t.jsx(dt,{data:o,maxValue:"auto",margin:e,padding:.15,colors:d=>i[d.index%i.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:s},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:mt,isInteractive:!1})})};function Dt({data:o}){const l=u.useMemo(()=>V.map(d=>({value:o.beltDonations[d]?o.beltDonations[d]/o.totalDonations:0,id:d,label:d})),[o]),r=u.useMemo(()=>V.map(d=>({value:o.beltDonorCountUnique[d]?o.beltDonorCountUnique[d]/o.totalDonorCountUnique:0,id:d,label:d})),[o]),n=u.useMemo(()=>[{label:"Donations",data:l},{label:"Donors",data:r}],[l,r]),[e,s]=u.useState(n[0]),i=u.useCallback(d=>s(d),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ct,{options:n,onChange:i}),t.jsx(bt,{beltDistribution:e.data})]})}const V=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"],vt=({data:o})=>{const l=Object.keys(o).sort((e,s)=>e.localeCompare(s)).reduce((e,s)=>{const i=s+" 23:59:59";return e.donorsCum=e.donorsCum+o[s].totalDonors||o[s].totalDonors,k(e,["totalDonors"],{x:i,y:o[s].totalDonorCountUnique}),k(e,["cumulativeDonors"],{x:i,y:o[s].cumDonorsUnique}),e.donationsCum=e.donationsCum+o[s].totalDonations||o[s].totalDonations,k(e,["totalDonations"],{x:i,y:o[s].totalDonations}),k(e,["cumulativeDonations"],{x:i,y:e.donationsCum}),e},[]),r={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},n=300;return Object.keys(o).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:r,children:"YOY"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(A,{chartdata:[{id:"2025",data:l.cumulativeDonations},{id:"2024",data:wt}],chartHeight:n,showAxisBottom:!0,colors:["#4fa720","#777"],tickValues:5})})]})},wt=[{x:"2025-01-01 23:59:59",y:901},{x:"2025-01-02 23:59:59",y:1336},{x:"2025-01-03 23:59:59",y:1536},{x:"2025-01-04 23:59:59",y:1798},{x:"2025-01-05 23:59:59",y:2948},{x:"2025-01-06 23:59:59",y:2948},{x:"2025-01-07 23:59:59",y:3766},{x:"2025-01-08 23:59:59",y:4446},{x:"2025-01-09 23:59:59",y:4846},{x:"2025-01-10 23:59:59",y:5230},{x:"2025-01-11 23:59:59",y:5480},{x:"2025-01-12 23:59:59",y:5681},{x:"2025-01-13 23:59:59",y:5952},{x:"2025-01-14 23:59:59",y:6157},{x:"2025-01-15 23:59:59",y:6217},{x:"2025-01-16 23:59:59",y:6283},{x:"2025-01-17 23:59:59",y:6288},{x:"2025-01-18 23:59:59",y:6848},{x:"2025-01-19 23:59:59",y:6998},{x:"2025-01-20 23:59:59",y:7201},{x:"2025-01-21 23:59:59",y:7975},{x:"2025-01-22 23:59:59",y:10897},{x:"2025-01-23 23:59:59",y:12055},{x:"2025-01-24 23:59:59",y:14413},{x:"2025-01-25 23:59:59",y:15133},{x:"2025-01-26 23:59:59",y:16728},{x:"2025-01-27 23:59:59",y:17209},{x:"2025-01-28 23:59:59",y:21677},{x:"2025-01-29 23:59:59",y:28598},{x:"2025-01-30 23:59:59",y:30012},{x:"2025-01-31 23:59:59",y:33701}];function St(){et("RAFL Report");const{data:o,loading:l,error:r}=tt({urls:Ct}),{siteFullNew:n,raflResponseDetails:e}=o||{},{width:s}=R(),d=s<560?"8px 8px 32px 8px":"24px 24px 32px 24px",b={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},h={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},D=b,S=l?"--":"(updated: "+P(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return l?t.jsx(Z,{}):r?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:d,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:D,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:S})]}),t.jsx(lt,{}),t.jsx("div",{style:{height:20}}),t.jsx(ht,{data:n}),t.jsx("div",{style:h,children:"Totals Over Time"}),t.jsx(jt,{data:e==null?void 0:e.detailedData}),t.jsx(vt,{data:e==null?void 0:e.detailedData}),t.jsx("div",{style:h,children:"Belt Distribution"}),t.jsx(Dt,{data:e==null?void 0:e.summaryData}),t.jsx("div",{style:h,children:"Page Tracking"}),t.jsx(pt,{data:n}),t.jsx("div",{style:h,children:"Pot Details"}),t.jsx(gt,{data:n}),t.jsx("div",{style:h,children:"Charity Details"}),t.jsx(yt,{data:n})]})}const Ct={siteFullNew:ot,raflResponseDetails:nt};function ie(){const{authLoaded:o}=u.useContext(E),{isMobile:l}=R(),{allPots:r}=u.useContext(W),{raffleAdmin:n}=u.useContext(W),e=t.jsxs(L.Fragment,{children:[!l&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(ut,{active:!0}),t.jsx(at,{})]});return t.jsx(K,{filterFields:Q,children:t.jsx(xt,{allEntries:r,children:t.jsxs(L.Fragment,{children:[t.jsx($,{title:"RAFL Report",extras:e}),o&&n&&t.jsx(St,{}),t.jsx(X,{}),t.jsx(_,{feature:"raflReport"})]})})})}export{ie as default};
