import{r as o,A as j,D as v,bB as R,bC as b,bD as h,bE as D,j as t,R as E,a1 as q,e as B,N as k,B as F,aE as N,h as S,bF as A,bG as C}from"./index-949896f0.js";import{L}from"./LoadingDisplay-17f3988c.js";import{D as M}from"./LockDataProvider-9a681939.js";import{a as w}from"./rankingRequestData-d3ef79e5.js";import{p as P,c as I}from"./postData-12886ed1.js";import"./Box-152b7355.js";import"./CircularProgress-e96f0282.js";import"./DataContext-8ec0965c.js";import"./index-5db7ba6c.js";import"./collectionStatsById-8def94ca.js";import"./useData-d7807b0d.js";import"./dataUrls-46e31bfb.js";import"./axios-3a665b0f.js";async function O({activityData:i}){const r=`${w}/log-activity`,e=!1,u=JSON.stringify({activityData:i});try{return await P({url:r,json:u,snackBars:e})}catch(c){throw console.error(I(c)),c}}function Z(){const{authLoaded:i,isLoggedIn:r}=o.useContext(j),{lockCollection:e}=o.useContext(v),[u,c]=o.useState([]),p=o.useRef(0);o.useEffect(()=>{const n=R(h(A,"ranking-requests"),b("requestStatus","!=","Deleted")),x=r?D(n,m=>{const l=m.docs.length;p.current+=l;const f=[{activity:"READ",activityCount:l,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName}];p.current>l&&f.push({activity:"REFRESH",activityCount:l,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName,prod:!C}),O({activityData:f}),c(g=>{const d=new Map(g.map(s=>[s.id,s]));return m.docChanges().forEach(s=>{const a={id:s.doc.id,...s.doc.data()};s.type==="added"?d.has(a.id)||d.set(a.id,a):s.type==="modified"?d.set(a.id,a):s.type==="removed"&&d.delete(a.id)}),Array.from(d.values())})},m=>{console.error("Error getting ranking requests from DB:",m)}):()=>{};return()=>x()},[r]);const y=o.useMemo(()=>u.filter(n=>n.makeModels&&n.makeModels[0].make&&n.makeModels[0].model),[u]);return t.jsxs(E.Fragment,{children:[!i&&t.jsx(L,{}),i&&r&&t.jsx(q,{context:y}),i&&!r&&t.jsx(B,{children:t.jsxs(M,{allEntries:[],children:[t.jsx(k,{title:"Please Sign In"}),t.jsx("div",{style:{maxWidth:700,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:46,marginBottom:46},children:t.jsxs("div",{style:{textAlign:"center",marginTop:40},children:["We're sorry, you must be signed in to request locks.",t.jsx("br",{}),t.jsx("br",{}),t.jsx(F,{style:{color:"#fff"},children:t.jsx(N,{})})]})})]})}),t.jsx(S,{})]})}export{Z as default};
