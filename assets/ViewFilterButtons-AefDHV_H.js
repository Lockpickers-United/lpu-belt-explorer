import{P as Re,Q as Te,U as De,V as Ie,r as t,F as N,u as q,j as e,a2 as re,R as J,I as Q,am as G,K as $,B as E,L as be,D as Me,a1 as ae,ah as Ne,aq as fe,A as Ce,$ as ye,bc as je,X as ze,a0 as ve}from"./index-Jkc3F5C3.js";import{B as ce,S as We}from"./Sort-B_h9jIhg.js";import{f as me,F as ke,a as Ee,C as Ae}from"./FilterAlt-cZI8ddg-.js";import{L as de}from"./LockListContext-C1IJrdXH.js";import{T as Fe,a as le}from"./ToggleButtonGroup-BVpJpxz5.js";import{B as ue}from"./Box-0ydYupt9.js";import{D as Se}from"./DataContext-CHgYj0K7.js";import{H as pe}from"./HighlightOff-nlCwghYB.js";import{s as xe}from"./setDeep-J6HEwWhX.js";import{A as Ge}from"./AddCircle-DRynykaD.js";import{F as $e,I as qe,S as _e}from"./Select-2PFlhjbk.js";import{C as He}from"./Cancel-DnKIewpy.js";const te=({advancedFilterGroups:d,entries:c,groupIndex:f,valueIndex:m})=>{if(!c||c.length===0)return[];const r=Array.isArray(d)?d:[];if(r.length===0||f<0)return c;const i=l=>{if(!l||!l.fieldName)return null;const o=l.fieldName,n=Array.isArray(l.values)?l.values.filter(s=>s!=null&&String(s).length):[];if(n.length===0)return null;const C=(l.operator||"AND").toUpperCase()==="OR"?"OR":"AND",u=(l.matchType||"Is").toLowerCase()==="is not";return{fieldName:o,values:n,operator:C,negative:u}};let a=r.map(i).filter(Boolean);if(a.length===0)return c;if(Number.isFinite(f)&&f>=0&&(a=a.slice(0,Math.min(f+1,a.length))),a.length>0&&Number.isFinite(m)&&m>=0){const l=a.length-1,o=a[l];Array.isArray(o.values)&&o.values.length>0&&(o.values=o.values.slice(0,Math.min(m+1,o.values.length)))}return c.filter(l=>a.every(({fieldName:o,values:n,operator:C,negative:u})=>{const s=l[o],p=x=>Array.isArray(s)?s.includes(x):s===x,v=n.some(x=>p(x)),h=n.every(x=>p(x)),S=C==="OR"?v:h;return u?!S:S}))};var P={},ge;function Ve(){if(ge)return P;ge=1;var d=Re();Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var c=d(Te()),f=De();return P.default=(0,c.default)((0,f.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline"),P}var Ue=Ve();const Ke=Ie(Ue);function Pe({label:d,active:c=!1,group:f,operator:m,valueIndex:r,currentValue:i,onFilter:a,onRemove:l,handleAddValue:o,sort:n,size:C="medium",context:u}){if(!d||d.length===0)return null;const{searchedBeltEntries:s,visibleEntries:p,visibleBeltEntries:v}=t.useContext(Se),{advancedFilterGroups:h,setAdvancedFilterGroups:S}=t.useContext(N),{fieldName:x,groupIndex:w,matchType:F,values:B=[]}=f;[...h()];let T=Array.isArray(B)?B.filter(b=>b&&String(b).length>0).join(m==="OR"?" OR ":" AND "):B;T=F==="Is Not"?`NOT ${T}`:T;const M=t.useMemo(()=>{if(c){if(w===0&&(!r||r===0))return s;if(w>0&&(!r||r===0)||r>0&&m==="OR")return te({advancedFilterGroups:h(),entries:s,groupIndex:w-1,valueIndex:99});if(r>0&&m==="AND")return te({advancedFilterGroups:h(),entries:s,groupIndex:w,valueIndex:r-1})}else return s;return[]},[c,w,r,m,s,h]),{options:_,counts:z}=t.useMemo(()=>{const b=M.reduce((k,A)=>(Array.isArray(A[x])?A[x].forEach(he=>{xe(k,[he],A.id)}):xe(k,[A[x]],A.id),k),{});let L=u==="drawer"?Array.from(new Set([...Object.keys(b),i,T])):Array.from(new Set([...Object.keys(b),i]));L=L.filter(k=>k&&String(k).length>0&&k!=="undefined");const V=L.sort((k,A)=>{if(n)return n(k,A);if(typeof k=="string"&&typeof A=="string")return k.localeCompare(A);if(Number.isInteger(k)&&Number.isInteger(A))return k-A});return{counts:V.reduce((k,A)=>{if(A==="no more options")return k[A]=0,k;const Oe=h().map((U,Be)=>{if(Be!==w)return U;if((U.operator||m)==="OR")return{...U,values:[A]};const K=Array.isArray(B)?[...B]:[];typeof r=="number"?K.length===0?K.push(A):K[r]=A:K.push(A);const Le=K.filter(ie=>ie!=null&&String(ie).length>0);return{...U,values:Le}});let ee;return c?ee=te({advancedFilterGroups:Oe.slice(0,w+1),entries:s}):ee=te({advancedFilterGroups:[{fieldName:x,matchType:F,operator:"OR",values:[A]}],entries:v,groupIndex:0}),k[A]=Array.isArray(ee)?ee.length:0,k},{}),options:V}},[M,u,i,T,x,n,h,c,w,m,B,r,F,v,s]),H=Array.isArray(B)?B.filter((b,L)=>L!==r):[];let D=_.filter(b=>z[b]>0&&(b!==i||b!==T||z[b]!==p.length)||b===i||b===T).filter(b=>!H.includes(b));D.length===0&&(D=["no more options"]);const g=D.length===1&&D[0]==="no more options",[j,y]=t.useState(!1),R=t.useCallback(b=>{y(!1);const L=b.target.value;L!=="no more options"&&(setTimeout(()=>a&&a(L),0),setTimeout(()=>document.activeElement.blur()))},[a]),O=t.useCallback(()=>{y(!1),setTimeout(()=>document.activeElement.blur())},[]),I=t.useCallback(()=>y(!0),[]),X=t.useCallback(()=>{let L=h().filter((V,Z)=>Z!==w);L.length===0&&(L=[{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),S(L)},[h,w,S]),se=t.useCallback(()=>{l&&l()},[l]),ne=u==="drawer"?18:12,oe=u!=="drawer"?{backgroundColor:i.length>0?"#333":void 0}:F==="Is Not"?{backgroundColor:i.length>0?"#642c2c":void 0}:{backgroundColor:i.length>0?"#555":void 0},{isMobile:Y}=q(),W=Y||u==="drawer"?210:250;return e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:ne},children:[(D==null?void 0:D.length)===0||(x==null?void 0:x.length)===0?null:e.jsxs($e,{style:{minWidth:W,marginBottom:0,marginRight:4},size:C==="small"?"small":"medium",fullWidth:!0,children:[e.jsx(qe,{id:`filter-${x}`,color:"secondary",style:{opacity:g?.5:1},children:d}),e.jsx(_e,{label:d,labelId:`filter-${x}`,value:g?"no more options":u==="drawer"?T:i,disabled:g,onChange:R,style:{...oe,opacity:g?.5:1},color:"secondary",open:j,onClose:O,onOpen:I,onBlur:O,children:D.map((b,L)=>{const V=z[b]||0,Z=["AND","OR"].some(k=>b.includes(k));return e.jsx(re,{value:b,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[e.jsx("div",{style:{maxWidth:160,overflow:"hidden",textOverflow:"ellipsis"},children:me[b]?me[b]:b}),e.jsx("div",{style:{fontSize:"0.8rem",marginLeft:8,opacity:.85},children:g||Z?"":V})]})},`${b}-${L}`)})})]}),u!=="drawer"&&e.jsxs(J.Fragment,{children:[r===0&&i.length>0&&e.jsx(Q,{"aria-label":"add filter group",onClick:o,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(Ge,{fontSize:"small",style:{color:"#5d854f"}})}),(i.length>0||r>0)&&e.jsx(Q,{"aria-label":"remove filter value",onClick:se,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(pe,{fontSize:"small",style:{color:"#d04e4e"}})}),(!r||r===0)&&x&&e.jsx(Q,{"aria-label":"remove filter group",onClick:X,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(Ke,{fontSize:"small",style:{color:"#eee"}})})]}),(i.length>0||r>0)&&u==="drawer"&&e.jsx(Q,{"aria-label":"remove filter value",onClick:X,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(pe,{fontSize:"small",style:{color:"#d04e4e"}})})]})}function Qe({style:d={}}){const{filters:c,addFilter:f,removeFilters:m}=t.useContext(N),{tab:r}=t.useContext(de),{belt:i}=c,a=/\/locks/.test(location.hash),l=t.useMemo(()=>r||i||"White",[i,r]),o=t.useMemo(()=>l!=="search"?"belt":"all",[l]),[n,C]=t.useState(l);l!==n&&l!=="search"?C(l):o==="belt"&&l==="search"&&C("search");const u=t.useCallback(h=>()=>{h==="all"?f("tab","search",!0):h==="belt"&&(m(["belt"]),f("tab",n,!0))},[f,n,m]),{color:s}=G[n]?G[n]:{color:"#inherit"},p=n==="Black"?"#444":s,v=o==="belt"?1:.7;return e.jsx(J.Fragment,{children:G[n]&&a&&e.jsx("div",{style:d,children:e.jsxs(Fe,{variant:"outlined",children:[e.jsxs(le,{onClick:u("belt"),style:{color:o==="belt"?"#fff":"#777",backgroundColor:o==="belt"?"#3f3f3f":"#222",height:28,padding:"0px 10px 0px 0px",borderColor:"#666",width:134,textAlign:"left",justifyContent:"flex-start"},value:"belt",disabled:o==="belt",children:[e.jsx("div",{style:{backgroundColor:s,height:26,width:12,borderRadius:"3px 0px 0px 3px",borderRight:`${p} 1px solid`,marginRight:8,opacity:v}}),e.jsxs("div",{style:{flexGrow:1,textAlign:"center"},children:[n," BELT"]})]},"belt"),e.jsx(le,{onClick:u("all"),style:{color:o==="all"?"#fff":"#777",backgroundColor:o==="all"?"#3f3f3f":"#222",height:28,padding:"0px 12px",borderColor:"#666"},value:"all",disabled:o==="all",children:"ALL LOCKS"},"all")]})})})}function we({forceText:d,forceIcon:c,closeDrawer:f,alwaysShow:m,drawer:r=!1,nav:i=!1}){const{isMobile:a}=q(),{filterCount:l,clearFilters:o,clearAdvancedFilterGroups:n}=t.useContext(N),C=t.useCallback(()=>{o(),n&&n(),f&&f()},[n,o,f]),u=r||i?"text":"outlined",s=i?{marginLeft:2}:{height:28,padding:"0px 12px",minWidth:80,marginLeft:8};return l===0&&!m?null:a&&!d||c?e.jsx($,{title:"Reset All",arrow:!0,disableFocusListener:!0,children:e.jsx(Q,{onClick:C,color:"warning",style:{padding:0},children:e.jsx(He,{})})}):e.jsx(E,{variant:u,color:"warning",onClick:C,style:s,children:"Reset"})}function Je({text:d}){const{filters:c,addFilter:f,removeFilter:m}=t.useContext(N),{expandAll:r}=c,i=t.useCallback(()=>{!r||r==="false"?f("expandAll","Expand All",!0):m("expandAll","Expand All")},[r,f,m]),a=r?"Collapse All":"Expand All";return d?e.jsx("div",{children:e.jsx($,{title:a,arrow:!0,disableFocusListener:!0,children:e.jsx(be,{onClick:()=>i(),style:{color:"#fff",textDecoration:"none",cursor:"pointer"},size:"small",children:e.jsx("div",{style:{marginLeft:5,marginTop:5,padding:5,fontWeight:700},children:a.toUpperCase()})})})}):e.jsx("div",{children:e.jsx($,{title:a,arrow:!0,disableFocusListener:!0,children:e.jsx(E,{onClick:()=>i(),style:{color:"#aaa"},size:"small",children:a})})})}function Xe({sortValues:d,compactMode:c,expandAll:f}){const[m,r]=t.useState(null),i=!!m,a=t.useCallback(F=>r(F.currentTarget),[]),l=t.useCallback(()=>r(null),[]),{filters:o,addFilter:n}=t.useContext(N),{sort:C}=o,{adminRole:u}=t.useContext(Me),{compact:s,setCompact:p}=t.useContext(ae),v=t.useCallback(F=>()=>{l(),p(F)},[l,p]),h=t.useCallback(F=>()=>{l(),setTimeout(()=>n("sort",F,!0),0)},[n,l]),S={vertical:"top",horizontal:"right"},{width:x}=q(),w=x<=500;return e.jsxs(J.Fragment,{children:[e.jsx($,{title:"View Options",arrow:!0,disableFocusListener:!0,children:e.jsx(E,{color:"inherit",onClick:a,style:{color:"#ddd"},children:e.jsx(ce,{variant:"dot",color:"secondary",invisible:!C,anchorOrigin:S,children:w?e.jsx(We,{}):"VIEW"})})}),e.jsxs(Ne,{anchorEl:m,open:i,onClose:l,children:[e.jsx("div",{style:{marginLeft:5,padding:5,fontWeight:700},children:"SORT BY"}),d.map(({label:F,value:B})=>e.jsx(re,{onClick:h(B),selected:C===B,children:F},F)),c&&e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx("div",{style:{marginLeft:5,marginTop:5,padding:5,fontWeight:700},children:"MODE"}),e.jsx(re,{onClick:v(!1),selected:!s,children:"Normal"}),e.jsx(re,{onClick:v(!0),selected:s,children:"Compact"})]}),u&&f&&e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(Je,{text:!0})]})]})]})}function Ye({onFiltersChanged:d}){const{isLoggedIn:c}=t.useContext(Ce),{beta:f}=t.useContext(ae),{filters:m,filterCount:r,addFilters:i,addFilter:a,filterFields:l,removeFilters:o}=t.useContext(N),{tab:n}=t.useContext(de),{belt:C}=m,u=/\/locks/.test(location.hash),s=t.useMemo(()=>n||C||"White",[C,n]),p=t.useMemo(()=>s!=="search"?"belt":"all",[s]),[v,h]=t.useState(s);s!==v&&s!=="search"?h(s):p==="belt"&&s==="search"&&h("search");const[S,x]=t.useState(!1),w=t.useCallback(()=>x(!S),[S]);ye("f",w);const F=t.useCallback(j=>()=>{j==="all"?a("tab","search",!0):j==="belt"&&(o(["belt"]),a("tab",v,!0))},[a,v,o]),B=t.useCallback((j,y)=>{i([{key:j,value:y},{key:"id",value:void 0},{key:"name",value:void 0}],!0),d&&d()},[i,d]),T=t.useCallback(()=>x(!0),[]),M=t.useCallback(()=>x(!1),[]),{color:_,lineColor:z="#999"}=G[v]?G[v]:{color:"#inherit"},H=p==="belt"?1:.7,{width:D}=q(),g=D<=500;return e.jsxs(J.Fragment,{children:[e.jsx($,{title:"Filter",arrow:!0,disableFocusListener:!0,children:e.jsx(E,{color:"inherit",onClick:T,style:{color:"#ddd"},children:e.jsx(ce,{variant:"dot",badgeContent:r,color:"secondary",anchorOrigin:{vertical:"top",horizontal:"right"},children:g?e.jsx(ke,{}):"FILTER"})})}),S&&e.jsxs(je,{anchor:"right",open:S,onClose:M,children:[e.jsx(ze,{variant:"dense",onClick:M,style:{padding:"8px 0px 0px 8px"},children:e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:700},children:"Filters"})}),G[v]&&u&&e.jsx("div",{style:{marginLeft:8,marginBottom:8},children:e.jsxs(Fe,{variant:"outlined",children:[e.jsxs(le,{onClick:F("belt"),style:{color:p==="belt"?"#eee":"#777",backgroundColor:p==="belt"?"inherit":"#111",padding:"6px 12px",borderColor:"#666"},value:"belt",disabled:p==="belt",children:[e.jsx("div",{style:{backgroundColor:_,height:16,width:16,borderColor:z,borderRadius:8,border:"1px solid",marginRight:8,opacity:H}}),v," BELT"]},"belt"),e.jsx(le,{onClick:F("all"),style:{color:p==="all"?"#eee":"#777",backgroundColor:p==="all"?"inherit":"#111",padding:"6px 12px",borderColor:"#666"},value:"all",disabled:p==="all",children:"ALL LOCKS"},"all")]})}),e.jsx(ue,{margin:1,children:e.jsx(ve,{direction:"column",style:{minWidth:250},children:l.filter(j=>(!j.beta||f)&&(!j.userBased||c)).filter(j=>!(p==="belt"&&n!=="search"&&j.label==="Belt")).map((j,y)=>e.jsx(Ee,{tab:n,...j,onFilter:B},y))})}),e.jsxs("div",{style:{padding:8},children:[e.jsx(Ae,{forceText:!0}),e.jsx(E,{variant:"outlined",color:"inherit",onClick:M,children:"Done"})]})]})]})}function Ze(){const[d,c]=t.useState(!1),{isLoggedIn:f}=t.useContext(Ce),{beta:m}=t.useContext(ae),{filters:r,filterCount:i,filterFields:a,showAdvancedSearch:l,setShowAdvancedSearch:o,advancedFilterGroups:n,setAdvancedFilterGroups:C}=t.useContext(N),{tab:u}=t.useContext(de),{visibleBeltEntries:s=[]}=t.useContext(Se),{belt:p}=r,v=t.useMemo(()=>{const g=n().filter(y=>y.fieldName.length>0&&Array.isArray(y.values)&&y.values.length>0).map(y=>({...a.find(O=>O.fieldName===y.fieldName),active:!0})),j=a.filter(y=>!g.find(R=>R.fieldName===y.fieldName));return[...g,...j]},[n,a]),h=t.useMemo(()=>u||p||"White",[p,u]),S=t.useMemo(()=>h!=="search"?"belt":"all",[h]),[x,w]=t.useState(h);h!==x&&h!=="search"?w(h):S==="belt"&&h==="search"&&w("search");const F=t.useCallback(()=>c(!d),[d]);ye("f",F);const B=t.useCallback((g,j)=>{if(!g||!j)return;o(!0);const y=[...n().filter(I=>I.fieldName.length>0)],R=y.findIndex(I=>I.fieldName===g&&Array.isArray(I.values)&&I.values.length>0);if(R>=0){const I=y[R];if(I.values.includes(j))return;y[R]={...I,values:[j]},C(y);return}const O={_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:g,matchType:"Is",operator:"OR",values:[j]};C([...y,O])},[n,C,o]),T=t.useCallback(()=>c(!0),[]),M=t.useCallback(()=>c(!1),[]),_=t.useCallback(()=>{o(!l)},[o,l]),z={color:"#ddd",textDecoration:"underline",cursor:"pointer","&:hover":{color:"#fff"}},{width:H}=q(),D=H<=500;return e.jsxs(J.Fragment,{children:[e.jsx($,{title:"Filter",arrow:!0,disableFocusListener:!0,children:e.jsx(E,{color:"inherit",onClick:T,style:{color:"#ddd"},children:e.jsx(ce,{variant:"dot",badgeContent:i,color:"warning",anchorOrigin:{vertical:"top",horizontal:"right"},children:D?e.jsx(ke,{}):"FILTER"})})}),d&&e.jsxs(je,{anchor:"right",open:d,onClose:M,sx:{".MuiDrawer-paper":{width:280,padding:1}},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"8px 8px 12px 8px",height:38},onClick:M,children:[e.jsx("div",{style:{fontWeight:700,fontSize:"1.3rem"},children:"Filters"}),e.jsxs("div",{style:{fontWeight:400,fontSize:"1.0rem",marginLeft:8},children:["(",(s==null?void 0:s.length)||0," Lock",(s==null?void 0:s.length)!==1&&"s",")"]}),e.jsx("div",{style:{flexGrow:1,textAlign:"right",fontSize:"0.9rem"},children:l?e.jsx(we,{advanced:!0,drawer:!0}):e.jsx(be,{onClick:_,sx:z,children:l?"Reset":"Advanced"})})]}),e.jsx(Qe,{style:{margin:"0px 0px 8px 8px"}}),e.jsx(ue,{margin:1,children:e.jsx(ve,{direction:"column",style:{minWidth:250},children:v.filter(g=>(!g.beta||m)&&(!g.userBased||f)).filter(g=>!(S==="belt"&&u!=="search"&&g.label==="Belt")).map((g,j)=>{var Y;const y=n(),R=y.findIndex(W=>W.fieldName===g.fieldName&&Array.isArray(W.values)&&W.values.length>0),O=R>=0?y[R]:null,I=O?{...O,groupIndex:R}:{fieldName:g.fieldName,groupIndex:-1,matchType:"Is",operator:"OR",values:[""]},X=O&&((Y=O.values)==null?void 0:Y[0])||"",se=O&&O.matchType||"Is",ne=O&&O.operator||"OR",oe=O?R:0;return e.jsx(Pe,{...g,active:g.active,label:g.label,group:I,groupIndex:oe,matchType:se,operator:ne,valueIndex:0,currentValue:X,onFilter:W=>B(g.fieldName,W),onRemove:()=>{},handleAddValue:()=>{},size:"small",context:"drawer"},j)})})}),e.jsxs("div",{style:{padding:8},children:[e.jsx(Ae,{forceText:!0}),e.jsx(E,{variant:"outlined",color:"inherit",onClick:M,children:"Close"})]})]})]})}function ht({sortValues:d,extraFilters:c=[],compactMode:f,resetAll:m=!1,expandAll:r=!1,style:i,advancedEnabled:a=!1}){const{filters:l,filterCount:o,isFiltered:n}=t.useContext(N),{sort:C}=l,u=C||o>0||n&&m,{width:s}=q(),p=s<=500,v=p?3:0,h=p?2:0,S=p?40:60;return e.jsxs(ue,{style:{display:"flex",paddingTop:v,marginBottom:h,marginLeft:0,justifyContent:"center",...i},sx:{".MuiBadge-anchorOriginTopRightRectangular":{marginTop:"5px"},".MuiButton-root":{minWidth:S}},children:[e.jsx(Xe,{sortValues:d,compactMode:f,expandAll:r}),a?e.jsx(Ze,{extraFilters:c}):e.jsx(Ye,{extraFilters:c}),!!u&&e.jsx(we,{advanced:!0,nav:!0})]})}export{Pe as A,Je as E,Qe as F,we as R,ht as V};
