import{r as s,D as ct,d as mt,u as E,j as t,B as k,T as pt,bB as xt,R as ht,e as ut,ac as gt,N as jt}from"./index-B4KJvJI6.js";import{I as ft}from"./IntroCopy-Bu2zP50G.js";import{u as yt}from"./usePageTitle-CqqGDAXN.js";import{L as bt}from"./LockEntrySearchBox-B4j2-XfB.js";import{B as vt}from"./BeltIcon-BFxafgIu.js";import{D as kt}from"./Dropzone-BzJ_ZCAK.js";import{L as Ct}from"./LoadingDisplay-CIRRtMjh.js";import{D as St}from"./DataContext-CemU_zSP.js";import"./index-Bp1Cg87t.js";import{n as Lt}from"./dataUrls-DkJe4Pqg.js";import{p as Nt,c as It}from"./postData-CXms7lPQ.js";import{C as wt}from"./Checkbox-ihLZJMnA.js";import{C as Bt}from"./Collapse-BaG-LOzM.js";import{T as C}from"./TextField-8QACALVq.js";import{I as Dt,a as Ft}from"./ImageListItem-CF1pfC5p.js";import{D as S}from"./Dialog-BrhRKPms.js";import{D as Rt}from"./LockDataProvider-BQznF1d5.js";import"./index-DLGiElKB.js";import"./index-CaEj1Xzs.js";import"./index-CukRDIL-.js";import"./Search-CfhZ74z-.js";import"./Select-Y1mfaP2T.js";import"./entryName-CvUepQAl.js";import"./BeltStripeMini-C5U8Ews5.js";import"./Autocomplete-CxtskeSS.js";import"./Chip-CP7Buq1k.js";import"./index-Bb2FbS6E.js";import"./Cancel-D4SZMG0j.js";import"./Box-CuQQoyOQ.js";import"./CircularProgress-BvudgzIl.js";import"./index-xsH4HHeE.js";import"./collectionStatsById-DY1NVZ7h.js";import"./useData-zx8nXG6u.js";import"./filterEntries-BBFZIbGW.js";function zt({profile:a,user:l}){var U,$,W,A,O,_;const{allEntries:m}=s.useContext(St),{updateProfileField:u}=s.useContext(ct),[o,x]=s.useState({}),[j,L]=s.useState(void 0),[c,f]=s.useState([]),[M,N]=s.useState(void 0),[I,y]=s.useState(!1),[n,w]=s.useState(void 0),[p,B]=s.useState(!1),[Y,D]=s.useState(""),[F,R]=s.useState(""),[h,H]=s.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)||""),[b,K]=s.useState(!1),G=mt().format("YYYYMMDD-HHMMss"),d=m.find(e=>e.id===(o==null?void 0:o.lockId)),q=!!(o!=null&&o.lockName)&&!!(o!=null&&o.lockId)&&!!h&&c.length>0,z=`${o.lockName}_${o.lockId}_`.replace("/","+"),T=`${h}`.replace("/","+"),J=c.map(e=>e.name),Q=c.length===1?"File":"Files",V=async e=>{e.preventDefault(),y(!0);const i=`${G}_${z}_${T}`,r=new FormData;c.forEach(g=>{const{base:v,ext:dt}=Tt(g.name);r.append("files",g,`${i}/${z}_${v}_${T}.${dt}`)}),r.append("droppedFileNames",J),r.append("lockFullName",o.lockFullName),r.append("lockName",o.lockName),r.append("version",d==null?void 0:d.version),r.append("belt",d==null?void 0:d.belt),r.append("lockId",o.lockId),r.append("photoCredit",h),r.append("displayName",a==null?void 0:a.displayName),r.append("uploadsDir",i),r.append("notes",F);const it=`${Lt}/upload`,rt=!1,lt=3e4;try{N(await Nt({user:l,url:it,formData:r,snackBars:rt,timeoutDuration:lt})),Z(h)}catch(g){w(It(g)),x([]),c.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{y(!1)}},X=s.useCallback(e=>{x(e),L(m.find(i=>i.id===e.lockId))},[m]),Z=s.useCallback(e=>{u("photoCredit",e)},[u]),tt=s.useCallback(e=>{const{value:i}=e.target;H(i)},[]),et=s.useCallback(e=>{const{value:i}=e.target;R(i)},[]),P=s.useCallback(()=>{x({}),L(void 0),c.forEach(e=>URL.revokeObjectURL(e.preview)),f([]),N(void 0),y(!1),w(void 0),B(!1),D(""),R(""),K(!b)},[c,b]),st=s.useCallback(()=>{B(!p),x([])},[p]),ot=s.useCallback(e=>{const{value:i}=e.target;D(i),x({lockFullName:i,lockName:i,lockId:"NOTINLIST"})},[]),at=p?.5:1,{flexStyle:nt}=E();return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:V,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"30px 0px 10px"},children:"Select Lock"}),t.jsx("div",{style:{opacity:at},children:t.jsx(bt,{handleChangeLock:X,allEntries:m,disabled:p,reset:b})}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx(wt,{onChange:st,color:"info",size:"small",id:"notInList",checked:p})," Submit photos for a lock not on the site."]}),t.jsxs(Bt,{in:p,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:Y,style:{width:400},onChange:ot,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:nt},children:[t.jsxs("div",{style:{marginRight:50,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),t.jsx(kt,{files:c,setFiles:f}),j&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),j.media?t.jsx("div",{children:t.jsx(Dt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:j.media.map(e=>t.jsx(Ft,{children:t.jsx("img",{srcSet:`${e.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${e.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:e.title,loading:"lazy"})},e.thumbnailUrl))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),o.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),t.jsx("br",{}),t.jsxs("div",{style:{display:"flex"},children:[o.lockId!=="NOTINLIST"&&t.jsx(vt,{value:d==null?void 0:d.belt,style:{marginBottom:-10}}),t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:o.lockFullName})]}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:h,style:{width:350},onChange:tt,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:F,onChange:et}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!q||I,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:I,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(Ct,{})})}),t.jsx(S,{open:!!M&&!n,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[Q," Uploaded Succesfully!"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:P,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!n,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",(($=(U=n==null?void 0:n.response)==null?void 0:U.data)==null?void 0:$.message)||(n==null?void 0:n.message),((A=(W=n==null?void 0:n.response)==null?void 0:W.data)==null?void 0:A.status)&&t.jsxs("span",{children:[" (",(_=(O=n==null?void 0:n.response)==null?void 0:O.data)==null?void 0:_.status,")"]})]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:P,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(pt,{feature:"uploadPhotos"})]})}function Tt(a){const l=a.lastIndexOf(".");return l===-1?{base:a,ext:""}:{base:a.substring(0,l),ext:a.substring(l)}}function ue(){const{isMobile:a}=E(),{profile:l,user:m}=xt();yt("Contribute Photos");const u=t.jsx(ht.Fragment,{children:!a&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return t.jsx(ut,{children:t.jsxs(Rt,{allEntries:gt,profile:l,children:[t.jsx(jt,{title:"Contribute Photos",extras:u}),l&&!l.photoCredit&&t.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:t.jsx(ft,{pageName:"photoUpload",maxWidth:820})}),t.jsx(zt,{profile:l,user:m})]})})}export{ue as default};
