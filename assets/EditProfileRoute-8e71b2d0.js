import{r as a,J as f,p as T,U as y,v as i,j as e,V as F,a7 as S,R as u,W as R,t as d,a8 as Y,M as U,N as V,O as $,P as z}from"./index-05508e2e.js";import{u as G}from"./useDocumentTitle-2b3b0c7c.js";import{l as M}from"./LPU-c3fa7122.js";import{C as W}from"./CopyProfileLinkButton-2fa6e274.js";import{L as Z}from"./LoadingDisplay-29178be0.js";import{T as _}from"./TextField-89efab4a.js";import{P as q}from"./MustBeLoggedIn-7abeda9e.js";import{L as H}from"./LinearProgress-9ab55fb0.js";import"./Link-24dc4ce1.js";import"./Select-b8271463.js";function I(){const{lockCollection:t,updateProfileDisplayName:n,deleteAllUserData:s}=a.useContext(f),[r,x]=a.useState(t.displayName||""),[m,p]=a.useState(null),[j,h]=a.useState(!1),g=T(),{user:c}=a.useContext(y),b=a.useCallback(o=>{const{value:k}=o.target;x(k)},[]),C=a.useCallback(o=>o.target.select(),[]),v=a.useCallback(async()=>{try{await n(r),i("Profile updated")}catch(o){console.error("Error while updating profile",o),i("Error while updating profile")}},[n,r]),w=a.useCallback(async()=>{try{await n(null),x(""),i("Display Name cleared")}catch(o){console.error("Error while updating profile",o),i("Error while updating profile")}},[n]),D=a.useCallback(()=>{g(`/profile/${c.uid}`)},[g,c.uid]),P=a.useCallback(o=>{o.preventDefault(),o.stopPropagation(),p(o.currentTarget)},[]),L=a.useCallback(async()=>{h(!0),await s(c.uid),p(null),h(!1),i("All data has been deleted")},[s,c]),l=r.length>0&&!J.test(r.toString()),N=r.length===0||r===(t==null?void 0:t.displayName),A=l?"Display name must only include A-Z, 0-9, _ and -.":"",B=r.length>0?"Edit Profile":"Create Profile",E=r.length>0?` (${r}) `:"";return e.jsxs(F,{style:{maxWidth:380,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46},children:[e.jsx(S,{title:B,action:null}),j?e.jsx(Z,{}):e.jsxs(u.Fragment,{children:[e.jsxs(R,{children:[t!=null&&t.displayName?e.jsxs("div",{style:{marginBottom:10},children:["Your display name ",E," shows up on the leaderboard and your profile can be shared with others.",e.jsx("br",{}),e.jsx("br",{}),"Your Google login information will never be displayed to other users."]}):e.jsxs("div",{style:{marginBottom:10},children:["Your display name will show up on the leaderboard and your profile can be shared with others.",e.jsx("br",{}),e.jsx("br",{}),"Your Google login information will never be displayed to other users."]}),e.jsx("br",{}),e.jsxs("div",{style:{width:"100%"},children:[e.jsx(_,{error:l,variant:"outlined",color:"secondary",label:"Display Name",helperText:A,value:r||"",onChange:b,onFocus:C,inputProps:{maxLength:32},size:"small",style:{width:260}}),e.jsx(d,{variant:"outlined",color:l?void 0:"success",onClick:v,disabled:l||N,style:{marginLeft:16,marginRight:0,marginBottom:10,height:40},children:"Save"})]})]}),e.jsx(Y,{children:e.jsxs("div",{style:{width:"100%",textAlign:"center",margin:"10px 0px 10px 0px"},children:[(t==null?void 0:t.displayName)&&e.jsx(d,{variant:"outlined",color:"info",onClick:w,disabled:l,style:{marginBottom:10,color:"#4972ab",padding:"5px 19px"},children:"Clear Display Name"}),e.jsx(d,{variant:"outlined",color:"info",onClick:D,style:{marginLeft:15,marginBottom:10,color:"#4972ab",padding:"5px 19px"},children:"View Profile"})]})}),e.jsxs("div",{style:{width:"100%",textAlign:"center",margin:"10px 0px 10px 0px"},children:[e.jsx(d,{variant:"outlined",color:"info",onClick:P,style:{marginBottom:10,color:"#4972ab",padding:"5px 110px"},children:"Delete All Data"}),e.jsxs(U,{anchorEl:m,open:!!m,onClose:()=>p(null),children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["This will permanently delete all of your data.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(d,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:L,edge:"start",color:"error",children:"Delete"})})]})]})]})]})}const J=/^[\sa-zA-Z0-9_-]{1,32}$/;function se(){const{authLoaded:t,isLoggedIn:n}=a.useContext(y),{dbLoaded:s}=a.useContext(f);G("LPU Belt Explorer - Edit Profile");const r=e.jsx(u.Fragment,{children:e.jsx(W,{page:"collection"})});return e.jsxs(u.Fragment,{children:[e.jsx(V,{title:"Edit Profile",extras:r}),(!t||!s)&&e.jsxs(u.Fragment,{children:[e.jsx(H,{variant:"indeterminate",color:"secondary"}),e.jsx("img",{alt:"Loading",src:M,style:{marginLeft:"auto",marginRight:"auto",display:"block"}})]}),t&&!n&&e.jsx(q,{}),t&&n&&s&&e.jsx(I,{}),e.jsx($,{}),e.jsx(z,{feature:"editprofile"})]})}export{se as default};
