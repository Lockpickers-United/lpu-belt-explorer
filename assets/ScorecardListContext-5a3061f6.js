import{r as s,ac as E,b0 as w,g as B,Z as T,j as y,d as r,az as z,aq as F,R as U}from"./index-8973b91a.js";import{F as R,D as W,f as G}from"./filterFields-6ab34fcc.js";import{r as I}from"./index-0dd34e17.js";function Q({children:v,cardActivity:o,cardBBCount:l,cardDanPoints:c,cardEligibleDan:p,cardNextDanPoints:u,cardNextDanLocks:m,cardUniqueLocks:d,popularLocks:e}){const{filters:t}=s.useContext(R),{search:n,id:O,tab:f,name:b,sort:C,image:Z,locks:q,...M}=t,h=s.useMemo(()=>o.map(a=>{const i=E(a.matchId),x=w(a.matchId),Y=B(a.matchId),L=Y?"Belt":x?"Project":"Lock";return{...a,...i,...x,...Y,id:a.id,type:L}}),[o]),j=s.useMemo(()=>h.reduce((a,i)=>(a[i.matchId]=i,a),{}),[h]),k=s.useMemo(()=>e.map(a=>({...E(a.id),...j[a.id],popularityRank:a.rank,userCount:a.saveCount})),[e,j]),g=s.useMemo(()=>Object.keys(M).map(a=>{const i=M[a];return Array.isArray(i)?i.map(x=>({key:a,value:x})):{key:a,value:i}}).flat(),[M]),D=s.useMemo(()=>P(h,g,n,C),[h,g,n,C]),A=s.useMemo(()=>P(k,g.concat({key:"exceptionType",value:void 0}),n,"popular"),[k,g,n]),S=s.useMemo(()=>({allEntries:T,cardActivity:o,cardBBCount:l,cardDanPoints:c,cardEligibleDan:p,cardNextDanPoints:u,cardNextDanLocks:m,visibleEntries:D,popularEntries:A,cardUniqueLocks:d,getEntryFromId:E,getProjectEntryFromId:w,getAwardEntryFromId:B}),[o,l,c,p,u,m,D,A,d]);return y.jsx(W.Provider,{value:S,children:v})}function P(v,o,l,c){const u=v.map(e=>{var t,n,O;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:f})=>f),fuzzy:I(((n=e==null?void 0:e.makeModels)==null?void 0:n.map(({make:f,model:b})=>[f,b]).flat().filter(f=>f).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}return"Worth Points"})()],simpleBelt:(O=e==null?void 0:e.belt)==null?void 0:O.replace(/\s\d/g,"")}}).filter(e=>o.every(({key:t,value:n})=>Array.isArray(e[t])?e[t].includes(n):e[t]===n)),m=l?G.go(I(l),u,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):u,d=(()=>{switch(c){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||F(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"dateAscending":return(e,t)=>r(e.date).valueOf()-r(t.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>r(t.date).valueOf()-r(e.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>F(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"beltDescending":return(e,t)=>z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>r(r(t.date).format("YYYY-MM-DD")).valueOf()-r(r(e.date).format("YYYY-MM-DD")).valueOf()||z(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return m.sort(d)}const V=U.createContext({});function X({children:v}){const{filters:o,addFilters:l,removeFilters:c}=s.useContext(R),p=o.id,u=s.useCallback(d=>{d?l([{key:"id",value:d}],!0):c(["id"])},[l,c]),m=s.useMemo(()=>({expanded:p,setExpanded:u}),[p,u]);return y.jsx(V.Provider,{value:m,children:v})}export{V as S,Q as a,X as b};
