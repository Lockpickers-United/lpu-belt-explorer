import{j as e,X as I,r as i,a6 as W,ad as F,d as z,a5 as D,R as E,U as b,W as A,bs as O,B as y,b as L,u as M,bL as N}from"./index-BxOcpRE8.js";import{R as P}from"./RaffleContext-BIG0rIty.js";import{C as $}from"./Cached-Bg08TKy1.js";import{E as q}from"./ExpandMore-DZIwf-P6.js";import{V as k}from"./AdminToolButtons-DBsHvLcd.js";import{C as H,c as V}from"./CircularProgress-D9uTr11C.js";import{n as G}from"./dataUrls-1xDVM400.js";import{a as U}from"./index-C0RmN517.js";import{B}from"./Box-DcTX4Bpf.js";import{A as Z,a as J,b as _}from"./AccordionSummary-6peRY54N.js";function X({diameter:t=40}){return e.jsx("div",{style:{display:"flex",placeItems:"center",justifyContent:"center",width:t,height:t},children:e.jsx(H,{variant:"indeterminate",disableShrink:!0,sx:{color:d=>(d.palette.mode==="light","#fff"),animationDuration:"550ms",[`& .${V.circle}`]:{strokeLinecap:"round"}},size:18,thickness:5})})}const K=(t,d)=>{const[r,s]=t.split("#"),a=r.includes("?")?"&":"?";return`${r}${a}${d}${s?"#"+s:""}`},Q=async({user:t,url:d,formData:r,json:s,snackBars:a,timeoutDuration:u=15e3})=>{var p,v,j,S,R,w;const n=new AbortController,m=setTimeout(()=>{n.abort()},u),g=Math.floor(Math.random()*1e6),x=t?await t.getIdToken():null,l=s!==void 0&&r===void 0,f={...x&&{Authorization:`Bearer ${x}`}},h=l?s:r;let c=h;try{typeof FormData<"u"&&h instanceof FormData&&(c=Object.fromEntries(h.entries()))}catch{}try{const o=await U.get(K(d,g),{headers:f,signal:n.signal,params:c});return clearTimeout(m),o.data}catch(o){clearTimeout(m);const C=o.name==="CanceledError"||o.code==="ERR_CANCELED"||((p=o.message)==null?void 0:p.includes("aborted"))?"Request timed out. Please try again.":((S=(j=(v=o.response)==null?void 0:v.data)==null?void 0:j.error)==null?void 0:S.message)||((w=(R=o.response)==null?void 0:R.data)==null?void 0:w.message)||o.message||"Error during authentication or server request";throw{...o,message:C}}};function Y({refresh:t,page:d}){const[r,s]=i.useState(!1),[a,u]=i.useState(""),[n,m]=i.useState(!1),{preview:g,setPreview:x,raflPreviewVersion:l}=i.useContext(P),{version:f}=i.useContext(W),[h,c]=F(),p=h.has("preview"),v=g||p,j=z(f).valueOf()>z(l.version).valueOf();console.log("oldPreview",j,f,l.version);const S=i.useCallback(async()=>{const T=`${G}/refresh-preview`;try{s(!0);const C=await Q({url:T,snackBars:!1,timeoutDuration:3e4});I("Request successful",{variant:"success"}),u(C)}catch(C){I(`Error creating request: ${C.message}`,{variant:"error",autoHideDuration:3e3})}finally{s(!1)}await t()},[t]),R=i.useRef(null),w=i.useCallback(()=>{p?(h.delete("preview"),c(h),x(!1)):x(!g)},[g,p,h,x,c]);D("p",()=>w(),{preventDefault:!0});const o=v?"#983de6":"#fff";return e.jsxs(E.Fragment,{children:[d!=="pots"?e.jsx(B,{ref:R,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:e.jsx(b,{style:{padding:8},disabled:!0,children:e.jsx(k,{style:{color:o,opacity:.5},fontSize:"small"})})}):e.jsxs("div",{children:[e.jsx(B,{ref:R,style:{display:"flex",alignItems:"center",overflow:"hidden"},children:v?e.jsx(O,{in:v,direction:"left",appear:!1,children:e.jsxs("div",{style:{display:"flex",flexGrow:1,marginRight:0},children:[e.jsx(y,{onClick:w,style:{padding:"0px 8px 0px 0px",marginRight:0,color:"#8830d3",fontSize:"1.0rem",lineHeight:"1.2rem",whiteSpace:"nowrap"},children:"PREVIEW MODE ON"}),r?e.jsx("div",{style:{marginRight:0},children:e.jsx(X,{diameter:36})}):e.jsx(A,{title:"Refresh From Sheet",arrow:!0,disableFocusListener:!0,children:e.jsx(b,{onClick:S,style:{marginRight:0},children:e.jsx($,{fontSize:"small"})})}),e.jsx(b,{onClick:w,style:{padding:8},children:e.jsx(k,{style:{color:o},fontSize:"small"})})]})}):e.jsx(A,{title:"Toggle Preview Mode",arrow:!0,disableFocusListener:!0,children:e.jsx(b,{onClick:w,style:{padding:8},children:e.jsx(k,{style:{color:o},fontSize:"small"})})})}),j&&e.jsx("div",{style:{fontSize:"0.8rem",color:"#d33030"},children:"Preview version is older than latest import."})]}),(a==null?void 0:a.status)==="Errors"&&e.jsxs(Z,{expanded:n,onChange:()=>m(!n),sx:{".MuiAccordionSummary-content":{margin:0}},children:[e.jsx(J,{expandIcon:e.jsx(q,{}),style:{maxWidth:700,margin:"0px auto 10px auto",paddingLeft:20,fontWeight:700,fontSize:"1rem",backgroundColor:"#e34141"},children:"There were errors trying to import"}),e.jsx(_,{style:{maxWidth:700,margin:"20px auto 10px auto",padding:10,fontWeight:400,fontSize:"0.8rem",backgroundColor:"#e34141",display:"flex",alignItems:"center"},children:e.jsx("pre",{children:JSON.stringify(a,null,2)})})]})]})}function ee({page:t,width:d=700}){const{preview:r,setPreview:s,refresh:a}=i.useContext(P),[u,n]=F(),m=u.has("preview"),g=r||m,x=L(),{setAnimateTotal:l}=i.useContext(P),f=i.useCallback(S=>{x(S),l(!1)},[x,l]),h=i.useCallback(()=>{g&&t==="pots"&&(u.delete("preview"),n(u),s(!1))},[t,u,s,n,g]),{isMobile:c}=M(),p=c?"1.0rem":"1.03rem",v=!r||t!=="pots"||!c,j={maxWidth:d,marginLeft:"auto",marginRight:"auto",display:"flex",alignItems:"center",height:40};return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:j,children:[e.jsx(b,{style:{padding:4},onClick:h,disabled:t!=="pots",children:e.jsx(N,{fontSize:"medium",style:{color:"#4c82fd"}})}),v&&e.jsxs(E.Fragment,{children:[e.jsx(y,{onClick:()=>f("/rafl/admin"),style:{padding:"0px 8px",marginRight:10,marginLeft:10,color:t==="entries"?"#48adf1":"#ccc",fontSize:p},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="entries",children:"ENTRIES"}),e.jsx(y,{onClick:()=>f("/rafl/reports"),style:{padding:"0px 8px",marginRight:10,color:t==="reports"?"#48adf1":"#ccc",fontSize:p},sx:{":hover":{bgcolor:"#333",color:"#fff"}},disabled:t==="reports",children:"REPORTS"})]}),e.jsx("div",{style:{display:"flex",flexGrow:1,justifyContent:"right"},children:e.jsx(Y,{page:t,refresh:a})})]}),e.jsx("div",{style:{height:2}})]})}function fe({page:t,width:d=700}){const{raflState:r,raffleAdminRole:s}=i.useContext(P),a=L(),{setAnimateTotal:u}=i.useContext(P),n=i.useCallback(v=>{a(v),u(!1)},[a,u]),{isMobile:m,flexStyle:g}=M(),x=m?0:4,l=m?"1.0rem":"1.03rem",f=m?3:10,h={maxWidth:d,marginLeft:"auto",marginRight:"auto",marginTop:10,padding:"0px 0px 0px 0px",fontWeight:700,display:g};let c=r!=="preview"||s||m?"PRIZES":"PRIZE PREVIEW";c=["hidden","post"].includes(r)?c.replace("PRIZES","2026 PRIZES"):c;const p=r==="live"||s?"ENTER":"INFO";return e.jsxs(E.Fragment,{children:[e.jsxs("div",{style:h,children:[e.jsx("div",{style:{flexGrow:1,fontSize:"1.7rem",marginTop:0},children:"LPU Annual Raffle"}),e.jsxs("div",{style:{marginTop:x,justifyItems:"right"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(y,{onClick:()=>n("/rafl"),style:{marginRight:f,color:t==="pots"?"#fff":"#ccc",fontSize:l},disabled:t==="pots",children:c}),r==="preview"&&!s&&e.jsx(y,{onClick:()=>n("/rafl/announce"),style:{marginRight:f,color:t==="announce"?"#fff":"#ccc",fontSize:l},disabled:t==="announce",children:"CONTRIBUTE"}),(r!=="hidden"||s)&&e.jsx(y,{onClick:()=>n("/rafl/charities"),style:{marginRight:f,color:t==="charities"?"#fff":"#ccc",fontSize:l},disabled:t==="charities",children:"CHARITIES"}),(["preview","live","post"].includes(r)||s)&&e.jsx(y,{onClick:()=>n("/rafl/enter"),style:{marginRight:0,color:t==="enter"?"#fff":"#ccc",fontSize:l},children:p}),(["live","post"].includes(r)||s)&&e.jsx(y,{onClick:()=>n("/rafl/stats"),style:{marginLeft:f,color:t==="stats"?"#fff":"#ccc",fontSize:l},children:"STATS"})]})]}),s&&e.jsx(ee,{page:t,width:d}),e.jsx("div",{style:{height:8}})]})}export{fe as R};
