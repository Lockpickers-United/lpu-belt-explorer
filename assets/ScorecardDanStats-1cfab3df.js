import{r as c,j as e,T as ie,I as R,as as U,at as $,Z as y,ap as N,aj as le,N as ae,R as D,a4 as re,x as T,w as ce,au as de,a2 as pe,C as xe,D as me,av as ue,a9 as he,p as fe}from"./index-66f67101.js";import{e as w,F as W,r as V,f as ge,D as A,B as ye}from"./BeltStripe-19db8e48.js";import{b as q}from"./sortFields-759e79e9.js";import{S as je,E as ke,d as ve}from"./CollectionButton-6b078086.js";import{d as be}from"./Link-d9282860.js";import{u as G}from"./useWindowSize-c4eb26fa.js";import{A as Ce,a as Se,b as Le}from"./Sort-0f3cd6fc.js";import{L as B}from"./Link-91716248.js";import{p as De}from"./chartDefaults-9fc07b21.js";import{B as ze}from"./nivo-bar.es-e023e680.js";function Be({entry:r}){const a=w(r).replace(/[\s/]/g,"_").replace(/\W/g,""),p=c.useCallback(n=>{n.preventDefault(),n.stopPropagation();const d=`${window.location.origin}/#/locks?id=${r.id}&name=${a}`,u=window.open(d,"_blank","noopener,noreferrer");u&&(u.opener=null)},[r.id,a]);return e.jsx(ie,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(R,{onClick:p,children:e.jsx(be,{style:{width:18,height:18}})})})}function Ge({children:r,cardEvidence:t,cardBBCount:a,cardDanPoints:p,cardEligibleDan:n,cardNextDanPoints:d,cardNextDanLocks:u}){const{filters:f}=c.useContext(W),{search:g,id:v,tab:z,name:m,sort:h,image:O,...s}=f,x=c.useMemo(()=>t.map(l=>{const j=U(l.matchId),k=$(l.matchId);return{...j,...l,...k,id:l.id}}),[t]),b=c.useMemo(()=>x.map(l=>{var j,k,i;return{...l,makes:(j=l==null?void 0:l.makeModels)==null?void 0:j.map(({make:o})=>o),fuzzy:V(((k=l==null?void 0:l.makeModels)==null?void 0:k.map(({make:o,model:L})=>[o,L]).flat().filter(o=>o).concat([l.version,l.notes,l.belt]).join(","))+" "),documentation:[l.exceptionType==="badlink"?"Bad Link":"Valid Link",l.date?"Valid Date":"No Date"],scoring:[l.exceptionType==="nomatch"?"Unmatched":l.exceptionType==="badlink"?"Bad Link":l.exceptionType==="duplicate"?"Duplicate":l.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(l.belt)?"Low Level":"Worth Points"],simpleBelt:(i=l==null?void 0:l.belt)==null?void 0:i.replace(/\s\d/g,"")}}),[x]),C=c.useMemo(()=>{const l=Object.keys(s).map(i=>{const o=s[i];return Array.isArray(o)?o.map(L=>({key:i,value:L})):{key:i,value:o}}).flat(),j=b.filter(i=>l.every(({key:o,value:L})=>Array.isArray(i[o])?i[o].includes(L):i[o]===L)),k=g?ge.go(V(g),j,{keys:Ie,threshold:-25e3}).map(i=>({...i.obj,score:i.score})):j;return h?k.sort((i,o)=>{if(h==="danPointsAscending")return i.points-o.points||y(o.date).valueOf()-y(i.date).valueOf();if(h==="danPointsDescending")return o.points-i.points||y(o.date).valueOf()-y(i.date).valueOf();if(h==="dateAscending")return y(i.date).valueOf()-y(o.date).valueOf()||N(i.simpleBelt,o.simpleBelt);if(h==="dateDescending")return y(o.date).valueOf()-y(i.date).valueOf()||N(i.simpleBelt,o.simpleBelt);if(h==="beltAscending")return le(i.belt,o.belt)||y(o.date).valueOf()-y(i.date).valueOf();if(h==="beltDescending")return N(i.belt,o.belt)||y(o.date).valueOf()-y(i.date).valueOf();if(h==="alphaAscending")return i.fuzzy.localeCompare(o.fuzzy)||o.points-i.points;if(h==="alphaDescending")return o.fuzzy.localeCompare(i.fuzzy)||o.points-i.points}):k.sort((i,o)=>y(o.date).valueOf()-y(i.date).valueOf()||N(i.belt,o.belt)||i.fuzzy.localeCompare(o.fuzzy))},[s,b,g,h]),S=c.useMemo(()=>({allEntries:ae,cardEvidence:t,cardBBCount:a,cardDanPoints:p,cardEligibleDan:n,cardNextDanPoints:d,cardNextDanLocks:u,visibleEntries:C,getEntryFromId:U,getProjectEntryFromId:$}),[t,a,p,n,d,u,C]);return e.jsx(A.Provider,{value:S,children:r})}const Ie=["fuzzy"];function Ee({owner:r,evid:t,expanded:a,onExpand:p,merged:n}){const{setFilters:d}=c.useContext(W),{cardEvidence:u,getEntryFromId:f,getProjectEntryFromId:g}=c.useContext(A),v=f(t.matchId),z=g(t.matchId),m=v||z,[h,O]=c.useState(!1),s=c.useRef(null);c.useEffect(()=>{if(a&&s&&!h){const M=window.innerWidth<=600?70:74,{id:oe}=re.parse(location.search),P=oe===t.id;O(!0),setTimeout(()=>{window.scrollTo({left:0,top:s.current.offsetTop-M,behavior:P?"auto":"smooth"})},P?0:100)}else a||O(!1)},[a,m,h,t.id]);let x=m?w(m):t.evidenceNotes;const b=t.exceptionType&&t.evidenceNotes.toLowerCase()!==x.toLowerCase()?t.evidenceNotes:null;x=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:x,x=t.exceptionType&&r&&n?x+" *":x;const C=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,S=t.exceptionId,l=S?u.find(E=>E.id===S):{},j=l?c.useMemo(()=>f(l.matchId),[f,l.matchId]):{},k=j?w(j,"short"):"",i=S?e.jsx(B,{style:{color:"#99c2e5"},onClick:()=>{L(S)},children:k}):null;let o=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"You must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const L=c.useCallback(E=>{d({id:E})},[d]),Y=t.points===1?"pt":"pts";let I=t.date?y(t.date).format("L"):"(no date)";I=I.replace("/202","/2"),I=I.replace("/201","/1");const Z=t.date?"#fff":"#aaa",H=c.useCallback((E,M)=>{r&&p(M?t.id:!1)},[t.id,p,r]),J=r?{}:{cursor:"default"},Q=r?e.jsx(ce,{}):null,{isMobile:F}=G(),X=F?"block":"flex",ee=F?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},te=F?"65%":"56%",ne=F?"-2px 0px 3px 0px":"1px 0px 3px 0px",se={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(Ce,{expanded:a,onChange:H,ref:s,children:[e.jsxs(Se,{expandIcon:Q,style:{...se,...J},children:[e.jsx(ye,{value:m?m.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:te,flexShrink:0,flexDirection:"column",opacity:C},children:[e.jsx(q,{value:x,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!b&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:b}),!!m&&!!(m!=null&&m.version)&&e.jsx(q,{name:"Version",value:e.jsx(T,{style:{fontSize:"0.95rem",lineHeight:1.25},children:m==null?void 0:m.version}),textStyle:(m==null?void 0:m.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:X,placeItems:"center",marginLeft:10,opacity:C},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:v&&e.jsx(Be,{entry:v})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(je,{url:t.link,handleChange:H,exceptionType:t.exceptionType,owner:r})})]}),e.jsxs("div",{style:ee,children:[e.jsx("div",{style:{margin:ne,color:Z,width:90,textAlign:"center"},children:I}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:Y})]})})]})]})]}),a&&e.jsx(D.Fragment,{children:e.jsxs(Le,{sx:{padding:"4px 16px 0px 26px"},children:[(o||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),o&&e.jsxs("span",{children:["* ",o," ",i]})]}),e.jsx(ke,{evid:t,handleUpdate:()=>{}})]})})]},t.id)}const Ke=D.memo(Ee,(r,t)=>{const a=Object.keys(r.evid),p=Object.keys(t.evid);if(a.length!==p.length)return!1;for(let n=0;n<a.length;n++)if(a[n]!==p[n]||r.evid[a[n]]!==t.evid[p[n]])return!1;return r.owner===t.owner&&r.expanded===t.expanded&&r.onExpand===t.onExpand&&r.merged===t.merged}),Te=D.createContext({});function Ye({children:r}){const{filters:t,addFilters:a,removeFilters:p}=c.useContext(W),n=t.id,d=c.useCallback(f=>{f?a([{key:"id",value:f}],!0):p(["id"])},[a,p]),u=c.useMemo(()=>({expanded:n,setExpanded:d}),[n,d]);return e.jsx(Te.Provider,{value:u,children:r})}function we({beltData:r}){const{width:t}=G(),a=t<=560,p=a?190:175,n=a?-90:-45,d=a?{top:0,right:0,bottom:80,left:15}:{top:0,right:0,bottom:60,left:15},u=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#3e3e3e","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c"],f=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#aaa","#000","#000","#000","#000","#000","#000"];return e.jsx("div",{style:{height:p,padding:"0px 0px 0px 0px",width:"100%"},children:e.jsx(ze,{data:r,margin:d,padding:.15,colors:g=>u[g.index%u.length],animate:!0,axisBottom:{tickRotation:n},axisLeft:null,enableGridY:!1,theme:De,isInteractive:!1,enableLabel:!0,label:g=>g.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:g=>f[g.index%f.length]})},"bar")}function Ze({entries:r}){const t=c.useMemo(()=>{const a=r.map(({belt:n})=>(n&&n.includes("Project"),n)).reduce((n,d)=>(n[d]||(n[d]=0),n[d]++,n),{});return a.Project=r.reduce((n,d)=>d.simpleBelt==="Project"?n+1:n,0),(a.Project>0?de:pe).map(n=>({id:n,label:n,count:a[n]||0,value:a[n]||0}))},[r]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(we,{beltData:t})})}var _={},Oe=me;Object.defineProperty(_,"__esModule",{value:!0});var K=_.default=void 0,Fe=Oe(xe()),Ne=e;K=_.default=(0,Fe.default)((0,Ne.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function We(){const{setFilters:r}=c.useContext(W),{cardEvidence:t,getEntryFromId:a}=c.useContext(A),[p,n]=c.useState(!1),d=c.useCallback(()=>{n(!0)},[]),u=c.useCallback(()=>{n(!1)},[]),f=c.useCallback(s=>{r({id:s}),n(!1)},[r]),g=t.map(s=>{const x=s.exceptionId,b=x?t.find(k=>k.id===x):{},C=b?a(b.matchId):{},S=C?w(C,"short"):"",l=s.matchId?a(s.matchId):null,j=l?w(l,"short"):"";return{...s,supersedingEntryId:x,supersedingLockName:S,matchLockName:j}}),v=g.filter(s=>s.exceptionType==="nomatch"),z=g.filter(s=>s.exceptionType==="badlink"),m=g.filter(s=>s.exceptionType==="duplicate"),h=g.filter(s=>s.exceptionType==="upgraded");if(v.length+z.length+m.length+h.length>0)return e.jsxs(D.Fragment,{children:[e.jsx(R,{onClick:d,style:{marginRight:0},children:e.jsx(K,{fontSize:"small"})}),e.jsx(ue,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:s=>s.zIndex.drawer+1},open:p,onClick:u,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(R,{onClick:u,children:e.jsx(ve,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),v.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(he,{style:{marginBottom:20}}),e.jsx(T,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:v.map((s,x)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(B,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{f(s.id)},children:s.evidenceNotes})},x))})]}),z.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(T,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:z.map((s,x)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(B,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{f(s.id)},children:s.matchLockName})},x))})]}),m.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(T,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:m.map((s,x)=>e.jsxs("li",{style:{marginBottom:4},children:[s.evidenceNotes," is a duplicate of ",e.jsx(B,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{f(s.supersedingEntryId)},children:s.supersedingLockName})]},x))})]}),h.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(T,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:h.map((s,x)=>e.jsxs("li",{style:{marginBottom:4},children:[s.evidenceNotes," is upgraded by ",e.jsx(B,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{f(s.supersedingEntryId)},children:s.supersedingLockName})]},x))})]})]})})]})}function Je(){const{cardDanPoints:r,cardBBCount:t,cardEligibleDan:a,cardNextDanPoints:p,cardNextDanLocks:n}=c.useContext(A),d=fe(),u=c.useCallback(()=>{d("/profile/scorecard/upgrades")},[d]);return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:["Eligible for Dan ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:a})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:r})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:t})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[p," point",p!==1&&"s"," and ",n," BB lock",n!==1&&"s"," to next Dan"]}),e.jsx("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:e.jsx(B,{onClick:u,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(We,{})})]})}export{Ze as I,Te as S,Je as a,Ke as b,Ge as c,Ye as d};
