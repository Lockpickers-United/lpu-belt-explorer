import{r,F as U,ag as C,aJ as I,g as R,a2 as V,j as W,ak as g,d as s,az as k,R as H}from"./index-Br3yKdvV.js";import{D as K,f as L}from"./DataContext-DTtaT4A0.js";import{r as S}from"./index-miKge_l_.js";function te({children:z,cardActivity:o,cardBBCount:u,cardDanPoints:c,cardEligibleDan:f,cardNextDanPoints:l,cardNextDanLocks:v,cardUniqueLocks:p,cardMaxBelt:e,popularLocks:t,popularLocksBB:n,profile:m,blackBeltScorecard:i}){const{filters:E}=r.useContext(U),{search:h,id:X,tab:Z,name:_,sort:A,image:$,locks:q,...j}=E,M=r.useMemo(()=>o.map(a=>{const d=C(a.matchId),x=I(a.matchId),F=R(a.matchId),J=F?"Belt":x?"Project":"Lock";return{...a,...d,...x,...F,id:a.id,type:J}}),[o]),O=r.useMemo(()=>M.reduce((a,d)=>(a[d.matchId]=d,a),{}),[M]),D=r.useMemo(()=>t.map(a=>({...C(a.id),...O[a.id],popularityRank:a.rank,userCount:a.saveCount})),[t,O]),w=r.useMemo(()=>n==null?void 0:n.map(a=>({...C(a.id),...O[a.id],popularityRank:a.rank,userCount:a.saveCount})),[n,O]),b=r.useMemo(()=>Object.keys(j).map(a=>{const d=j[a];return Array.isArray(d)?d.map(x=>({key:a,value:x})):{key:a,value:d}}).flat(),[j]),P=r.useMemo(()=>T(M,b,h,A),[M,b,h,A]),Y=r.useMemo(()=>T(D,b.concat({key:"exceptionType",value:void 0}),h,"popular"),[D,b,h]),y=r.useMemo(()=>(m==null?void 0:m.blackBeltAwardedAt)>0,[m]),G=r.useMemo(()=>({allEntries:V,cardActivity:o,cardBBCount:u,cardDanPoints:c,cardEligibleDan:f,cardNextDanPoints:l,cardNextDanLocks:v,visibleEntries:P,popularEntries:Y,bbPopularEntries:w,cardUniqueLocks:p,cardMaxBelt:e,blackBeltUser:y,blackBeltScorecard:i,getEntryFromId:C,getProjectEntryFromId:I,getAwardEntryFromId:R}),[o,u,c,f,l,v,P,Y,w,p,e,y,i]);return W.jsx(K.Provider,{value:G,children:z})}function T(z,o,u,c){const l=z.map(e=>{var t,n,m;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:i})=>i),fuzzy:S(((n=e==null?void 0:e.makeModels)==null?void 0:n.map(({make:i,model:E})=>[i,E]).flat().filter(i=>i).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}return"Worth Points"})()],simpleBelt:(m=e==null?void 0:e.belt)==null?void 0:m.replace(/\s\d/g,"")}}).filter(e=>o.every(({key:t,value:n})=>Array.isArray(e[t])?e[t].includes(n):e[t]===n)),v=u?L.go(S(u),l,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):l,p=(()=>{switch(c){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||k(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||g(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"dateAscending":return(e,t)=>s(e.date).valueOf()-s(t.date).valueOf()||g(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>s(t.date).valueOf()-s(e.date).valueOf()||g(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>k(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"beltDescending":return(e,t)=>g(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>s(s(t.date).format("YYYY-MM-DD")).valueOf()-s(s(e.date).format("YYYY-MM-DD")).valueOf()||g(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return v.sort(p)}const Q=H.createContext({});function ae({children:z}){const{filters:o,addFilters:u,removeFilters:c}=r.useContext(U),f=o.id,l=r.useCallback(p=>{p?u([{key:"id",value:p}],!0):c(["id"])},[u,c]),v=r.useMemo(()=>({expanded:f,setExpanded:l}),[f,l]);return W.jsx(Q.Provider,{value:v,children:z})}export{Q as S,te as a,ae as b};
