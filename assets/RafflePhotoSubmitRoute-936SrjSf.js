import{r as e,D as U,b as ct,d as mt,u as E,j as t,L as $,B as k,T as pt,A as xt,R as ht,e as ut,N as gt,h as ft}from"./index-C9FQgRYG.js";import{u as jt}from"./usePageTitle-v01Jxov2.js";import{R as yt}from"./RaflPotSearchBox-DClJ5poV.js";import{D as bt}from"./Dropzone-sRgxDPBk.js";import{L as vt}from"./LoadingDisplay-B20pMxEe.js";import{R as kt}from"./RaffleContext-DbqdJpUd.js";import{p as Ct,c as St}from"./postData-DjbH4qz6.js";import{n as Lt}from"./dataUrls-DVxTtpO-.js";import{C as Nt}from"./Checkbox-C0ZawYYy.js";import{C as Rt}from"./Collapse-DskmBOEL.js";import{T as C}from"./TextField-DlvGjyMi.js";import{I as Pt,a as wt}from"./ImageListItem-D-3RQLSf.js";import{D as S}from"./Dialog-CPcZPixf.js";import{A as Ft}from"./AdminToolButtons-DBHRPyy0.js";import"./Search-D-4bNWYf.js";import"./useFormControl-RICDS016.js";import"./Select-PBlO-pv4.js";import"./index-D3xIQtsF.js";import"./Cancel-KKGJTIZt.js";import"./LoadingDisplaySmall-BpfZi5ud.js";import"./Box-BTiZXmP_.js";import"./CircularProgress-eTZUB4UO.js";import"./useData--h01AJnp.js";import"./index-TtCAOyTV.js";import"./setDeep-J6HEwWhX.js";import"./index-C0RmN517.js";import"./SwitchBase-DPtXXIYu.js";import"./EmojiEvents-C11WGWLe.js";function zt({profile:s,user:d}){const{allPots:x=[]}=e.useContext(kt),{updateProfileField:h}=e.useContext(U),[n,c]=e.useState({}),[g,L]=e.useState(void 0),[r,f]=e.useState([]),[M,N]=e.useState(void 0),[R,j]=e.useState(!1),[l,P]=e.useState(void 0),[m,w]=e.useState(!1),[O,F]=e.useState(""),[z,B]=e.useState(""),[p,_]=e.useState((s==null?void 0:s.photoCredit)||(s==null?void 0:s.displayName)||""),[y,Y]=e.useState(!1),I=ct(),b=e.useMemo(()=>[...x],[x]),H=mt().format("YYYYMMDD-HHMMss"),K=!!(n!=null&&n.lockFullName)&&!!(n!=null&&n.lockId)&&!!p&&r.length>0,D=`${n.lockName}_${n.lockId}_`.replace("/","+"),A=`${p}`.replace("/","+"),G=r.map(o=>o.name),q=e.useCallback((o,a)=>{f(o)},[]),J=r.length===1?"File":"Files",Q=async o=>{o.preventDefault(),j(!0);const a=`${H}_${D}_${A}`,i=new FormData;r.forEach(u=>{const{base:v,ext:dt}=Bt(u.name);i.append("files",u,`${a}/${D}_${v}_${A}.${dt}`)}),i.append("droppedFileNames",G),i.append("lockFullName",n.lockFullName),i.append("lockName",n.lockName),i.append("lockId",n.lockId),i.append("photoCredit",p),i.append("displayName",s==null?void 0:s.displayName),i.append("uploadsDir",a),i.append("notes",z);const it=`${Lt}/upload`,rt=!0,lt=45e3;try{N(await Ct({user:d,url:it,formData:i,snackBars:rt,timeoutDuration:lt})),X(p)}catch(u){P(St(u)),c([]),r.forEach(v=>URL.revokeObjectURL(v.preview)),f([])}finally{j(!1)}},V=e.useCallback(o=>{c(o),L(b.find(a=>a.id===o.lockId))},[b]),X=e.useCallback(o=>{h("photoCredit",o)},[h]),Z=e.useCallback(o=>{const{value:a}=o.target;_(a)},[]),tt=e.useCallback(o=>{const{value:a}=o.target;B(a)},[]),W=e.useCallback(()=>{c({}),L(void 0),r.forEach(o=>URL.revokeObjectURL(o.preview)),f([]),N(void 0),j(!1),P(void 0),w(!1),F(""),B(""),Y(!y)},[r,y]),et=e.useCallback(()=>{w(!m),c([])},[m]),ot=e.useCallback(o=>{const{value:a}=o.target;F(a),c({lockFullName:a,lockName:a,lockId:"NOTINLIST"})},[]),st=m?.5:1,{flexStyle:nt,isMobile:at}=E(),T={color:"#bbb",textDecoration:"underline",cursor:"pointer",fontWeight:500,"&:hover":{color:"#fff"}};return t.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:600,marginBottom:20},children:["Pot ",t.jsx($,{onClick:()=>I("/rafl/contribute"),sx:T,children:"Info"})," |   Photos |  ",t.jsx($,{onClick:()=>I("/rafl/potpreview"),sx:T,children:"Preview"})]}),t.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:Q,children:t.jsxs("div",{children:[t.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"0px 0px 0px"},children:"Select Pot"}),t.jsx("div",{style:{opacity:st},children:t.jsx(yt,{handleChangeLock:V,allEntries:b,disabled:m,reset:y})}),t.jsxs("div",{style:{marginTop:0},children:[t.jsx(Nt,{onChange:et,color:"info",size:"small",id:"notInList",checked:m})," Submit photos for a pot not on the site."]}),t.jsxs(Rt,{in:m,style:{marginTop:10},children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx(C,{type:"text",id:"altLockName",name:"altLockName",value:O,style:{width:400},onChange:ot,color:"info"})]}),t.jsx("br",{}),t.jsx("br",{}),t.jsxs("div",{style:{display:nt},children:[t.jsxs("div",{style:{marginRight:50,marginBottom:20,width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",t.jsx("br",{})]}),at&&t.jsx("div",{style:{fontSize:"0.9rem",marginBottom:10,fontStyle:"italic"},children:"Previews may not appear on some mobile devices, but images will be uploaded."}),t.jsx(bt,{files:r||[],otherFiles:[],handleDroppedFiles:q,maxFiles:5,backgroundColor:"#333"}),g&&t.jsxs("div",{children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",t.jsx("br",{})]}),g.media?t.jsx("div",{children:t.jsx(Pt,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:g.media.map((o,a)=>t.jsx(wt,{children:t.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},a))})}):t.jsx("span",{children:"no images"})]})]}),t.jsxs("div",{style:{width:350},children:[t.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",t.jsx("br",{})]}),n.lockFullName&&t.jsxs("span",{children:[t.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),t.jsx("br",{}),t.jsx("div",{style:{display:"flex"},children:t.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:n.lockFullName})}),t.jsx("br",{})]}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"photoCredit",value:p,style:{width:350},onChange:Z,color:"info"}),t.jsx("br",{}),t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),t.jsx("br",{}),t.jsx(C,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:z,onChange:tt}),t.jsx("br",{}),t.jsx("br",{}),t.jsx(k,{type:"submit",variant:"contained",color:"info",disabled:!K||R,children:"Upload"})]})]}),t.jsx("br",{}),t.jsx("br",{})]})}),t.jsx(S,{open:R,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(vt,{})})}),t.jsx(S,{open:!!M&&!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:10,textAlign:"center"},children:[J," Uploaded Successfully!"]}),t.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:60,textAlign:"center"},children:"Images will be added to the site shortly"}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:W,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(S,{open:!!l,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[l==null?void 0:l.message,t.jsx("br",{}),"(Error code ",l==null?void 0:l.status,")"]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(k,{onClick:W,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(pt,{feature:"uploadPhotos"})]})}function Bt(s){const d=s.lastIndexOf(".");return d===-1?{base:s,ext:""}:{base:s.substring(0,d),ext:s.substring(d)}}function re(){const{isMobile:s}=E(),{lockCollection:d}=e.useContext(U),{user:x}=e.useContext(xt);jt("RAFL Pot Photos");const h=t.jsxs(ht.Fragment,{children:[!s&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(Ft,{})]}),n=s?8:0,c={maxWidth:700,marginLeft:"auto",marginRight:"auto",paddingLeft:n,paddingRight:n};return t.jsx(ut,{children:t.jsxs("div",{style:c,children:[t.jsx(gt,{title:"RAFL Pot Photos",extras:h}),t.jsx(zt,{profile:d,user:x}),t.jsx(ft,{})]})})}export{re as default};
