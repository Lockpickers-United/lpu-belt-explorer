import{r as l,F as R,j as t,A as M,a6 as D,ak as G,an as z,O as L,u as _,aa as W,ab as $,B as k}from"./index-BaQvk_ff.js";import{A as N,F as q,R as P}from"./ViewFilterButtons-CfpSKQB7.js";import{C as H}from"./ChoiceButtonGroup-CPI4zhgw.js";import{T as J,a as K}from"./ToggleButtonGroup-A7A51AIl.js";import{C as w}from"./Collapse-BAYACI-2.js";import{F as Q,I as U,S as X}from"./Select-DXLzWWfB.js";import{D as Y}from"./DataContext-Djy8i7W3.js";function Z({group:i={},onChange:e}){const{fieldName:p="",matchType:c="Is",operator:m="OR",values:a=[],groupIndex:u=0}=i,{filterFields:v}=l.useContext(R),f=v.find(r=>r.fieldName===p)||{},h=l.useMemo(()=>[{label:"OR",value:"OR"},{label:"AND",value:"AND"}],[]),g=l.useCallback(()=>{const r=[...a,""];e&&e({values:r})},[e,a]),n=l.useCallback(r=>{const o=(r==null?void 0:r.value)||(r==null?void 0:r.label)||"OR";e&&e({operator:o})},[e]),b=l.useCallback((r,o)=>{const s=a.map((d,I)=>I===r?o:d);e&&e({values:s})},[e,a]),j=l.useCallback(r=>{const o=a.filter((s,d)=>d!==r);e&&e({values:o})},[e,a]);return t.jsxs("div",{children:[a.length>0&&a.map((r,o)=>t.jsxs("div",{style:{display:"block",width:250},children:[t.jsx(N,{...f,active:!0,group:i,groupIndex:u,matchType:c,operator:m,valueIndex:o,currentValue:r,groupValues:a,onFilter:s=>b(o,s),onRemove:()=>j(o),handleAddValue:g,size:"small"},o),o===0&&a.length>1&&t.jsx(H,{options:h,defaultValue:m,onChange:n,small:!0,rounded:!0,style:{margin:"0px 0 13px 0"}})]},o)),a.length===0&&t.jsx(N,{...f,active:!0,group:i,groupIndex:u,matchType:c,operator:m,currentValue:"",onFilter:r=>e&&e({values:[r]}),onRemove:()=>e&&e({values:[]}),handleAddValue:g,size:"small"},0)]})}function ee({options:i,onChange:e,defaultValue:p,rounded:c,small:m=!1,style:a={}}){const[u,v]=l.useState(p||i[0].value),f=l.useCallback(n=>()=>{const b=i.find(j=>j.value===n);v(n),e&&e(b)},[e,i]),h=m?{padding:"1px 10px"}:{padding:"6px 12px"},g=c?null:{borderRadius:0};return t.jsx(J,{variant:"outlined",style:{...a,borderRadius:c?4:0},children:i.map(n=>t.jsx(K,{onClick:f(n.value),style:{color:u===n.value?"#eee":"#777",backgroundColor:u===n.value?n.backgroundColor||"#292929":"#111",borderColor:"#000",...h,...g},value:String(u),children:n.label},n.value))})}function te({group:i={},onChange:e}){const{isLoggedIn:p}=l.useContext(M),{beta:c}=l.useContext(D),{filterFields:m,advancedFilterGroups:a}=l.useContext(R),{fieldName:u="",matchType:v="Is"}=i,[f,h]=l.useState(u),g=l.useMemo(()=>m.filter(s=>(!s.beta||c)&&(!s.userBased||p)).filter(s=>!a().some(d=>d.fieldName===s.fieldName&&s.fieldName!==u)),[a,c,u,m,p]),n=l.useCallback(s=>{const d=s.target.value;h(d),e&&e({fieldName:d,values:[]}),setTimeout(()=>document.activeElement.blur())},[e]),b=l.useMemo(()=>[{label:"Is",value:"Is"},{label:"Not",value:"Is Not",backgroundColor:"#733030"}],[]),j=l.useCallback(s=>{const d=(s==null?void 0:s.value)||(s==null?void 0:s.label)||"Is";e&&e({matchType:d})},[e]),[r,o]=l.useState(!1);return l.useEffect(()=>{o(!0)},[]),t.jsx(w,{in:r||u.length>0,unmountOnExit:!0,children:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",margin:"0px 0 12px 0",alignItems:"flex-start"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",marginTop:0},children:[t.jsxs(Q,{style:{width:200,marginRight:0,marginTop:8},size:"small",children:[t.jsx(U,{color:"info",children:"Filter"}),t.jsx(X,{value:f,label:"Filter",onChange:n,color:"info",name:"fieldName",children:g.map((s,d)=>t.jsx(G,{value:s.fieldName,children:s.label},d))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[t.jsx(ee,{options:b,defaultValue:v,onChange:j,small:!1,rounded:!0,style:{height:40,margin:"8px 12px 8px 12px",borderRadius:4}}),t.jsx("br",{})]})]}),t.jsx("div",{style:{display:"flex",alignItems:"flex-start",marginTop:8},children:t.jsx(Z,{group:i,onChange:e})})]})})}function ue(){const{advancedFilterGroups:i,setAdvancedFilterGroups:e,showAdvancedSearch:p,setShowAdvancedSearch:c,hideAdvancedSearch:m,filterCount:a,removeFilters:u,clearFilters:v}=l.useContext(R),{visibleEntries:f=[],visibleBeltEntries:h}=l.useContext(Y),g=z(),n=L.parse(g.search);l.useEffect(()=>{n.preview==="advanced"&&(c(!0),u(["preview"]))},[u,n.preview,c]);const b=l.useCallback(()=>{const x=[...i(),{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}];e(x)},[i,e]),j=l.useCallback(()=>{v()},[v]),r=l.useCallback((x,y)=>{const T=i().map((C,V)=>V===x?{...C,...y}:C);e(T)},[i,e]),o=l.useCallback(x=>{let F=i().filter((T,C)=>C!==x);F.length===0&&(F=[{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),e(F)},[i,e]);l.useEffect(()=>{i().length===0&&!m&&e([{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),a>0&&c(!0)},[i,a,m,e,c]);const{isMobile:s}=_(),d=s?{maxWidth:700,borderRadius:0}:{maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},I=s?8:16,O=s?2:0,[B,S]=l.useState(!1);l.useEffect(()=>{m?S(!1):(p||a>0)&&S(!0)},[p,a,m]);const[E,A]=l.useState(!1);return l.useEffect(()=>{if(p||a>0)A(!0);else{const x=setTimeout(()=>{A(!1)},300);return()=>clearTimeout(x)}},[p,a]),t.jsx(w,{in:B,unmountOnExit:!0,children:E&&t.jsx(W,{style:{...d,paddingBottom:0,paddingTop:16},id:"advanced-filters",children:t.jsxs($,{style:{paddingTop:0,paddingLeft:I,paddingRight:I,alignItems:"top"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"top",marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"top"},children:[t.jsxs("div",{style:{display:"flex",marginRight:36,marginBottom:0,alignItems:"center"},children:[t.jsx("div",{style:{fontWeight:700,fontSize:"1.3rem"},children:"Advanced Filters"}),t.jsxs("div",{style:{fontWeight:400,fontSize:"1.0rem",marginLeft:8},children:["(",(h||f||[]).length||0," Lock",(h||f||[]).length!==1&&"s",")"]})]}),t.jsx(q,{style:{margin:"16px 0px 0px 0px"}})]}),t.jsx("div",{style:{flexGrow:1,textAlign:"right",alignItems:"top",marginTop:O},children:t.jsx(P,{alwaysShow:!0})})]}),t.jsx("div",{style:{display:"flex",flexDirection:"column"},children:i().map((x,y)=>t.jsx(te,{group:{...x,groupIndex:y,groupId:x._id},groupIndex:y,onChange:F=>r(y,F),onRemove:()=>o(y)},x._id||y))}),t.jsxs("div",{style:{display:"flex",justifyContent:"center",marginTop:2},children:[t.jsx(k,{onClick:j,variant:"contained",size:"small",style:{backgroundColor:"#444",marginRight:16},children:"Clear"}),t.jsx(k,{onClick:b,variant:"contained",color:"info",size:"small",children:"Add Filter"})]})]})})})}export{ue as A};
