import{af as R,r as t,K as H,p as ee,j as e,R as E,t as b,Z as A,$ as me,v as P,a9 as q,w as ue,a0 as te,a5 as je,a7 as ge,x as ye,a8 as fe,al as ve,M as se,T as Ce,I as be,y as z,z as O,A as $,am as ke,an as Se,O as Ee,P as we,Q as De}from"./index-5981b98a.js";import{u as Ae}from"./useData-d58eb7f6.js";import{S as Ie,I as K,a as Q,b as Le,c as Te,d as Be}from"./ScorecardDanStats-b399cf15.js";import{B as Fe,D as ae,F as Pe,e as Y,a as Re,s as Me}from"./BeltStripe-6753dd24.js";import{u as M}from"./useWindowSize-74c355bb.js";import{L as ne,B as Ne}from"./LoadingDisplay-f653c1d1.js";import{L as ze}from"./Link-0c479988.js";import{T as Oe}from"./TextField-81f9dd49.js";import{L as re,A as oe,D as $e,E as He}from"./CollectionButton-bfb36e3d.js";import{m as We,P as Ue,a as Ge}from"./ProfileHeader-3eaae6c8.js";import{b as Je,S as _e,a as Ve,s as qe,F as Ke}from"./sortFields-f30d7ae4.js";import{A as ie,a as le,b as ce}from"./Sort-b6af923c.js";import{I as Qe}from"./IntroCopy-51cca29d.js";import{L as Ye}from"./LoadingDisplay-cc5fa3eb.js";import{d as Z,a as X,b as Ze,c as Xe}from"./download-d10cf3e7.js";import{d as et}from"./ContentCopy-5b8d1b0e.js";import"./Link-b5f57d46.js";import"./chartDefaults-9fc07b21.js";import"./nivo-bar.es-56f0770b.js";import"./nivo-legends.es-e5bd197e.js";import"./index-80c77461.js";import"./Select-dbbf16ce.js";import"./PhotoCamera-07c92afd.js";import"./Dialog-4bac2972.js";import"./Autocomplete-e8f8c9d0.js";import"./Search-1e6d9ef6.js";import"./ListItem-573966f9.js";import"./CopyProfileLinkButton-ac7854fe.js";import"./ToggleButtonGroup-6bdfdb88.js";import"./LPU-c3fa7122.js";import"./LinearProgress-accb3105.js";function tt({setControlsExpanded:n,adminAction:s}){const{userId:x}=R(),{importUnclaimedEvidence:p}=t.useContext(H),{isMobile:r}=M(),[l,d]=t.useState(!1),h=ee(),[m,c]=t.useState(""),[y,o]=t.useState(null),u=t.useCallback(async()=>{d(!0);const i=await p(x,m);d(!1),i?(c(""),n(!1),s()):o("Cannot find dan sheet tab")},[p,x,m,n,s]),j=r?"block":"flex";return e.jsx(E.Fragment,{children:e.jsx("div",{style:{placeItems:"center",display:j},children:l?e.jsx(ne,{}):e.jsx(E.Fragment,{children:e.jsxs("div",{style:{padding:20},children:[e.jsx("strong",{children:"For Black Belt pickers only."}),e.jsx("br",{}),"Black Belt pickers currently use another scorecard system known as the Dan Sheet. This import allows them to bring their picking history over to the site. If you do not already have a tab in the Dan sheet, this import will not work for you. For those that do, specify the name of your tab in the sheet to import your history into your Scorecard. Please note that tab names are case sensitive. ",e.jsx(ze,{onClick:()=>{h("/profile/scorecard/howto")},style:{color:"#bbb",cursor:"pointer"},children:"Click here to learn more."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("div",{style:{padding:"0px",alignItems:"center"},children:e.jsxs("div",{style:{padding:"0px",display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(Oe,{id:"tab-to-import",label:"Tab to Import",value:m,size:"small",error:!!y,helperText:y,margin:"dense",color:"secondary",onChange:i=>{c(i.target.value)}}),e.jsx(b,{style:{color:"#000",padding:0,lineHeight:"1rem",height:40,marginTop:8,marginLeft:10},variant:"contained",onClick:u,edge:"start",color:"secondary",children:"Import"})]})})]})})})})}A.extend(me);function st({owner:n,date:s}){const{userId:x}=R(),{updateProfileBlackBeltAwardedAt:p}=t.useContext(H),[r,l]=t.useState(!1),[d,h]=t.useState(!1),[m,c]=t.useState(A.utc(s)),y=t.useCallback((S,B)=>{n&&l(B)},[n]),o=t.useCallback(()=>{c(A.utc(s)),h(!1)},[s]),u=t.useCallback(async()=>{try{p(x,m),P("Profile updated"),h(!1)}catch(S){console.error("Error while updating profile",S),P("Error while updating profile")}},[x,m,p]);let j=s?A.utc(s).format("L"):"(no date)";j=j.replace("/202","/2"),j=j.replace("/201","/1");const i={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"},a=n?{}:{cursor:"default"},g=n?e.jsx(ue,{}):null,{isMobile:v}=M(),w=v?"block":"flex",D=v?"65%":"56%",T=v?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},I=d?"#fff":"#555",k=d?"#e15c07":"#555";return e.jsxs(E.Fragment,{children:[e.jsxs(ie,{expanded:r,onChange:y,children:[e.jsxs(le,{expandIcon:g,style:{...i,...a},children:[e.jsx(Fe,{value:"Black"}),e.jsx("div",{style:{margin:"4px 0px 0px 8px",width:D,flexShrink:0,flexDirection:"column"},children:e.jsx(Je,{value:"Black Belt Awarded",textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}})}),e.jsxs("div",{style:{display:w,placeItems:"center",marginLeft:10},children:[e.jsx("div",{style:{display:"flex",width:76}}),e.jsx("div",{style:T,children:e.jsx("div",{style:{margin:"4px 0px 0px 10px"},children:j})})]})]}),r&&e.jsx(ce,{sx:{padding:"4px 16px 0px 26px"},children:e.jsx(re,{adapterLocale:A.locale(),dateAdapter:oe,children:e.jsx(E.Fragment,{children:e.jsxs("div",{style:{display:"flex",width:"100%",marginBottom:20},children:[e.jsx($e,{label:"Awarded date",value:m,onChange:S=>{c(S),h(!0)},sx:{width:400},disableFuture:!0}),e.jsxs("div",{style:{width:"100%",textAlign:"right",position:"relative",top:"30px",padding:"0px 12px 8px 0px"},children:[e.jsx(b,{style:{marginRight:10,color:k},onClick:o,disabled:!d,children:"Cancel"}),e.jsx(b,{style:{marginRight:0,color:I},onClick:u,disabled:!d,children:"Save"})]})]})})})})]}),e.jsx(q,{}),e.jsx(q,{})]})}function at({collectionType:n}){const{user:s}=t.useContext(te),{userId:x}=R(),p=ee(),{isMobile:r}=M(),l=r?{marginTop:20,maxWidth:700,marginLeft:8,marginRight:8,borderRadius:0}:{marginTop:20,maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},d=x===(s==null?void 0:s.uid),h=d?e.jsx("div",{style:{width:"100%",display:"flex",placeItems:"center"},children:e.jsxs("div",{style:{fontSize:"1.0rem",fontWeight:400,width:400,marginLeft:"auto",marginRight:"auto"},children:[e.jsx("strong",{children:"There are no locks in your Scorecard."}),e.jsx("br",{}),'Browse the site and use the "My Collection" button to track locks that you have picked and recorded.',e.jsx("br",{}),e.jsx("br",{}),e.jsx("img",{alt:"My Collection",src:We})]})}):"There are no locks in this collection.",m=d?n==="safelocks"?"Explore Safe Locks":"Explore Locks":"Go Home",c=t.useCallback(()=>{p(n==="safelocks"?"/safelocks":"/locks")},[p,n]);return e.jsx(Ne,{alignContent:"center",children:e.jsxs(je,{style:l,children:[e.jsx(ge,{children:e.jsx(ye,{variant:"h6",align:"center",children:h})}),e.jsxs(fe,{children:[e.jsx("div",{style:{width:"100%"}}),e.jsx(b,{variant:"outlined",color:"secondary",onClick:c,style:{whiteSpace:"nowrap",padding:"10px 30px",margin:10},children:m})]})]})})}function nt({owner:n,profile:s,adminAction:x}){const{isMobile:p}=M(),{userId:r}=R(),{visibleEntries:l=[],cardEvidence:d}=t.useContext(ae),{expanded:h}=t.useContext(Ie),{filters:m,removeFilters:c}=t.useContext(Pe),{createEvidenceForEntries:y,removeEvidence:o,removeProfileBlackBeltAwarded:u,updateUserStatistics:j}=t.useContext(H),{admin:i}=t.useContext(ve),[a,g]=t.useState(h),[v,w]=t.useState(!1),[D,T]=t.useState("import"),[I,k]=t.useState(!1);h&&h!==a&&g(h);const S=t.useMemo(()=>{if(s&&s.recorded){const f=d.map(G=>G.matchId);return s.recorded.filter(G=>!f.includes(G))}else return[]},[s,d]),B=t.useCallback(f=>{m.id&&c(["id"]),g(f)},[m,c]),W=t.useCallback(async()=>{k(!0),await y(r,S),w(!1),k(!1),x()},[y,r,S,x]),L=t.useCallback(f=>{T(f),w(!v)},[v]),[N,C]=t.useState(null),F=!!N,de=t.useCallback(f=>{f.preventDefault(),f.stopPropagation(),C(f.currentTarget)},[]),U=t.useCallback(()=>C(null),[]),xe=t.useCallback(async()=>{k(!0),await j(r),k(!1)},[j,r]),pe=t.useCallback(async()=>{k(!0),await o(d),await u(r),U(),k(!1),x()},[d,o,U,x,u,r]),J=p?10:40,_=p?"block":"flex",V=(s==null?void 0:s.blackBeltAwardedAt)>0,he=V?"100%":"50%";return e.jsxs("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:[e.jsx(Ue,{profile:s,page:"scorecard"}),n&&l.length>0&&!s.tabClaimed&&e.jsx("div",{style:{margin:8,padding:"0px 0px"},children:e.jsx(Qe,{pageName:"scorecard"})}),l.length>0&&e.jsx(E.Fragment,{children:p?e.jsxs("div",{style:{display:_,padding:"0px 8px 0px 16px"},children:[s.danLevel>0&&e.jsx(Q,{}),e.jsx("div",{style:{marginRight:0,width:"95%"},children:e.jsx(K,{profile:s,entries:l})})]}):e.jsxs("div",{style:{display:_,padding:"10px 8px 0px 16px"},children:[e.jsx("div",{style:{marginRight:0,width:380},children:e.jsx(K,{profile:s,entries:l})}),s.danLevel>0&&e.jsx("div",{style:{flexGrow:1,marginRight:0},children:e.jsx(Q,{})})]})}),(n||i)&&e.jsxs(ie,{expanded:v,disableGutters:!0,children:[e.jsx(le,{style:{paddingLeft:J,paddingRight:J,placeItems:"center",width:"100%"},children:e.jsxs("div",{style:{width:"100%",placeItems:"center",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",width:"100%",placeItems:"center",textAlign:"center"},children:[!V&&e.jsx("div",{style:{width:"50%",textAlign:"center"},children:e.jsx(b,{variant:"contained",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>L("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:he,textAlign:"center"},children:e.jsx(b,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>L("project"),children:v&&D==="project"?"CANCEL ADD PROJECT":"ADD PROJECT"})})]}),I&&e.jsx(ne,{}),i&&!I&&e.jsx("div",{style:{backgroundColor:"#700",padding:5,marginTop:20},children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{width:"10%",textAlign:"center"},children:"admin"}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(b,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>L("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsx(b,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:xe,children:"UPDATE STATS"})}),e.jsx("div",{style:{width:"20%",textAlign:"center"},children:e.jsxs(b,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:W,children:["MERGE RECORDED (",S.length,")"]})}),e.jsxs("div",{style:{width:"20%",textAlign:"center"},children:[e.jsx(b,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:de,children:"DELETE SCORECARD"}),e.jsxs(se,{anchorEl:N,open:F,onClose:U,children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["You cannot undo delete.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(b,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:pe,edge:"start",color:"error",children:"Delete"})})]})]})]})})]})}),e.jsxs(ce,{style:{backgroundColor:"#333"},children:[D==="import"&&e.jsx(tt,{setControlsExpanded:w,adminAction:x}),D==="project"&&e.jsx(He,{evid:null,handleUpdate:L,addProject:!0})]})]}),l.length===0&&e.jsx(at,{}),s&&s.blackBeltAwardedAt&&e.jsx(st,{owner:n,date:s.blackBeltAwardedAt.toDate().toJSON()}),e.jsx("div",{children:l.map(f=>e.jsx(Le,{owner:n,evid:f,expanded:f.id===a,onExpand:B,merged:s.blackBeltAwardedAt>0},f.id))})]})}function rt(){const[n,s]=t.useState(null),x=!!n,p=t.useCallback(c=>s(c.currentTarget),[]),r=t.useCallback(()=>s(null),[]),{visibleEntries:l=[]}=t.useContext(ae),d=t.useCallback(()=>{const c=JSON.stringify(l);r(),Z("scorecardData.json",c),P("Current Scorecard entries downloaded as scorecardData.json")},[r,l]),h=t.useCallback(()=>{const y=l.map(o=>({id:o.id,make:o.makeModels.map(u=>u.make).join(","),model:o.makeModels.map(u=>u.model).join(","),version:o.version,belt:o.belt,name:Y(o),versionText:o.version?" ("+o.version+")":""})).map(o=>"* "+o.name+o.versionText).join(`
`);r(),navigator.clipboard.writeText(y),P("Current scorecard entries copied to clipboard.")},[r,l]),m=t.useCallback(()=>{const c=["id","name","version","belt","modifier","points","date","link"],y=l.map(i=>({id:i.matchId,make:i.makeModels.map(a=>a.make).join(","),model:i.makeModels.map(a=>a.model).join(","),version:i.version,belt:i.belt,link:i.link,modifier:i.modifier,points:i.points,date:i.date?A(i.date).format("L"):"",name:Y(i)})),o=c.join(","),u=y.map(i=>c.map(a=>i[a]).map(a=>{const g=`${a??""}`.replace(/"/g,'""');return/(\s|,|")/.test(g)?`"${g}"`:g}).join(",")).join(`
`),j=`${o}
${u}`;r(),Z("scorecardData.csv",j),P("Current Scorecard entries downloaded as scorecardData.csv")},[r,l]);return e.jsxs(E.Fragment,{children:[e.jsx(Ce,{title:"Export",arrow:!0,disableFocusListener:!0,children:e.jsx(be,{onClick:p,children:e.jsx(X,{})})}),e.jsxs(se,{anchorEl:n,open:x,onClose:r,children:[e.jsxs(z,{disabled:!0,children:[e.jsx(O,{children:e.jsx(X,{fontSize:"small"})}),e.jsx($,{children:"Export"})]}),e.jsxs(z,{onClick:h,children:[e.jsx(O,{children:e.jsx(et,{fontSize:"small"})}),e.jsx($,{children:"Copy to clipboard"})]}),e.jsxs(z,{onClick:m,children:[e.jsx(O,{children:e.jsx(Ze,{fontSize:"small"})}),e.jsx($,{children:"CSV"})]}),e.jsxs(z,{onClick:d,children:[e.jsx(O,{children:e.jsx(Xe,{fontSize:"small"})}),e.jsx($,{children:"JSON"})]})]})]})}function Nt(){const{userId:n}=R(),{user:s}=t.useContext(te),{getProfile:x,getEvidence:p}=t.useContext(H),{scoredEvidence:r,bbCount:l,danPoints:d,eligibleDan:h,nextDanPoints:m,nextDanLocks:c}=t.useContext(ke),{isMobile:y}=M(),[o,u]=t.useState(!1),j=t.useCallback(()=>{u(!o)},[o]),i=t.useCallback(async()=>{try{const C=await x(n);if(C){const F=C.displayName?C.displayName.toLowerCase().endsWith("s")?`${C.displayName}'`:`${C.displayName}'s`:"Anonymous";document.title=`LPU Belt Explorer - ${F} Scorecard`}if((s==null?void 0:s.uid)!==n){const F=await p(n);return{profile:C,...Se(F)}}else return{profile:C,scoredEvidence:r,bbCount:l,danPoints:d,eligibleDan:h,nextDanPoints:m,nextDanLocks:c}}catch(C){return console.error("Error loading profile and evidence.",C),null}},[o,s,n,x,p,r,l,d,h,m,c]),{data:a={},loading:g,error:v}=Ae({loadFn:i}),w=a?a.profile:{},D=a?a.scoredEvidence:[],T=a?a.bbCount:0,I=a?a.danPoints:0,k=a?a.eligibleDan:0,S=a?a.nextDanPoints:0,B=a?a.nextDanLocks:0,W=e.jsxs(E.Fragment,{children:[e.jsx(_e,{label:"Scorecard",extraFilters:[{key:"tab",value:"search"}]}),e.jsx(Ve,{sortValues:qe}),e.jsx(Ke,{extraFilters:[{key:"tab",value:"search"}]}),!y&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})]}),L=e.jsxs(E.Fragment,{children:[e.jsx("br",{}),e.jsx(rt,{})]}),N=g?"Loading...":"Profile";return g||v?null:e.jsx(Re,{filterFields:Me,children:e.jsx(Te,{cardEvidence:D,cardBBCount:T,cardDanPoints:I,cardEligibleDan:k,cardNextDanPoints:S,cardNextDanLocks:B,children:e.jsxs(Be,{children:[e.jsxs(re,{adapterLocale:A.locale(),dateAdapter:oe,children:[e.jsx(Ee,{title:N,extras:W}),g&&e.jsx(Ye,{}),!g&&a&&!v&&e.jsx(nt,{owner:s&&s.uid===n,profile:w,adminAction:j}),!g&&(!a||v)&&e.jsx(Ge,{}),e.jsx(we,{extras:L})]}),e.jsx(De,{feature:"scorecard"})]})})})}export{Nt as default};
