import{d as F,u as R,j as t,R as L,b as U,r as f,L as $,A as _,e as J,N as K,h as Q,T as Z}from"./index-DVSFr6OD.js";import{c as tt}from"./filterFields-BuUFPiNz.js";import{L as et}from"./LoadingDisplay-12eRQ-ru.js";import{u as V}from"./useData-CR5OB6H1.js";import{u as nt}from"./usePageTitle-BDU_duyy.js";import{m as ot,j as it,o as st,s as at}from"./dataUrls-DkJe4Pqg.js";import{y as H}from"./nivo-line-CAonIqpy.js";import{p as N}from"./adminChartDefaults-CBhS7ojG.js";import{A as rt}from"./AdminStatsTable-Bq05FVLR.js";import{A as Y}from"./AdminStatsTableSort-BpzAHlpv.js";import{R as lt}from"./RaffleAutocompleteBox-BWd6XupO.js";import{D as ct}from"./DataContext-ks8A5s2j.js";import{R as B,A as dt}from"./AdminRoleButton-B88sEehX.js";import{a as P}from"./setDeep-J6HEwWhX.js";import{R as mt,a as ut}from"./RaffleYOYLines-j1y2gwez.js";import{C as ft}from"./ChoiceButtonGroup-ChkG1e4V.js";import{X as ht}from"./nivo-bar-DKGMK2HS.js";import{p as pt}from"./chartDefaults-pV7GKcxU.js";import{R as xt}from"./ReportButton-CZFDCGkC.js";import{R as gt}from"./RaffleDataProvider-DGaMAPCy.js";import"./LPU-DltM2OBF.js";import"./LinearProgress-CAJ9i2uh.js";import"./nivo-legends-MJcnM5uq.js";import"./nivo-axes-CffKF4FQ.js";import"./uniq-CEc6DxCl.js";import"./line-lAozK6xi.js";import"./TableRow-B9uep0jf.js";import"./Search-Dfn_e4WH.js";import"./useFormControl-DTv-C_uL.js";import"./Select-B2ePLM0t.js";import"./TextField-CGjTFXh-.js";import"./index-DV9PfA0w.js";import"./ToggleButtonGroup-BiQAEkh9.js";import"./_baseClone-cyP827LW.js";import"./filterEntries-BBFZIbGW.js";const yt=({lineData:n})=>{const r=[n.rafl28days.data],i=[],o=new Map,e=new Map,s=new Map;r.forEach(m=>{const g=[],j=[],k=[];for(let w=0;w<m.length;w++){let S=m[w].date;if(F(S)<F("2024-12-25"))continue;S=S+" 23:59:59";const h=new Map;h.x=S,h.y=m[w].potListViews,g.push(h);const p=new Map;p.x=S,p.y=m[w].potViews,j.push(p);const T=new Map;T.x=S,T.y=m[w].raflForm,k.push(T)}o.id="Pot List",o.data=g,e.id="Pot Views",e.data=j,s.id="Entry Form",s.data=k,i.push(e),i.push(o),i.push(s)});const{width:l}=R(),d=l<=360,u=l<=395,b=l<=428,y=l<=560,v=l<=820,x=d||u?200:b?210:v?230:350,C=y?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:x,width:"100%"},children:t.jsx(H,{theme:N,data:i,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:C,height:x,curve:"natural",yScale:{type:"linear",min:0,max:"5000",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function bt({data:n}){const{width:r}=R(),i=r<=560,s={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...i?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:s,children:t.jsx(yt,{lineData:n})})})})}const jt=({data:n})=>{const{rafl28days:r}=n,i=r.data.filter(m=>F(m.date)>F("2024-12-28")),o=i.reduce((m,g)=>(Object.keys(r.data[r.data.length-1]).map(j=>{["date","dateString"].includes(j)||(m[j]=m[j]?m[j]+g[j]:g[j])}),m),{});o.dateString="Total",i.push(o);const e=Object.keys(o).reduce((m,g)=>(m[g]=Math.floor(o[g]/i.length),m),{});e.dateString="Average",i.push(e);const s={columns:r.columns,data:i},{width:l}=R(),d=l<=360,u=l<=395,b=l<=428,y=l<=560,v=l<=820,x=d?".8rem":u?".85rem":b?".9rem":".95rem";return t.jsx(rt,{tableData:s,tableWidth:"100%",fontSize:x})},wt=({statsData:n})=>{const r=U(),{potViewsById:i}=n,{getPotFromId:o}=f.useContext(ct),{data:e}=V({url:ot}),{potWatches:s}=e||{},l=[{name:"Pot #",align:"center",id:"potNumber"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"},{id:"watchlists",name:"Watchlists",align:"center"}],d=!0,[u,b]=f.useState("potNumber"),[y,v]=f.useState(!0),[x,C]=f.useState({}),m=i.data.map(a=>{var A,z;const c=o(a.id);if(!c)return null;let D=c!=null&&c.title?c.title.substring(0,32):`unknown (${a.id})`;D=((A=c==null?void 0:c.title)==null?void 0:A.length)<32||!(c!=null&&c.title)?D:D+"...";const M=(z=a==null?void 0:a.id)==null?void 0:z.replace("2025-","");return{...a,percentViews:Math.floor(a.percentViews*100)+"%",...c,title:D,id:M,watchlists:(s==null?void 0:s[a.id])||0}}).filter(a=>a).sort((a,c)=>{switch(u){case"potNumber":return a.potNumber-c.potNumber||a.title.localeCompare(c.title);case"id":return a[u].localeCompare(c[u]);case"title":return a[u].localeCompare(c[u]);case"donors":return parseInt(c[u])-parseInt(a[u])||a.title.localeCompare(c.title);case"percentViews":return parseInt(c[u])-parseInt(a[u])||a.views-c.views;default:return parseInt(c[u])-parseInt(a[u])||a.title.localeCompare(c.title)}}),g=y?m:m.reverse(),k=(Object.keys(x).length>0?[g==null?void 0:g.find(a=>a.title===x.itemTitle)]:g||[]).map(a=>a.donors&&a.donors>0?{...a}:{...a,donors:0,tickets:0}),w={columns:l,data:k},S=f.useCallback((a,c)=>{const D=m.find(A=>A.title===c),M=D==null?void 0:D.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return a==="title"?t.jsx($,{onClick:()=>r(`/rafl/?id=2025-${D.id}&name=${M}`),style:{color:"#fff"},children:c}):c},[r,m]),h=f.useCallback(a=>a!=null&&a.title?a.title:"unknown",[]),{width:p}=R(),T=p<=360,O=p<=395,G=p<=428,q=p<=560,X=p<=820,E=T?".8rem":O?".85rem":G?".9rem":".95rem";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(lt,{allItems:m,setItemDetails:C,getOptionTitle:h,searchText:"Search Pots"})})}),t.jsx(Y,{tableData:w,tableWidth:"100%",fontSize:E,sortable:d,sort:u,setSort:b,ascending:y,setAscending:v,linkFunction:S})]})},vt=()=>{const{allCharities:n}=f.useContext(B),r=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],i=!0,[o,e]=f.useState("name"),[s,l]=f.useState(!0),d=n.sort((h,p)=>{switch(o){case"name":return h.name.localeCompare(p.name);case"donors":return p[o]-h[o];case"donations":return p[o]-h[o];default:return h.name.localeCompare(p.name)}}),b=(s?d:d.reverse()).map(h=>h.donations&&h.donations>0?{...h,donations:`$${h.donations}`}:{...h}),y={columns:r,data:b},v=f.useCallback((h,p)=>p,[]),{width:x}=R(),C=x<=360,m=x<=395,g=x<=428,j=x<=560,k=x<=820,w=C?".8rem":m?".85rem":g?".9rem":".95rem";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(Y,{tableData:y,tableWidth:"100%",fontSize:w,sortable:i,sort:o,setSort:e,ascending:s,setAscending:l,linkFunction:v})]})};function W({chartHeight:n,chartdata:r,showAxisBottom:i,colors:o,tickValues:e,curve:s}){const l=i?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},d=i?"bottom":"top-left",u=i?70:20,b=i?0:20;return t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(H,{theme:N,data:r,enableGridX:!1,enableGridY:!1,colors:o,lineWidth:3,margin:l,height:n,curve:s??"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:e||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:i?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:i?[]:[{anchor:d,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:b,translateY:u,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const St=({data:n})=>{const r=Object.keys(n).sort((e,s)=>e.localeCompare(s)).reduce((e,s)=>{const l=s+" 23:59:59";return e.donorsCum=e.donorsCum+n[s].totalDonors||n[s].totalDonors,P(e,["totalDonors"],{x:l,y:n[s].totalDonorCountUnique}),P(e,["cumulativeDonors"],{x:l,y:n[s].cumDonorsUnique}),e.donationsCum=e.donationsCum+n[s].totalDonations||n[s].totalDonations,P(e,["totalDonations"],{x:l,y:n[s].totalDonations}),P(e,["cumulativeDonations"],{x:l,y:e.donationsCum}),e},[]),i={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},o=120;return Object.keys(n).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:i,children:"Donations"}),t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(W,{chartdata:[{id:"Donations Cumulative",data:r.cumulativeDonations}],chartHeight:o,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(W,{chartdata:[{id:"Donations",data:r.totalDonations}],chartHeight:o,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:i,children:"Unique Donors"}),t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(W,{chartdata:[{id:"Donors Cumulative",data:r.cumulativeDonors}],chartHeight:o,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:o,width:"100%"},children:t.jsx(W,{chartdata:[{id:"Donors",data:r.totalDonors}],chartHeight:o,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},Dt=({beltDistribution:n})=>{const{width:r}=R(),i=r<500,o=250,e=i?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},s=i?-45:0,l=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:o},children:t.jsx(ht,{data:n,maxValue:"auto",margin:e,padding:.15,colors:d=>l[d.index%l.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:s},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:pt,isInteractive:!1})})};function Rt({data:n}){const r=f.useMemo(()=>I.map(d=>({value:n.beltDonations[d]?n.beltDonations[d]/n.totalDonations:0,id:d,label:d})),[n]),i=f.useMemo(()=>I.map(d=>({value:n.beltDonorCountUnique[d]?n.beltDonorCountUnique[d]/n.totalDonorCountUnique:0,id:d,label:d})),[n]),o=f.useMemo(()=>[{label:"Donations",data:r},{label:"Donors",data:i}],[r,i]),[e,s]=f.useState(o[0]),l=f.useCallback(d=>s(d),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ft,{options:o,onChange:l}),t.jsx(Dt,{beltDistribution:e.data})]})}const I=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"];function Ct(){nt("RAFL Report");const{data:n,loading:r,error:i}=V({urls:kt}),{siteFullNew:o,raflResponseDetails:e,raflSiteStats2025:s}=n||{},{width:l}=R(),u=l<560?"8px 8px 32px 8px":"24px 24px 32px 24px",b={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},y={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},v=b,x=r?"--":"(updated: "+F(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return r?t.jsx(et,{}):i?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:u,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:v,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:x})]}),t.jsx(mt,{animate:!1}),t.jsx("div",{style:b,children:"Totals Over Time"}),t.jsx(ut,{data:e==null?void 0:e.detailedData}),t.jsx(St,{data:e==null?void 0:e.detailedData}),t.jsx("div",{style:y,children:"Site Traffic"}),t.jsx(bt,{data:s}),t.jsx("div",{style:y,children:"Belt Distribution"}),t.jsx(Rt,{data:e==null?void 0:e.summaryData}),t.jsx("div",{style:y,children:"Page Tracking"}),t.jsx(jt,{data:s}),t.jsx("div",{style:y,children:"Pot Details"}),t.jsx(wt,{statsData:s}),t.jsx("div",{style:y,children:"Charity Details"}),t.jsx(vt,{data:s})]})}const kt={siteFullNew:at,raflSiteStats2025:st,raflResponseDetails:it};function de(){const{authLoaded:n}=f.useContext(_),{isMobile:r}=R(),{allPots:i}=f.useContext(B),{raffleAdmin:o}=f.useContext(B),e=t.jsxs(L.Fragment,{children:[!r&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(xt,{active:!0}),t.jsx(dt,{})]});return t.jsx(J,{filterFields:tt,children:t.jsx(gt,{allEntries:i,children:t.jsxs(L.Fragment,{children:[t.jsx(K,{title:"RAFL Report",extras:e}),n&&o&&t.jsx(Ct,{}),t.jsx(Q,{}),t.jsx(Z,{feature:"raflReport"})]})})})}export{de as default};
