import{r as n,A as h,D as b,bC as j,bD as v,bE as R,bF as D,j as t,R as q,$ as E,N as C,B as F,aB as M,F as S,bG as k,bH as w}from"./index-8af2e99a.js";import{L as A}from"./LoadingDisplay-41b3eb05.js";import{a as B}from"./DataContext-632ea8a3.js";import{D as N}from"./LockDataProvider-d3ac3bb5.js";import{a as T}from"./rankingRequestData-d3ef79e5.js";import"./Box-c2a01b8a.js";import"./CircularProgress-d6ac0ac2.js";import"./index-2022f701.js";async function L({activityData:d}){const a=new AbortController,e=setTimeout(()=>{a.abort()},1e4),m=Math.floor(Math.random()*1e6);try{const s=await fetch(`${T}/log-activity?${m}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityData:d}),signal:a.signal});if(clearTimeout(e),s.ok)return await s.json().catch(()=>({}));{let o="Error updating request";try{const u=await s.json();console.error("errorData",u),o=u.message||o}catch{}return{response:{data:{status:s.status,message:o}}}}}catch(s){throw clearTimeout(e),console.error("Error during authentication or server request:",s),s}}function U(){const{authLoaded:d,isLoggedIn:a}=n.useContext(h),{lockCollection:e}=n.useContext(b),[m,s]=n.useState([]),o=n.useRef(0);n.useEffect(()=>{const c=j(R(k,"ranking-requests"),v("requestStatus","!=","Deleted")),y=a?D(c,p=>{const f=p.docs.length;o.current+=f;const g=[{activity:"READ",activityCount:f,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName}];o.current>f&&g.push({activity:"REFRESH",activityCount:f,source:"request-subscription",id:"",displayName:e==null?void 0:e.displayName,prod:!w}),L({activityData:g}),s(x=>{const l=new Map(x.map(r=>[r.id,r]));return p.docChanges().forEach(r=>{const i={id:r.doc.id,...r.doc.data()};r.type==="added"?l.has(i.id)||l.set(i.id,i):r.type==="modified"?l.set(i.id,i):r.type==="removed"&&l.delete(i.id)}),Array.from(l.values())})},p=>{console.error("Error getting ranking requests from DB:",p)}):()=>{};return()=>y()},[a]);const u=n.useMemo(()=>m.filter(c=>c.makeModels&&c.makeModels[0].make&&c.makeModels[0].model),[m]);return t.jsxs(q.Fragment,{children:[!d&&t.jsx(A,{}),d&&a&&t.jsx(E,{context:u}),d&&!a&&t.jsx(B,{children:t.jsxs(N,{allEntries:[],children:[t.jsx(C,{title:"Please Sign In"}),t.jsx("div",{style:{maxWidth:700,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:46,marginBottom:46},children:t.jsxs("div",{style:{textAlign:"center",marginTop:40},children:["We're sorry, you must be signed in to request locks.",t.jsx("br",{}),t.jsx("br",{}),t.jsx(F,{style:{color:"#fff"},children:t.jsx(M,{})})]})})]})}),t.jsx(S,{})]})}export{U as default};
