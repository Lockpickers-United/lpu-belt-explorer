import{r as s,A as I,j as t,D as M,F as T,d as h,R as C,u as N,N as S,bb as G,h as k,e as O,T as H}from"./index-CXi9J06m.js";import{A as K}from"./AdminToolButtons-Bx5xZ-0j.js";import{R as W}from"./RaffleContext-ChGaDXOk.js";import{L as U}from"./LoadingDisplay-DVb-UMH4.js";import{R as V}from"./RaffleEntries-rv874FhY.js";import{D as R}from"./DataContext-C7zFJW3q.js";import{e as Z,c as q}from"./filterFields-BeLyHH6i.js";import{a as J}from"./filterEntriesAdvanced-B1eU2Lg1.js";import{r as Q}from"./index-C5okh_FM.js";import"./EmojiEvents-BkKjp7Gb.js";import"./useData-DClNTc5D.js";import"./dataUrls-CThgH6Wi.js";import"./setDeep-J6HEwWhX.js";import"./Box-7HALAcYe.js";import"./CircularProgress-DSRvdEKg.js";import"./NoEntriesCard-CuvwqnWc.js";import"./LockListContext-CXqMummY.js";import"./entryName-Bbboiw5-.js";import"./RaffleExportButton-iM2aZ1JS.js";import"./ExpandMore-BM4t_6_I.js";import"./CopyLinkToRaflPotButton-Cl2vRpKT.js";import"./Link-CaO-ysXX.js";import"./FieldValue-D8mVjWF_.js";import"./FilterChip-Dl-WUeoS.js";import"./glossary-B-_vYIGQ.js";import"./Chip-Dc6Prxu_.js";import"./ImageGallery-DpYKr1U9.js";import"./ImageViewer-BpNAEYKu.js";import"./Launch-B4K-sBnD.js";import"./Dialog-DsqL6nst.js";import"./LinearProgress-CrL_y23e.js";import"./DialogContent-_u_JduE_.js";import"./ImageListItem-BUE1Wchx.js";import"./ContentCopy-CJVJeaPl.js";import"./ScopedDialog-K2iygKPK.js";import"./Cancel-BLNaQVCN.js";import"./Zoom-B8M5Y-XW.js";import"./LoadingDisplaySmall-xzb9Rl5J.js";import"./AccordionSummary-wDVNlM6i.js";import"./Collapse-B_3k3dYK.js";import"./index-Ber1Y2to.js";import"./index-DF7CsW-F.js";import"./AccordionActions-CSlrMLpG.js";import"./download-CX6a5LGM.js";import"./List-C5-CN3oh.js";import"./RaffleSearchBar-DeZiKv9_.js";import"./SearchBox-C1fzvRuW.js";import"./Search-DmEsIELw.js";import"./useFormControl-BGxGvZ5u.js";import"./Select-_CErO9jP.js";import"./Sort-DYYWCZWK.js";import"./TextField-BQr_qZCu.js";import"./ViewFilterButtons-BVpokOgn.js";import"./FilterAlt-Bz-lKX_w.js";import"./HighlightOff-DUM0-p54.js";import"./ToggleButtonGroup-D3ujnois.js";import"./AddCircle-BcduJRfS.js";import"./sortFields-1lK6XsoA.js";import"./AdvancedFilters-Dhdvd-NW.js";import"./ChoiceButtonGroup-C_4w-KgI.js";function X(){const{lockCollection:l}=s.useContext(I),{visiblePotEntries:a}=s.useContext(R);console.log("RaffleDrawingEntries visiblePotEntries",a);const p=s.useMemo(()=>a==null?void 0:a.filter(m=>{var f;return((f=m.entrants)==null?void 0:f.length)>0}),[a]);return console.log("RaffleDrawingEntries drawPots",p),t.jsx(V,{profile:l,allPots:p,drawing:!0})}function Y({children:l,drawing:a}){const p=s.useContext(R),{allPots:m}=s.useContext(W),{allRaffleEntries:f}=s.useContext(M),{filters:g}=s.useContext(T),{search:u,id:v,tab:tt,name:et,sort:c,image:rt,preview:ot,single:st,expandAll:A,...y}=g||{},F=(e,r)=>{const i=String(r??""),o=i.startsWith("!"),n=o?i.slice(1):i;return{key:e,value:n,negative:o}},D=Object.keys(y).map(e=>{const r=y[e];return Array.isArray(r)?r.map(i=>F(e,i)):F(e,r)}).flat(),E=s.useMemo(()=>f.filter(e=>e.status==="approved").reduce((e,r)=>(r.pots.forEach(i=>{e.push({username:r.username,entryId:r.id,platform:r.platform,potId:i.itemId,potTickets:i.tickets})}),e),[]),[f]),d=s.useMemo(()=>m.map(e=>{const r=E.filter(i=>i.potId===e.id);return r.length>0&&(e.entrants=r),e},[]),[m,E]);console.log("mappedPotEntries",d);const P=s.useMemo(()=>{const e=d.filter(o=>D.every(({key:n,value:b,negative:L})=>{const j=o[n];if(Array.isArray(j)){const x=j.includes(b);return L?!x:x}else{const x=j===b;return L?!x:x}})),r=u?J.go(Q(u),e,{keys:_,threshold:-25e3}).map(o=>({...o.obj,score:o.score})):e;let i=c?r.sort((o,n)=>c==="updatedAt"?h(o.updatedAt).isBefore(h(n.updatedAt))?1:-1:c==="status"?Z(o.status,n.status):c==="username"?o.username.localeCompare(n.username):c==="totalDonation"?n.totalDonation-o.totalDonation:h(o.createdAt).isBefore(h(n.createdAt))?1:-1):r.sort((o,n)=>o.potNumber-n.potNumber);return a&&(i=i.filter(o=>{var n;return((n=o.entrants)==null?void 0:n.length)>0})),i},[a,D,d,u,c]),w=s.useCallback(e=>d.find(r=>r.id===e),[d]),B=s.useMemo(()=>({...p,allEntries:m,visibleEntries:P,mappedPotEntries:d,getPotFromId:w,expandAll:A,statusLabels:$}),[p,m,P,d,w,A]);return t.jsx(R.Provider,{value:B,children:l})}const _=["fuzzy"],$={pending:{entryColor:"Blue",backgroundColor:"#3e71bd",textColor:"#fff"},approved:{entryColor:"Green",backgroundColor:"#34732f",textColor:"#fff"},issues:{entryColor:"Orange",backgroundColor:"#e16936",textColor:"#fff"},rejected:{entryColor:"Red",backgroundColor:"#c52323",textColor:"#fff"}};function z({width:l=700}){const a={maxWidth:l,marginLeft:"auto",marginRight:"auto",marginTop:10,fontWeight:700,display:"flex",flexDirection:"row"};return t.jsx(C.Fragment,{children:t.jsxs("div",{style:a,children:[t.jsx("div",{style:{flexGrow:1,fontSize:"1.7rem",margin:0},children:"LPU Raffle"}),t.jsx("div",{style:{fontSize:"1.4rem",marginTop:"0.3rem"},children:"PRIZE DRAWING"})]})})}function fe(){const{raffleAdmin:l,setRaffleAdminRole:a}=s.useContext(W),{authLoaded:p,isLoggedIn:m}=s.useContext(I);s.useEffect(()=>{l&&a(!0)});const{isMobile:f}=N(),g=t.jsxs(C.Fragment,{children:[!f&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(K,{})]});if(!p)return t.jsx(U,{message:"Loading..."});if(p&&!l)return t.jsxs(C.Fragment,{children:[t.jsx(S,{title:"RAFL Admin",extras:g}),t.jsx(z,{page:"drawing"}),t.jsxs("div",{style:{padding:20},children:[!m&&t.jsx("div",{children:"Please log in to access this page."}),m&&!l&&t.jsx("div",{children:"Sorry, you do not have access to this page."}),t.jsx("div",{children:t.jsx(G,{})})]}),t.jsx(k,{})]});const u=f?8:0,v={maxWidth:700,marginLeft:"auto",marginRight:"auto",paddingLeft:u,paddingRight:u};return t.jsx(O,{filterFields:q,children:t.jsx(Y,{drawing:!0,children:t.jsxs("div",{style:v,children:[t.jsx(S,{title:"RAFL 2026",extras:g}),t.jsx(z,{page:"drawing"}),l&&t.jsx(X,{}),t.jsx(k,{}),t.jsx(H,{feature:"raflAdmin"})]})})})}export{fe as default};
