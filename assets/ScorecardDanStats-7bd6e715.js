import{r as c,j as e,T as ie,I as M,as as P,at as U,a1 as y,ap as N,aj as le,K as ae,R as D,a6 as re,w as E,au as ce,a4 as de,A as pe,C as ue,av as xe,a9 as me,af as he,U as fe,p as ge,v as ye}from"./index-73116345.js";import{e as O,F as A,r as $,f as je,D as W,B as ke}from"./BeltStripe-3f5ee6b2.js";import{F as V,d as ve}from"./FieldValue-ca67e80b.js";import{S as be,E as Ce,d as Se}from"./CollectionButton-43210c81.js";import{d as Le}from"./Link-443b3f75.js";import{u as G}from"./useWindowSize-e6883609.js";import{A as Be,a as De,b as Ie}from"./AccordionSummary-cd9a947e.js";import{L as z}from"./Link-536488e9.js";import{p as ze}from"./chartDefaults-9fc07b21.js";import{B as Te}from"./nivo-bar.es-79c60ac0.js";function we({entry:r}){const l=O(r).replace(/[\s/]/g,"_").replace(/\W/g,""),d=c.useCallback(n=>{n.preventDefault(),n.stopPropagation();const x=`${window.location.origin}/#/locks?id=${r.id}&name=${l}`,g=window.open(x,"_blank","noopener,noreferrer");g&&(g.opener=null)},[r.id,l]);return e.jsx(ie,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(M,{onClick:d,children:e.jsx(Le,{style:{width:18,height:18}})})})}function Je({children:r,cardEvidence:t,cardBBCount:l,cardDanPoints:d,cardEligibleDan:n,cardNextDanPoints:x,cardNextDanLocks:g}){const{filters:p}=c.useContext(A),{search:f,id:j,tab:S,name:m,sort:h,image:I,...s}=p,u=c.useMemo(()=>t.map(a=>{const k=P(a.matchId),b=U(a.matchId);return{...k,...a,...b,id:a.id}}),[t]),v=c.useMemo(()=>u.map(a=>{var k,b,i;return{...a,makes:(k=a==null?void 0:a.makeModels)==null?void 0:k.map(({make:o})=>o),fuzzy:$(((b=a==null?void 0:a.makeModels)==null?void 0:b.map(({make:o,model:B})=>[o,B]).flat().filter(o=>o).concat([a.version,a.notes,a.belt]).join(","))+" "),documentation:[a.exceptionType==="badlink"?"Bad Link":"Valid Link",a.date?"Valid Date":"No Date"],scoring:[a.exceptionType==="nomatch"?"Unmatched":a.exceptionType==="badlink"?"Bad Link":a.exceptionType==="duplicate"?"Duplicate":a.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(a.belt)?"Low Level":"Worth Points"],simpleBelt:(i=a==null?void 0:a.belt)==null?void 0:i.replace(/\s\d/g,"")}}),[u]),C=c.useMemo(()=>{const a=Object.keys(s).map(i=>{const o=s[i];return Array.isArray(o)?o.map(B=>({key:i,value:B})):{key:i,value:o}}).flat(),k=v.filter(i=>a.every(({key:o,value:B})=>Array.isArray(i[o])?i[o].includes(B):i[o]===B)),b=f?je.go($(f),k,{keys:Ee,threshold:-25e3}).map(i=>({...i.obj,score:i.score})):k;return h?b.sort((i,o)=>{if(h==="danPointsAscending")return i.points-o.points||y(o.date).valueOf()-y(i.date).valueOf();if(h==="danPointsDescending")return o.points-i.points||y(o.date).valueOf()-y(i.date).valueOf();if(h==="dateAscending")return y(i.date).valueOf()-y(o.date).valueOf()||N(i.simpleBelt,o.simpleBelt);if(h==="dateDescending")return y(o.date).valueOf()-y(i.date).valueOf()||N(i.simpleBelt,o.simpleBelt);if(h==="beltAscending")return le(i.belt,o.belt)||y(o.date).valueOf()-y(i.date).valueOf();if(h==="beltDescending")return N(i.belt,o.belt)||y(o.date).valueOf()-y(i.date).valueOf();if(h==="alphaAscending")return i.fuzzy.localeCompare(o.fuzzy)||o.points-i.points;if(h==="alphaDescending")return o.fuzzy.localeCompare(i.fuzzy)||o.points-i.points}):b.sort((i,o)=>y(o.date).valueOf()-y(i.date).valueOf()||N(i.belt,o.belt)||i.fuzzy.localeCompare(o.fuzzy))},[s,v,f,h]),L=c.useMemo(()=>({allEntries:ae,cardEvidence:t,cardBBCount:l,cardDanPoints:d,cardEligibleDan:n,cardNextDanPoints:x,cardNextDanLocks:g,visibleEntries:C,getEntryFromId:P,getProjectEntryFromId:U}),[t,l,d,n,x,g,C]);return e.jsx(W.Provider,{value:L,children:r})}const Ee=["fuzzy"];function Oe({owner:r,evid:t,expanded:l,onExpand:d,merged:n}){const{setFilters:x}=c.useContext(A),{cardEvidence:g,getEntryFromId:p,getProjectEntryFromId:f}=c.useContext(W),j=p(t.matchId),S=f(t.matchId),m=j||S,[h,I]=c.useState(!1),s=c.useRef(null);c.useEffect(()=>{if(l&&s&&!h){const R=window.innerWidth<=600?70:74,{id:oe}=re.parse(location.search),H=oe===t.id;I(!0),setTimeout(()=>{window.scrollTo({left:0,top:s.current.offsetTop-R,behavior:H?"auto":"smooth"})},H?0:100)}else l||I(!1)},[l,m,h,t.id]);let u=m?O(m):t.evidenceNotes;const v=t.exceptionType&&t.evidenceNotes.toLowerCase()!==u.toLowerCase()?t.evidenceNotes:null;u=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:u,u=t.exceptionType&&r&&n?u+" *":u;const C=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,L=t.exceptionId,a=L?g.find(w=>w.id===L):{},k=a?c.useMemo(()=>p(a.matchId),[p,a.matchId]):{},b=k?O(k,"short"):"",i=L?e.jsx(z,{style:{color:"#99c2e5"},onClick:()=>{B(L)},children:b}):null;let o=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"You must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const B=c.useCallback(w=>{x({id:w})},[x]),Y=t.points===1?"pt":"pts";let T=t.date?y(t.date).format("L"):"(no date)";T=T.replace("/202","/2"),T=T.replace("/201","/1");const J=t.date?"#fff":"#aaa",q=c.useCallback((w,R)=>{r&&d(R?t.id:!1)},[t.id,d,r]),Q=r?{}:{cursor:"default"},X=r?e.jsx(ve,{}):null,{isMobile:F}=G(),Z=F?"block":"flex",ee=F?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},te=F?"65%":"56%",ne=F?"-2px 0px 3px 0px":"1px 0px 3px 0px",se={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(Be,{expanded:l,onChange:q,ref:s,children:[e.jsxs(De,{expandIcon:X,style:{...se,...Q},children:[e.jsx(ke,{value:m?m.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:te,flexShrink:0,flexDirection:"column",opacity:C},children:[e.jsx(V,{value:u,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!v&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:v}),!!m&&!!(m!=null&&m.version)&&e.jsx(V,{name:"Version",value:e.jsx(E,{style:{fontSize:"0.95rem",lineHeight:1.25},children:m==null?void 0:m.version}),textStyle:(m==null?void 0:m.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:Z,placeItems:"center",marginLeft:10,opacity:C},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:j&&e.jsx(we,{entry:j})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(be,{url:t.link,handleChange:q,exceptionType:t.exceptionType,owner:r})})]}),e.jsxs("div",{style:ee,children:[e.jsx("div",{style:{margin:ne,color:J,width:90,textAlign:"center"},children:T}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:Y})]})})]})]})]}),l&&e.jsx(D.Fragment,{children:e.jsxs(Ie,{sx:{padding:"4px 16px 0px 26px"},children:[(o||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),o&&e.jsxs("span",{children:["* ",o," ",i]})]}),e.jsx(Ce,{evid:t,handleUpdate:()=>{}})]})})]},t.id)}const Qe=D.memo(Oe,(r,t)=>{const l=Object.keys(r.evid),d=Object.keys(t.evid);if(l.length!==d.length)return!1;for(let n=0;n<l.length;n++)if(l[n]!==d[n]||r.evid[l[n]]!==t.evid[d[n]])return!1;return r.owner===t.owner&&r.expanded===t.expanded&&r.onExpand===t.onExpand&&r.merged===t.merged}),Fe=D.createContext({});function Xe({children:r}){const{filters:t,addFilters:l,removeFilters:d}=c.useContext(A),n=t.id,x=c.useCallback(p=>{p?l([{key:"id",value:p}],!0):d(["id"])},[l,d]),g=c.useMemo(()=>({expanded:n,setExpanded:x}),[n,x]);return e.jsx(Fe.Provider,{value:g,children:r})}function Ne({beltData:r}){const{width:t}=G(),l=t<=560,d=l?190:175,n=l?-90:-45,x=l?{top:0,right:0,bottom:80,left:15}:{top:0,right:0,bottom:60,left:15},g=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#3e3e3e","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c"],p=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#aaa","#000","#000","#000","#000","#000","#000"];return e.jsx("div",{style:{height:d,padding:"0px 0px 0px 0px",width:"100%"},children:e.jsx(Te,{data:r,margin:x,padding:.15,colors:f=>g[f.index%g.length],animate:!0,axisBottom:{tickRotation:n},axisLeft:null,enableGridY:!1,theme:ze,isInteractive:!1,enableLabel:!0,label:f=>f.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:f=>p[f.index%p.length]})},"bar")}function Ze({entries:r}){const t=c.useMemo(()=>{const l=r.map(({belt:n})=>(n&&n.includes("Project"),n)).reduce((n,x)=>(n[x]||(n[x]=0),n[x]++,n),{});return l.Project=r.reduce((n,x)=>x.simpleBelt==="Project"?n+1:n,0),(l.Project>0?ce:de).map(n=>({id:n,label:n,count:l[n]||0,value:l[n]||0}))},[r]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(Ne,{beltData:t})})}var _={},Ae=ue;Object.defineProperty(_,"__esModule",{value:!0});var K=_.default=void 0,We=Ae(pe()),Re=e;K=_.default=(0,We.default)((0,Re.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function Me(){const{setFilters:r}=c.useContext(A),{cardEvidence:t,getEntryFromId:l}=c.useContext(W),[d,n]=c.useState(!1),x=c.useCallback(()=>{n(!0)},[]),g=c.useCallback(()=>{n(!1)},[]),p=c.useCallback(s=>{r({id:s}),n(!1)},[r]),f=t.map(s=>{const u=s.exceptionId,v=u?t.find(b=>b.id===u):{},C=v?l(v.matchId):{},L=C?O(C,"short"):"",a=s.matchId?l(s.matchId):null,k=a?O(a,"short"):"";return{...s,supersedingEntryId:u,supersedingLockName:L,matchLockName:k}}),j=f.filter(s=>s.exceptionType==="nomatch"),S=f.filter(s=>s.exceptionType==="badlink"),m=f.filter(s=>s.exceptionType==="duplicate"),h=f.filter(s=>s.exceptionType==="upgraded");if(j.length+S.length+m.length+h.length>0)return e.jsxs(D.Fragment,{children:[e.jsx(M,{onClick:x,style:{marginRight:0},children:e.jsx(K,{fontSize:"small"})}),e.jsx(xe,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:s=>s.zIndex.drawer+1},open:d,onClick:g,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(M,{onClick:g,children:e.jsx(Se,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),j.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(me,{style:{marginBottom:20}}),e.jsx(E,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:j.map((s,u)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(z,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{p(s.id)},children:s.evidenceNotes})},u))})]}),S.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(E,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:S.map((s,u)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(z,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{p(s.id)},children:s.matchLockName})},u))})]}),m.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(E,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:m.map((s,u)=>e.jsxs("li",{style:{marginBottom:4},children:[s.evidenceNotes," is a duplicate of ",e.jsx(z,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{p(s.supersedingEntryId)},children:s.supersedingLockName})]},u))})]}),h.length>0&&e.jsxs(D.Fragment,{children:[e.jsx(E,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:h.map((s,u)=>e.jsxs("li",{style:{marginBottom:4},children:[s.evidenceNotes," is upgraded by ",e.jsx(z,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{p(s.supersedingEntryId)},children:s.supersedingLockName})]},u))})]})]})})]})}function et({profile:r,owner:t}){var v;const{userId:l}=he(),{user:d}=c.useContext(fe),n=(v=r.displayName)==null?void 0:v.replace(/\s/g,"_"),{cardDanPoints:x,cardBBCount:g,cardEligibleDan:p,cardNextDanPoints:f,cardNextDanLocks:j}=c.useContext(W),S=ge(),m=c.useCallback(()=>{S("/profile/scorecard/upgrades")},[S]),h={1:"st",2:"nd",3:"rd"},I=h[[p]]?p+h[[p]]:p+"th",s=c.useCallback(async()=>{const C=`@LPUBeltBot request ${I} Dan https://lpubelts.com/#/profile/${l||(d==null?void 0:d.uid)}/scorecard?name=${n}`;await navigator.clipboard.writeText(C),ye("Request copied to clipboard. Take it over to #belt-requests!")},[I,n,d==null?void 0:d.uid,l]),u=r.blackBeltAwardedAt>0&&p===1?"DAN":"Eligible for Dan";return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:[u," ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:p})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:x})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:g})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[f," point",f!==1&&"s"," and ",j," BB lock",j!==1&&"s"," to next Dan"]}),e.jsxs("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:[p>1&&t&&e.jsxs("span",{children:[e.jsx(z,{onClick:s,style:{color:"#99c2e5",cursor:"pointer"},children:"Copy Request"})," • "]}),e.jsx(z,{onClick:m,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})]})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(Me,{})})]})}export{Ze as I,Fe as S,et as a,Qe as b,Je as c,Xe as d};
