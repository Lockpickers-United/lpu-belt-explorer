import{u as E,j as e,r as m,bz as F,ag as W,F as H,aK as O,L as B,b8 as R,R as u,I as z,bc as q,aq as M,O as A,aw as U,A as G,b as $,g as X,bA as Y,M as K}from"./index-DlU4pp1T.js";import{p as _}from"./chartDefaults-pV7GKcxU.js";import{X as J}from"./nivo-bar-BaemPbMc.js";import{D as N}from"./DataContext-BUiQXDkT.js";import"./index-Dguw21GC.js";import{a as Q,H as V}from"./EvidenceForm-XI5zGLjM.js";import{e as P}from"./entryName-nLkqVmmL.js";function Z({beltData:o}){const{width:p}=E(),h=p<=560,i=h?190:175,g=h?-90:-45,n=h?{top:0,right:0,bottom:80,left:15}:{top:0,right:0,bottom:60,left:15},r=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#3e3e3e","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c"],x=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#aaa","#000","#000","#000","#000","#000","#000"];return e.jsx("div",{style:{height:i,padding:"0px 0px 0px 0px",width:"100%"},children:e.jsx(J,{data:o,margin:n,padding:.15,colors:a=>r[a.index%r.length],animate:!0,axisBottom:{tickRotation:g},axisLeft:null,enableGridY:!1,theme:_,isInteractive:!1,enableLabel:!0,label:a=>a.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:a=>x[a.index%x.length]})},"bar")}function le({entries:o}){const p=m.useMemo(()=>{const i=o.filter(n=>!n.awardType).map(({belt:n})=>(n&&n.includes("Project"),n)).reduce((n,r)=>(n[r]||(n[r]=0),n[r]++,n),{});return i.Project=o.reduce((n,r)=>r.simpleBelt==="Project"?n+1:n,0),(i.Project>0?F:W).map(n=>({id:n,label:n,count:i[n]||0,value:i[n]||0}))},[o]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(Z,{beltData:p})})}function ee(){const{setFilters:o}=m.useContext(H),{cardActivity:p,getEntryFromId:h}=m.useContext(N),[i,g]=m.useState(!1),n=m.useCallback(()=>{g(!0)},[]),r=m.useCallback(()=>{g(!1)},[]),x=m.useCallback(t=>{o({id:t}),g(!1)},[o]),a=p.map(t=>{const s=t.exceptionId,d=s?p.find(S=>S.id===s):{},k=d?h(d.matchId):{},b=d?O(d.matchId):{},L=k?P(k,"short"):"",D=t.matchId?h(t.matchId):null,I=D?P(D,"short"):"",v=k?e.jsx(B,{style:{color:"#6dbbff",textDecoration:"none"},onClick:()=>{x(s)},children:L}):b==null?void 0:b.name;return{...t,supersedingEntryId:s,supersedingLockName:L,matchLockName:I,supersedingLink:v}}),l=a.filter(t=>t.exceptionType==="nomatch"),y=a.filter(t=>t.exceptionType==="badlink"&&!R(t.matchId)),f=a.filter(t=>t.exceptionType==="duplicate"),j=a.filter(t=>t.exceptionType==="upgraded");return l.length+y.length+f.length+j.length>0?e.jsxs(u.Fragment,{children:[e.jsx(z,{onClick:n,style:{marginRight:0},children:e.jsx(Q,{fontSize:"small"})}),e.jsx(q,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:t=>t.zIndex.drawer+1},open:i,onClick:r,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some entries ineligible for Dan Points"}),e.jsx(z,{onClick:r,children:e.jsx(V,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),l.length>0&&e.jsxs(u.Fragment,{children:[e.jsx(M,{style:{marginBottom:20}}),e.jsx(A,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:l.map((t,s)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(B,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{x(t.id)},children:t.evidenceNotes})},s))})]}),y.length>0&&e.jsxs(u.Fragment,{children:[e.jsx(A,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:y.map((t,s)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(B,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{x(t.id)},children:t.matchLockName})},s))})]}),f.length>0&&e.jsxs(u.Fragment,{children:[e.jsx(A,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:f.map((t,s)=>e.jsxs("li",{style:{marginBottom:4},children:[t.evidenceNotes," is a duplicate of ",t.supersedingLink]},s))})]}),j.length>0&&e.jsxs(u.Fragment,{children:[e.jsx(A,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:j.map((t,s)=>e.jsxs("li",{style:{marginBottom:4},children:[t.evidenceNotes," is upgraded by ",t.supersedingLink]},s))})]})]})})]}):null}function de({profile:o,owner:p}){var S;const{userId:h}=U(),{user:i}=m.useContext(G),g=(S=o==null?void 0:o.displayName)==null?void 0:S.replace(/\s/g,"_"),n=$(),r=m.useCallback(()=>{n("/profile/scorecard/upgrades")},[n]),{cardDanPoints:x,cardBBCount:a,cardEligibleDan:l,cardNextDanLocks:y,cardUniqueLocks:f,cardActivity:j,cardMaxBelt:C}=m.useContext(N),t=j.reduce((c,T)=>{const w=X(T.matchId);return c=(w==null?void 0:w.awardType)==="dan"?Math.max(c,w.rank):c,c},0),s=Math.max(l,t),d=Y.find(c=>c.level===s+1),k=l<=t?"":"Eligible for ",b=(l<=t,"DAN"),L=m.useCallback(async()=>{const c=`@LPUBeltBot request ${v(l)} Dan https://lpubelts.com/#/profile/${h||(i==null?void 0:i.uid)}/scorecard?name=${g}`;await navigator.clipboard.writeText(c),K("Request copied to clipboard. Take it over to #belt-requests!")},[l,g,i==null?void 0:i.uid,h]),D=t<20?Math.max(0,(d==null?void 0:d.bbLocks)-a):0,I=t<20?Math.max(0,(d==null?void 0:d.points)-x):0;return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 0px 18px 0px",flexGrow:1},children:[l>0?e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:[k," ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:v(s)})," ",b]}):e.jsx("div",{style:{fontWeight:700,marginBottom:6,marginTop:8},children:e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:C==null?void 0:C.name})}),o.danLevel>0&&e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:x})]}),e.jsxs("div",{style:{marginBottom:5},children:["Unique Locks ",e.jsx("strong",{children:f})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:a})]}),t>0&&t<20&&e.jsxs(u.Fragment,{children:[e.jsxs("div",{style:{fontSize:"0.85rem"},children:[I," point",I!==1&&"s"," and ",D," BB lock",y!==1&&"s"," to ",v(s+1)," Dan"]}),e.jsxs("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:[l>t&&p&&e.jsxs("span",{children:[e.jsx(B,{onClick:L,style:{color:"#99c2e5",cursor:"pointer"},children:"Copy Request Text"})," • "]}),e.jsx(B,{onClick:r,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})]})]}),t===20&&e.jsx("div",{style:{fontSize:"0.85rem"},children:"You've reached the highest Dan level. Congratulations!"})]}),e.jsx("div",{style:{textAlign:"right",minWidth:20},children:e.jsx(ee,{})})]});function v(c){const T=["st","nd","rd","th"];return c+""+T[Math.min(4,c)-1]}}export{le as I,de as S};
