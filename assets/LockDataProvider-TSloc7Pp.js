import{r as c,F as O,aw as F,al as P,d as u,az as A,ak as w,j as H}from"./index-Bwxc9M6K.js";import{D as R,f as L}from"./DataContext-L-kzGPgn.js";import{r as S}from"./index-Cc14aa1t.js";import{c as V}from"./collectionStatsById-DY1NVZ7h.js";import{u as W}from"./useData-6ILk58NV.js";import{h as E}from"./dataUrls-DkJe4Pqg.js";function te({children:j,allEntries:d,profile:a}){const{filters:I}=c.useContext(O),{search:m,id:G,tab:J,name:Q,sort:o,image:T,expandAll:y,...b}=I,{data:h,loading:M,error:g}=W({urls:q}),p=c.useMemo(()=>h&&!M&&!g?h.lockbazzarEntryIds:[],[h,g,M]),x=c.useMemo(()=>{const l=(a==null?void 0:a.userLockNotes)||{};return d.map(t=>{var i,f,n;return{...t,makes:t.makeModels[0].make?t.makeModels.map(({make:e})=>e):t.makeModels[0].model,fuzzy:S(t.makeModels.map(({make:e,model:s})=>[e,s]).flat().filter(e=>e).concat([t.version,t.notes,t.belt]).join(",")),content:[(i=t.media)!=null&&i.some(e=>!e.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(f=t.media)!=null&&f.some(e=>e.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((n=t.links)==null?void 0:n.length)>0?"Has Links":"No Links",P[t.belt].danPoints>0?"Worth Dan Points":void 0,u(t.lastUpdated).isAfter(u().subtract(1,"days"))?"Updated Recently":void 0,t.belt.startsWith("Black")?"Is Black":void 0,t.belt!=="Unranked"?"Is Ranked":void 0,l[t.id]?"Has Personal Notes":void 0].flat().filter(e=>e),collection:F.locks.map.map(e=>a&&a[e.key]&&a[e.key].includes(t.id)?e.label:"Not "+e.label),collectionSaves:V[t.id]||0,simpleBelt:t.belt.replace(/\s\d/g,""),personalNotes:l[t.id]}})},[d,a]),C=c.useMemo(()=>{const l=(e,s)=>{const r=String(s??""),z=r.startsWith("!"),v=z?r.slice(1):r;return{key:e,value:v,negative:z}},t=Object.keys(b).map(e=>{const s=b[e];return Array.isArray(s)?s.map(r=>l(e,r)):l(e,s)}).flat(),i=x.filter(e=>t.every(({key:s,value:r,negative:z})=>{const v=e[s];if(Array.isArray(v)){const k=v.includes(r);return z?!k:k}else{const k=v===r;return z?!k:k}})),f=m&&i.find(e=>e.id===m);let n=i;return f?n=[f]:m&&(n=L.go(S(m),i,{keys:K,threshold:-23e3}).map(e=>({...e.obj,score:e.score})).filter(e=>e.score>.23)),o?n.sort((e,s)=>{if(o==="popularity")return s.collectionSaves-e.collectionSaves||s.views-e.views||e.fuzzy.localeCompare(s.fuzzy);if(o==="beltAscending")return A(e.belt,s.belt);if(o==="beltDescending")return w(e.belt,s.belt);if(o==="alphaAscending")return e.fuzzy.localeCompare(s.fuzzy);if(o==="alphaDescending")return s.fuzzy.localeCompare(e.fuzzy);if(o==="recentlyUpdated")return Math.floor(u(s.lastUpdated).valueOf()/3600)-Math.floor(u(e.lastUpdated).valueOf()/3600)||A(e.belt,s.belt)||e.fuzzy.localeCompare(s.fuzzy);if(o==="dateAdded")return Math.floor(u(s.dateAdded).valueOf()/3600*24)-Math.floor(u(e.dateAdded).valueOf()/3600*24)||A(e.belt,s.belt)||e.fuzzy.localeCompare(s.fuzzy)}):n},[b,x,m,o]),U=c.useCallback(l=>d.find(t=>t.id===l),[d]),D=c.useCallback(l=>p==null?void 0:p.includes(l),[p]),N=c.useMemo(()=>(a==null?void 0:a.blackBeltAwardedAt)>0,[a]),B=c.useMemo(()=>({allEntries:d,visibleEntries:C,getEntryFromId:U,expandAll:y,profile:a,blackBeltUser:N,lockbazzarAvailable:D}),[d,C,U,y,a,N,D]);return H.jsx(R.Provider,{value:B,children:j})}const K=["fuzzy"],q={lockbazzarEntryIds:E};export{te as D};
