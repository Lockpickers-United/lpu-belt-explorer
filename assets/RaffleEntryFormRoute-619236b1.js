import{K as te,M as re,j as e,u as q,r as n,R as U,G as de,I as X,a8 as ce,B as O,a$ as me,aa as Z,D as pe,N as ue,F as xe,T as he}from"./index-b9e74f93.js";import{u as fe}from"./usePageTitle-bf22abf1.js";import{R as je}from"./RaffleHeader-0b7a116d.js";import{R as ye}from"./RaffleAutocompleteBox-a35dece6.js";import{b as ge,a as ve,c as be}from"./RaffleContext-1c1eaf6c.js";import{R as Ce}from"./RaffleSubHead-feb97441.js";import{d as ee}from"./Search-036462b0.js";import{A as ke}from"./Autocomplete-f02da2e3.js";import{T as _,F as Re}from"./TextField-75ac8469.js";import{I as Ie}from"./Chip-88ccd14a.js";import{F as W,I as Fe,S as Se}from"./Select-150c38d2.js";import{L as Te}from"./Link-be3b6446.js";import{R as $e,A as Ae}from"./AdminRoleButton-6007f8e7.js";import{R as Pe}from"./RaffleComingSoon-404ae816.js";import"./useDocumentTitle-6f28e5fe.js";import"./Collapse-3fa79a7c.js";import"./useData-d5038742.js";import"./dataUrls-4eb203c4.js";import"./index-f338394d.js";import"./Dialog-6c172601.js";var Y={},we=re;Object.defineProperty(Y,"__esModule",{value:!0});var se=Y.default=void 0,ze=we(te()),Ee=e;se=Y.default=(0,ze.default)((0,Ee.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function Le({questionStyle:t,index:x,potData:s,handlePotChange:T,showIssues:r,removePot:g}){const{isMobile:l,flexStyle:h}=q(),R=!1,w={maxWidth:700},A=n.useRef(),[o,I]=n.useState(s[x]),z=Array.from(Object.keys(s)).length>1;if(s[x].tickets!==o.tickets||s[x].itemFullTitle!==o.itemFullTitle){const j=o.itemFullTitle&&o.tickets;T(x,o,j)}const k=n.useMemo(()=>{let j=[],d={},C={},M={},S={};return ge.sort((u,y)=>parseInt(u.potNumber)-parseInt(y.potNumber)||u.title.localeCompare(y.title)).map(u=>{const y=`Pot ${u.potNumber} - ${u.title}`;C[y]=u.title,d[y]=u.id,M[y]=u.potNumber,j.push(y)}).filter(u=>u),{options:j,itemIds:d,itemTitles:C,itemPotNumbers:M,itemFormIds:S}},[]),{options:v,itemIds:a,itemTitles:m,itemPotNumbers:b}=k,E=n.useCallback(j=>{const d=j.target.value.replace(/[^0-9]/,""),C={...o,tickets:d};I(C)},[o]),p=n.useCallback((j,d)=>{let C;v.includes(d)?C={itemFullTitle:d,itemTitle:m[d],itemId:a[d],itemPotNumber:b[d],itemIndex:v.indexOf(d)}:C={},I({...o,...C})},[v,o,m,a,b]),[P,N]=n.useState(!1),F=n.useCallback(()=>{N(!0),setTimeout(()=>A.current.focus(),15)},[]),L=n.useCallback(()=>N(!1),[]),H=P&&R?{width:"auto",position:"fixed",left:60,right:0,paddingRight:16,maxWidth:"unset",zIndex:9999999,backgroundColor:"#272727"}:{},D=r&&!o.itemFullTitle?{borderBottom:"#b00 solid 4px"}:{};return e.jsxs("div",{style:{display:h,margin:12},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100,minWidth:280},children:[e.jsx("div",{style:{...t},children:"Selected Pot"}),e.jsx("div",{style:{height:4}}),e.jsxs(U.Fragment,{children:[!P&&R&&e.jsx(de,{title:"Search",arrow:!0,disableFocusListener:!0,children:e.jsx(X,{color:"inherit",onClick:F,children:e.jsx(ee,{})})}),(P||!R)&&e.jsx(ke,{selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:{...w,...H},options:v,onChange:p,renderInput:j=>e.jsx(_,{...j,style:D,placeholder:"Search Pots",variant:"standard",color:"info",inputRef:A,InputProps:{...j.InputProps,startAdornment:e.jsx(Ie,{position:"start",children:e.jsx(ee,{})})}})}),e.jsx(ce,{invisible:!0,open:P&&R,onClick:L})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:r&&!o.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsxs(W,{children:[!l&&e.jsx("div",{style:t,children:" "}),e.jsx(_,{type:"text",name:"tickets",label:"Tickets",value:s[x].tickets?s[x].tickets:"",error:r&&!o.tickets,helperText:r&&!s[x].tickets?"Required Field":" ",onChange:E,color:"info",size:"small",style:{width:120}})]}),z&&e.jsxs("div",{style:{marginLeft:10},children:[!l&&e.jsx("div",{style:t,children:" "}),e.jsx(X,{color:"warning",onClick:()=>g(x),children:e.jsx(se,{})})]})]})]})}var K={},Me=re;Object.defineProperty(K,"__esModule",{value:!0});var ne=K.default=void 0,Be=Me(te()),We=e;ne=K.default=(0,Be.default)((0,We.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle");function _e({donation:t,questionStyle:x,potData:s,showIssues:T,setPotData:r,allocated:g}){const l=Array.from(Object.keys(s)),h=t?parseInt(t)-g:0-g,R=n.useCallback(()=>{const a=l[l.length-1]+1e3,m={...s};m[a]={tickets:0},r(m)},[s,l,r]),w=n.useCallback(a=>{const m={...s};delete m[a],r(m)},[s,r]),A=n.useCallback(()=>{const a=Math.floor(t/l.length),m=t%l.length;l.map((b,E)=>{const p={...s};E===0&&t?p[b].tickets=a+m:t?p[b].tickets=a:p[b].tickets=0,r(p)})},[t,s,l,r]),o=n.useCallback((a,m)=>{const b={...s};b[a]=m,r(b)},[s,r]),I=h>0?{color:"#0b0",fontWeight:700}:h<0?{color:"#b00",fontWeight:700}:{},{isMobile:z,flexStyle:k}=q(),v=z?"1.0rem":"1.2rem";return e.jsxs(U.Fragment,{children:[l.map(a=>e.jsx(Le,{questionStyle:x,index:a,potData:s,handlePotChange:o,showIssues:T,removePot:w},a)),e.jsx("div",{style:{display:"flex",justifyContent:"center"},children:e.jsx(O,{variant:"outlined",onClick:()=>{R()},size:"small",color:"info",startIcon:e.jsx(ne,{}),children:"Add Pot"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",fontSize:v,marginTop:15},children:[e.jsxs("div",{style:{display:k,padding:8},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Total tickets"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:t||0})]})]}),e.jsxs("div",{style:{display:k,padding:8,margin:"0px 10px"},children:[e.jsx("div",{children:e.jsx("nobr",{children:"Allocated"})}),e.jsxs("div",{children:[" ",e.jsx("strong",{children:g})]})]}),e.jsxs("div",{style:{display:k,padding:8},children:[e.jsx("div",{style:{...I},children:e.jsx("nobr",{children:"Remaining"})}),e.jsxs("div",{style:{...I},children:[" ",e.jsx("strong",{children:t||g?h:0})]})]}),t&&e.jsx("div",{style:{display:k,padding:8,marginLeft:10,alignContent:"center"},children:e.jsx(Te,{onClick:()=>{A()},style:{color:"#417ee6",fontWeight:700},children:"Auto"})})]}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",textAlign:"center"},children:T&&t>g?e.jsx("span",{children:"All tickets must be assigned to a pot"}):T&&t<g?e.jsx("span",{children:"You have too many tickets allocated"}):e.jsx("span",{children:" "})})]})}function Ne(){const[t,x]=n.useState({}),[s,T]=n.useState({}),[r,g]=n.useState({0:{tickets:0}}),l=Array.from(Object.keys(r)),{raflQuestionMap:h,displayStats:R,setDisplayStats:w}=n.useContext(ve),[A,o]=n.useState(!0);A&&R&&(w(!1),o(!1));const I=n.useMemo(()=>l.reduce((i,c)=>{const $=parseInt(r[c].tickets)?parseInt(r[c].tickets):0;return i=i?i+$:$,i},0),[r,l]),z=n.useMemo(()=>l.reduce((i,c)=>!(r[c].tickets&&r[c].tickets),!1),[r,l]),k=n.useCallback(i=>{const c=window.open(i,"_blank","noopener,noreferrer");c&&(c.opener=null)},[]),v=n.useCallback(i=>{const c={...t};i.target.name==="donation"?c[i.target.name]=i.target.value.replace(/[^0-9]/,""):c[i.target.name]=i.target.value,x(c)},[t]),a=n.useCallback((i,c)=>{const $={...r};$[i]=c,g($)},[r]),m=n.useCallback(()=>{const i="https://docs.google.com/forms/d/e/1FAIpQLSe0Rr8mykkE5FAgzUACzGsGYq_mN-vS34arr2uL0QDEFHBSNQ/viewform?usp=pp_url",c=Object.keys(t).reduce((f,B)=>{const G=`&entry.${h[B]}=${encodeURIComponent(t[B])}`;return f=(f==null?void 0:f.length)>0?`${f}${G}`:G,f},""),$=`&entry.${h[0].formId}=${encodeURIComponent(t.platform)}`,ie=`&entry.${h[1].formId}=${encodeURIComponent(t.username)}`,le=`&entry.${h[2].formId}=${encodeURIComponent(s.itemTitle)}`,oe=`&entry.${h[3].formId}=${encodeURIComponent(t.receipt)}`,ae=`&entry.${h[4].formId}=${encodeURIComponent(t.donation)}`,Q=[$,ie,le,oe,ae],V=Object.keys(r).reduce((f,B)=>{const J=`&entry.${h[r[B].itemIndex+5].formId}=${r[B].tickets}`;return f=(f==null?void 0:f.length)>0?`${f}${J}`:J,f},"");console.log("params",c),console.log("url",`${Q.join("")}${V}`),k(`${i}${Q.join("")}${V}`)},[s,t,k,r,h]),b=be.map(i=>({...i,title:i.name})),E=n.useCallback(i=>i.name,[]),[p,P]=n.useState(!1),N=["platform","username","charity","donation"],F=i=>N.includes(i)&&!t[i]&&p,L=(t.receipt||p)&&!me(t.receipt),H=L?"Receipt link is not a valid URL":" ",D=p&&!s.itemFullTitle,j=parseInt(t.donation)!==parseInt(I),d=!t.platform||!t.username||!s.itemFullTitle||!t.donation||!t.receipt||L||!!z||j,C=d?"#666":"#4dd04d",{flexStyle:M}=q(),S={maxWidth:700,marginLeft:"auto",marginRight:"auto"},u={fontSize:"1.5rem",fontWeight:700,marginBottom:8},y={fontSize:"1.1rem",fontWeight:400,marginBottom:8};return e.jsxs("div",{style:{paddingBottom:32},children:[e.jsx(Ce,{text:"ENTRY FORM"}),e.jsxs("div",{style:{...S,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:u,children:"About You"}),e.jsxs("div",{style:{display:M,margin:"12px 12px 0px 12px"},children:[e.jsxs(W,{style:{width:250,marginRight:16},size:"small",error:F("platform"),children:[e.jsx(Fe,{color:"info",children:"Preferred Platform"}),e.jsxs(Se,{value:t.platform?t.platform:"",label:"Preferred Platform",onChange:v,color:"info",name:"platform",children:[e.jsx(Z,{value:"Discord",children:"Discord"}),e.jsx(Z,{value:"Reddit",children:"Reddit"})]}),e.jsx(Re,{children:F("platform")?"Required Field":" "})]}),e.jsx(W,{style:{width:250},size:"small",children:e.jsx(_,{type:"text",name:"username",label:"Username",value:t.username?t.username:"",error:F("username"),helperText:F("username")?"Required Field":" ",onChange:v,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{...S,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:u,children:"Your Donation"}),e.jsxs("div",{style:{display:M,margin:"12px 12px 0px 12px"},children:[e.jsxs("div",{style:{flexGrow:1,marginRight:40,height:100},children:[e.jsx("div",{style:y,children:"Selected Charity"}),e.jsx("div",{style:{height:6}}),e.jsx(ye,{allItems:b,setItemDetails:T,getOptionTitle:E,searchText:"Search Charities",error:D}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#f44336",margin:"4px 14px 0px 14px",display:p&&!s.itemFullTitle?"block":"none"},children:"Required Field"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{...y},children:"Total donation in USD"}),e.jsx(W,{children:e.jsx(_,{type:"text",name:"donation",label:"Donation Amount",value:t.donation?t.donation:"",error:F("donation"),helperText:F("donation")?"Required Field":" ",onChange:v,color:"info",size:"small"})})]})]}),e.jsxs("div",{style:{margin:"6px 12px 0px 12px"},children:[e.jsxs("div",{style:y,children:["Receipt from approved charity ",e.jsx("span",{style:{fontWeight:400},children:"(hosted image link, must contain a visible date)"})]}),e.jsx(W,{fullWidth:!0,children:e.jsx(_,{type:"text",name:"receipt",label:"Receipt Link",error:L,helperText:H,value:t.receipt?t.receipt:"",onChange:v,color:"info",size:"small",fullWidth:!0})})]})]}),e.jsxs("div",{style:{...S,backgroundColor:"#222",minHeight:72,alignItems:"center",borderBottom:"1px #555 solid",padding:"20px 20px"},children:[e.jsx("div",{style:u,children:"Your Pots"}),e.jsx(_e,{donation:t.donation,potData:r,handlePotChange:a,questionStyle:y,showIssues:p,setPotData:g,allocated:I})]}),e.jsxs("div",{style:{...S,padding:"20px 20px 20px 20px"},children:[e.jsx("div",{style:{...u,textAlign:"center"},children:"All Done?"}),e.jsxs("div",{style:{...S,justifyContent:"center",marginTop:0,display:"flex"},children:[e.jsx("div",{style:{display:d?"flex":"none"},children:e.jsx(O,{variant:"outlined",onClick:()=>{P(!p)},style:{marginRight:20,color:p?"#de2323":"#bbb",borderColor:p?"#de2323":"#bbb"},children:"Show Issues"})}),e.jsx(O,{style:{backgroundColor:C,color:"#000"},variant:"contained",disabled:d,onClick:m,children:"Review Entry on Google"})]}),e.jsx("div",{style:{...S,justifyContent:"center",marginTop:16,color:"#de2323",display:d?"flex":"none"},children:e.jsx(O,{style:{color:"#b00"},variant:"text",onClick:m,children:"Test Send Incomplete"})})]})]})}function ot(){const{lockCollection:t}=n.useContext(pe),{isMobile:x}=q();fe("RAFL Entry Form");const s=e.jsxs(U.Fragment,{children:[!x&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),e.jsx($e,{}),e.jsx(Ae,{})]});return e.jsxs(U.Fragment,{children:[e.jsx(ue,{title:"RAFL Entry Form",extras:s}),e.jsx(je,{page:"entryform"}),e.jsx(Ne,{profile:t}),e.jsx(xe,{}),e.jsx(he,{feature:"raflForm"}),e.jsx(Pe,{})]})}export{ot as default};
