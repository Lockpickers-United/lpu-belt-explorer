import{a1 as C,a2 as E,r as i,J as L,v as P,j as e,x as j,I as J,t as b,R as H,S as Q,ab as X,U as Y}from"./index-8cbae00a.js";import{u as Z}from"./usePageTitle-8569bd0a.js";import{u as U}from"./useWindowSize-d65923fa.js";import{C as w,d as ee,F as se}from"./FieldValue-0cb8e28a.js";import{S as B}from"./SystemMessage-5d786a13.js";import{d as te}from"./Launch-f3d92df8.js";import{T as y}from"./TextField-eb620506.js";import{L as I}from"./Link-56238afe.js";import{A as N,a as F,b as G,C as le}from"./AccordionSummary-c5d4f5af.js";import{A as ie}from"./AccordionActions-cd52a791.js";import{T as R,a as A}from"./ToggleButtonGroup-989ed5f0.js";import"./useDocumentTitle-f28e684a.js";import"./Select-79dedc74.js";C.extend(E);function ne({message:a,temp:s,setTemp:t,updated:o,setUpdated:l}){var h,S;const{updateSystemMessage:v}=i.useContext(L),x=i.useCallback(async()=>{const n=C().utc().format();t({...s,modified:n}),await v(s),P("Message changes saved."),l(!1)},[t,l,s,v]),p=i.useCallback(()=>{o&&(t(a),l(!1))},[o,t,a,l]),r=i.useCallback(n=>{t({...s,[n]:!s[n]}),l(!0)},[t,l,s]),k=o?"#fff":"#555",u=o?"#e15c07":"#555",c=((h=s.linkDestination)==null?void 0:h.length)>0?"#fff":"#666";return e.jsxs("div",{style:{display:"block",width:"100%"},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10},children:[e.jsxs(y,{select:!0,style:{width:280},id:"messageType",label:"Message Type",value:s.messageType,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,messageType:n.target.value}),l(!0)},children:[e.jsx(j,{value:"Good News",children:"Good News"}),e.jsx(j,{value:"Info",children:"Info"}),e.jsx(j,{value:"Alert",children:"Alert"}),e.jsx(j,{value:"Neutral",children:"Neutral"})]}),e.jsx(y,{id:"priority",label:"Priority",value:s.priority,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,priority:n.target.value}),l(!0)},style:{marginLeft:10}}),e.jsx(y,{id:"description",label:"Description",value:s.description,fullWidth:!0,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,description:n.target.value}),l(!0)},style:{marginLeft:10}})]}),e.jsx(y,{id:"messageHeadline",label:"Headline",value:s.messageHeadline,fullWidth:!0,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,messageHeadline:n.target.value}),l(!0)},style:{marginBottom:10}}),e.jsx(y,{id:"messageText",label:"Message Text",value:s.messageText,multiline:!0,rows:3,fullWidth:!0,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,messageText:n.target.value}),l(!0)},style:{marginBottom:10}}),e.jsxs("div",{style:{display:"flex",marginBottom:10},children:[e.jsx(y,{id:"linkText",label:"Link Text",value:s.linkText,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,linkText:n.target.value}),l(!0)}}),e.jsx(y,{id:"linkDestination",label:"Link Destination",value:s.linkDestination,fullWidth:!0,size:"small",margin:"dense",color:"secondary",onChange:n=>{t({...s,linkDestination:n.target.value}),l(!0)},style:{marginLeft:10}}),e.jsx(J,{disabled:((S=s.linkDestination)==null?void 0:S.length)===0,children:e.jsx("a",{href:"https://lpubelts.com/#"+s.linkDestination,target:"_blank",rel:"noreferrer",children:e.jsx(te,{style:{fontSize:"large",color:c}})})})]}),e.jsxs("div",{style:{display:"flex",marginBottom:10},children:[e.jsx(y,{id:"pageIds",label:"Page Ids",value:s.pageIds,size:"small",margin:"dense",color:"secondary",onChange:n=>{const f=n.target.value.split(",");t({...s,pageIds:f}),l(!0)},style:{marginLeft:0,width:"50%"}}),e.jsx(y,{id:"excludePageIds",label:"Exclude Page Ids",value:s.excludePageIds,size:"small",margin:"dense",color:"secondary",onChange:n=>{const f=n.target.value.split(",");t({...s,excludePageIds:f}),l(!0)},style:{marginLeft:10,width:"49%"}})]}),e.jsxs("div",{style:{display:"flex",fontSize:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:250},children:[e.jsx(w,{checked:s.targetAdminOnly,color:"secondary",onChange:()=>{r("targetAdminOnly")}}),e.jsx(I,{style:{color:"#fff"},onClick:()=>{r("targetAdminOnly")},children:"Target Admin Only"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(w,{checked:s.targetCollectionUsersOnly,color:"secondary",onChange:()=>{r("targetCollectionUsersOnly")}}),e.jsx(I,{style:{color:"#fff"},onClick:()=>{r("targetCollectionUsersOnly")},children:"Target Collection Users Only"})]})]}),e.jsxs("div",{style:{display:"flex",fontSize:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:250},children:[e.jsx(w,{checked:s.targetLoggedIn,color:"secondary",onChange:()=>{r("targetLoggedIn")}}),e.jsx(I,{style:{color:"#fff"},onClick:()=>{r("targetLoggedIn")},children:"Target Logged In Only"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(w,{checked:s.targetAnonymousNotOK,color:"secondary",onChange:()=>{r("targetAnonymousNotOK")}}),e.jsx(I,{style:{color:"#fff"},onClick:()=>{r("targetAnonymousNotOK")},children:"Target Anonymous NOT ok"})]})]}),e.jsxs("div",{style:{display:"flex",fontSize:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:250},children:[e.jsx(w,{checked:s.targetBlackBeltsOnly,color:"secondary",onChange:()=>{r("targetBlackBeltsOnly")}}),e.jsx(I,{style:{color:"#fff"},onClick:()=>{r("targetBlackBeltsOnly")},children:"Target Black Belts Only"})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(w,{checked:s.noDismiss,color:"secondary",onChange:()=>{r("noDismiss")}}),e.jsx(I,{style:{color:"#fff"},onClick:()=>{r("noDismiss")},children:"No Dismiss Button"})]})]}),e.jsx(y,{id:"targetUserIds",label:"Target User Ids",value:s.targetUserIds||"",fullWidth:!0,size:"small",margin:"dense",color:"secondary",onChange:n=>{const f=n.target.value.split(",");console.log("idArray",f),t({...s,pageIds:f}),l(!0)}}),e.jsxs("div",{style:{width:"100%",textAlign:"right",padding:"0px 12px 8px 0px"},children:[e.jsx(b,{style:{marginRight:10,color:u},onClick:p,disabled:!o,children:"Cancel"}),e.jsx(b,{style:{marginRight:0,color:k},onClick:x,disabled:!o,children:"Save"})]})]})}C.extend(E);function ae({message:a,expanded:s,onExpand:t,setControlsExpanded:o}){const{id:l,description:v,pageIds:x}=a,{updateSystemMessageStatus:p}=i.useContext(L),[r,k]=i.useState(!1),u=i.useRef(null),[c,h]=i.useState({...a}),[S,n]=i.useState(!1);i.useEffect(()=>{if(s&&u&&!r){const m=window.innerWidth<=600?70:74;k(!0),setTimeout(()=>{window.scrollTo({left:0,top:u.current.offsetTop-m,behavior:s?"auto":"smooth"})},s?0:100)}else s||k(!1)},[s,a,r]);const f=i.useCallback((g,m)=>{t&&t(m?a.id:!1)},[a.id,t]),z=i.useCallback(g=>{g.preventDefault(),g.stopPropagation();const m=C().utc().format();h({...c,status:g.target.value,modified:m}),p(l,g.target.value,m)},[l,c,p]),T={width:760,marginLeft:"auto",marginRight:"auto"},M=c.status==="archived"?.4:c.status==="completed"||c.status==="pending"?.8:1;return e.jsxs(N,{expanded:s,onChange:f,style:T,ref:u,children:[e.jsx(F,{expandIcon:e.jsx(ee,{}),children:e.jsxs("div",{style:{display:"block",width:680,opacity:M},children:[e.jsxs("div",{style:{margin:"2px 0px 2px 4px",width:"100%",display:"flex",placeItems:"center"},children:[e.jsxs("div",{style:{fontWeight:500,fontSize:"1.2rem",lineHeight:1.25,marginBottom:"4px",flexGrow:1},children:[v," ",e.jsxs("span",{style:{fontWeight:400,color:"#bbb",fontSize:"1rem"},children:["(",l,")"]}),e.jsx("br",{}),e.jsx("span",{style:{fontWeight:400,color:"#bbb",fontSize:"0.93rem"},children:x==null?void 0:x.join(", ")})]}),e.jsx("div",{style:{fontWeight:400,color:"#bbb",fontSize:"1rem"},children:e.jsx(se,{name:"Priority",value:c.priority,headerStyle:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.73rem"},textStyle:{color:"#fff",marginTop:"10px",fontWeight:700},style:{height:40,margin:"8px 0px 4px 0px"}})}),e.jsxs(y,{select:!0,variant:"standard",style:{width:150,fontWeight:700,marginLeft:30},sx:{".MuiInputBase-root":{fontWeight:700,paddingLeft:"5px"}},id:"status",label:"Status",value:c.status,size:"small",margin:"dense",color:"secondary",onChange:g=>{g.preventDefault(),g.stopPropagation(),z(g)},onClick:g=>{g.preventDefault(),g.stopPropagation()},children:[e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"completed",children:"Completed"}),e.jsx(j,{value:"archived",children:"Archived"})]})]}),c.status!=="archived"&&e.jsx(B,{override:c})]},c.id)}),s&&e.jsxs(H.Fragment,{children:[e.jsx(G,{sx:{padding:"8px 16px 0px 16px"},children:e.jsxs("div",{style:{display:"block"},children:[c.status==="archived"&&e.jsx(B,{override:c}),e.jsx(Q,{direction:"row",alignItems:"flex-start",style:{flexGrow:1},children:e.jsx(ne,{message:a,temp:c,setTemp:h,updated:S,setUpdated:n,setControlsExpanded:o})})]})}),e.jsx(ie,{disableSpacing:!0})]})]})}const W=H.memo(ae,(a,s)=>{const t=Object.keys(a.message),o=Object.keys(s.message);if(t.length!==o.length)return!1;for(let l=0;l<t.length;l++)if(t[l]!==o[l]||a.message[t[l]]!==s.message[o[l]])return!1;return a.expanded===s.expanded&&a.onExpand===s.onExpand});function re(){const[a,s]=i.useState("*"),[t,o]=i.useState(!1),l=i.useCallback(()=>{o(!t)},[t]),v={id:"007",status:"active",description:"placeholder",messageType:"Placeholder",linkText:"OK",priority:0,messageHeadline:"No Matching Messages.",messageText:"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",noDismiss:!0,textColor:"#555"};return e.jsxs("div",{style:{textAlign:"center",width:760,marginLeft:"auto",marginRight:"auto",marginBottom:20},children:[t&&e.jsxs(le,{in:t,syle:{height:"auto"},children:[e.jsx(B,{overridePageId:a,placeholder:v}),e.jsx(y,{select:!0,style:{width:280,marginBottom:10},id:"pageId",label:"Page",value:a,size:"small",margin:"dense",color:"info",onChange:x=>{s(x.target.value)},children:oe.map((x,p)=>e.jsx(j,{value:x,children:x},p))})]}),e.jsx("div",{style:{width:760,marginLeft:"auto",marginRight:"auto"},children:e.jsxs("div",{style:{width:"100%",textAlign:"center"},children:[!t&&e.jsx(b,{variant:"outlined",color:"info",size:"small",style:{lineHeight:"1rem"},onClick:()=>l(),children:"Preview"}),t&&e.jsx(b,{variant:"outlined",color:"info",size:"small",style:{lineHeight:"1rem"},onClick:()=>l(),children:"Close Preview"})]})})]})}const oe=[...new Set(X.reduce((a,s)=>{const t=s.path.replace("/:userId","");return a.push(t),s.children&&s.children.map(o=>{const l=o.path.replace("/:userId","");a.push(l)}),a},[]))].sort();function Se(){Z("System Message Admin");const{user:a}=i.useContext(Y),{systemMessages:s,getAllSystemMessages:t,removeDismissedMessages:o}=i.useContext(L),[l,v]=i.useState([]),[x,p]=i.useState(null),[r,k]=i.useState(!1),[u,c]=i.useState("status"),[h,S]=i.useState("recent");i.useEffect(()=>{t().then(d=>v(d))},[t,s]);const n=i.useMemo(()=>l.filter(d=>h==="all"||h==="active"&&d.status==="active"?!0:h==="recent"&&["active","pending","completed"].includes(d.status)),[l,h]),f=i.useMemo(()=>n==null?void 0:n.sort((d,O)=>{const D=["active","pending","completed","archived"];return u==="priority"?O.priority-d.priority:u==="status"?D.indexOf(d.status)-D.indexOf(O.status)||C(O.modified).valueOf()-C(d.modified).valueOf():C(O.modified).valueOf()-C(d.modified).valueOf()}),[n,u]),z=i.useDeferredValue(x),T=i.useCallback(d=>{p(d)},[]),M=i.useCallback(d=>{c(d)},[]),g=i.useCallback(d=>{S(d)},[]),m=i.useCallback(()=>{k(!r)},[r]),K=i.useCallback(async()=>{await o(a==null?void 0:a.uid),P("Dismissed messages cleared.")},[o,a]),{width:_}=U(),q=_<560?"8px 8px 32px 8px":"24px 24px 32px 24px",V={margin:"0px 0px 20px 0px",width:"100%",textAlign:"center",color:"#fff"},$={id:i.useMemo(()=>Math.floor(Math.random()*4294967296).toString(16),[]),status:"pending",description:"new message",messageType:"Neutral",priority:0,messageHeadline:"Hello!",messageText:"",pageIds:[],excludePageIds:[],targetAdminOnly:!0,targetLoggedIn:!1,targetBlackBeltsOnly:!1,noDismiss:!1,targetAnonymousNotOK:!1,targetCollectionUsersOnly:!1,targetUserIds:!1};return e.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:q,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[e.jsxs("div",{style:V,children:["System Message Admin",e.jsx("br",{})]}),e.jsx(re,{}),e.jsxs("div",{style:{width:760,marginLeft:"auto",marginRight:"auto",marginBottom:20,display:"flex"},children:[e.jsxs("div",{style:{},children:[e.jsx("span",{style:{fontSize:".7rem",marginRight:5},children:"SORT"}),e.jsxs(R,{style:{height:26,marginTop:10},children:[e.jsx(A,{selected:u==="modified"||!u,style:{padding:7},value:"name",onClick:()=>M("modified"),children:"Modified"}),e.jsx(A,{selected:u==="priority",style:{padding:7},value:"lock",onClick:()=>M("priority"),children:"Priority"}),e.jsx(A,{selected:u==="status",style:{padding:7},value:"lock",onClick:()=>M("status"),children:"Status"})]})]}),e.jsxs("div",{style:{textAlign:"right",flexGrow:1},children:[e.jsx("span",{style:{fontSize:".7rem",marginRight:5},children:"FILTER"}),e.jsxs(R,{style:{height:26,marginTop:10},children:[e.jsx(A,{selected:h==="active",style:{padding:7},value:"name",onClick:()=>g("active"),children:"Active"}),e.jsx(A,{selected:h==="recent",style:{padding:7},value:"lock",onClick:()=>g("recent"),children:"Recent"}),e.jsx(A,{selected:h==="all",style:{padding:7},value:"lock",onClick:()=>g("all"),children:"All"})]})]})]}),e.jsxs(N,{expanded:r,disableGutters:!1,style:{width:760,marginLeft:"auto",marginRight:"auto"},children:[e.jsxs(F,{children:[e.jsx("div",{children:e.jsx(b,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>K(),children:"Clear My Dismissed"})}),e.jsxs("div",{style:{width:"100%",textAlign:"right"},children:[!r&&e.jsx(b,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>m(),children:"New Message"}),r&&e.jsx(b,{variant:"outlined",color:"info",size:"small",style:{lineHeight:"1rem"},onClick:()=>m(),children:"Close New Message"})]})]}),e.jsx(G,{style:{backgroundColor:"#333",padding:0},children:r&&e.jsx(W,{message:$,expanded:!0})})]}),f.map(d=>e.jsx(W,{message:d,onExpand:T,expanded:d.id===z,setControlsExpanded:k},d.id))]})}export{Se as default};
