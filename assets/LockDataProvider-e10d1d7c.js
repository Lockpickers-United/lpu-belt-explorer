import{r,F as U,aj as I,d,as as S,av as v,ai as O,j as B}from"./index-31104e8d.js";import{D as F,f as N}from"./DataContext-043af698.js";import{r as x}from"./index-8faba5ef.js";import{c as P}from"./collectionStatsById-8def94ca.js";import{u as R}from"./useData-fa8086e9.js";import{h as H}from"./dataUrls-46e31bfb.js";function Y({children:C,allEntries:i,profile:c}){const{filters:j}=r.useContext(U),{search:n,id:L,tab:V,name:W,sort:s,image:K,expandAll:b,...p}=j,{data:z,loading:k,error:h}=R({urls:E}),f=r.useMemo(()=>z&&!k&&!h?z.lockbazzarEntryIds:[],[z,h,k]),y=r.useMemo(()=>i.map(t=>{var o,u,l;return{...t,makes:t.makeModels[0].make?t.makeModels.map(({make:e})=>e):t.makeModels[0].model,fuzzy:x(t.makeModels.map(({make:e,model:a})=>[e,a]).flat().filter(e=>e).concat([t.version,t.notes,t.belt]).join(",")),content:[(o=t.media)!=null&&o.some(e=>!e.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(u=t.media)!=null&&u.some(e=>e.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((l=t.links)==null?void 0:l.length)>0?"Has Links":"No Links",I[t.belt].danPoints>0?"Worth Dan Points":void 0,d(t.lastUpdated).isAfter(d().subtract(1,"days"))?"Updated Recently":void 0,t.belt.startsWith("Black")?"Is Black":void 0,t.belt!=="Unranked"?"Is Ranked":void 0].flat().filter(e=>e),collection:S.locks.map.map(e=>c&&c[e.key]&&c[e.key].includes(t.id)?e.label:"Not "+e.label),collectionSaves:P[t.id]||0,simpleBelt:t.belt.replace(/\s\d/g,"")}}),[i,c]),A=r.useMemo(()=>{const t=Object.keys(p).map(e=>{const a=p[e];return Array.isArray(a)?a.map(m=>({key:e,value:m})):{key:e,value:a}}).flat(),o=y.filter(e=>t.every(({key:a,value:m})=>Array.isArray(e[a])?e[a].includes(m):e[a]===m)),u=n&&o.find(e=>e.id===n);let l=o;return u?l=[u]:n&&(l=N.go(x(n),o,{keys:w,threshold:-25e3}).map(e=>({...e.obj,score:e.score}))),s?l.sort((e,a)=>{if(s==="popularity")return a.collectionSaves-e.collectionSaves||a.views-e.views||e.fuzzy.localeCompare(a.fuzzy);if(s==="beltAscending")return v(e.belt,a.belt);if(s==="beltDescending")return O(e.belt,a.belt);if(s==="alphaAscending")return e.fuzzy.localeCompare(a.fuzzy);if(s==="alphaDescending")return a.fuzzy.localeCompare(e.fuzzy);if(s==="recentlyUpdated")return Math.floor(d(a.lastUpdated).valueOf()/3600)-Math.floor(d(e.lastUpdated).valueOf()/3600)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy);if(s==="dateAdded")return Math.floor(d(a.dateAdded).valueOf()/3600*24)-Math.floor(d(e.dateAdded).valueOf()/3600*24)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy)}):l},[p,y,n,s]),M=r.useCallback(t=>i.find(o=>o.id===t),[i]),g=r.useCallback(t=>f==null?void 0:f.includes(t),[f]),D=r.useMemo(()=>({allEntries:i,visibleEntries:A,getEntryFromId:M,expandAll:b,profile:c,lockbazzarAvailable:g}),[i,M,A,b,c,g]);return B.jsx(F.Provider,{value:D,children:C})}const w=["fuzzy"],E={lockbazzarEntryIds:H};export{Y as D};
