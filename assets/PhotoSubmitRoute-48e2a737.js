import{u as z,r as t,as as ae,j as e,R as M,a8 as ne,D as ie,d as re,B as T,T as le,Z as de,N as ce}from"./index-8af2e99a.js";import{I as me}from"./IntroCopy-fb355891.js";import{u as pe}from"./usePageTitle-c0820dcf.js";import{d as xe}from"./Search-a9ebb28b.js";import{e as E}from"./entryName-eddaf9a1.js";import{A as he}from"./Autocomplete-d64d9332.js";import{T as R}from"./TextField-61b7d135.js";import{I as ue}from"./Chip-d88a41e3.js";import{a as fe}from"./axios-439bb627.js";import{B as ge}from"./BeltIcon-f862bb8c.js";import{D as je}from"./Dropzone-b8600459.js";import{L as ke}from"./LoadingDisplay-41b3eb05.js";import{D as _,a as be}from"./DataContext-632ea8a3.js";import"./index-2022f701.js";import{C as ye}from"./Checkbox-b358a91d.js";import{C as ve}from"./Collapse-730d9875.js";import{I as Ne,a as Ce}from"./ImageListItem-d77139e4.js";import{D}from"./Dialog-2befe3c1.js";import{D as Se}from"./LockDataProvider-d3ac3bb5.js";import"./index-f300c0f0.js";import"./index-23c6b76c.js";import"./index-4209bf5f.js";import"./Link-dcae602c.js";import"./useDocumentTitle-8f83e56d.js";import"./Select-58fcb456.js";import"./index-dbe9bf44.js";import"./Box-c2a01b8a.js";import"./CircularProgress-d6ac0ac2.js";function Le({handleChangeLock:a,allEntries:i,disabled:k,reset:n=!1}){const b={maxWidth:700},{isMobile:N}=z(),L=t.useRef(),p=t.useMemo(()=>{let o={},r={};return{allLocks:i==null?void 0:i.sort((x,l)=>{ae(x.belt,l.belt)||E(x,"short").localeCompare(E(l,"short"))}).reduce((x,l)=>{const P=l.version?" - "+l.version:"";return l.makeModels.map(u=>{const $=u.make?u.make:u.model,w=u.make?` ${u.model}`:"",m=`${$}${w}${P}`;x.push({id:l.id,lockName:m,make:$,model:w})}),x},[]).filter(x=>x),lockIds:o,lockNames:r}},[i]),{allLocks:h,lockIds:C,lockNames:v}=p,I=h.filter((o,r)=>h.findIndex(S=>S.lockName===o.lockName)!==r),y=h==null?void 0:h.map(o=>(o.lockName=I.find(r=>r.lockName===o.lockName)?o.lockName+` (${i.find(r=>r.id===o.id).belt})`:o.lockName,o)).map(o=>(C[o.lockName]=o.id,v[o.lockName]=`${o.make}${o.model}`,o.lockName)),g=t.useCallback((o,r)=>{r?y.includes(r)&&a({lockFullName:r,lockName:v[r],lockId:C[r]}):a({})},[C,v,y,a]),[B,j]=t.useState(!1),F=t.useCallback(()=>j(!1),[]);return e.jsxs(M.Fragment,{children:[e.jsx(he,{disabled:k,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:b,options:y,onChange:g,renderInput:o=>e.jsx(R,{...o,placeholder:"Search Locks",variant:"standard",color:"info",inputRef:L,InputProps:{...o.InputProps,startAdornment:e.jsx(ue,{position:"start",children:e.jsx(xe,{})})}})},n||k),e.jsx(ne,{invisible:!0,open:B&&N,onClick:F})]})}function Ie({profile:a}){var O;const{allEntries:i}=t.useContext(_),{updateProfileField:k}=t.useContext(ie),[n,b]=t.useState({}),[N,L]=t.useState(void 0),[p,h]=t.useState([]),[C,v]=t.useState(void 0),[I,y]=t.useState(!1),[g,B]=t.useState(!1),[j,F]=t.useState(!1),[o,r]=t.useState(""),[S,x]=t.useState(""),[l,P]=t.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)),[u,$]=t.useState(!1),w=re().format("YYYYMMDD-HHMMss"),m=i.find(s=>s.id===(n==null?void 0:n.lockId)),Y=!!(n!=null&&n.lockName)&&!!(n!=null&&n.lockId)&&!!l&&p.length>0,U=`${n.lockName}_${n.lockId}_`.replace("/","+"),W=`${l}`.replace("/","+"),H=p.map(s=>s.name),K=p.length===1?"File":"Files",G=async s=>{s.preventDefault(),y(!0);const d=`${w}_${U}_${W}`,c=new FormData;p.forEach(f=>{const{base:oe,ext:se}=Be(f.name);c.append("files",f,`${d}/${U}_${oe}_${W}.${se}`)}),c.append("droppedFileNames",H),c.append("lockFullName",n.lockFullName),c.append("lockName",n.lockName),c.append("version",m==null?void 0:m.version),c.append("belt",m==null?void 0:m.belt),c.append("lockId",n.lockId),c.append("photoCredit",l),c.append("displayName",a.displayName),c.append("uploadsDir",d),c.append("notes",S),await fe.post("https://explore.lpubelts.com:8443/upload",c,{headers:{"Content-Type":"multipart/form-data"}}).then(f=>{v(f.data),q(l)}).catch(f=>{console.error("upload error",f),B(f)}),g||(b([]),p.forEach(f=>URL.revokeObjectURL(f.preview)),h([]),y(!1))},Z=t.useCallback(s=>{b(s),L(i.find(d=>d.id===s.lockId))},[i]),q=t.useCallback(s=>{k("photoCredit",s)},[k]),J=t.useCallback(s=>{const{value:d}=s.target;P(d)},[]),Q=t.useCallback(s=>{const{value:d}=s.target;x(d)},[]),A=t.useCallback(()=>{b({}),L(void 0),p.forEach(s=>URL.revokeObjectURL(s.preview)),h([]),v(void 0),y(!1),B(void 0),F(!1),r(""),x(""),$(!u)},[p,u]),V=t.useCallback(()=>{F(!j),b([])},[j]),X=t.useCallback(s=>{const{value:d}=s.target;r(d),b({lockFullName:d,lockName:d,lockId:"NOTINLIST"})},[]),ee=j?.5:1,{flexStyle:te}=z();return e.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[e.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:G,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:"Select Lock"}),e.jsx("div",{style:{opacity:ee},children:e.jsx(Le,{handleChangeLock:Z,allEntries:i,disabled:j,reset:u})}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(ye,{onChange:V,color:"info",size:"small",id:"notInList",checked:j})," Submit photos for a lock not on the site."]}),e.jsxs(ve,{in:j,style:{marginTop:10},children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),e.jsx("br",{}),e.jsx(R,{type:"text",id:"altLockName",name:"altLockName",value:o,style:{width:400},onChange:X,color:"info"})]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:te},children:[e.jsxs("div",{style:{marginRight:50,width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",e.jsx("br",{})]}),e.jsx(je,{files:p,setFiles:h}),N&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",e.jsx("br",{})]}),N.media?e.jsx("div",{children:e.jsx(Ne,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:N.media.map(s=>e.jsx(Ce,{children:e.jsx("img",{srcSet:`${s.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${s.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:s.title,loading:"lazy"})},s.thumbnailUrl))})}):e.jsx("span",{children:"no images"})]})]}),e.jsxs("div",{style:{width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",e.jsx("br",{})]}),n.lockFullName&&e.jsxs("span",{children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex"},children:[n.lockId!=="NOTINLIST"&&e.jsx(ge,{value:m==null?void 0:m.belt,style:{marginBottom:-10}}),e.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:n.lockFullName})]}),e.jsx("br",{})]}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),e.jsx("br",{}),e.jsx(R,{type:"text",name:"photoCredit",value:l,style:{width:350},onChange:J,color:"info"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),e.jsx("br",{}),e.jsx(R,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:S,onChange:Q}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(T,{type:"submit",variant:"contained",color:"info",disabled:!Y||I,children:"Upload"})]})]}),e.jsx("br",{}),e.jsx("br",{})]})}),e.jsx(D,{open:I,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:e.jsx(ke,{})})}),e.jsx(D,{open:!!C&&!g,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[K," Uploaded Succesfully!"]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(T,{onClick:A,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"Submit more photos"})})]})})}),e.jsx(D,{open:!!g,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",e.jsx("br",{}),"Please try again later.",e.jsx("br",{})]}),e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",(O=g==null?void 0:g.response)==null?void 0:O.data]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(T,{onClick:A,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(le,{feature:"uploadPhotos"})]})}function Be(a){const i=a.lastIndexOf(".");return i===-1?{base:a,ext:""}:{base:a.substring(0,i),ext:a.substring(i)}}function st(){const{profile:a}=t.useContext(_),{isMobile:i}=z();pe("LPU Belt Explorer - Submit Photos");const k=e.jsx(M.Fragment,{children:!i&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(be,{children:e.jsxs(Se,{allEntries:de,children:[e.jsx(ce,{title:"Submit Photos",extras:k}),a&&!a.photoCredit&&e.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:e.jsx(me,{pageName:"photoUpload",maxWidth:820})}),e.jsx(Ie,{profile:a})]})})}export{st as default};
