import{d as F,u as C,j as t,R as L,b as E,r as u,A as U,N as $,F as X,T as _}from"./index-32d4c99f.js";import{D as J,a as K,r as Q}from"./filterFields-4f11352b.js";import{L as Z}from"./LoadingDisplay-ceb93b25.js";import{u as tt}from"./useData-5f5ad995.js";import{u as et}from"./usePageTitle-8d8d3910.js";import{s as nt,g as ot}from"./dataUrls-f163a2c2.js";import{P as I}from"./nivo-line.es-4c4da239.js";import{p as H}from"./adminChartDefaults-e02caa29.js";import{A as it}from"./AdminStatsTable-743df61a.js";import{A as N}from"./AdminStatsTableSort-14fb9e0b.js";import{R as st}from"./RaffleAutocompleteBox-cebd20f2.js";import{L as at}from"./Link-ff1555b0.js";import{R as B,s as A,A as rt}from"./AdminRoleButton-5f90598b.js";import{R as lt}from"./RaffleStatsHeader-3871c55f.js";import{C as ct}from"./ChoiceButtonGroup-131aa3f1.js";import{B as dt}from"./nivo-bar.es-8873b5e4.js";import{p as mt}from"./chartDefaults-9fc07b21.js";import{R as ut}from"./ReportButton-123d534a.js";import{R as ft}from"./RaffleDataProvider-27c26b7c.js";import"./LPU-c3fa7122.js";import"./LinearProgress-a0287b87.js";import"./useDocumentTitle-2b68771e.js";import"./nivo-legends.es-7fecc3b1.js";import"./index-22411e02.js";import"./TableRow-3975770a.js";import"./Search-74ce18f0.js";import"./Autocomplete-60175c91.js";import"./Select-018f8bd6.js";import"./Chip-4e489496.js";import"./TextField-5afc7aff.js";import"./index-6474dce1.js";import"./ToggleButtonGroup-52c70f6b.js";const ht=({lineData:i})=>{const l=[i.rafl28days.data],s=[],n=new Map,e=new Map,r=new Map;l.forEach(m=>{const y=[],g=[],k=[];for(let D=0;D<m.length;D++){let x=m[D].date;if(F(x)<F("2024-11-25"))continue;x=x+" 23:59:59";const f=new Map;f.x=x,f.y=m[D].potListViews,y.push(f);const j=new Map;j.x=x,j.y=m[D].potViews,g.push(j);const T=new Map;T.x=x,T.y=m[D].raflForm,k.push(T)}n.id="Pot List",n.data=y,e.id="Pot Views",e.data=g,r.id="Entry Form",r.data=k,s.push(e),s.push(n),s.push(r)});const{width:o}=C(),d=o<=360,b=o<=395,p=o<=428,w=o<=560,S=o<=820,h=d||b?200:p?210:S?230:350,v=w?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:h,width:"100%"},children:t.jsx(I,{theme:H,data:s,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:v,height:h,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function pt({data:i}){const{width:l}=C(),s=l<=560,r={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...s?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:r,children:t.jsx(ht,{lineData:i})})})})}const xt=({data:i})=>{const{rafl28days:l}=i,s=l.data.filter(m=>F(m.date)>F("2024-11-27")),n=s.reduce((m,y)=>(Object.keys(l.data[l.data.length-1]).map(g=>{["date","dateString"].includes(g)||(m[g]=m[g]?m[g]+y[g]:y[g])}),m),{});n.dateString="Total",s.push(n);const e=Object.keys(n).reduce((m,y)=>(m[y]=Math.floor(n[y]/s.length),m),{});e.dateString="Average",s.push(e);const r={columns:l.columns,data:s},{width:o}=C(),d=o<=360,b=o<=395,p=o<=428,w=o<=560,S=o<=820,h=d?".8rem":b?".85rem":p?".9rem":".95rem",v="100%";return t.jsx(it,{tableData:r,tableWidth:v,fontSize:h})},gt=({data:i})=>{const l=E(),{potViewsById:s}=i,{getPotFromId:n}=u.useContext(J),e=[{name:"Pot #",align:"center",id:"potNumber"},{name:"ID",align:"center",id:"id"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],r=!0,[o,d]=u.useState("potNumber"),[b,p]=u.useState(!0),[w,S]=u.useState({}),h=s.data.map(a=>{var P,V;const c=n(a.id);if(!c)return null;let R=c!=null&&c.title?c.title.substring(0,32):`unknown (${a.id})`;R=((P=c==null?void 0:c.title)==null?void 0:P.length)<32||!(c!=null&&c.title)?R:R+"...";const W=(V=a==null?void 0:a.id)==null?void 0:V.replace("2025-","");return{...a,percentViews:Math.floor(a.percentViews*100)+"%",...c,title:R,id:W}}).filter(a=>a).sort((a,c)=>{switch(o){case"potNumber":return a.potNumber-c.potNumber||a.title.localeCompare(c.title);case"id":return a[o].localeCompare(c[o]);case"title":return a[o].localeCompare(c[o]);case"donors":return parseInt(c[o])-parseInt(a[o])||a.title.localeCompare(c.title);case"percentViews":return parseInt(c[o])-parseInt(a[o])||a.views-c.views;default:return parseInt(c[o])-parseInt(a[o])||a.title.localeCompare(c.title)}}),v=b?h:h.reverse(),y=(Object.keys(w).length>0?[v==null?void 0:v.find(a=>a.title===w.itemTitle)]:v||[]).map(a=>a.donors&&a.donors>0?{...a}:{...a,donors:0,tickets:0}),g={columns:e,data:y},k=u.useCallback((a,c)=>{const R=h.find(P=>P.title===c),W=R==null?void 0:R.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return a==="title"?t.jsx(at,{onClick:()=>l(`/rafl/?id=${R.id}&name=${W}`),style:{color:"#fff"},children:c}):c},[l,h]),D=u.useCallback(a=>a!=null&&a.title?a.title:"unknown",[]),{width:x}=C(),f=x<=360,j=x<=395,T=x<=428,O=x<=560,Y=x<=820,G=f?".8rem":j?".85rem":T?".9rem":".95rem",q="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(st,{allItems:h,setItemDetails:S,getOptionTitle:D,searchText:"Search Pots"})})}),t.jsx(N,{tableData:g,tableWidth:q,fontSize:G,sortable:r,sort:o,setSort:d,ascending:b,setAscending:p,linkFunction:k})]})},yt=()=>{const{allCharities:i}=u.useContext(B),l=[{id:"name",align:"left",name:"Charity Name"},{id:"donors",name:"Donors",align:"left"},{id:"donations",name:"Donations",align:"left"}],s=!0,[n,e]=u.useState("name"),[r,o]=u.useState(!0),d=i.sort((f,j)=>{switch(n){case"name":return f.name.localeCompare(j.name);case"donors":return j[n]-f[n];case"donations":return j[n]-f[n];default:return f.name.localeCompare(j.name)}}),p=(r?d:d.reverse()).map(f=>f.donations&&f.donations>0?{...f,donations:`$${f.donations}`}:{...f}),w={columns:l,data:p},S=u.useCallback((f,j)=>j,[]),{width:h}=C(),v=h<=360,m=h<=395,y=h<=428,g=h<=560,k=h<=820,D=v?".8rem":m?".85rem":y?".9rem":".95rem",x="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400}})}),t.jsx(N,{tableData:w,tableWidth:x,fontSize:D,sortable:s,sort:n,setSort:e,ascending:r,setAscending:o,linkFunction:S})]})};function M({chartHeight:i,chartdata:l,showAxisBottom:s,colors:n,tickValues:e,curve:r}){const o=s?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},d=s?"bottom":"top-left",b=s?70:20,p=s?0:20;return t.jsx("div",{style:{height:i,width:"100%"},children:t.jsx(I,{theme:H,data:l,enableGridX:!1,enableGridY:!1,colors:n,lineWidth:3,margin:o,height:i,curve:r??"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:e||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:s?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"}:null,legends:s?[]:[{anchor:d,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:p,translateY:b,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const jt=({data:i})=>{const l=Object.keys(i).sort((e,r)=>e.localeCompare(r)).reduce((e,r)=>{const o=r+" 23:59:59";return e.donorsCum=e.donorsCum+i[r].totalDonors||i[r].totalDonors,A(e,["totalDonors"],{x:o,y:i[r].totalDonorCountUnique}),A(e,["cumulativeDonors"],{x:o,y:i[r].cumDonorsUnique}),e.donationsCum=e.donationsCum+i[r].totalDonations||i[r].totalDonations,A(e,["totalDonations"],{x:o,y:i[r].totalDonations}),A(e,["cumulativeDonations"],{x:o,y:e.donationsCum}),e},[]),s={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},n=120;return Object.keys(i).length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(L.Fragment,{children:[t.jsx("div",{style:s,children:"Donations"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(M,{chartdata:[{id:"Donations Cumulative",data:l.cumulativeDonations}],chartHeight:n,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(M,{chartdata:[{id:"Donations",data:l.totalDonations}],chartHeight:n,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:s,children:"Unique Donors"}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(M,{chartdata:[{id:"Donors Cumulative",data:l.cumulativeDonors}],chartHeight:n,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:n,width:"100%"},children:t.jsx(M,{chartdata:[{id:"Donors",data:l.totalDonors}],chartHeight:n,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},bt=({beltDistribution:i})=>{const{width:l}=C(),s=l<500,n=250,e=s?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},r=s?-45:0,o=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:n},children:t.jsx(dt,{data:i,maxValue:"auto",margin:e,padding:.15,colors:d=>o[d.index%o.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:r},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:mt,isInteractive:!1})})};function wt({data:i}){const l=u.useMemo(()=>z.map(d=>({value:i.beltDonations[d]?i.beltDonations[d]/i.totalDonations:0,id:d,label:d})),[i]),s=u.useMemo(()=>z.map(d=>({value:i.beltDonorCountUnique[d]?i.beltDonorCountUnique[d]/i.totalDonorCountUnique:0,id:d,label:d})),[i]),n=u.useMemo(()=>[{label:"Donations",data:l},{label:"Donors",data:s}],[l,s]),[e,r]=u.useState(n[0]),o=u.useCallback(d=>r(d),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(ct,{options:n,onChange:o}),t.jsx(bt,{beltDistribution:e.data})]})}const z=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"];function vt(){et("RAFL Report");const{data:i,loading:l,error:s}=tt({urls:Dt}),{siteFullNew:n,raflResponseDetails:e}=i||{},{width:r}=C(),d=r<560?"8px 8px 32px 8px":"24px 24px 32px 24px",b={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},p={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},w=b,S=l?"--":"(updated: "+F(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return l?t.jsx(Z,{}):s?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:d,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:w,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:S})]}),t.jsx(lt,{}),t.jsx("div",{style:{height:20}}),t.jsx(pt,{data:n}),t.jsx("div",{style:p,children:"Totals Over Time"}),t.jsx(jt,{data:e==null?void 0:e.detailedData}),t.jsx("div",{style:p,children:"Belt Distribution"}),t.jsx(wt,{data:e==null?void 0:e.summaryData}),t.jsx("div",{style:p,children:"Page Tracking"}),t.jsx(xt,{data:n}),t.jsx("div",{style:p,children:"Pot Details"}),t.jsx(gt,{data:n}),t.jsx("div",{style:p,children:"Charity Details"}),t.jsx(yt,{data:n})]})}const Dt={siteFullNew:nt,raflResponseDetails:ot};function ne(){const{authLoaded:i}=u.useContext(U),{isMobile:l}=C(),{allPots:s}=u.useContext(B),{raffleAdmin:n}=u.useContext(B),e=t.jsxs(L.Fragment,{children:[!l&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(ut,{active:!0}),t.jsx(rt,{})]});return t.jsx(K,{filterFields:Q,children:t.jsx(ft,{allEntries:s,children:t.jsxs(L.Fragment,{children:[t.jsx($,{title:"RAFL Report",extras:e}),i&&n&&t.jsx(vt,{}),t.jsx(X,{}),t.jsx(_,{feature:"raflReport"})]})})})}export{ne as default};
