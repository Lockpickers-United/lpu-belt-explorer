import{P as Le,Q as Te,U as De,V as Ie,r as t,F as z,u as q,j as e,a2 as se,R as J,I as Q,am as G,K as $,B as N,L as be,D as Me,a1 as ae,ah as Ne,aq as fe,A as Ce,$ as ye,bc as je,X as ze,a0 as ve}from"./index-C1bacnV5.js";import{B as ce,S as Ee}from"./Sort-Dt6b_ia6.js";import{f as me,F as ke,a as We,C as Ae}from"./FilterAlt-DmRpCQay.js";import{L as de}from"./LockListContext-BAmp8hGe.js";import{T as Fe,a as re}from"./ToggleButtonGroup-CsFJAYcG.js";import{B as ue}from"./Box-BD7IwCQ-.js";import{D as Se}from"./DataContext-DyL1rT7K.js";import{H as pe}from"./HighlightOff-C-g9IUMT.js";import{s as xe}from"./setDeep-J6HEwWhX.js";import{A as Ge}from"./AddCircle-cdyNhwBe.js";import{F as $e,I as qe,S as _e}from"./Select-ChGT3VTk.js";import{C as we}from"./Cancel-C_wS1fFs.js";const te=({advancedFilterGroups:u,entries:c,groupIndex:p,valueIndex:d})=>{if(!c||c.length===0)return[];const r=Array.isArray(u)?u:[];if(r.length===0||p<0)return c;const a=s=>{if(!s||!s.fieldName)return null;const o=s.fieldName,n=Array.isArray(s.values)?s.values.filter(l=>l!=null&&String(l).length):[];if(n.length===0)return null;const y=(s.operator||"AND").toUpperCase()==="OR"?"OR":"AND",h=(s.matchType||"Is").toLowerCase()==="is not";return{fieldName:o,values:n,operator:y,negative:h}};let i=r.map(a).filter(Boolean);if(i.length===0)return c;if(Number.isFinite(p)&&p>=0&&(i=i.slice(0,Math.min(p+1,i.length))),i.length>0&&Number.isFinite(d)&&d>=0){const s=i.length-1,o=i[s];Array.isArray(o.values)&&o.values.length>0&&(o.values=o.values.slice(0,Math.min(d+1,o.values.length)))}return c.filter(s=>i.every(({fieldName:o,values:n,operator:y,negative:h})=>{const l=s[o],b=m=>Array.isArray(l)?l.includes(m):l===m,j=n.some(m=>b(m)),f=n.every(m=>b(m)),w=y==="OR"?j:f;return h?!w:w}))};var P={},ge;function He(){if(ge)return P;ge=1;var u=Le();Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var c=u(Te()),p=De();return P.default=(0,c.default)((0,p.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM8 9h8v10H8zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline"),P}var Ve=He();const Ue=Ie(Ve);function Ke({label:u,active:c=!1,group:p,operator:d,valueIndex:r,currentValue:a,onFilter:i,onRemove:s,handleAddValue:o,sort:n,size:y="medium",context:h}){if(!u||u.length===0)return null;const{searchedBeltEntries:l,visibleEntries:b,visibleBeltEntries:j}=t.useContext(Se),{advancedFilterGroups:f,setAdvancedFilterGroups:w}=t.useContext(z),{fieldName:m,groupIndex:v,matchType:A,values:O=[]}=p;[...f()];let B=Array.isArray(O)?O.filter(g=>g&&String(g).length>0).join(d==="OR"?" OR ":" AND "):O;B=A==="Is Not"?`NOT ${B}`:B;const M=t.useMemo(()=>{if(c){if(v===0&&(!r||r===0))return l;if(v>0&&(!r||r===0)||r>0&&d==="OR")return te({advancedFilterGroups:f(),entries:l,groupIndex:v-1,valueIndex:99});if(r>0&&d==="AND")return te({advancedFilterGroups:f(),entries:l,groupIndex:v,valueIndex:r-1})}else return l;return[]},[c,v,r,d,l,f]),{options:_,counts:E}=t.useMemo(()=>{const g=M.reduce((F,S)=>(Array.isArray(S[m])?S[m].forEach(he=>{xe(F,[he],S.id)}):xe(F,[S[m]],S.id),F),{});let L=h==="drawer"?Array.from(new Set([...Object.keys(g),a,B])):Array.from(new Set([...Object.keys(g),a]));L=L.filter(F=>F&&String(F).length>0&&F!=="undefined");const V=L.sort((F,S)=>{if(n)return n(F,S);if(typeof F=="string"&&typeof S=="string")return F.localeCompare(S);if(Number.isInteger(F)&&Number.isInteger(S))return F-S});return{counts:V.reduce((F,S)=>{if(S==="no more options")return F[S]=0,F;const Oe=f().map((U,Re)=>{if(Re!==v)return U;if((U.operator||d)==="OR")return{...U,values:[S]};const K=Array.isArray(O)?[...O]:[];typeof r=="number"?K.length===0?K.push(S):K[r]=S:K.push(S);const Be=K.filter(ie=>ie!=null&&String(ie).length>0);return{...U,values:Be}});let ee;return c?ee=te({advancedFilterGroups:Oe.slice(0,v+1),entries:l}):ee=te({advancedFilterGroups:[{fieldName:m,matchType:A,operator:"OR",values:[S]}],entries:j,groupIndex:0}),F[S]=Array.isArray(ee)?ee.length:0,F},{}),options:V}},[M,h,a,B,m,n,f,c,v,d,O,r,A,j,l]),H=Array.isArray(O)?O.filter((g,L)=>L!==r):[];let D=_.filter(g=>E[g]>0&&(g!==a||g!==B||E[g]!==b.length)||g===a||g===B).filter(g=>!H.includes(g));D.length===0&&(D=["no more options"]);const x=D.length===1&&D[0]==="no more options",[k,C]=t.useState(!1),T=t.useCallback(g=>{C(!1);const L=g.target.value;L!=="no more options"&&(setTimeout(()=>i&&i(L),0),setTimeout(()=>document.activeElement.blur()))},[i]),R=t.useCallback(()=>{C(!1),setTimeout(()=>document.activeElement.blur())},[]),I=t.useCallback(()=>C(!0),[]),X=t.useCallback(()=>{let L=f().filter((V,Z)=>Z!==v);L.length===0&&(L=[{_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:"",matchType:"Is",operator:"OR",values:[]}]),w(L)},[f,v,w]),le=t.useCallback(()=>{s&&s()},[s]),ne=h==="drawer"?10:4,oe=h!=="drawer"?{backgroundColor:a.length>0?"#333":void 0}:A==="Is Not"?{backgroundColor:a.length>0?"#642c2c":void 0}:{backgroundColor:a.length>0?"#555":void 0},{isMobile:Y}=q(),W=Y||h==="drawer"?210:250;return e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:ne},children:[(D==null?void 0:D.length)===0||(m==null?void 0:m.length)===0?null:e.jsxs($e,{style:{minWidth:W,marginTop:0,marginRight:4},size:y==="small"?"small":"medium",fullWidth:!0,children:[e.jsx(qe,{id:`filter-${m}`,color:"secondary",style:{opacity:x?.5:1},children:u}),e.jsx(_e,{label:u,labelId:`filter-${m}`,value:x?"no more options":h==="drawer"?B:a,disabled:x,onChange:T,style:{...oe,opacity:x?.5:1},color:"secondary",open:k,onClose:R,onOpen:I,onBlur:R,children:D.map((g,L)=>{const V=E[g]||0,Z=["AND","OR"].some(F=>g.includes(F));return e.jsx(se,{value:g,children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[e.jsx("div",{style:{maxWidth:160,overflow:"hidden",textOverflow:"ellipsis"},children:me[g]?me[g]:g}),e.jsx("div",{style:{fontSize:"0.8rem",marginLeft:8,opacity:.85},children:x||Z?"":V})]})},`${g}-${L}`)})})]}),h!=="drawer"&&e.jsxs(J.Fragment,{children:[r===0&&a.length>0&&e.jsx(Q,{"aria-label":"add filter group",onClick:o,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(Ge,{fontSize:"small",style:{color:"#5d854f"}})}),(a.length>0||r>0)&&e.jsx(Q,{"aria-label":"remove filter value",onClick:le,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(pe,{fontSize:"small",style:{color:"#d04e4e"}})}),(!r||r===0)&&m&&e.jsx(Q,{"aria-label":"remove filter group",onClick:X,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(Ue,{fontSize:"small",style:{color:"#eee"}})})]}),(a.length>0||r>0)&&h==="drawer"&&e.jsx(Q,{"aria-label":"remove filter value",onClick:X,style:{marginTop:4,marginLeft:2},size:"small",children:e.jsx(pe,{fontSize:"small",style:{color:"#d04e4e"}})})]})}function Pe({style:u={}}){const{filters:c,addFilter:p,removeFilters:d}=t.useContext(z),{tab:r}=t.useContext(de),{belt:a}=c,i=/\/locks/.test(location.hash),s=t.useMemo(()=>r||a||"White",[a,r]),o=t.useMemo(()=>s!=="search"?"belt":"all",[s]),[n,y]=t.useState(s);s!==n&&s!=="search"?y(s):o==="belt"&&s==="search"&&y("search");const h=t.useCallback(f=>()=>{f==="all"?p("tab","search",!0):f==="belt"&&(d(["belt"]),p("tab",n,!0))},[p,n,d]),{color:l}=G[n]?G[n]:{color:"#inherit"},b=n==="Black"?"#444":l,j=o==="belt"?1:.7;return e.jsx(J.Fragment,{children:G[n]&&i&&e.jsx("div",{style:u,children:e.jsxs(Fe,{variant:"outlined",children:[e.jsxs(re,{onClick:h("belt"),style:{color:o==="belt"?"#fff":"#777",backgroundColor:o==="belt"?"#3f3f3f":"#222",height:28,padding:"0px 10px 0px 0px",borderColor:"#666",width:134,textAlign:"left",justifyContent:"flex-start"},value:"belt",disabled:o==="belt",children:[e.jsx("div",{style:{backgroundColor:l,height:26,width:12,borderRadius:"3px 0px 0px 3px",borderRight:`${b} 1px solid`,marginRight:8,opacity:j}}),e.jsxs("div",{style:{flexGrow:1,textAlign:"center"},children:[n," BELT"]})]},"belt"),e.jsx(re,{onClick:h("all"),style:{color:o==="all"?"#fff":"#777",backgroundColor:o==="all"?"#3f3f3f":"#222",height:28,padding:"0px 12px",borderColor:"#666"},value:"all",disabled:o==="all",children:"ALL LOCKS"},"all")]})})})}function Qe({forceText:u,forceIcon:c,closeDrawer:p,alwaysShow:d,drawer:r=!1}){const{isMobile:a}=q(),{filterCount:i,clearFilters:s,clearAdvancedFilterGroups:o}=t.useContext(z),n=t.useCallback(()=>{s(),o&&o(),p&&p()},[o,s,p]),y=r?"text":"outlined";return i===0&&!d?null:a&&!u||c?e.jsx($,{title:"Reset All",arrow:!0,disableFocusListener:!0,children:e.jsx(Q,{onClick:n,color:"warning",style:{padding:0},children:e.jsx(we,{})})}):e.jsx(N,{variant:y,color:"warning",onClick:n,style:{height:28,padding:"0px 12px",minWidth:80,marginLeft:8},children:"Reset"})}function Je({text:u}){const{filters:c,addFilter:p,removeFilter:d}=t.useContext(z),{expandAll:r}=c,a=t.useCallback(()=>{!r||r==="false"?p("expandAll","Expand All",!0):d("expandAll","Expand All")},[r,p,d]),i=r?"Collapse All":"Expand All";return u?e.jsx("div",{children:e.jsx($,{title:i,arrow:!0,disableFocusListener:!0,children:e.jsx(be,{onClick:()=>a(),style:{color:"#fff",textDecoration:"none",cursor:"pointer"},size:"small",children:e.jsx("div",{style:{marginLeft:5,marginTop:5,padding:5,fontWeight:700},children:i.toUpperCase()})})})}):e.jsx("div",{children:e.jsx($,{title:i,arrow:!0,disableFocusListener:!0,children:e.jsx(N,{onClick:()=>a(),style:{color:"#aaa"},size:"small",children:i})})})}function Xe({sortValues:u,compactMode:c,expandAll:p}){const[d,r]=t.useState(null),a=!!d,i=t.useCallback(A=>r(A.currentTarget),[]),s=t.useCallback(()=>r(null),[]),{filters:o,addFilter:n}=t.useContext(z),{sort:y}=o,{adminRole:h}=t.useContext(Me),{compact:l,setCompact:b}=t.useContext(ae),j=t.useCallback(A=>()=>{s(),b(A)},[s,b]),f=t.useCallback(A=>()=>{s(),setTimeout(()=>n("sort",A,!0),0)},[n,s]),w={vertical:"top",horizontal:"right"},{width:m}=q(),v=m<=500;return e.jsxs(J.Fragment,{children:[e.jsx($,{title:"View Options",arrow:!0,disableFocusListener:!0,children:e.jsx(N,{color:"inherit",onClick:i,style:{color:"#ddd"},children:e.jsx(ce,{variant:"dot",color:"secondary",invisible:!y,anchorOrigin:w,children:v?e.jsx(Ee,{}):"VIEW"})})}),e.jsxs(Ne,{anchorEl:d,open:a,onClose:s,children:[e.jsx("div",{style:{marginLeft:5,padding:5,fontWeight:700},children:"SORT BY"}),u.map(({label:A,value:O})=>e.jsx(se,{onClick:f(O),selected:y===O,children:A},A)),c&&e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx("div",{style:{marginLeft:5,marginTop:5,padding:5,fontWeight:700},children:"MODE"}),e.jsx(se,{onClick:j(!1),selected:!l,children:"Normal"}),e.jsx(se,{onClick:j(!0),selected:l,children:"Compact"})]}),h&&p&&e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(Je,{text:!0})]})]})]})}function Ye({onFiltersChanged:u}){const{isLoggedIn:c}=t.useContext(Ce),{beta:p}=t.useContext(ae),{filters:d,filterCount:r,addFilters:a,addFilter:i,filterFields:s,removeFilters:o}=t.useContext(z),{tab:n}=t.useContext(de),{belt:y}=d,h=/\/locks/.test(location.hash),l=t.useMemo(()=>n||y||"White",[y,n]),b=t.useMemo(()=>l!=="search"?"belt":"all",[l]),[j,f]=t.useState(l);l!==j&&l!=="search"?f(l):b==="belt"&&l==="search"&&f("search");const[w,m]=t.useState(!1),v=t.useCallback(()=>m(!w),[w]);ye("f",v);const A=t.useCallback(k=>()=>{k==="all"?i("tab","search",!0):k==="belt"&&(o(["belt"]),i("tab",j,!0))},[i,j,o]),O=t.useCallback((k,C)=>{a([{key:k,value:C},{key:"id",value:void 0},{key:"name",value:void 0}],!0),u&&u()},[a,u]),B=t.useCallback(()=>m(!0),[]),M=t.useCallback(()=>m(!1),[]),{color:_,lineColor:E="#999"}=G[j]?G[j]:{color:"#inherit"},H=b==="belt"?1:.7,{width:D}=q(),x=D<=500;return e.jsxs(J.Fragment,{children:[e.jsx($,{title:"Filter",arrow:!0,disableFocusListener:!0,children:e.jsx(N,{color:"inherit",onClick:B,style:{color:"#ddd"},children:e.jsx(ce,{variant:"dot",badgeContent:r,color:"secondary",anchorOrigin:{vertical:"top",horizontal:"right"},children:x?e.jsx(ke,{}):"FILTER"})})}),w&&e.jsxs(je,{anchor:"right",open:w,onClose:M,children:[e.jsx(ze,{variant:"dense",onClick:M,style:{padding:"8px 0px 0px 8px"},children:e.jsx("div",{style:{fontSize:"1.3rem",fontWeight:700},children:"Filters"})}),G[j]&&h&&e.jsx("div",{style:{marginLeft:8,marginBottom:8},children:e.jsxs(Fe,{variant:"outlined",children:[e.jsxs(re,{onClick:A("belt"),style:{color:b==="belt"?"#eee":"#777",backgroundColor:b==="belt"?"inherit":"#111",padding:"6px 12px",borderColor:"#666"},value:"belt",disabled:b==="belt",children:[e.jsx("div",{style:{backgroundColor:_,height:16,width:16,borderColor:E,borderRadius:8,border:"1px solid",marginRight:8,opacity:H}}),j," BELT"]},"belt"),e.jsx(re,{onClick:A("all"),style:{color:b==="all"?"#eee":"#777",backgroundColor:b==="all"?"inherit":"#111",padding:"6px 12px",borderColor:"#666"},value:"all",disabled:b==="all",children:"ALL LOCKS"},"all")]})}),e.jsx(ue,{margin:1,children:e.jsx(ve,{direction:"column",style:{minWidth:250},children:s.filter(k=>(!k.beta||p)&&(!k.userBased||c)).filter(k=>!(b==="belt"&&n!=="search"&&k.label==="Belt")).map((k,C)=>e.jsx(We,{tab:n,...k,onFilter:O},C))})}),e.jsxs("div",{style:{padding:8},children:[e.jsx(Ae,{forceText:!0}),e.jsx(N,{variant:"outlined",color:"inherit",onClick:M,children:"Done"})]})]})]})}function Ze(){const[u,c]=t.useState(!1),{isLoggedIn:p}=t.useContext(Ce),{beta:d}=t.useContext(ae),{filters:r,filterCount:a,filterFields:i,showAdvancedSearch:s,setShowAdvancedSearch:o,advancedFilterGroups:n,setAdvancedFilterGroups:y}=t.useContext(z),{tab:h}=t.useContext(de),{visibleBeltEntries:l=[]}=t.useContext(Se),{belt:b}=r,j=t.useMemo(()=>{const x=n().filter(C=>C.fieldName.length>0&&Array.isArray(C.values)&&C.values.length>0).map(C=>({...i.find(R=>R.fieldName===C.fieldName),active:!0})),k=i.filter(C=>!x.find(T=>T.fieldName===C.fieldName));return[...x,...k]},[n,i]),f=t.useMemo(()=>h||b||"White",[b,h]),w=t.useMemo(()=>f!=="search"?"belt":"all",[f]),[m,v]=t.useState(f);f!==m&&f!=="search"?v(f):w==="belt"&&f==="search"&&v("search");const A=t.useCallback(()=>c(!u),[u]);ye("f",A);const O=t.useCallback((x,k)=>{if(!x||!k)return;o(!0);const C=[...n().filter(I=>I.fieldName.length>0)],T=C.findIndex(I=>I.fieldName===x&&Array.isArray(I.values)&&I.values.length>0);if(T>=0){const I=C[T];if(I.values.includes(k))return;C[T]={...I,values:[k]},y(C);return}const R={_id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,fieldName:x,matchType:"Is",operator:"OR",values:[k]};y([...C,R])},[n,y,o]),B=t.useCallback(()=>c(!0),[]),M=t.useCallback(()=>c(!1),[]),_=t.useCallback(()=>{o(!s)},[o,s]),E={color:"#ddd",textDecoration:"underline",cursor:"pointer","&:hover":{color:"#fff"}},{width:H}=q(),D=H<=500;return e.jsxs(J.Fragment,{children:[e.jsx($,{title:"Filter",arrow:!0,disableFocusListener:!0,children:e.jsx(N,{color:"inherit",onClick:B,style:{color:"#ddd"},children:e.jsx(ce,{variant:"dot",badgeContent:a,color:"warning",anchorOrigin:{vertical:"top",horizontal:"right"},children:D?e.jsx(ke,{}):"FILTER"})})}),u&&e.jsxs(je,{anchor:"right",open:u,onClose:M,sx:{".MuiDrawer-paper":{width:280,padding:1}},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",margin:"8px 8px 12px 8px",height:38},onClick:M,children:[e.jsx("div",{style:{fontWeight:700,fontSize:"1.3rem"},children:"Filters"}),e.jsxs("div",{style:{fontWeight:400,fontSize:"1.0rem",marginLeft:8},children:["(",(l==null?void 0:l.length)||0," Lock",(l==null?void 0:l.length)!==1&&"s",")"]}),e.jsx("div",{style:{flexGrow:1,textAlign:"right",fontSize:"0.9rem"},children:s?e.jsx(Qe,{advanced:!0,drawer:!0}):e.jsx(be,{onClick:_,sx:E,children:s?"Reset":"Advanced"})})]}),e.jsx(Pe,{style:{margin:"0px 0px 8px 8px"}}),e.jsx(ue,{margin:1,children:e.jsx(ve,{direction:"column",style:{minWidth:250},children:j.filter(x=>(!x.beta||d)&&(!x.userBased||p)).filter(x=>!(w==="belt"&&h!=="search"&&x.label==="Belt")).map((x,k)=>{var Y;const C=n(),T=C.findIndex(W=>W.fieldName===x.fieldName&&Array.isArray(W.values)&&W.values.length>0),R=T>=0?C[T]:null,I=R?{...R,groupIndex:T}:{fieldName:x.fieldName,groupIndex:-1,matchType:"Is",operator:"OR",values:[""]},X=R&&((Y=R.values)==null?void 0:Y[0])||"",le=R&&R.matchType||"Is",ne=R&&R.operator||"OR",oe=R?T:0;return e.jsx(Ke,{...x,active:x.active,label:x.label,group:I,groupIndex:oe,matchType:le,operator:ne,valueIndex:0,currentValue:X,onFilter:W=>O(x.fieldName,W),onRemove:()=>{},handleAddValue:()=>{},size:"small",context:"drawer"},k)})})}),e.jsxs("div",{style:{padding:8},children:[e.jsx(Ae,{forceText:!0}),e.jsx(N,{variant:"outlined",color:"inherit",onClick:M,children:"Close"})]})]})]})}function ht({sortValues:u,extraFilters:c=[],compactMode:p,resetAll:d=!1,expandAll:r=!1,style:a,advancedEnabled:i=!1}){const{filters:s,filterCount:o,setFilters:n,isFiltered:y,setShowAdvancedSearch:h}=t.useContext(z),{tab:l,sort:b,search:j}=s,f=b||o>0||y&&d,w=t.useCallback(()=>{n(d?{tab:l}:{tab:l,search:j}),h&&h(!1)},[d,j,n,h,l]),{width:m}=q(),v=m<=500,A=v?3:0,O=v?2:0,B=v?40:60;return e.jsxs(ue,{style:{display:"flex",paddingTop:A,marginBottom:O,marginLeft:0,justifyContent:"center",...a},sx:{".MuiBadge-anchorOriginTopRightRectangular":{marginTop:"5px"},".MuiButton-root":{minWidth:B}},children:[e.jsx(Xe,{sortValues:u,compactMode:p,expandAll:r}),i?e.jsx(Ze,{extraFilters:c}):e.jsx(Ye,{extraFilters:c}),f&&e.jsx(N,{color:"inherit",style:{color:"#bbb"},onClick:w,children:v?e.jsx(we,{}):"RESET"})]})}export{Ke as A,Je as E,Pe as F,Qe as R,ht as V};
