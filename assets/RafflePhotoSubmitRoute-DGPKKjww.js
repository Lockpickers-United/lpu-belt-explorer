import{u as B,r as t,j as e,R as O,aj as re,D as E,d as ce,B as z,T as de,A as me,e as pe,N as he}from"./index-CnIorFME.js";import{u as ue}from"./usePageTitle-CrA1gDpy.js";import{A as xe,I as ge,S as fe}from"./Search-CPzCUwtC.js";import{T as I}from"./TextField-Cm7VMp-z.js";import{D as je}from"./Dropzone-DAwCcURw.js";import{L as be}from"./LoadingDisplay-BXdu0Vsq.js";import{R as ke}from"./RaffleContext-DIHROqAP.js";import{p as ye,c as ve}from"./postData-CIf1PnrD.js";import{n as Ce}from"./dataUrls-CThgH6Wi.js";import{C as Se}from"./Checkbox-BPaG9hFm.js";import{C as Ne}from"./Collapse-BxaTYoof.js";import{I as Le,a as Fe}from"./ImageListItem-_R65hW_6.js";import{D as A}from"./Dialog-BxUCRdmE.js";import"./useFormControl-DuK8y-gc.js";import"./Select-D-o1ucVJ.js";import"./index-DSnQcLth.js";import"./Cancel-CDeLWcFz.js";import"./LoadingDisplaySmall-CR-7BLyn.js";import"./Box-BncJYkZr.js";import"./CircularProgress-Ct_N3BXv.js";import"./useData-Bj1EpJf9.js";import"./index-CRJ9kQJp.js";import"./setDeep-J6HEwWhX.js";import"./index-xsH4HHeE.js";import"./SwitchBase-BoSkBpbc.js";function Ie({handleChangeLock:n,allEntries:d=[],disabled:u,reset:g=!1}){const l={maxWidth:700},{isMobile:x}=B(),k=t.useRef(),C=t.useMemo(()=>{let s={};return{allLocks:[...d].sort((c,h)=>{c.title.localeCompare(h.title)}).reduce((c,h)=>{const j=`${h.contributedBy.join(", ")} - ${h.title}`;return c.push({id:h.id,lockName:j}),s[j]=j,c},[]).filter(c=>c),lockNames:s}},[d]),{allLocks:m,lockNames:f}=C,R=m.sort((s,a)=>s.lockName.localeCompare(a.lockName)).map(s=>({label:s.lockName,id:s.id})),S=t.useCallback((s,a)=>{n(a?{lockFullName:a.label,lockName:f[a.label],lockId:a.id}:{})},[f,n]),[N,y]=t.useState(!1),p=t.useCallback(()=>y(!1),[]);return e.jsxs(O.Fragment,{children:[e.jsx(xe,{disabled:u,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:l,options:R,onChange:S,renderInput:s=>e.jsx(I,{...s,placeholder:"Search Locks",variant:"standard",color:"info",inputRef:k,InputProps:{...s.InputProps,startAdornment:e.jsx(ge,{position:"start",children:e.jsx(fe,{})})}}),isOptionEqualToValue:(s,a)=>s.label===a.label,getOptionLabel:s=>s.label,renderOption:(s,a)=>{const{key:c,...h}=s;return e.jsx("div",{...h,style:{...s.style,height:34,padding:0,overflow:"elipsis",whiteSpace:"nowrap",color:a.belt==="Unranked"?"#aaa":"#fff",fontSize:"0.95rem",marginLeft:10},children:a.label},c)}},g||u),e.jsx(re,{invisible:!0,open:N&&x,onClick:p})]})}function Re({profile:n,user:d}){const{allPots:u=[]}=t.useContext(ke),{updateProfileField:g}=t.useContext(E),[l,x]=t.useState({}),[k,C]=t.useState(void 0),[m,f]=t.useState([]),[R,S]=t.useState(void 0),[N,y]=t.useState(!1),[p,s]=t.useState(void 0),[a,c]=t.useState(!1),[h,j]=t.useState(""),[D,$]=t.useState(""),[v,M]=t.useState((n==null?void 0:n.photoCredit)||(n==null?void 0:n.displayName)||""),[P,_]=t.useState(!1),L=t.useMemo(()=>[...u],[u]),Y=ce().format("YYYYMMDD-HHMMss"),b=L.find(o=>o.id===(l==null?void 0:l.lockId)),H=!!(l!=null&&l.lockFullName)&&!!(l!=null&&l.lockId)&&!!v&&m.length>0,W=`${l.lockName}_${l.lockId}_`.replace("/","+"),T=`${v}`.replace("/","+"),K=m.map(o=>o.name),q=t.useCallback((o,i)=>{f(o)},[]),G=m.length===1?"File":"Files",V=async o=>{o.preventDefault(),y(!0);const i=`${Y}_${W}_${T}`,r=new FormData;m.forEach(F=>{const{base:w,ext:ie}=Pe(F.name);r.append("files",F,`${i}/${W}_${w}_${T}.${ie}`)}),r.append("droppedFileNames",K),r.append("lockFullName",l.lockFullName),r.append("lockName",l.lockName),r.append("version",b==null?void 0:b.version),r.append("belt",b==null?void 0:b.belt),r.append("lockId",l.lockId),r.append("photoCredit",v),r.append("displayName",n==null?void 0:n.displayName),r.append("uploadsDir",i),r.append("notes",D);const ne=`${Ce}/upload`,ae=!0,le=3e4;try{S(await ye({user:d,url:ne,formData:r,snackBars:ae,timeoutDuration:le})),Q(v)}catch(F){s(ve(F)),x([]),m.forEach(w=>URL.revokeObjectURL(w.preview)),f([])}finally{y(!1)}},J=t.useCallback(o=>{x(o),C(L.find(i=>i.id===o.lockId))},[L]),Q=t.useCallback(o=>{g("photoCredit",o)},[g]),X=t.useCallback(o=>{const{value:i}=o.target;M(i)},[]),Z=t.useCallback(o=>{const{value:i}=o.target;$(i)},[]),U=t.useCallback(()=>{x({}),C(void 0),m.forEach(o=>URL.revokeObjectURL(o.preview)),f([]),S(void 0),y(!1),s(void 0),c(!1),j(""),$(""),_(!P)},[m,P]),ee=t.useCallback(()=>{c(!a),x([])},[a]),te=t.useCallback(o=>{const{value:i}=o.target;j(i),x({lockFullName:i,lockName:i,lockId:"NOTINLIST"})},[]),oe=a?.5:1,{flexStyle:se}=B();return e.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[e.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:V,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,margin:"30px 0px 10px"},children:"Select Pot"}),e.jsx("div",{style:{opacity:oe},children:e.jsx(Ie,{handleChangeLock:J,allEntries:L,disabled:a,reset:P})}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(Se,{onChange:ee,color:"info",size:"small",id:"notInList",checked:a})," Submit photos for a pot not on the site."]}),e.jsxs(Ne,{in:a,style:{marginTop:10},children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),e.jsx("br",{}),e.jsx(I,{type:"text",id:"altLockName",name:"altLockName",value:h,style:{width:400},onChange:te,color:"info"})]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:se},children:[e.jsxs("div",{style:{marginRight:50,width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",e.jsx("br",{})]}),e.jsx(je,{files:m||[],otherFiles:[],handleDroppedFiles:q,maxFiles:5,backgroundColor:"#333"}),k&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",e.jsx("br",{})]}),k.media?e.jsx("div",{children:e.jsx(Le,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:k.media.map((o,i)=>e.jsx(Fe,{children:e.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},i))})}):e.jsx("span",{children:"no images"})]})]}),e.jsxs("div",{style:{width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",e.jsx("br",{})]}),l.lockFullName&&e.jsxs("span",{children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Pot Name"}),e.jsx("br",{}),e.jsx("div",{style:{display:"flex"},children:e.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:l.lockFullName})}),e.jsx("br",{})]}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),e.jsx("br",{}),e.jsx(I,{type:"text",name:"photoCredit",value:v,style:{width:350},onChange:X,color:"info"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),e.jsx("br",{}),e.jsx(I,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:D,onChange:Z}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(z,{type:"submit",variant:"contained",color:"info",disabled:!H||N,children:"Upload"})]})]}),e.jsx("br",{}),e.jsx("br",{})]})}),e.jsx(A,{open:N,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:e.jsx(be,{})})}),e.jsx(A,{open:!!R&&!p,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:10,textAlign:"center"},children:[G," Uploaded Successfully!"]}),e.jsx("div",{style:{fontSize:"1.1rem",fontWeight:400,marginBottom:60,textAlign:"center"},children:"Images will be added to the site shortly"}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:U,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(A,{open:!!p,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",e.jsx("br",{}),"Please try again later.",e.jsx("br",{})]}),e.jsxs("div",{style:{fontSize:"0.95rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:[p==null?void 0:p.message,e.jsx("br",{}),"(Error code ",p==null?void 0:p.status,")"]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:U,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(de,{feature:"uploadPhotos"})]})}function Pe(n){const d=n.lastIndexOf(".");return d===-1?{base:n,ext:""}:{base:n.substring(0,d),ext:n.substring(d)}}function ot(){const{isMobile:n}=B(),{lockCollection:d}=t.useContext(E),{user:u}=t.useContext(me);ue("RAFL Pot Photos");const g=e.jsx(O.Fragment,{children:!n&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsxs(pe,{children:[e.jsx(he,{title:"RAFL Pot Photos",extras:g}),e.jsx(Re,{profile:d,user:u})]})}export{ot as default};
