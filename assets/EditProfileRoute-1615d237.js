import{r as i,D as R,am as z,u as G,A as T,G as l,j as e,R as p,B as r,W as Y,N as M,F as Q,T as q}from"./index-55b1d90f.js";import{u as K}from"./useDocumentTitle-9d5712c3.js";import{l as Z}from"./LPU-c3fa7122.js";import{C as H}from"./CopyProfileLinkButton-ffb98ac0.js";import{L as J}from"./LoadingDisplay-5c6678e5.js";import{u as X}from"./useWindowSize-ddd79567.js";import{T as y}from"./TextField-e413904e.js";import{P as ee}from"./MustBeLoggedIn-7ddfe774.js";import{L as te}from"./LinearProgress-ae469504.js";import"./Link-c2ff03f2.js";import"./Box-4773417c.js";import"./Select-0268719f.js";function ae(){const{lockCollection:t,updateProfileDisplayName:s,deleteAllUserData:d,oauthState:u,removeServiceAuth:f}=i.useContext(R),{beta:_}=i.useContext(z),[n,D]=i.useState(t.displayName||""),[j,h]=i.useState(null),[w,v]=i.useState(!1),E=G(),{user:o}=i.useContext(T),{isMobile:b}=X(),L=i.useCallback(a=>{const{value:m}=a.target;D(m)},[]),S=i.useCallback(a=>a.target.select(),[]),A=i.useCallback(async()=>{try{await s(n),l("Profile updated")}catch(a){console.error("Error while updating profile",a),l("Error while updating profile")}},[s,n]),N=i.useCallback(async()=>{try{await s(null),D(""),l("Display Name cleared")}catch(a){console.error("Error while updating profile",a),l("Error while updating profile")}},[s]),P=i.useCallback(()=>{E(`/profile/${o.uid}`)},[E,o.uid]),B=i.useCallback(a=>{a.preventDefault(),a.stopPropagation(),h(a.currentTarget)},[]),C=i.useCallback(async a=>{await f(a),l(`${a} account removed.`)},[f]),U=i.useCallback(()=>{const{VITE_DISCORD_CLIENT_ID:a}={VITE_LOCAL_DATA:"false",VITE_DISCORD_CLIENT_ID:"1271550138929774725",VITE_DISCORD_CLIENT_SECRET:"CoecO8cx2SyhMq2k3WdWNp-lavxYkeS-",VITE_REDDIT_CLIENT_ID:"i_lvEF-IFPalom2BR_lVjg",VITE_REDDIT_CLIENT_SECRET:"09PAhQfve1tysFh3jQAtmFaG5pWG0A",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},m=encodeURIComponent("identify"),g=encodeURIComponent(`${location.origin}/#/auth/discord`),x=`https://discord.com/oauth2/authorize?client_id=${a}&response_type=code&redirect_uri=${g}&scope=${m}`;window.location.assign(x)},[]),O=i.useCallback(async()=>{const{VITE_REDDIT_CLIENT_ID:a}={VITE_LOCAL_DATA:"false",VITE_DISCORD_CLIENT_ID:"1271550138929774725",VITE_DISCORD_CLIENT_SECRET:"CoecO8cx2SyhMq2k3WdWNp-lavxYkeS-",VITE_REDDIT_CLIENT_ID:"i_lvEF-IFPalom2BR_lVjg",VITE_REDDIT_CLIENT_SECRET:"09PAhQfve1tysFh3jQAtmFaG5pWG0A",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},m=await u(o.uid),g=encodeURIComponent("identity flair privatemessages"),x=encodeURIComponent(`${location.origin}/#/auth/reddit`),$=`https://www.reddit.com/api/v1/authorize?client_id=${a}&response_type=code&state=${m}&redirect_uri=${x}&duration=temporary&scope=${g}`;window.location.assign($)},[u,o]),F=i.useCallback(async()=>{v(!0),await d(o.uid),h(null),v(!1),l("All data has been deleted")},[d,o]),c=n.length>0&&!ie.test(n.toString()),V=n.length===0||n===(t==null?void 0:t.displayName),k=c?"Display name must only include A-Z, 0-9, _ and -.":"",W=n.length>0?` (${n}) `:"",I=b?"block":"flex";return e.jsx("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:w?e.jsx(J,{}):e.jsxs(p.Fragment,{children:[e.jsxs("div",{style:{display:I,padding:16},children:[t!=null&&t.displayName?e.jsxs("div",{style:{marginBottom:10,marginRight:20,maxWidth:325},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:500},children:["Display Name",e.jsx("br",{})]}),"Your display name ",W," shows up on the leaderboard and your profile can be shared with others.",e.jsx("br",{}),e.jsx("br",{}),"Your Google login information will never be displayed to other users."]}):e.jsxs("div",{style:{marginBottom:10,marginRight:20,maxWidth:325},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:500},children:["Display Name",e.jsx("br",{})]}),"Your display name will show up on the leaderboard and your profile can be shared with others.",e.jsx("br",{}),e.jsx("br",{}),"Your Google login information will never be displayed to other users."]}),e.jsxs("div",{style:{width:"100%",marginTop:40},children:[e.jsx(y,{error:c,variant:"outlined",color:"secondary",label:"Display Name",helperText:k,value:n||"",onChange:L,onFocus:S,inputProps:{maxLength:32},size:"small",style:{width:220}}),e.jsx(r,{variant:"outlined",color:c?void 0:"success",onClick:A,disabled:c||V,style:{marginLeft:16,marginRight:0,marginBottom:10,height:40},children:"Save"}),e.jsxs("div",{style:{width:"100%",textAlign:"left",margin:"10px 0px 28px 0px"},children:[(t==null?void 0:t.displayName)&&e.jsx(r,{variant:"outlined",color:"info",onClick:N,disabled:c,style:{marginBottom:10,color:"#4972ab",padding:"5px 10px"},children:"Clear Display Name"}),e.jsx(r,{variant:"outlined",color:"info",onClick:P,style:{marginLeft:15,marginBottom:10,padding:"5px 10px"},children:"View Profile"})]})]})]}),_&&e.jsxs("div",{style:{display:I,padding:16},children:[e.jsxs("div",{style:{marginBottom:10,marginRight:20,maxWidth:325},children:[e.jsxs("span",{style:{fontSize:"1.2rem",fontWeight:500},children:["Linked Accounts",e.jsx("br",{})]}),"Linked accounts are used to import your approved Belt and Dan Rankings. Rankings from Discord will update automatically as long as your account is linked. You will need to re-authorize with Reddit to update new approved belts."]}),e.jsxs("div",{style:{width:"100%",marginTop:40},children:[t!=null&&t.discordUsername?e.jsxs("div",{style:{width:"100%",marginBottom:10},children:[e.jsx(y,{variant:"outlined",label:"Discord Username",value:(t==null?void 0:t.discordUsername)||"",inputProps:{maxLength:32,readOnly:!0},size:"small",style:{width:200},color:"warning"}),e.jsx(r,{variant:"outlined",color:"warning",onClick:()=>C("Discord"),disabled:!(t!=null&&t.discordUsername),style:{marginLeft:16,marginRight:0,marginBottom:10,height:40},children:"Remove"})]}):e.jsx(r,{variant:"outlined",color:"warning",style:{marginBottom:16,height:40},onClick:U,children:"LINK DISCORD ACCOUNT"}),t!=null&&t.redditUsername?e.jsxs("div",{style:{width:"100%",padding:"8px 0px"},children:[e.jsx(y,{variant:"outlined",label:"Reddit Username",value:(t==null?void 0:t.redditUsername)||"",inputProps:{maxLength:32,readOnly:!0},size:"small",style:{width:200},color:"warning",readOnly:!0}),e.jsx(r,{variant:"outlined",color:"warning",onClick:()=>C("Reddit"),disabled:!(t!=null&&t.redditUsername),style:{marginLeft:16,marginRight:0,marginBottom:10,height:40},children:"Remove"})]}):e.jsx(r,{variant:"outlined",color:"warning",style:{marginBottom:16,height:40},onClick:O,children:"LINK REDDIT ACCOUNT"})]})]}),e.jsxs("div",{style:{width:"100%",textAlign:"center",margin:"10px 0px 10px 0px"},children:[e.jsx(r,{variant:"outlined",color:"error",onClick:B,style:{marginBottom:10,color:"#d31f1f",padding:"5px 110px"},children:"Delete All Data"}),e.jsxs(Y,{anchorEl:j,open:!!j,onClose:()=>h(null),children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["This will permanently delete all of your data.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(r,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:F,edge:"start",color:"error",children:"Delete"})})]})]}),e.jsx("div",{style:{height:20}})]})})}const ie=/^[\sa-zA-Z0-9_-]{1,32}$/;function xe(){const{authLoaded:t,isLoggedIn:s}=i.useContext(T),{dbLoaded:d}=i.useContext(R);K("LPU Belt Explorer - Edit Profile");const u=e.jsx(p.Fragment,{children:e.jsx(H,{page:"collection"})});return e.jsxs(p.Fragment,{children:[e.jsx(M,{title:"Edit Profile",extras:u}),(!t||!d)&&e.jsxs(p.Fragment,{children:[e.jsx(te,{variant:"indeterminate",color:"secondary"}),e.jsx("img",{alt:"Loading",src:Z,style:{marginLeft:"auto",marginRight:"auto",display:"block"}})]}),t&&!s&&e.jsx(ee,{}),t&&s&&d&&e.jsx(ae,{}),e.jsx(Q,{}),e.jsx(q,{feature:"editprofile"})]})}export{xe as default};
