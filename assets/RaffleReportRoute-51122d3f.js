import{d as D,u as v,j as t,R as L,b as z,r as w,A as B,D as H,N as I,F as O,T as Y}from"./index-a08903d0.js";import{L as E}from"./LoadingDisplay-684fd2db.js";import{u as G}from"./useData-85375b18.js";import{u as $}from"./usePageTitle-92f643a7.js";import{s as X}from"./dataUrls-02b67476.js";import"./LockViewsLine-cc99ddc7.js";import{P as N}from"./nivo-line.es-6b224315.js";import{p as _}from"./adminChartDefaults-e02caa29.js";import{A as q}from"./AdminStatsTable-6c331835.js";import{a as J}from"./RaffleContext-d7505131.js";import{A as K}from"./AdminStatsTableSort-ba5d7939.js";import{R as Q}from"./RaffleAutocompleteBox-c3904ec7.js";import{L as U}from"./Link-0e1fd53a.js";import{R as Z,A as tt}from"./AdminRoleButton-b249ea5e.js";import"./LPU-c3fa7122.js";import"./LinearProgress-631a5179.js";import"./useDocumentTitle-9c7ce376.js";import"./chartDefaults-9fc07b21.js";import"./nivo-legends.es-fcd34861.js";import"./index-cc9fccbd.js";import"./TableRow-b08bc83d.js";import"./Search-3b802198.js";import"./Autocomplete-390e7671.js";import"./Select-18bc60b9.js";import"./Chip-6bde20da.js";import"./TextField-94ada92d.js";const et=({lineData:l})=>{const i=[l.rafl28days.data],o=[],e=new Map,c=new Map,m=new Map;i.forEach(s=>{const u=[],d=[],k=[];for(let r=0;r<s.length;r++){const S=s[r].date;if(D(S)<D("2024-11-25"))continue;const P=new Map;P.x=S,P.y=s[r].potListViews,u.push(P);const T=new Map;T.x=S,T.y=s[r].potViews,d.push(T);const A=new Map;A.x=S,A.y=s[r].raflForm,k.push(A)}e.id="Pot List",e.data=u,c.id="Pot Views",c.data=d,m.id="Entry Form",m.data=k,o.push(c),o.push(e),o.push(m)});const{width:a}=v(),j=a<=360,p=a<=395,b=a<=428,x=a<=560,g=a<=820,f=j||p?200:b?210:g?230:350,y=x?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50};return t.jsx("div",{style:{height:f,width:"100%"},children:t.jsx(N,{theme:_,data:o,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:y,height:f,curve:"natural",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.2f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:"every day"},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function at({data:l}){const{width:i}=v(),o=i<=560,m={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...o?{}:{display:"flex"}};return t.jsx(L.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:m,children:t.jsx(et,{lineData:l})})})})}const ot=({data:l})=>{const{rafl28days:i}=l,o=i.data.filter(s=>D(s.date)>D("2024-11-27")),e=o.reduce((s,u)=>(Object.keys(i.data[i.data.length-1]).map(d=>{["date","dateString"].includes(d)||(s[d]=s[d]?s[d]+u[d]:u[d])}),s),{});e.dateString="Total",o.push(e);const c=Object.keys(e).reduce((s,u)=>(s[u]=Math.floor(e[u]/o.length),s),{});c.dateString="Average",o.push(c);const m={columns:i.columns,data:o},{width:a}=v(),j=a<=360,p=a<=395,b=a<=428,x=a<=560,g=a<=820,f=j?".8rem":p?".85rem":b?".9rem":".95rem",y="100%";return t.jsx(q,{tableData:m,tableWidth:y,fontSize:f})},st=({data:l})=>{const i=z(),{potViewsById:o}=l,{potStats:e}=w.useContext(J),c=[{name:"Pot ID",align:"left",id:"id"},{id:"title",align:"left",name:"Pot Title"},{id:"views",align:"center",name:"Pot Views"},{id:"percentViews",name:"% Views",align:"center"},{id:"donors",name:"Donors",align:"center"},{id:"tickets",name:"Tickets",align:"center"}],m=!0,[a,j]=w.useState("id"),[p,b]=w.useState(!0),[x,g]=w.useState({}),f=o.data.map(n=>{const h=e.find(R=>R.id===n.id);return{...n,...h,percentViews:Math.floor(n.percentViews*100)+"%"}}).sort((n,h)=>{switch(a){case"id":return n[a].localeCompare(h[a]);case"title":return n[a].localeCompare(h[a]);default:return h[a]-n[a]||n.id.localeCompare(h.id)}}),y=p?f:f.reverse(),s=Object.keys(x).length>0?[y==null?void 0:y.find(n=>n.title===x.itemTitle)]:y||[],u={columns:c,data:s},d=w.useCallback((n,h)=>{const R=f.find(V=>V.title===h),W=R==null?void 0:R.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return n==="title"?t.jsx(U,{onClick:()=>i(`/rafl/?id=${R.id}&name=${W}`),style:{color:"#fff"},children:h}):h},[i,f]),k=w.useCallback(n=>n.title,[]),{width:r}=v(),S=r<=360,P=r<=395,T=r<=428,A=r<=560,C=r<=820,F=S?".8rem":P?".85rem":T?".9rem":".95rem",M="100%";return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(Q,{allItems:f,setItemDetails:g,getOptionTitle:k,searchText:"Search Pots"})})}),t.jsx(K,{tableData:u,tableWidth:M,fontSize:F,sortable:m,sort:a,setSort:j,ascending:p,setAscending:b,linkFunction:d})]})};function it(){var g;$("RAFL Report");const{data:l,loading:i,error:o}=G({urls:nt}),{siteFullNew:e}=l||{},{width:c}=v(),a=c<560?"8px 8px 32px 8px":"24px 24px 32px 24px",j={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff"},p={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff"},b=(g=e==null?void 0:e.firstVistsLastSevenDays)!=null&&g.countryCount?p:j,x=i?"--":"(updated: "+D(e==null?void 0:e.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+` ${e==null?void 0:e.metadata.timezone})`;return i?t.jsx(E,{}):o?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:a,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[t.jsxs("div",{style:b,children:["RAFL Summary",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:x})]}),t.jsx(at,{data:e}),t.jsx("div",{style:p,children:"Page Tracking"}),t.jsx(ot,{data:e}),t.jsx("div",{style:p,children:"Pot Details"}),t.jsx(st,{data:e}),t.jsx(L.Fragment,{children:!1})]})}const nt={siteFullNew:X};function Mt(){const{authLoaded:l}=w.useContext(B),{adminRole:i}=w.useContext(H),{isMobile:o}=v(),e=t.jsxs(L.Fragment,{children:[!o&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(Z,{active:!0}),t.jsx(tt,{})]});return t.jsxs(L.Fragment,{children:[t.jsx(I,{title:"RAFL Report",extras:e}),l&&i&&t.jsx(it,{}),t.jsx(O,{}),t.jsx(Y,{feature:"raflReport"})]})}export{Mt as default};
