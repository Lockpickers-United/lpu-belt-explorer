import{r,F as O,aA as P,aq as H,d as i,K as v,ap as R,j as w}from"./index-C8JhLQMS.js";import{D as L,f as G}from"./DataContext-DtyHY-ya.js";import{r as N}from"./index-DTPTfajd.js";import{c as K}from"./collectionStatsById-DY1NVZ7h.js";import{u as V}from"./useData-D3hwABwS.js";import{h as W}from"./dataUrls-DkJe4Pqg.js";import{f as q}from"./filterEntriesAdvanced-B_LinbMH.js";function te({children:F,allEntries:u,profile:l}){const{filters:j,advancedFilterGroups:h}=r.useContext(O),{search:m,tab:d,sort:c,expandAll:M}=j,{data:k,loading:A,error:C}=V({urls:J}),p=r.useMemo(()=>k&&!A&&!C?k.lockbazzarEntryIds:[],[k,C,A]),[b,g]=r.useState(.3),n=r.useMemo(()=>{const s=(l==null?void 0:l.userLockNotes)||{};return u.map(e=>{var t,a,D;return{...e,makes:e.makeModels[0].make?e.makeModels.map(({make:o})=>o):e.makeModels[0].model,fuzzy:N(e.makeModels.map(({make:o,model:I})=>[o,I]).flat().filter(o=>o).concat([e.version,e.notes,e.belt]).join(",")),content:[(t=e.media)!=null&&t.some(o=>!o.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(a=e.media)!=null&&a.some(o=>o.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((D=e.links)==null?void 0:D.length)>0?"Has Links":"No Links",H[e.belt].danPoints>0?"Worth Dan Points":void 0,i(e.lastUpdated).isAfter(i().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,s[e.id]?"Has Personal Notes":void 0].flat().filter(o=>o),collection:P.locks.map.map(o=>l&&l[o.key]&&l[o.key].includes(e.id)?o.label:"Not "+o.label),collectionSaves:K[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:s[e.id]}})},[u,l]),f=r.useCallback(s=>{const e=m&&s.find(t=>t.id===m);return e?[e]:m?G.go(N(m),s,{keys:T,threshold:-23e3}).map(t=>({...t.obj,score:t.score})).filter(t=>t.score>b):s},[m,b]),x=r.useMemo(()=>d==="search"||!d?f(n):f(n).filter(s=>s.simpleBelt===d),[n,f,d]),z=r.useMemo(()=>{const s=q({advancedFilterGroups:h(),entries:n}),e=f([...s]);return c?e.sort((t,a)=>{if(c==="popularity")return a.collectionSaves-t.collectionSaves||a.views-t.views||t.fuzzy.localeCompare(a.fuzzy);if(c==="beltAscending")return v(t.belt,a.belt);if(c==="beltDescending")return R(t.belt,a.belt);if(c==="alphaAscending")return t.fuzzy.localeCompare(a.fuzzy);if(c==="alphaDescending")return a.fuzzy.localeCompare(t.fuzzy);if(c==="recentlyUpdated")return Math.floor(i(a.lastUpdated).valueOf()/3600)-Math.floor(i(t.lastUpdated).valueOf()/3600)||v(t.belt,a.belt)||t.fuzzy.localeCompare(a.fuzzy);if(c==="dateAdded")return Math.floor(i(a.dateAdded).valueOf()/3600*24)-Math.floor(i(t.dateAdded).valueOf()/3600*24)||v(t.belt,a.belt)||t.fuzzy.localeCompare(a.fuzzy)}):e},[h,n,f,c]),B=r.useCallback(s=>u.find(e=>e.id===s),[u]),S=r.useMemo(()=>d==="search"||!d?z:z.filter(s=>s.simpleBelt===d),[d,z]),U=r.useCallback(s=>p==null?void 0:p.includes(s),[p]),y=r.useMemo(()=>(l==null?void 0:l.blackBeltAwardedAt)>0,[l]),E=r.useMemo(()=>({allEntries:u,mappedEntries:n,searchedBeltEntries:x,visibleEntries:z,visibleBeltEntries:S,getEntryFromId:B,expandAll:M,profile:l,blackBeltUser:y,lockbazzarAvailable:U,searchCutoff:b,setSearchCutoff:g}),[u,n,x,z,S,B,M,l,y,U,b,g]);return w.jsx(L.Provider,{value:E,children:F})}const T=["fuzzy"],J={lockbazzarEntryIds:W};export{te as D};
