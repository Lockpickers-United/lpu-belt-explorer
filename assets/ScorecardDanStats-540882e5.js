import{p as _,r,j as e,T as ne,I as F,R as k,ak as se,a6 as oe,a1 as ie,w as L,ax as ae,a4 as le,A as re,C as ce,ay as de,a9 as xe,ac as pe,U as me,v as he}from"./index-8cbae00a.js";import{F as O,d as ue}from"./FieldValue-0cb8e28a.js";import{B as ge}from"./BeltStripe-797c2f17.js";import{S as fe,E as ye,d as je}from"./CollectionButton-967c65fb.js";import{e as B,F as q,D as z}from"./index-85fe30bf.js";import{d as ke}from"./Link-a71e0ace.js";import{u as H}from"./useWindowSize-d65923fa.js";import{A as be,a as Ce,b as Se}from"./AccordionSummary-c5d4f5af.js";import{L as b}from"./Link-56238afe.js";import{p as ve}from"./chartDefaults-9fc07b21.js";import{B as De}from"./nivo-bar.es-e90c7376.js";function Le({entry:o,color:t}){const i=_(),n=B(o).replace(/[\s/]/g,"_").replace(/\W/g,""),x=t||"#fff",h=r.useCallback(a=>{a.preventDefault(),a.stopPropagation(),i(`/locks?id=${o.id}&name=${n}`)},[o.id,i,n]);return e.jsx(ne,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(F,{onClick:h,children:e.jsx(ke,{style:{width:18,height:18,color:x}})})})}function Be({owner:o,evid:t,expanded:i,onExpand:c,merged:n}){const{setFilters:x}=r.useContext(q),{cardEvidence:h,getEntryFromId:a,getProjectEntryFromId:p}=r.useContext(z),{admin:g}=r.useContext(se),u=a(t.matchId),f=p(t.matchId),l=u||f,[C,s]=r.useState(!1),d=r.useRef(null);r.useEffect(()=>{if(i&&d&&!C){const N=window.innerWidth<=600?70:74,{id:te}=oe.parse(location.search),A=te===t.id;s(!0),setTimeout(()=>{window.scrollTo({left:0,top:d.current.offsetTop-N,behavior:A?"auto":"smooth"})},A?0:100)}else i||s(!1)},[i,l,C,t.id]);let m=l?B(l):t.evidenceNotes;const y=t.exceptionType&&t.evidenceNotes.toLowerCase()!==m.toLowerCase()?t.evidenceNotes:null;m=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:m,m=t.exceptionType&&o&&n?m+" *":m;const I=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,j=t.exceptionId,S=j?h.find(D=>D.id===j):{},T=S?r.useMemo(()=>a(S.matchId),[a,S.matchId]):{},$=T?B(T,"short"):"",U=j?e.jsx(b,{style:{color:"#99c2e5"},onClick:()=>{P(j)},children:$}):null;let w=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"Must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const P=r.useCallback(D=>{x({id:D})},[x]),V=t.points===1?"pt":"pts";let v=t.date?ie(t.date).format("L"):"(no date)";v=v.replace("/202","/2"),v=v.replace("/201","/1");const G=t.date?"#fff":"#aaa",W=r.useCallback((D,N)=>{(o||g)&&c(N?t.id:!1)},[g,t.id,c,o]),K=o?{}:{cursor:"default"},Y=o||g?e.jsx(ue,{}):null,{isMobile:E}=H(),J=E?"block":"flex",Q=E?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},X=E?"65%":"56%",Z=E?"-2px 0px 3px 0px":"1px 0px 3px 0px",ee={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(be,{expanded:i,onChange:W,ref:d,children:[e.jsxs(Ce,{expandIcon:Y,style:{...ee,...K},children:[e.jsx(ge,{value:l?l.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:X,flexShrink:0,flexDirection:"column",opacity:I},children:[e.jsx(O,{value:m,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!y&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:y}),!!l&&!!(l!=null&&l.version)&&e.jsx(O,{name:"Version",value:e.jsx(L,{style:{fontSize:"0.95rem",lineHeight:1.25},children:l==null?void 0:l.version}),textStyle:(l==null?void 0:l.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:J,placeItems:"center",marginLeft:10,opacity:I},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:u&&e.jsx(Le,{entry:u})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(fe,{url:t.link,handleChange:W,exceptionType:t.exceptionType,owner:o})})]}),e.jsxs("div",{style:Q,children:[e.jsx("div",{style:{margin:Z,color:G,width:90,textAlign:"center"},children:v}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:V})]})})]})]})]}),i&&e.jsx(k.Fragment,{children:e.jsxs(Se,{sx:{padding:"4px 16px 0px 26px"},children:[(w||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),w&&e.jsxs("span",{children:["* ",w," ",U]})]}),e.jsx(ye,{evid:t,owner:o,handleUpdate:()=>{}})]})})]},t.id)}const Ue=k.memo(Be,(o,t)=>{const i=Object.keys(o.evid),c=Object.keys(t.evid);if(i.length!==c.length)return!1;for(let n=0;n<i.length;n++)if(i[n]!==c[n]||o.evid[i[n]]!==t.evid[c[n]])return!1;return o.owner===t.owner&&o.expanded===t.expanded&&o.onExpand===t.onExpand&&o.merged===t.merged});function Ie({beltData:o}){const{width:t}=H(),i=t<=560,c=i?190:175,n=i?-90:-45,x=i?{top:0,right:0,bottom:80,left:15}:{top:0,right:0,bottom:60,left:15},h=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#3e3e3e","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c","#a5a93c"],a=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#aaa","#000","#000","#000","#000","#000","#000"];return e.jsx("div",{style:{height:c,padding:"0px 0px 0px 0px",width:"100%"},children:e.jsx(De,{data:o,margin:x,padding:.15,colors:p=>h[p.index%h.length],animate:!0,axisBottom:{tickRotation:n},axisLeft:null,enableGridY:!1,theme:ve,isInteractive:!1,enableLabel:!0,label:p=>p.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:p=>a[p.index%a.length]})},"bar")}function Pe({entries:o}){const t=r.useMemo(()=>{const i=o.map(({belt:n})=>(n&&n.includes("Project"),n)).reduce((n,x)=>(n[x]||(n[x]=0),n[x]++,n),{});return i.Project=o.reduce((n,x)=>x.simpleBelt==="Project"?n+1:n,0),(i.Project>0?ae:le).map(n=>({id:n,label:n,count:i[n]||0,value:i[n]||0}))},[o]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(Ie,{beltData:t})})}var R={},Te=ce;Object.defineProperty(R,"__esModule",{value:!0});var M=R.default=void 0,Ee=Te(re()),we=e;M=R.default=(0,Ee.default)((0,we.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function Ne(){const{setFilters:o}=r.useContext(q),{cardEvidence:t,getEntryFromId:i}=r.useContext(z),[c,n]=r.useState(!1),x=r.useCallback(()=>{n(!0)},[]),h=r.useCallback(()=>{n(!1)},[]),a=r.useCallback(s=>{o({id:s}),n(!1)},[o]),p=t.map(s=>{const d=s.exceptionId,m=d?t.find(T=>T.id===d):{},y=m?i(m.matchId):{},I=y?B(y,"short"):"",j=s.matchId?i(s.matchId):null,S=j?B(j,"short"):"";return{...s,supersedingEntryId:d,supersedingLockName:I,matchLockName:S}}),g=p.filter(s=>s.exceptionType==="nomatch"),u=p.filter(s=>s.exceptionType==="badlink"),f=p.filter(s=>s.exceptionType==="duplicate"),l=p.filter(s=>s.exceptionType==="upgraded");if(g.length+u.length+f.length+l.length>0)return e.jsxs(k.Fragment,{children:[e.jsx(F,{onClick:x,style:{marginRight:0},children:e.jsx(M,{fontSize:"small"})}),e.jsx(de,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:s=>s.zIndex.drawer+1},open:c,onClick:h,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(F,{onClick:h,children:e.jsx(je,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),g.length>0&&e.jsxs(k.Fragment,{children:[e.jsx(xe,{style:{marginBottom:20}}),e.jsx(L,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:g.map((s,d)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(b,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{a(s.id)},children:s.evidenceNotes})},d))})]}),u.length>0&&e.jsxs(k.Fragment,{children:[e.jsx(L,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:u.map((s,d)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(b,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{a(s.id)},children:s.matchLockName})},d))})]}),f.length>0&&e.jsxs(k.Fragment,{children:[e.jsx(L,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:f.map((s,d)=>e.jsxs("li",{style:{marginBottom:4},children:[s.evidenceNotes," is a duplicate of ",e.jsx(b,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{a(s.supersedingEntryId)},children:s.supersedingLockName})]},d))})]}),l.length>0&&e.jsxs(k.Fragment,{children:[e.jsx(L,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:l.map((s,d)=>e.jsxs("li",{style:{marginBottom:4},children:[s.evidenceNotes," is upgraded by ",e.jsx(b,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{a(s.supersedingEntryId)},children:s.supersedingLockName})]},d))})]})]})})]})}function Ve({profile:o,owner:t}){var m;const{userId:i}=pe(),{user:c}=r.useContext(me),n=(m=o==null?void 0:o.displayName)==null?void 0:m.replace(/\s/g,"_"),{cardDanPoints:x,cardBBCount:h,cardEligibleDan:a,cardNextDanPoints:p,cardNextDanLocks:g}=r.useContext(z),u=_(),f=r.useCallback(()=>{u("/profile/scorecard/upgrades")},[u]),l={1:"st",2:"nd",3:"rd"},C=l[[a]]?a+l[[a]]:a+"th",s=r.useCallback(async()=>{const y=`@LPUBeltBot request ${C} Dan https://lpubelts.com/#/profile/${i||(c==null?void 0:c.uid)}/scorecard?name=${n}`;await navigator.clipboard.writeText(y),he("Request copied to clipboard. Take it over to #belt-requests!")},[C,n,c==null?void 0:c.uid,i]),d=(o==null?void 0:o.blackBeltAwardedAt)>0&&a===1?"DAN":"Eligible for Dan";return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:[d," ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:a})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:x})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:h})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[p," point",p!==1&&"s"," and ",g," BB lock",g!==1&&"s"," to next Dan"]}),e.jsxs("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:[a>1&&t&&e.jsxs("span",{children:[e.jsx(b,{onClick:s,style:{color:"#99c2e5",cursor:"pointer"},children:"Copy Request"})," • "]}),e.jsx(b,{onClick:f,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})]})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(Ne,{})})]})}export{Pe as I,Ve as S,Le as V,Ue as a};
