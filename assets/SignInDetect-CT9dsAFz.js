import{r as t,A,D as O,d as C,X as R,j as s,R as W,B as L,bb as D}from"./index-CBySJVFP.js";import{S as b}from"./ScopedDialog-D3LhAhXz.js";function N({newSignIn:k=!1,setNewSignIn:l=a=>{},dialog:r,required:u,linkText:S="You must be signed in to use this page.",containerRef:p=null}){const{authLoaded:a,isLoggedIn:i,user:e,initialUser:f,setInitialUser:c}=t.useContext(A),{getProfile:g}=t.useContext(O),[v,m]=t.useState(!1),[o,B]=t.useState(void 0),h=t.useCallback(async()=>{const n=e!=null&&e.uid?await g(e==null?void 0:e.uid):null;n!=null&&n.displayName&&B(n.displayName)},[g,e]);t.useEffect(()=>{h().then()},[h]);const x=t.useCallback(()=>{c("yes");const n=C(e.metadata.creationTime).isBefore(C(),"hour")?" back":"";r?m(!0):R(o?`Welcome back ${o}!`:`Welcome${n}!`,{variant:"success"})},[r,o,c,e]),y=t.useRef(!1);t.useEffect(()=>{a&&(i&&!y.current&&Object.keys(e||{}).length>0&&f==="no"&&Object.keys(e||{}).length>0&&(l(!0),x()),y.current=i)},[a,i,f,e,x,k,l]);const d=t.useCallback(n=>{n.preventDefault(),n.stopPropagation(),l(!1),c("yes"),m(!1)},[c,l]),I=s.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",padding:30,placeItems:"center",margin:"40px 0px"},onClick:d,children:[s.jsxs("div",{style:{textAlign:"center",fontSize:"1.3rem",fontWeight:700,marginBottom:25},children:["Welcome",o?" back "+o:"","!",s.jsx("br",{})]}),s.jsx(L,{variant:"outlined",style:{width:100},onClick:d,children:"Close"})]}),[w,j]=t.useState(!1);t.useEffect(()=>{j(!!(u&&a&&!i))},[a,i,u]);const E=s.jsxs("div",{style:{width:"100%",padding:"50px 10px",justifyItems:"center"},children:[s.jsx("div",{style:{textAlign:"center",fontSize:"1.2rem",marginBottom:15,width:250},children:s.jsx(D,{linkText:S})}),s.jsx("div",{style:{width:204},children:s.jsx(D,{})})]});return s.jsxs(W.Fragment,{children:[s.jsx(b,{open:r&&v,dialogContent:I,handleClose:d,containerRef:p,width:400,position:{top:80},centerX:!0}),s.jsx(b,{open:w,dialogContent:E,handleClose:void 0,containerRef:p,position:{top:80},centerX:!0,dark:!0})]})}export{N as S};
