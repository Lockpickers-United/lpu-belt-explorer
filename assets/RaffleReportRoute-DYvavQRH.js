import{d as C,u as S,j as t,R as M,r as h,b as z,L as H,A as Y,e as N,N as O,h as G,T as I}from"./index-DywgU4A8.js";import{e as q}from"./filterFields-CsSL3LSL.js";import{L as E}from"./LoadingDisplay-_LZV6r1W.js";import{u as P}from"./useData-DO1Msq2g.js";import{u as X}from"./usePageTitle-Ci7SybHg.js";import{m as $,o as U,q as _}from"./dataUrls-DVxTtpO-.js";import{y as A}from"./nivo-line-95B0BS24.js";import{p as V}from"./adminChartDefaults-CBhS7ojG.js";import{A as J}from"./AdminStatsTable-W0Wi3OYr.js";import{R as K}from"./RaffleAutocompleteBox-HMIR9fs_.js";import{R as F}from"./RaffleContext-CLGBxYdD.js";import{D as B}from"./DataTableSort-BRxgJY1W.js";import{R as Q,a as Z}from"./RaffleYOYLines-BBMSUy51.js";import{C as tt}from"./ChoiceButtonGroup-Bf1sIquA.js";import{X as et}from"./nivo-bar-C-eaKpei.js";import{p as it}from"./chartDefaults-pV7GKcxU.js";import{A as nt}from"./AdminToolButtons-CthIvXTk.js";import{R as st}from"./RaffleHeader-DXQs4FrA.js";import"./LPU-DltM2OBF.js";import"./LinearProgress-tyJBkui4.js";import"./nivo-legends-QgB64xI5.js";import"./isEqual-C6NPCN9Q.js";import"./uniq-CXwfHQsn.js";import"./utcYear-CqgfcYrB.js";import"./TableRow-CLRbxxIL.js";import"./Search-eDFBvc1Y.js";import"./useFormControl-BEj6lfXb.js";import"./Select-JNS0Tjaq.js";import"./TextField-BKWD_rqX.js";import"./index-DwotGC99.js";import"./setDeep-J6HEwWhX.js";import"./ArrowDropDown-nleQnKhL.js";import"./ToggleButtonGroup-CT-cU-hE.js";import"./_baseClone-CG_2_cux.js";import"./EmojiEvents-CcjAMle6.js";import"./Cached-DCGpmnEM.js";import"./ExpandMore-XGCwLra8.js";import"./CircularProgress-BqcvLnQp.js";import"./index-C0RmN517.js";import"./Box-n8Fc6-Eu.js";import"./AccordionSummary-BX-ytmv8.js";import"./Collapse-DiM06WNe.js";const at=({lineData:i})=>{const a=[i.rafl28days.data],e=[],o=new Map,r=new Map,c=new Map;a.forEach(x=>{const s=[],m=[],b=[];for(let g=0;g<x.length;g++){let j=x[g].date;if(C(j)<C("2024-12-25"))continue;j=j+" 23:59:59";const k=new Map;k.x=j,k.y=x[g].potListViews,s.push(k);const T=new Map;T.x=j,T.y=x[g].potViews,m.push(T);const D=new Map;D.x=j,D.y=x[g].raflForm,b.push(D)}o.id="Pot List",o.data=s,r.id="Pot Views",r.data=m,c.id="Entry Form",c.data=b,e.push(r),e.push(o),e.push(c)});const{isMobile:d,width:n}=S(),y=n<=360,l=n<=395,u=n<=428,f=n<=560,R=n<=820,w=y||l?200:u?210:R?230:350,p=f?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50},v=d?"every 2 days":"every day";return t.jsx("div",{style:{height:w,width:"100%"},children:t.jsx(A,{theme:V,data:e,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:p,height:w,curve:"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:v},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function ot({data:i}){const{width:a}=S(),e=a<=560,c={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...e?{}:{display:"flex"}};return t.jsx(M.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:c,children:t.jsx(at,{lineData:i})})})})}const rt=({data:i})=>{const{rafl28days:a}=i,e=a.data.filter(p=>C(p.date)>C("2024-12-28")),o=e.reduce((p,v)=>(Object.keys(a.data[a.data.length-1]).map(x=>{["date","dateString"].includes(x)||(p[x]=p[x]?p[x]+v[x]:v[x])}),p),{});o.dateString="Total",e.push(o);const r=Object.keys(o).reduce((p,v)=>(p[v]=Math.floor(o[v]/e.length),p),{});r.dateString="Average",e.push(r);const c={columns:a.columns,data:e},{width:d}=S(),n=d<=360,y=d<=395,l=d<=428,u=d<=560,f=d<=820,R=n?".8rem":y?".85rem":l?".9rem":".95rem";return t.jsx(J,{tableData:c,tableWidth:"100%",fontSize:R})},lt=({statsData:i})=>{const{allPots:a}=h.useContext(F),{potViewsById:e}=i,{data:o}=P({url:$}),{potWatches:r}=o||{},c=z(),d=[{name:"Pot #",align:"center",id:"potNumber"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views",descending:!0},{id:"uniqueDonorCount",name:"Donors",align:"center",descending:!0},{id:"totalTickets",name:"Tickets",align:"center",descending:!0},{id:"watchlists",name:"Watchlists",align:"center",descending:!0}],[n,y]=h.useState({}),l=a.map(s=>{var k,T;const m=a.find(D=>D.id===s.id)||{};if(!m)return null;const b=e.data.find(D=>D.id===s.id)||{};s={...s,views:b.views||0,percentViews:b.percentViews||0,uniqueDonorCount:b.uniqueDonorCount||0,totalTickets:b.totalTickets||0};let g=m!=null&&m.title?m.title.substring(0,28):`unknown (${s.id})`;g=((k=m==null?void 0:m.title)==null?void 0:k.length)<28||!(m!=null&&m.title)?g:g+"...";const j=(T=s==null?void 0:s.id)==null?void 0:T.replace("2025-","");return{...s,...m,title:g,id:j,watchlists:(r==null?void 0:r[s.id])||0,percentViews:Math.floor(s.percentViews*100)+"%"}}).filter(s=>s),f=(Object.keys(n).length>0?[l==null?void 0:l.find(s=>s.title===n.itemTitle)]:l||[]).map(s=>s.donors&&s.donors>0?{...s}:{...s,donors:0,tickets:0}),w={columns:d,rows:f,defaultSort:"potNumber",sortable:!0},p=h.useCallback((s,m)=>{const b=l.find(j=>j.title===m),g=b==null?void 0:b.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return s==="title"?t.jsx(H,{onClick:()=>c(`/rafl/?id=2025-${b.id}&name=${g}`),style:{color:"#fff"},children:m}):m},[c,l]),v=h.useCallback(s=>s!=null&&s.title?s.title:"unknown",[]);return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(K,{allItems:l,value:n.itemTitle||null,setItemDetails:y,getOptionTitle:v,searchText:"Search Pots"})})}),t.jsx(B,{tableData:w,tableWidth:"100%",linkFunction:p})]})},dt=()=>{const{allCharities:i}=h.useContext(F),{isMobile:a}=S(),e=a?24:48,o=i.map(l=>{var f;let u=l!=null&&l.name?l==null?void 0:l.name.substring(0,e):"unknown";return u=((f=l==null?void 0:l.name)==null?void 0:f.length)<e?u:u+"...",{...l,displayName:u}}),d={columns:[{id:"displayName",align:"left",name:"Charity Name"},{id:"donations2024",name:"2024",align:"left",displayField:"donations2024text",descending:!0},{id:"donations2025",name:"2025",align:"center",displayField:"donations2025text",descending:!0},{id:"donations",name:"Raised",align:"right",displayField:"donationsText",descending:!0},{id:"donors",name:"Donors",align:"center",descending:!0}],rows:o,defaultSort:"displayName",sortable:!0},n="100%",y=h.useCallback((l,u)=>u,[]);return t.jsx("div",{style:{marginTop:20,width:n},children:t.jsx(B,{tableData:d,tableWidth:n,linkFunction:y})})};function L({chartHeight:i,chartdata:a=[],showAxisBottom:e,colors:o,tickValues:r,curve:c}){const d=e?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},n=e?"bottom":"top-left",y=e?70:20,l=e?0:20,{isMobile:u}=S(),f=u?"every 2 days":"every day";return t.jsx("div",{style:{height:i,width:"100%"},children:t.jsx(A,{theme:V,data:a,enableGridX:!1,enableGridY:!1,colors:o,lineWidth:3,margin:d,height:i,curve:c??"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:r||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:e?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:f}:null,legends:e?[]:[{anchor:n,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:l,translateY:y,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const ct=({data:i})=>{var o,r;const a={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},e=120;return((r=(o=i==null?void 0:i.lineDataCurrent)==null?void 0:o.cumulativeDonations)==null?void 0:r.length)===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(M.Fragment,{children:[t.jsx("div",{style:a,children:"Donations"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations Cumulative",data:i.lineDataCurrent.cumulativeDonations||[]}],chartHeight:e,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations",data:i.lineDataCurrent.totalDonations||[]}],chartHeight:e,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:a,children:"Unique Donors"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors Cumulative",data:i.lineDataCurrent.cumulativeUniqueDonors||[]}],chartHeight:e,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors",data:i.lineDataCurrent.totalEntries||[]}],chartHeight:e,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},mt=({beltDistribution:i})=>{const{width:a}=S(),e=a<500,o=250,r=e?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},c=e?-45:0,d=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:o},children:t.jsx(et,{data:i,maxValue:"auto",margin:r,padding:.15,colors:n=>d[n.index%d.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:c},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:it,isInteractive:!1})})};function ut({data:i}){const a=h.useMemo(()=>W.map(n=>({value:i.beltDonations[n]?i.beltDonations[n]/i.totalDonations:0,id:n,label:n})),[i]),e=h.useMemo(()=>W.map(n=>({value:i.beltDonorCount[n]?i.beltDonorCount[n]/i.totalEntries:0,id:n,label:n})),[i]),o=h.useMemo(()=>[{label:"Donations",data:a},{label:"Donors",data:e}],[a,e]),[r,c]=h.useState(o[0]),d=h.useCallback(n=>c(n),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(tt,{options:o,onChange:d}),t.jsx(mt,{beltDistribution:r.data})]})}const W=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"];function ft(){X("RAFL Report");const{data:i,loading:a,error:e}=P({urls:ht}),{raflResponseDetails:o,raflSiteStats:r}=i||{},{allPots:c}=h.useContext(F),{summary:d}=h.useContext(F);console.log("summary",d);const{width:n}=S(),l=n<560?"8px 8px 32px 8px":"24px 24px 32px 24px",u={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},f={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},R=u,w=a?"--":"(updated: "+C(o==null?void 0:o.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return a?t.jsx(E,{}):e?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:l,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:R,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:w})]}),t.jsx(Q,{animate:!1}),t.jsx("div",{style:u,children:"Totals Over Time"}),t.jsx(Z,{}),t.jsx(ct,{data:d}),t.jsx("div",{style:f,children:"Site Traffic"}),t.jsx(ot,{data:r}),t.jsx("div",{style:f,children:"Belt Distribution"}),t.jsx(ut,{data:d}),t.jsx("div",{style:f,children:"Page Tracking"}),t.jsx(rt,{data:r}),t.jsx("div",{style:f,children:"Pot Details"}),t.jsx(lt,{statsData:r,allPots:c}),t.jsx("div",{style:f,children:"Charity Details"}),t.jsx(dt,{})]})}const ht={raflSiteStats:_,raflResponseDetails:U};function ne(){const{authLoaded:i}=h.useContext(Y),{isMobile:a}=S(),{raffleAdmin:e}=h.useContext(F),o=t.jsxs(M.Fragment,{children:[!a&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(nt,{})]}),r=a?8:0,c={maxWidth:800,marginLeft:"auto",marginRight:"auto",paddingLeft:r,paddingRight:r};return t.jsx(N,{filterFields:q,children:t.jsxs("div",{style:c,children:[t.jsx(O,{title:"RAFL Report",extras:o}),t.jsx(st,{page:"reports",width:700}),i&&e&&t.jsx(ft,{}),t.jsx(G,{}),t.jsx(I,{feature:"raflReport"})]})})}export{ne as default};
