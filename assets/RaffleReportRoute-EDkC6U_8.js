import{d as C,u as S,j as t,R as M,r as f,b as z,L as H,A as Y,e as N,N as O,h as q,T as G}from"./index-DJRAeEHO.js";import{c as I}from"./filterFields-DwMmBapO.js";import{L as X}from"./LoadingDisplay-we-Q2SYK.js";import{u as P}from"./useData-DOrH_lAC.js";import{u as E}from"./usePageTitle-DDfacEkI.js";import{j as U,k as $,m as _}from"./dataUrls-CThgH6Wi.js";import{y as A}from"./nivo-line-nCBzTgrJ.js";import{p as V}from"./adminChartDefaults-CBhS7ojG.js";import{A as J}from"./AdminStatsTable-CP9FZkHl.js";import{R as K}from"./RaffleAutocompleteBox-nKzGodIw.js";import{R as F}from"./RaffleContext-CcuGQo1A.js";import{D as B}from"./DataTableSort-BjwIYTij.js";import{R as Q,a as Z}from"./RaffleYOYLines-DuMtY9lC.js";import{C as tt}from"./ChoiceButtonGroup-DvqB6hiF.js";import{X as et}from"./nivo-bar-y2LWeWeC.js";import{p as it}from"./chartDefaults-pV7GKcxU.js";import{A as nt}from"./AdminToolsButton-BFhK6geE.js";import{R as at}from"./RaffleHeader-MTMZ0fkU.js";import"./LPU-DltM2OBF.js";import"./LinearProgress-Cy21v8Ei.js";import"./nivo-legends-CmsPH9zz.js";import"./nivo-axes-f6mklMG0.js";import"./uniq-C_-X59-i.js";import"./line-CjMXOKl0.js";import"./TableRow-B-MZA7aQ.js";import"./Search-CNS9kD8O.js";import"./useFormControl-C-cVDaIf.js";import"./Select-B52CPzDC.js";import"./TextField-BRc-gEQm.js";import"./index-2WCyNFux.js";import"./setDeep-J6HEwWhX.js";import"./ArrowDropDown-BiakK3Id.js";import"./ToggleButtonGroup-CP2oH-Qe.js";import"./_baseClone-nB0EfuuX.js";import"./EmojiEvents-BCRzZFp5.js";import"./Cached-B3Me9OHb.js";import"./ExpandMore-BGjNgYAN.js";import"./CircularProgress-0ZEjxGZw.js";import"./index-xsH4HHeE.js";import"./Box-BzBDJsm5.js";import"./AccordionSummary-5vfyi8OV.js";import"./Collapse-DIiIbche.js";const st=({lineData:i})=>{const o=[i.rafl28days.data],e=[],n=new Map,l=new Map,d=new Map;o.forEach(p=>{const s=[],u=[],b=[];for(let x=0;x<p.length;x++){let j=p[x].date;if(C(j)<C("2024-12-25"))continue;j=j+" 23:59:59";const R=new Map;R.x=j,R.y=p[x].potListViews,s.push(R);const k=new Map;k.x=j,k.y=p[x].potViews,u.push(k);const w=new Map;w.x=j,w.y=p[x].raflForm,b.push(w)}n.id="Pot List",n.data=s,l.id="Pot Views",l.data=u,d.id="Entry Form",d.data=b,e.push(l),e.push(n),e.push(d)});const{isMobile:c,width:a}=S(),y=a<=360,r=a<=395,m=a<=428,g=a<=560,D=a<=820,T=y||r?200:m?210:D?230:350,h=g?{top:10,right:20,bottom:50,left:50}:{top:10,right:20,bottom:70,left:50},v=c?"every 2 days":"every day";return t.jsx("div",{style:{height:T,width:"100%"},children:t.jsx(A,{theme:V,data:e,enableGridX:!1,enableGridY:!0,colors:["#5265ed","#082fd1","#4fa720"],lineWidth:3,margin:h,height:T,curve:"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:v},legends:[{anchor:"bottom",itemTextColor:"#bbb",direction:"row",justify:!1,translateX:0,translateY:70,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})};function ot({data:i}){const{width:o}=S(),e=o<=560,d={...{width:"100%",padding:"0px",marginBottom:12,alignItems:"center",marginLeft:"auto",marginRight:"auto"},...e?{}:{display:"flex"}};return t.jsx(M.Fragment,{children:t.jsx("div",{style:{textAlign:"center"},children:t.jsx("div",{style:d,children:t.jsx(st,{lineData:i})})})})}const rt=({data:i})=>{const{rafl28days:o}=i,e=o.data.filter(h=>C(h.date)>C("2024-12-28")),n=e.reduce((h,v)=>(Object.keys(o.data[o.data.length-1]).map(p=>{["date","dateString"].includes(p)||(h[p]=h[p]?h[p]+v[p]:v[p])}),h),{});n.dateString="Total",e.push(n);const l=Object.keys(n).reduce((h,v)=>(h[v]=Math.floor(n[v]/e.length),h),{});l.dateString="Average",e.push(l);const d={columns:o.columns,data:e},{width:c}=S(),a=c<=360,y=c<=395,r=c<=428,m=c<=560,g=c<=820,D=a?".8rem":y?".85rem":r?".9rem":".95rem";return t.jsx(J,{tableData:d,tableWidth:"100%",fontSize:D})},lt=({statsData:i})=>{const{allPots:o}=f.useContext(F),{potViewsById:e}=i,{data:n}=P({url:U}),{potWatches:l}=n||{},d=z(),c=[{name:"Pot #",align:"center",id:"potNumber"},{id:"title",align:"left",name:"Title"},{id:"views",align:"center",name:"Views",descending:!0},{id:"uniqueDonorCount",name:"Donors",align:"center",descending:!0},{id:"totalTickets",name:"Tickets",align:"center",descending:!0},{id:"watchlists",name:"Watchlists",align:"center",descending:!0}],[a,y]=f.useState({}),r=o.map(s=>{var R,k;const u=o.find(w=>w.id===s.id)||{};if(!u)return null;const b=e.data.find(w=>w.id===s.id)||{};s={...s,views:b.views||0,percentViews:b.percentViews||0,uniqueDonorCount:b.uniqueDonorCount||0,totalTickets:b.totalTickets||0};let x=u!=null&&u.title?u.title.substring(0,28):`unknown (${s.id})`;x=((R=u==null?void 0:u.title)==null?void 0:R.length)<28||!(u!=null&&u.title)?x:x+"...";const j=(k=s==null?void 0:s.id)==null?void 0:k.replace("2025-","");return{...s,...u,title:x,id:j,watchlists:(l==null?void 0:l[s.id])||0,percentViews:Math.floor(s.percentViews*100)+"%"}}).filter(s=>s),g=(Object.keys(a).length>0?[r==null?void 0:r.find(s=>s.title===a.itemTitle)]:r||[]).map(s=>s.donors&&s.donors>0?{...s}:{...s,donors:0,tickets:0}),T={columns:c,rows:g,defaultSort:"potNumber",sortable:!0},h=f.useCallback((s,u)=>{const b=r.find(j=>j.title===u),x=b==null?void 0:b.title.replace(/[\s/]/g,"_").replace(/\W/g,"");return s==="title"?t.jsx(H,{onClick:()=>d(`/rafl/?id=2025-${b.id}&name=${x}`),style:{color:"#fff"},children:u}):u},[d,r]),v=f.useCallback(s=>s!=null&&s.title?s.title:"unknown",[]);return t.jsxs("div",{children:[t.jsx("div",{style:{justifyItems:"center",marginBottom:20},children:t.jsx("div",{style:{width:400},children:t.jsx(K,{allItems:r,value:a.itemTitle||null,setItemDetails:y,getOptionTitle:v,searchText:"Search Pots"})})}),t.jsx(B,{tableData:T,tableWidth:"100%",linkFunction:h})]})},dt=()=>{const{allCharities:i}=f.useContext(F),{isMobile:o}=S(),e=o?24:48,n=i.map(r=>{var g;let m=r!=null&&r.name?r==null?void 0:r.name.substring(0,e):"unknown";return m=((g=r==null?void 0:r.name)==null?void 0:g.length)<e?m:m+"...",{...r,displayName:m}}),c={columns:[{id:"displayName",align:"left",name:"Charity Name"},{id:"donations2024",name:"2024",align:"left",displayField:"donations2024text",descending:!0},{id:"donations2025",name:"2025",align:"center",displayField:"donations2025text",descending:!0},{id:"donations",name:"Raised",align:"right",displayField:"donationsText",descending:!0},{id:"donors",name:"Donors",align:"center",descending:!0}],rows:n,defaultSort:"displayName",sortable:!0},a="100%",y=f.useCallback((r,m)=>m,[]);return t.jsx("div",{style:{marginTop:20,width:a},children:t.jsx(B,{tableData:c,tableWidth:a,linkFunction:y})})};function L({chartHeight:i,chartdata:o,showAxisBottom:e,colors:n,tickValues:l,curve:d}){const c=e?{top:10,right:20,bottom:70,left:50}:{top:10,right:20,bottom:10,left:50},a=e?"bottom":"top-left",y=e?70:20,r=e?0:20,{isMobile:m}=S(),g=m?"every 2 days":"every day";return t.jsx("div",{style:{height:i,width:"100%"},children:t.jsx(A,{theme:V,data:o,enableGridX:!1,enableGridY:!1,colors:n,lineWidth:3,margin:c,height:i,curve:d??"basis",yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:l||5,tickSize:5,tickPadding:5,tickRotation:0,format:","},xScale:{type:"time",format:"%Y-%m-%d %H:%M:%S"},xFormat:"time:%m/%d/%y",axisBottom:e?{format:"%b %d",tickSize:5,tickPadding:5,tickRotation:-45,direction:"row",legendOffset:-12,tickValues:g}:null,legends:e?[]:[{anchor:a,itemTextColor:"#bbb",direction:"row",justify:!1,translateX:r,translateY:y,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const ct=()=>{const{summary:i}=f.useContext(F),o={margin:"30px 0px 0px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.2rem"},e=120;return i.lineDataCurrent.cumulativeDonations.length===0?t.jsx("div",{style:{color:"#fff",textAlign:"center",fontSize:"1.2rem",margin:"20px 0px 0px 0px"},children:"No data available"}):t.jsxs(M.Fragment,{children:[t.jsx("div",{style:o,children:"Donations"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations Cumulative",data:i.lineDataCurrent.cumulativeDonations}],chartHeight:e,showAxisBottom:!1,colors:["#4fa720"],tickValues:5})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donations",data:i.lineDataCurrent.totalDonations}],chartHeight:e,showAxisBottom:!0,colors:["#3a7919"],tickValues:2,curve:"step"})}),t.jsx("div",{style:o,children:"Unique Donors"}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors Cumulative",data:i.lineDataCurrent.cumulativeUniqueDonors}],chartHeight:e,showAxisBottom:!1,colors:["#5265ed","#082fd1","#4fa720"]})}),t.jsx("div",{style:{height:e,width:"100%"},children:t.jsx(L,{chartdata:[{id:"Donors",data:i.lineDataCurrent.totalEntries}],chartHeight:e,showAxisBottom:!0,colors:["#082fd1","#4fa720"],tickValues:2,curve:"step"})})]})},mt=({beltDistribution:i})=>{const{width:o}=S(),e=o<500,n=250,l=e?{top:30,right:5,bottom:55,left:48}:{top:30,right:20,bottom:30,left:50},d=e?-45:0,c=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000000","#000000"];return t.jsx("div",{style:{height:n},children:t.jsx(et,{data:i,maxValue:"auto",margin:l,padding:.15,colors:a=>c[a.index%c.length],animate:!0,enableLabel:!1,axisBottom:{tickRotation:d},axisLeft:{tickSize:5,tickPadding:5,tickRotation:0,format:".0%"},enableGridY:!1,theme:it,isInteractive:!1})})};function ut({data:i}){const o=f.useMemo(()=>W.map(a=>({value:i.beltDonations[a]?i.beltDonations[a]/i.totalDonations:0,id:a,label:a})),[i]),e=f.useMemo(()=>W.map(a=>({value:i.beltDonorCountUnique[a]?i.beltDonorCountUnique[a]/i.totalDonorCountUnique:0,id:a,label:a})),[i]),n=f.useMemo(()=>[{label:"Donations",data:o},{label:"Donors",data:e}],[o,e]),[l,d]=f.useState(n[0]),c=f.useCallback(a=>d(a),[]);return t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx(tt,{options:n,onChange:c}),t.jsx(mt,{beltDistribution:l.data})]})}const W=["White","Yellow","Orange","Green","Blue","Purple","Brown","Red","Black"];function ft(){E("RAFL Report");const{data:i,loading:o,error:e}=P({urls:ht}),{raflResponseDetails:n,raflSiteStats2025:l}=i||{},{allPots:d}=f.useContext(F),{width:c}=S(),y=c<560?"8px 8px 32px 8px":"24px 24px 32px 24px",r={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},m={margin:"46px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff",fontSize:"1.3rem",fontWeight:700},g=r,D=o?"--":"(updated: "+C(n==null?void 0:n.metadata.updatedDateTime).format("MM/DD/YY hh:mm")+")";return o?t.jsx(X,{}):e?null:t.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:y,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.0rem"},children:[t.jsxs("div",{style:g,children:["RAFL REPORT",t.jsx("br",{}),t.jsx("span",{style:{fontSize:"0.85rem"},children:D})]}),t.jsx(Q,{animate:!1}),t.jsx("div",{style:r,children:"Totals Over Time"}),t.jsx(Z,{}),t.jsx(ct,{data:n==null?void 0:n.detailedData}),t.jsx("div",{style:m,children:"Site Traffic"}),t.jsx(ot,{data:l}),t.jsx("div",{style:m,children:"Belt Distribution"}),t.jsx(ut,{data:n==null?void 0:n.summaryData}),t.jsx("div",{style:m,children:"Page Tracking"}),t.jsx(rt,{data:l}),t.jsx("div",{style:m,children:"Pot Details"}),t.jsx(lt,{statsData:l,allPots:d}),t.jsx("div",{style:m,children:"Charity Details"}),t.jsx(dt,{})]})}const ht={raflSiteStats2025:_,raflResponseDetails:$};function ne(){const{authLoaded:i}=f.useContext(Y),{isMobile:o}=S(),{raffleAdmin:e}=f.useContext(F),n=t.jsxs(M.Fragment,{children:[!o&&t.jsx("div",{style:{flexGrow:1,minWidth:"10px"}}),t.jsx(nt,{})]}),l=o?8:0,d={maxWidth:800,marginLeft:"auto",marginRight:"auto",paddingLeft:l,paddingRight:l};return t.jsx(N,{filterFields:I,children:t.jsxs("div",{style:d,children:[t.jsx(O,{title:"RAFL Report",extras:n}),t.jsx(at,{page:"reports",width:700}),i&&e&&t.jsx(ft,{}),t.jsx(q,{}),t.jsx(G,{feature:"raflReport"})]})})}export{ne as default};
