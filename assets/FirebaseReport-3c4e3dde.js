import{b as k,r as f,d as _,j as s,u as g}from"./index-7e758895.js";import{L as W}from"./LoadingDisplay-8f4c8650.js";import{u as T}from"./usePageTitle-f3343359.js";import{u as F}from"./useData-4e34f0f8.js";import{n as H}from"./dataUrls-46e31bfb.js";import{A as L}from"./AdminStatsTableSort-e76215d4.js";import{L as A}from"./Link-a7264907.js";import{y as Y}from"./nivo-line-db450941.js";import{p as z}from"./chartDefaults-bfd54756.js";import{A as M}from"./AdminStatsTable-8d6e7832.js";import"./LPU-c3fa7122.js";import"./LinearProgress-596b18da.js";import"./useDocumentTitle-86e2c772.js";import"./TableRow-ada105d9.js";import"./nivo-legends-40fcbeb5.js";import"./nivo-axes-c8d1bacd.js";import"./uniq-41ca8cee.js";import"./line-ff7edfe1.js";const C=({data:n})=>{const a=k(),{dailyTotals:t,requestSubscriptions:l}=n,m=[{name:"Date",align:"left",id:"date"},{name:"Total Reads",align:"left",id:"reads"},{name:"Writes",align:"left",id:"writes"},{name:"",align:"left",id:"spacer"},{name:"Subscription Reads",align:"left",id:"subscriptionReads"},{name:"Subscription Refresh Reads",align:"left",id:"subscriptionRefreshes"}],o=!0,[r,d]=f.useState("date"),[p,u]=f.useState(!0),h=Object.keys(t).map(e=>{var b,x;const c=_(e)||0,w=t[e].READ||0,E=t[e].WRITE||0,q=((b=l[e])==null?void 0:b.READ)||0,D=((x=l[e])==null?void 0:x.REFRESH)||0;return{date:c.format("MM/DD/YYYY"),reads:w,writes:E,spacer:"|",subscriptionReads:q,subscriptionRefreshes:D}}).filter(e=>e).sort((e,c)=>{switch(r){case"reads":return e.reads-c.reads;default:return parseInt(c[r])-parseInt(e[r])}}),S=p?h:h.reverse(),v={columns:m,data:S},y=f.useCallback((e,c)=>e==="title"?s.jsx(A,{onClick:()=>a(`/foobar/${c}`),style:{color:"#fff"},children:c}):c,[a]),{isMobile:R}=g(),j=R?".8rem":".95rem",i="100%";return s.jsx("div",{children:s.jsx(L,{tableData:v,tableWidth:i,fontSize:j,sortable:o,sort:r,setSort:d,ascending:p,setAscending:u,linkFunction:y})})};function I({data:n}){const{width:a}=g(),t=a<=360,l=a<=395,m=a<=560,o=t?230:l?270:m?290:350,r=m?["midnight","2 am","4 am","6 am","8 am","10 am","noon","2 pm","4 pm","6 pm","8 pm","10 pm"]:["midnight","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","noon","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"];return s.jsx("div",{style:{height:o},children:s.jsx(Y,{theme:P,data:n,colors:["#007de2","#16325d"],lineWidth:3,margin:{top:10,right:20,bottom:70,left:58},curve:"natural",xScale:{type:"point"},yScale:{type:"linear",min:0,max:"auto",stacked:!1,reverse:!1},yFormat:" >-.0f",axisLeft:{tickValues:5,tickSize:5,tickPadding:5,tickRotation:0,format:","},axisBottom:{tickValues:r,tickSize:5,tickPadding:5,tickRotation:-45,direction:"row"},legends:[{anchor:"bottom",itemTextColor:"#ddd",text:{fontSize:18},direction:"row",justify:!1,translateX:0,translateY:75,itemsSpacing:0,itemWidth:100,itemHeight:20,symbolSize:13,symbolShape:"circle"}],enablePoints:!1,useMesh:!0,isInteractive:!0})})}const O={grid:{line:{stroke:"#333",strokeWidth:1}}},P={...z,...O},V=({data:n})=>{const{hourly:a}=n,t=["midnight","1 am","2 am","3 am","4 am","5 am","6 am","7 am","8 am","9 am","10 am","11 am","noon","1 pm","2 pm","3 pm","4 pm","5 pm","6 pm","7 pm","8 pm","9 pm","10 pm","11 pm"],m=[{id:"Hourly Requests",data:Object.keys(a).map(o=>{const r=t[parseInt(o)],d=Object.keys(a[o]).reduce((p,u)=>p+a[o][u],0);return{x:r,y:d}}).sort((o,r)=>t.indexOf(o.x)-t.indexOf(r.x))}];return s.jsx("div",{children:s.jsx(I,{data:m})})},$=({data:n})=>{const a=k(),{bySource:t}=n,l=[{name:"Date",align:"left",id:"date"},{name:"Export Collections",align:"left",id:"collectionsExport_lockcollections"},{name:"Export Evidence",align:"left",id:"awardsEvidenceExport_evidence"},{name:"Export Awards",align:"left",id:"awardsEvidenceExport_awards"},{name:"Requests Subscriptions",align:"left",id:"request_subscription"},{name:"Request Votes",align:"left",id:"request_upvote"},{name:"Request Updates",align:"left",id:"request_update"}],m=!0,[o,r]=f.useState("date"),[d,p]=f.useState(!0),u=Object.keys(t).map(i=>{var x;const e=_(i),c=t[i].collectionsExport_lockcollections,w=t[i].awardsEvidenceExport_evidence,E=((x=t[i])==null?void 0:x.awardsEvidenceExport_awards)||0,q=t[i]["request-subscription"]||0,D=t[i]["request-upvote"]||0,b=t[i]["request-update"]||0;return{date:e.format("MM/DD/YYYY"),collectionsExport_lockcollections:c,awardsEvidenceExport_evidence:w,awardsEvidenceExport_awards:E,request_subscription:q,request_upvote:D,request_update:b}}).filter(i=>i).sort((i,e)=>{switch(o){case"reads":return i.reads-e.reads;default:return parseInt(e[o])-parseInt(i[o])}}),h=d?u:u.reverse(),S={columns:l,data:h},v=f.useCallback((i,e)=>i==="title"?s.jsx(A,{onClick:()=>a(`/foobar/${e}`),style:{color:"#fff"},children:e}):e,[a]),{isMobile:y}=g(),R=y?".8rem":".95rem",j="100%";return s.jsx("div",{children:s.jsx(M,{tableData:S,tableWidth:j,fontSize:R,sortable:m,sort:o,setSort:r,ascending:d,setAscending:p,linkFunction:v})})};function lt(){T("Firebase Activity Report");const{data:n,loading:a,error:t}=F({url:`${H}/process-firebase-log`}),{width:l}=g(),o=l<560?"8px 8px 32px 8px":"24px 24px 32px 24px",r={margin:"56px 0px 18px 0px",width:"100%",textAlign:"center",color:"#fff"},d={margin:"0px 0px 36px 0px",width:"100%",textAlign:"center",color:"#fff"};return a?s.jsx(W,{}):t?null:s.jsxs("div",{style:{minWidth:"320px",maxWidth:900,height:"100%",padding:o,backgroundColor:"#292929",marginLeft:"auto",marginRight:"auto",fontSize:"1.5rem",lineHeight:.8},children:[s.jsxs("div",{style:d,children:["Firebase Activity Report",s.jsx("br",{})]}),s.jsx(C,{data:n,loading:a,error:t}),s.jsx("div",{style:r,children:"Hourly Requests"}),s.jsx(V,{data:n,loading:a,error:t}),s.jsx("div",{style:r,children:"Requests by Source"}),s.jsx($,{data:n})]})}export{lt as default};
