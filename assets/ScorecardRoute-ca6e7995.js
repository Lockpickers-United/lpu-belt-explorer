import{r as n,j as e,T as Se,I as X,al as le,am as ce,Z as v,an as K,aj as De,N as Ee,R as B,a4 as we,x as M,w as ue,a2 as Ie,y as Le,z as Be,ao as Te,a9 as ee,p as ne,af as U,K as Y,t as A,$ as Ae,v as de,a0 as me,a5 as Fe,a7 as ze,a8 as Re,ap as Oe,M as Ne,aq as Pe,ar as Me,O as We,P as He,Q as Ue}from"./index-3dd971e4.js";import{u as _e}from"./useData-c7f6fe30.js";import{e as H,F as _,r as xe,f as $e,D as $,B as ge,a as Ge,s as qe}from"./BeltStripe-852e119d.js";import{b as te,S as Ve,a as Ke,s as Ye,F as Je}from"./sortFields-3a347d6d.js";import{S as Qe,E as fe,d as Ze,L as ye,A as je,D as Xe}from"./CollectionButton-c72c2712.js";import{d as et}from"./Link-1233071d.js";import{u as N}from"./useWindowSize-41ba91e6.js";import{A as se,a as ie,b as oe}from"./Sort-5e1562bb.js";import{L as O}from"./Link-e709d399.js";import{p as tt}from"./chartDefaults-9fc07b21.js";import{B as nt}from"./nivo-bar.es-10eb89da.js";import{L as ve,B as st}from"./LoadingDisplay-94b8bcd4.js";import{T as it}from"./TextField-82e6bed2.js";import{m as ot,P as rt,a as at}from"./ProfileHeader-da04aa63.js";import{I as lt}from"./IntroCopy-e0a77b72.js";import{L as ct}from"./LoadingDisplay-3d1895c7.js";import"./Select-cceec113.js";import"./Search-853ebd8f.js";import"./PhotoCamera-c12f2184.js";import"./Dialog-46f0ca20.js";import"./Autocomplete-18761650.js";import"./index-1c169be7.js";import"./ListItem-46654267.js";import"./nivo-legends.es-0a554a36.js";import"./CopyProfileLinkButton-7f22fa6e.js";import"./ToggleButtonGroup-16264649.js";import"./LPU-c3fa7122.js";import"./LinearProgress-22e23440.js";function dt({entry:s}){const r=H(s).replace(/[\s/]/g,"_").replace(/\W/g,""),i=n.useCallback(l=>{l.preventDefault(),l.stopPropagation();const u=`${window.location.origin}/#/locks?id=${s.id}&name=${r}`,p=window.open(u,"_blank","noopener,noreferrer");p&&(p.opener=null)},[s.id,r]);return e.jsx(Se,{title:"View Lock Details",arrow:!0,disableFocusListener:!0,children:e.jsx(X,{onClick:i,children:e.jsx(et,{style:{width:18,height:18}})})})}function xt({children:s,cardEvidence:t,cardBBCount:r,cardDanPoints:i,cardEligibleDan:l,cardNextDanPoints:u,cardNextDanLocks:p}){const{filters:h}=n.useContext(_),{search:g,id:y,tab:D,name:m,sort:f,image:S,...o}=h,c=n.useMemo(()=>t.map(x=>{const C=le(x.matchId),b=ce(x.matchId);return{...C,...x,...b,id:x.id}}),[t]),j=n.useMemo(()=>c.map(x=>{var C,b,d;return{...x,makes:(C=x==null?void 0:x.makeModels)==null?void 0:C.map(({make:a})=>a),fuzzy:xe(((b=x==null?void 0:x.makeModels)==null?void 0:b.map(({make:a,model:I})=>[a,I]).flat().filter(a=>a).concat([x.version,x.notes,x.belt]).join(","))+" "),documentation:[x.exceptionType==="badlink"?"Bad Link":"Valid Link",x.date?"Valid Date":"No Date"],scoring:[x.exceptionType==="nomatch"?"Unmatched":x.exceptionType==="badlink"?"Bad Link":x.exceptionType==="duplicate"?"Duplicate":x.exceptionType==="upgraded"?"Upgraded":["White","Yellow","Orange","Green"].includes(x.belt)?"Low Level":"Worth Points"],simpleBelt:(d=x==null?void 0:x.belt)==null?void 0:d.replace(/\s\d/g,"")}}),[c]),k=n.useMemo(()=>{const x=Object.keys(o).map(d=>{const a=o[d];return Array.isArray(a)?a.map(I=>({key:d,value:I})):{key:d,value:a}}).flat(),C=j.filter(d=>x.every(({key:a,value:I})=>Array.isArray(d[a])?d[a].includes(I):d[a]===I)),b=g?$e.go(xe(g),C,{keys:pt,threshold:-25e3}).map(d=>({...d.obj,score:d.score})):C;return f?b.sort((d,a)=>{if(f==="danPointsAscending")return d.points-a.points||v(a.date).valueOf()-v(d.date).valueOf();if(f==="danPointsDescending")return a.points-d.points||v(a.date).valueOf()-v(d.date).valueOf();if(f==="dateAscending")return v(d.date).valueOf()-v(a.date).valueOf()||K(d.simpleBelt,a.simpleBelt);if(f==="dateDescending")return v(a.date).valueOf()-v(d.date).valueOf()||K(d.simpleBelt,a.simpleBelt);if(f==="beltAscending")return De(d.belt,a.belt)||v(a.date).valueOf()-v(d.date).valueOf();if(f==="beltDescending")return K(d.belt,a.belt)||v(a.date).valueOf()-v(d.date).valueOf();if(f==="alphaAscending")return d.fuzzy.localeCompare(a.fuzzy)||a.points-d.points;if(f==="alphaDescending")return a.fuzzy.localeCompare(d.fuzzy)||a.points-d.points}):b.sort((d,a)=>v(a.date).valueOf()-v(d.date).valueOf()||K(d.belt,a.belt)||d.fuzzy.localeCompare(a.fuzzy))},[o,j,g,f]),E=n.useMemo(()=>({allEntries:Ee,cardEvidence:t,cardBBCount:r,cardDanPoints:i,cardEligibleDan:l,cardNextDanPoints:u,cardNextDanLocks:p,visibleEntries:k,getEntryFromId:le,getProjectEntryFromId:ce}),[t,r,i,l,u,p,k]);return e.jsx($.Provider,{value:E,children:s})}const pt=["fuzzy"];function ht({owner:s,evid:t,expanded:r,onExpand:i,merged:l}){const{setFilters:u}=n.useContext(_),{cardEvidence:p,getEntryFromId:h,getProjectEntryFromId:g}=n.useContext($),y=h(t.matchId),D=g(t.matchId),m=y||D,[f,S]=n.useState(!1),o=n.useRef(null);n.useEffect(()=>{if(r&&o&&!f){const Z=window.innerWidth<=600?70:74,{id:Ce}=we.parse(location.search),ae=Ce===t.id;S(!0),setTimeout(()=>{window.scrollTo({left:0,top:o.current.offsetTop-Z,behavior:ae?"auto":"smooth"})},ae?0:100)}else r||S(!1)},[r,m,f,t.id]);let c=m?H(m):t.evidenceNotes;const j=t.exceptionType&&t.evidenceNotes.toLowerCase()!==c.toLowerCase()?t.evidenceNotes:null;c=t.exceptionType==="nomatch"?`[ ${t.evidenceNotes} ]`:c,c=t.exceptionType&&s&&l?c+" *":c;const k=["nomatch","duplicate","upgraded"].includes(t.exceptionType)?.5:1,E=t.exceptionId,x=E?p.find(F=>F.id===E):{},C=x?n.useMemo(()=>h(x.matchId),[h,x.matchId]):{},b=C?H(C,"short"):"",d=E?e.jsx(O,{style:{color:"#99c2e5"},onClick:()=>{I(E)},children:b}):null;let a=t.exceptionType==="nomatch"?"Could not be matched to a lock or project":t.exceptionType==="badlink"?"You must provide a valid link.":t.exceptionType==="duplicate"?"Duplicate of ":t.exceptionType==="upgraded"?"Upgraded to ":null;const I=n.useCallback(F=>{u({id:F})},[u]),z=t.points===1?"pt":"pts";let T=t.date?v(t.date).format("L"):"(no date)";T=T.replace("/202","/2"),T=T.replace("/201","/1");const L=t.date?"#fff":"#aaa",R=n.useCallback((F,Z)=>{s&&i(Z?t.id:!1)},[t.id,i,s]),J=s?{}:{cursor:"default"},W=s?e.jsx(ue,{}):null,{isMobile:P}=N(),G=P?"block":"flex",q=P?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},V=P?"65%":"56%",Q=P?"-2px 0px 3px 0px":"1px 0px 3px 0px",w={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"};return e.jsxs(se,{expanded:r,onChange:R,ref:o,children:[e.jsxs(ie,{expandIcon:W,style:{...w,...J},children:[e.jsx(ge,{value:m?m.belt:""}),e.jsxs("div",{style:{margin:"8px 0px 0px 8px",width:V,flexShrink:0,flexDirection:"column",opacity:k},children:[e.jsx(te,{value:c,textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}}),!!j&&e.jsx("span",{style:{margin:"0px 0px 0px 15px",fontSize:"0.95rem",lineHeight:1.25,color:"#bbb"},children:j}),!!m&&!!(m!=null&&m.version)&&e.jsx(te,{name:"Version",value:e.jsx(M,{style:{fontSize:"0.95rem",lineHeight:1.25},children:m==null?void 0:m.version}),textStyle:(m==null?void 0:m.belt)==="Unranked"?{color:"#aaa"}:{}})]}),e.jsxs("div",{style:{display:G,placeItems:"center",marginLeft:10,opacity:k},children:[e.jsxs("div",{style:{display:"flex",width:76},children:[e.jsx("div",{style:{margin:"2px 0px 0px 6px",width:30,flexShrink:0,flexDirection:"column"},children:y&&e.jsx(dt,{entry:y})}),e.jsx("div",{style:{margin:"0px 0px 0px 6px",flexShrink:0,flexDirection:"column"},children:e.jsx(Qe,{url:t.link,handleChange:R,exceptionType:t.exceptionType,owner:s})})]}),e.jsxs("div",{style:q,children:[e.jsx("div",{style:{margin:Q,color:L,width:90,textAlign:"center"},children:T}),e.jsx("div",{style:{margin:"1px 0px 0px 22px"},children:e.jsxs("nobr",{children:[e.jsxs("span",{style:{fontWeight:700},children:[t.points," "]}),e.jsx("span",{style:{color:"#666"},children:z})]})})]})]})]}),r&&e.jsx(B.Fragment,{children:e.jsxs(oe,{sx:{padding:"4px 16px 0px 26px"},children:[(a||t.modifier)&&e.jsxs("div",{style:{margin:"0px 0px 20px 20px",fontWeight:600,fontSize:".95rem"},children:[t.modifier&&e.jsxs("span",{children:[t.modifier,"     "]}),a&&e.jsxs("span",{children:["* ",a," ",d]})]}),e.jsx(fe,{evid:t,handleUpdate:()=>{}})]})})]},t.id)}const ut=B.memo(ht,(s,t)=>{const r=Object.keys(s.evid),i=Object.keys(t.evid);if(r.length!==i.length)return!1;for(let l=0;l<r.length;l++)if(r[l]!==i[l]||s.evid[r[l]]!==t.evid[i[l]])return!1;return s.owner===t.owner&&s.expanded===t.expanded&&s.onExpand===t.onExpand&&s.merged===t.merged}),ke=B.createContext({});function mt({children:s}){const{filters:t,addFilters:r,removeFilters:i}=n.useContext(_),l=t.id,u=n.useCallback(h=>{h?r([{key:"id",value:h}],!0):i(["id"])},[r,i]),p=n.useMemo(()=>({expanded:l,setExpanded:u}),[l,u]);return e.jsx(ke.Provider,{value:p,children:s})}function gt({beltData:s}){const{width:t}=N(),r=t<=560,i=r?180:175,l=r?{top:0,right:0,bottom:60,left:15}:{top:0,right:0,bottom:60,left:15},u=["#d5d5d5","#d8d801","#ed7d01","#389700","#0090de","#634b9f","#9d5918","#ba0303","#000","#000","#000","#000","#000","#a5a93c"],p=["#000","#000","#000","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd","#ddd"];return e.jsx("div",{style:{height:i,padding:"0px 8px 0px 8px",width:"100%"},children:e.jsx(nt,{data:s,margin:l,padding:.15,colors:h=>u[h.index%u.length],animate:!0,axisBottom:{tickRotation:-45},axisLeft:null,enableGridY:!1,theme:tt,isInteractive:!1,enableLabel:!0,label:h=>h.data.count,labelSkipWidth:12,labelSkipHeight:12,labelTextColor:h=>p[h.index%p.length]})},"bar")}function pe({entries:s}){const t=n.useMemo(()=>{const r=s.map(({belt:i})=>i&&i.includes("Project")?"Project":i).reduce((i,l)=>(i[l]||(i[l]=0),i[l]++,i),{});return Ie.map(i=>({id:i,label:i,count:r[i]||0,value:r[i]||0}))},[s]);return e.jsx("div",{style:{width:"100%",marginTop:"0px"},children:e.jsx(gt,{beltData:t})})}var re={},ft=Be;Object.defineProperty(re,"__esModule",{value:!0});var be=re.default=void 0,yt=ft(Le()),jt=e;be=re.default=(0,yt.default)((0,jt.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");function vt(){const{setFilters:s}=n.useContext(_),{cardEvidence:t,getEntryFromId:r}=n.useContext($),[i,l]=n.useState(!1),u=n.useCallback(()=>{l(!0)},[]),p=n.useCallback(()=>{l(!1)},[]),h=n.useCallback(o=>{s({id:o}),l(!1)},[s]),g=t.map(o=>{const c=o.exceptionId,j=c?t.find(b=>b.id===c):{},k=j?r(j.matchId):{},E=k?H(k,"short"):"",x=o.matchId?r(o.matchId):null,C=x?H(x,"short"):"";return{...o,supersedingEntryId:c,supersedingLockName:E,matchLockName:C}}),y=g.filter(o=>o.exceptionType==="nomatch"),D=g.filter(o=>o.exceptionType==="badlink"),m=g.filter(o=>o.exceptionType==="duplicate"),f=g.filter(o=>o.exceptionType==="upgraded");if(y.length+D.length+m.length+f.length>0)return e.jsxs(B.Fragment,{children:[e.jsx(X,{onClick:u,style:{marginRight:5},children:e.jsx(be,{fontSize:"small"})}),e.jsx(Te,{sx:{color:"#fff",textAlign:"left",height:700,zIndex:o=>o.zIndex.drawer+1},open:i,onClick:p,children:e.jsxs("div",{style:{maxWidth:600,fontSize:"0.95rem",padding:15},children:[e.jsxs("div",{style:{display:"flex",marginBottom:10,placeItems:"center"},children:[e.jsx("div",{style:{fontWeight:600,fontSize:"1.3rem",flexGrow:1},children:"Some documentation ineligible for Dan Points"}),e.jsx(X,{onClick:p,children:e.jsx(Ze,{sx:{cursor:"pointer"}})})]}),e.jsx("div",{style:{marginBottom:20},children:"Some of the entries in your Scorecard are not eligible for Dan Points. Reasons for this may include: the link in your documentation is missing or not valid, we could not find a lock matching your entry, you have multiple entries for the same lock, or an entry may have been replaced by an upgrade of the same lock. Locks ranked below Blue Belt are never eligible for Dan Points."}),y.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(ee,{style:{marginBottom:20}}),e.jsx(M,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Could not be matched to a lock or project"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:y.map((o,c)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.id)},children:o.evidenceNotes})},c))})]}),D.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(M,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Missing or invalid URLs"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:D.map((o,c)=>e.jsx("li",{style:{marginBottom:4},children:e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.id)},children:o.matchLockName})},c))})]}),m.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(M,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Duplicated by another entry"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:m.map((o,c)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is a duplicate of ",e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.supersedingEntryId)},children:o.supersedingLockName})]},c))})]}),f.length>0&&e.jsxs(B.Fragment,{children:[e.jsx(M,{style:{fontWeight:500,fontSize:"1.0rem",lineHeight:"1.25rem",margin:"0px"},children:"Upgraded by another lock"}),e.jsx("ul",{style:{padding:0,marginLeft:20},children:f.map((o,c)=>e.jsxs("li",{style:{marginBottom:4},children:[o.evidenceNotes," is upgraded by ",e.jsx(O,{style:{color:"#99c2e5",textDecoration:"none"},onClick:()=>{h(o.supersedingEntryId)},children:o.supersedingLockName})]},c))})]})]})})]})}function he(){const{cardDanPoints:s,cardBBCount:t,cardEligibleDan:r,cardNextDanPoints:i,cardNextDanLocks:l}=n.useContext($),u=ne(),p=n.useCallback(()=>{u("/profile/scorecard/upgrades")},[u]);return e.jsxs("div",{style:{display:"flex"},children:[e.jsxs("div",{style:{textAlign:"right",padding:"10px 12px 18px 0px",flexGrow:1},children:[e.jsxs("div",{style:{fontWeight:700,marginBottom:6},children:["Eligible for Dan ",e.jsx("span",{style:{fontSize:"1.8rem",lineHeight:"1rem"},children:r})]}),e.jsxs("div",{style:{marginBottom:5},children:["Dan Points ",e.jsx("strong",{children:s})]}),e.jsxs("div",{style:{marginBottom:5},children:["Black Belt Locks ",e.jsx("strong",{children:t})]}),e.jsxs("div",{style:{fontSize:"0.85rem"},children:[i," point",i!==1&&"s"," and ",l," BB lock",l!==1&&"s"," until next Dan"]}),e.jsx("div",{style:{margin:"10px 0px",fontSize:"0.85rem"},children:e.jsx(O,{onClick:p,style:{color:"#99c2e5",cursor:"pointer"},children:"Upgrades list"})})]}),e.jsx("div",{style:{textAlign:"right"},children:e.jsx(vt,{})})]})}function kt({setControlsExpanded:s,adminAction:t}){const{userId:r}=U(),{importUnclaimedEvidence:i}=n.useContext(Y),{isMobile:l}=N(),[u,p]=n.useState(!1),h=ne(),[g,y]=n.useState(""),[D,m]=n.useState(null),f=n.useCallback(async()=>{p(!0);const o=await i(r,g);p(!1),o?(y(""),s(!1),t()):m("Cannot find dan sheet tab")},[i,r,g,s,t]),S=l?"block":"flex";return e.jsx(B.Fragment,{children:e.jsx("div",{style:{placeItems:"center",display:S},children:u?e.jsx(ve,{}):e.jsx(B.Fragment,{children:e.jsxs("div",{style:{padding:20},children:[e.jsx("strong",{children:"For Black Belt pickers only."}),e.jsx("br",{}),"Black Belt pickers currently use another scorecard system known as the Dan Sheet. This import allows them to bring their picking history over to the site. If you do not already have a tab in the Dan sheet, this import will not work for you. For those that do, specify the name of your tab in the sheet to import your history into your Scorecard. Please note that tab names are case sensitive. ",e.jsx(O,{onClick:()=>{h("/profile/scorecard/howto")},style:{color:"#bbb",cursor:"pointer"},children:"Click here to learn more."}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("div",{style:{padding:"0px",alignItems:"center"},children:e.jsxs("div",{style:{padding:"0px",display:"flex"},children:[e.jsx("div",{style:{flexGrow:1}}),e.jsx(it,{id:"tab-to-import",label:"Tab to Import",value:g,size:"small",error:!!D,helperText:D,margin:"dense",color:"secondary",onChange:o=>{y(o.target.value)}}),e.jsx(A,{style:{color:"#000",padding:0,lineHeight:"1rem",height:40,marginTop:8,marginLeft:10},variant:"contained",onClick:f,edge:"start",color:"secondary",children:"Import"})]})})]})})})})}v.extend(Ae);function bt({owner:s,date:t}){const{userId:r}=U(),{updateProfileBlackBeltAwardedAt:i}=n.useContext(Y),[l,u]=n.useState(!1),[p,h]=n.useState(!1),[g,y]=n.useState(v.utc(t)),D=n.useCallback((a,I)=>{s&&u(I)},[s]),m=n.useCallback(()=>{y(v.utc(t)),h(!1)},[t]),f=n.useCallback(async()=>{try{i(r,g),de("Profile updated"),h(!1)}catch(a){console.error("Error while updating profile",a),de("Error while updating profile")}},[r,g,i]);let S=t?v.utc(t).format("L"):"(no date)";S=S.replace("/202","/2"),S=S.replace("/201","/1");const o={maxWidth:700,marginLeft:"auto",marginRight:"auto",display:"flex",placeItems:"center"},c=s?{}:{cursor:"default"},j=s?e.jsx(ue,{}):null,{isMobile:k}=N(),E=k?"block":"flex",x=k?"65%":"56%",C=k?{display:"block",marginLeft:0,placeItems:"center"}:{display:"flex",margin:"0px 0px 0px 20px"},b=p?"#fff":"#555",d=p?"#e15c07":"#555";return e.jsxs(B.Fragment,{children:[e.jsxs(se,{expanded:l,onChange:D,children:[e.jsxs(ie,{expandIcon:j,style:{...o,...c},children:[e.jsx(ge,{value:"Black"}),e.jsx("div",{style:{margin:"4px 0px 0px 8px",width:x,flexShrink:0,flexDirection:"column"},children:e.jsx(te,{value:"Black Belt Awarded",textStyle:{marginLeft:"0px",fontWeight:700},style:{marginBottom:"2px"}})}),e.jsxs("div",{style:{display:E,placeItems:"center",marginLeft:10},children:[e.jsx("div",{style:{display:"flex",width:76}}),e.jsx("div",{style:C,children:e.jsx("div",{style:{margin:"4px 0px 0px 10px"},children:S})})]})]}),l&&e.jsx(oe,{sx:{padding:"4px 16px 0px 26px"},children:e.jsx(ye,{adapterLocale:v.locale(),dateAdapter:je,children:e.jsx(B.Fragment,{children:e.jsxs("div",{style:{display:"flex",width:"100%",marginBottom:20},children:[e.jsx(Xe,{label:"Awarded date",value:g,onChange:a=>{y(a),h(!0)},sx:{width:400},disableFuture:!0}),e.jsxs("div",{style:{width:"100%",textAlign:"right",position:"relative",top:"30px",padding:"0px 12px 8px 0px"},children:[e.jsx(A,{style:{marginRight:10,color:d},onClick:m,disabled:!p,children:"Cancel"}),e.jsx(A,{style:{marginRight:0,color:b},onClick:f,disabled:!p,children:"Save"})]})]})})})})]}),e.jsx(ee,{}),e.jsx(ee,{})]})}function Ct({collectionType:s}){const{user:t}=n.useContext(me),{userId:r}=U(),i=ne(),{isMobile:l}=N(),u=l?{marginTop:20,maxWidth:700,marginLeft:8,marginRight:8,borderRadius:0}:{marginTop:20,maxWidth:700,marginLeft:"auto",marginRight:"auto",borderRadius:0},p=r===(t==null?void 0:t.uid),h=p?e.jsx("div",{style:{width:"100%",display:"flex",placeItems:"center"},children:e.jsxs("div",{style:{fontSize:"1.0rem",fontWeight:400,width:400,marginLeft:"auto",marginRight:"auto"},children:[e.jsx("strong",{children:"There are no locks in your Scorecard."}),e.jsx("br",{}),'Browse the site and use the "My Collection" button to track locks that you have picked and recorded.',e.jsx("br",{}),e.jsx("br",{}),e.jsx("img",{alt:"My Collection",src:ot})]})}):"There are no locks in this collection.",g=p?s==="safelocks"?"Explore Safe Locks":"Explore Locks":"Go Home",y=n.useCallback(()=>{i(s==="safelocks"?"/safelocks":"/locks")},[i,s]);return e.jsx(st,{alignContent:"center",children:e.jsxs(Fe,{style:u,children:[e.jsx(ze,{children:e.jsx(M,{variant:"h6",align:"center",children:h})}),e.jsxs(Re,{children:[e.jsx("div",{style:{width:"100%"}}),e.jsx(A,{variant:"outlined",color:"secondary",onClick:y,style:{whiteSpace:"nowrap",padding:"10px 30px",margin:10},children:g})]})]})})}function St({owner:s,profile:t,adminAction:r}){const{isMobile:i}=N(),{userId:l}=U(),{visibleEntries:u=[],cardEvidence:p}=n.useContext($),{expanded:h}=n.useContext(ke),{filters:g,removeFilters:y}=n.useContext(_),{createEvidenceForEntries:D,removeEvidence:m,removeProfileBlackBeltAwarded:f}=n.useContext(Y),{admin:S}=n.useContext(Oe),[o,c]=n.useState(h),[j,k]=n.useState(!1),[E,x]=n.useState("import"),[C,b]=n.useState(!1);h&&h!==o&&c(h);const d=n.useMemo(()=>{if(t&&t.recorded){const w=p.map(F=>F.matchId);return t.recorded.filter(F=>!w.includes(F))}else return[]},[t,p]),a=n.useCallback(w=>{g.id&&y(["id"]),c(w)},[g,y]),I=n.useCallback(async()=>{b(!0),await D(l,d),k(!1),b(!1),r()},[D,l,d,r]),z=n.useCallback(w=>{x(w),k(!j)},[j]),[T,L]=n.useState(null),R=!!T,J=n.useCallback(w=>{w.preventDefault(),w.stopPropagation(),L(w.currentTarget)},[]),W=n.useCallback(()=>L(null),[]),P=n.useCallback(async()=>{b(!0),await m(p),await f(l),W(),b(!1),r()},[p,m,W,r,f,l]),G=i?10:40,q=i?"block":"flex",V=(t==null?void 0:t.blackBeltAwardedAt)>0,Q=V?"100%":"50%";return e.jsxs("div",{style:{maxWidth:700,padding:0,backgroundColor:"#222",marginLeft:"auto",marginRight:"auto",marginTop:16},children:[e.jsx(rt,{profile:t,page:"scorecard"}),s&&u.length>0&&!t.tabClaimed&&e.jsx("div",{style:{margin:8,padding:"0px 0px"},children:e.jsx(lt,{pageName:"scorecard"})}),u.length>0&&e.jsx(B.Fragment,{children:i?e.jsxs("div",{style:{display:q,padding:"0px 8px 0px 16px"},children:[t.danLevel>0&&e.jsx(he,{}),e.jsx("div",{style:{marginRight:0,width:"95%"},children:e.jsx(pe,{profile:t,entries:u})})]}):e.jsxs("div",{style:{display:q,padding:"10px 8px 0px 16px"},children:[e.jsx("div",{style:{marginRight:0,width:350},children:e.jsx(pe,{profile:t,entries:u})}),t.danLevel>0&&e.jsx("div",{style:{flexGrow:1,marginRight:0},children:e.jsx(he,{})})]})}),(s||S)&&e.jsxs(se,{expanded:j,disableGutters:!0,children:[e.jsx(ie,{style:{paddingLeft:G,paddingRight:G,placeItems:"center",width:"100%"},children:e.jsxs("div",{style:{width:"100%",placeItems:"center",textAlign:"center"},children:[e.jsxs("div",{style:{display:"flex",width:"100%",placeItems:"center",textAlign:"center"},children:[!V&&e.jsx("div",{style:{width:"50%",textAlign:"center"},children:e.jsx(A,{variant:"contained",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>z("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:Q,textAlign:"center"},children:e.jsx(A,{variant:"outlined",color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>z("project"),children:j&&E==="project"?"CANCEL ADD PROJECT":"ADD PROJECT"})})]}),C&&e.jsx(ve,{}),S&&!C&&e.jsx("div",{style:{backgroundColor:"#700",padding:5,marginTop:20},children:e.jsxs("div",{style:{display:"flex"},children:[e.jsx("div",{style:{width:"10%",textAlign:"center"},children:"admin"}),e.jsx("div",{style:{width:"30%",textAlign:"center"},children:e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:()=>z("import"),children:"IMPORT DAN SHEET"})}),e.jsx("div",{style:{width:"30%",textAlign:"center"},children:e.jsxs(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:I,children:["MERGE RECORDED (",d.length,")"]})}),e.jsxs("div",{style:{width:"30%",textAlign:"center"},children:[e.jsx(A,{color:"secondary",size:"small",style:{lineHeight:"1rem"},onClick:J,children:"DELETE SCORECARD"}),e.jsxs(Ne,{anchorEl:T,open:R,onClose:W,children:[e.jsxs("div",{style:{padding:20,textAlign:"center"},children:["You cannot undo delete.",e.jsx("br",{}),"Are you sure?"]}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{style:{marginBottom:10,color:"#000"},variant:"contained",onClick:P,edge:"start",color:"error",children:"Delete"})})]})]})]})})]})}),e.jsxs(oe,{style:{backgroundColor:"#333"},children:[E==="import"&&e.jsx(kt,{setControlsExpanded:k,adminAction:r}),E==="project"&&e.jsx(fe,{evid:null,handleUpdate:z,addProject:!0})]})]}),u.length===0&&e.jsx(Ct,{}),t&&t.blackBeltAwardedAt&&e.jsx(bt,{owner:s,date:t.blackBeltAwardedAt.toDate().toJSON()}),e.jsx("div",{children:u.map(w=>e.jsx(ut,{owner:s,evid:w,expanded:w.id===o,onExpand:a,merged:t.blackBeltAwardedAt>0},w.id))})]})}function Xt(){const{userId:s}=U(),{user:t}=n.useContext(me),{getProfile:r,getEvidence:i}=n.useContext(Y),{scoredEvidence:l,bbCount:u,danPoints:p,eligibleDan:h,nextDanPoints:g,nextDanLocks:y}=n.useContext(Pe),{isMobile:D}=N(),[m,f]=n.useState(!1),S=n.useCallback(()=>{f(!m)},[m]),o=n.useCallback(async()=>{try{const L=await r(s);if(L){const R=L.displayName?L.displayName.toLowerCase().endsWith("s")?`${L.displayName}'`:`${L.displayName}'s`:"Anonymous";document.title=`LPU Belt Explorer - ${R} Scorecard`}if((t==null?void 0:t.uid)!==s){const R=await i(s);return{profile:L,...Me(R)}}else return{profile:L,scoredEvidence:l,bbCount:u,danPoints:p,eligibleDan:h,nextDanPoints:g,nextDanLocks:y}}catch(L){return console.error("Error loading profile and evidence.",L),null}},[m,t,s,r,i,l,u,p,h,g,y]),{data:c={},loading:j,error:k}=_e({loadFn:o}),E=c?c.profile:{},x=c?c.scoredEvidence:[],C=c?c.bbCount:0,b=c?c.danPoints:0,d=c?c.eligibleDan:0,a=c?c.nextDanPoints:0,I=c?c.nextDanLocks:0,z=e.jsxs(B.Fragment,{children:[e.jsx(Ve,{label:"Scorecard",extraFilters:[{key:"tab",value:"search"}]}),e.jsx(Ke,{sortValues:Ye}),e.jsx(Je,{extraFilters:[{key:"tab",value:"search"}]}),!D&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})]}),T=j?"Loading...":"Profile";return j||k?null:e.jsx(Ge,{filterFields:qe,children:e.jsx(xt,{cardEvidence:x,cardBBCount:C,cardDanPoints:b,cardEligibleDan:d,cardNextDanPoints:a,cardNextDanLocks:I,children:e.jsxs(mt,{children:[e.jsxs(ye,{adapterLocale:v.locale(),dateAdapter:je,children:[e.jsx(We,{title:T,extras:z}),j&&e.jsx(ct,{}),!j&&c&&!k&&e.jsx(St,{owner:t&&t.uid===s,profile:E,adminAction:S}),!j&&(!c||k)&&e.jsx(at,{}),e.jsx(He,{})]}),e.jsx(Ue,{feature:"scorecard"})]})})})}export{Xt as default};
