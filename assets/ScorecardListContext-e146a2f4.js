import{r,a5 as C,b0 as A,N as B,j as F,a1 as s,aw as x,aj as w,R as L}from"./index-09232361.js";import{F as P,D as U,r as D,f as T}from"./index-a73e9af8.js";function q({children:v,cardEvidence:n,cardBBCount:o,cardDanPoints:u,cardEligibleDan:c,cardNextDanPoints:l,cardNextDanLocks:d,popularLocks:i}){const{filters:e}=r.useContext(P),{search:t,id:p,tab:O,name:m,sort:z,image:W,locks:G,...k}=e,h=r.useMemo(()=>n.map(a=>({...C(a.matchId),...a,...A(a.matchId),id:a.id})),[n]),E=r.useMemo(()=>h.reduce((a,f)=>(a[f.matchId]=f,a),{}),[h]),M=r.useMemo(()=>i.map(a=>({...C(a.lockID),...E[a.lockID],popularityRank:a.rank,userCount:a.count})),[i,E]),g=r.useMemo(()=>Object.keys(k).map(a=>{const f=k[a];return Array.isArray(f)?f.map(S=>({key:a,value:S})):{key:a,value:f}}).flat(),[k]),b=r.useMemo(()=>I(h,g,t,z),[h,g,t,z]),j=r.useMemo(()=>I(M,g.concat({key:"exceptionType",value:void 0}),t,"popular"),[M,g,t]),R=r.useMemo(()=>({allEntries:B,cardEvidence:n,cardBBCount:o,cardDanPoints:u,cardEligibleDan:c,cardNextDanPoints:l,cardNextDanLocks:d,visibleEntries:b,popularEntries:j,getEntryFromId:C,getProjectEntryFromId:A}),[n,o,u,c,l,d,b,j]);return F.jsx(U.Provider,{value:R,children:v})}function I(v,n,o,u){const l=v.map(e=>{var t,p,O;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:m})=>m),fuzzy:D(((p=e==null?void 0:e.makeModels)==null?void 0:p.map(({make:m,model:z})=>[m,z]).flat().filter(m=>m).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}return"Worth Points"})()],simpleBelt:(O=e==null?void 0:e.belt)==null?void 0:O.replace(/\s\d/g,"")}}).filter(e=>n.every(({key:t,value:p})=>Array.isArray(e[t])?e[t].includes(p):e[t]===p)),d=o?T.go(D(o),l,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):l,i=(()=>{switch(u){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||s(t.date).valueOf()-s(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||s(t.date).valueOf()-s(e.date).valueOf();case"dateAscending":return(e,t)=>s(e.date).valueOf()-s(t.date).valueOf()||x(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>s(t.date).valueOf()-s(e.date).valueOf()||x(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>w(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"beltDescending":return(e,t)=>x(e.belt,t.belt)||s(t.date).valueOf()-s(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>s(t.date).valueOf()-s(e.date).valueOf()||x(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return d.sort(i)}const y=L.createContext({});function H({children:v}){const{filters:n,addFilters:o,removeFilters:u}=r.useContext(P),c=n.id,l=r.useCallback(i=>{i?o([{key:"id",value:i}],!0):u(["id"])},[o,u]),d=r.useMemo(()=>({expanded:c,setExpanded:l}),[c,l]);return F.jsx(y.Provider,{value:d,children:v})}export{y as S,q as a,H as b};
