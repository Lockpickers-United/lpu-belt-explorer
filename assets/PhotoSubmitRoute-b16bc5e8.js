import{u as W,r as t,as as pe,j as e,R as q,a8 as xe,D as he,d as ue,B as z,T as ge,bC as fe,Z as je,N as ke}from"./index-2be545be.js";import{I as be}from"./IntroCopy-eef5ba62.js";import{u as ye}from"./usePageTitle-2b8b3aea.js";import{d as ve}from"./Search-0ab03872.js";import{e as Z}from"./entryName-2e50a817.js";import{A as Ne}from"./Autocomplete-daf73878.js";import{T as R}from"./TextField-f69b3aba.js";import{I as Ce}from"./Chip-e7f3cb72.js";import{B as Se}from"./BeltIcon-acf26028.js";import{D as Le}from"./Dropzone-bac1f081.js";import{L as Ie}from"./LoadingDisplay-9729e829.js";import{D as Be,a as Fe}from"./DataContext-682a0955.js";import"./index-dec1c8bd.js";import{p as $e,c as we}from"./postData-29b0d461.js";import{C as De}from"./Checkbox-f3baf1f9.js";import{C as Re}from"./Collapse-f2328264.js";import{I as Pe,a as Te}from"./ImageListItem-4ca15491.js";import{D as U}from"./Dialog-9223d38a.js";import{D as ze}from"./LockDataProvider-51f94bb1.js";import"./index-8901ba25.js";import"./index-18c16b06.js";import"./index-71622287.js";import"./Link-c21e1151.js";import"./useDocumentTitle-52fa3bd1.js";import"./Select-56221e34.js";import"./index-668b0270.js";import"./Box-8b25064a.js";import"./CircularProgress-3ae84037.js";import"./axios-439bb627.js";function Ue({handleChangeLock:a,allEntries:i,disabled:h,reset:y=!1}){const n={maxWidth:700},{isMobile:f}=W(),C=t.useRef(),B=t.useMemo(()=>{let s={},l={};return{allLocks:i==null?void 0:i.sort((p,x)=>{pe(p.belt,x.belt)||Z(p,"short").localeCompare(Z(x,"short"))}).reduce((p,x)=>{const k=x.version?" - "+x.version:"";return x.makeModels.map(b=>{const N=b.make?b.make:b.model,w=b.make?` ${b.model}`:"",P=`${N}${w}${k}`;p.push({id:x.id,lockName:P,make:N,model:w})}),p},[]).filter(p=>p),lockIds:s,lockNames:l}},[i]),{allLocks:c,lockIds:j,lockNames:S}=B,F=c.filter((s,l)=>c.findIndex(I=>I.lockName===s.lockName)!==l),v=c==null?void 0:c.map(s=>(s.lockName=F.find(l=>l.lockName===s.lockName)?s.lockName+` (${i.find(l=>l.id===s.id).belt})`:s.lockName,s)).map(s=>(j[s.lockName]=s.id,S[s.lockName]=`${s.make}${s.model}`,s.lockName)),L=t.useCallback((s,l)=>{l?v.includes(l)&&a({lockFullName:l,lockName:S[l],lockId:j[l]}):a({})},[j,S,v,a]),[r,$]=t.useState(!1),g=t.useCallback(()=>$(!1),[]);return e.jsxs(q.Fragment,{children:[e.jsx(Ne,{disabled:h,selectOnFocus:!0,clearOnEscape:!0,handleHomeEndKeys:!0,fullWidth:!0,style:n,options:v,onChange:L,renderInput:s=>e.jsx(R,{...s,placeholder:"Search Locks",variant:"standard",color:"info",inputRef:C,InputProps:{...s.InputProps,startAdornment:e.jsx(Ce,{position:"start",children:e.jsx(ve,{})})}})},y||h),e.jsx(xe,{invisible:!0,open:r&&f,onClick:g})]})}function We({profile:a,user:i}){var _,Y,E,H,K,G;const{allEntries:h}=t.useContext(Be),{updateProfileField:y}=t.useContext(he),[n,f]=t.useState({}),[C,B]=t.useState(void 0),[c,j]=t.useState([]),[S,F]=t.useState(void 0),[v,L]=t.useState(!1),[r,$]=t.useState(void 0),[g,s]=t.useState(!1),[l,I]=t.useState(""),[p,x]=t.useState(""),[k,b]=t.useState((a==null?void 0:a.photoCredit)||(a==null?void 0:a.displayName)||""),[N,w]=t.useState(!1),P=ue().format("YYYYMMDD-HHMMss"),u=h.find(o=>o.id===(n==null?void 0:n.lockId)),J=!!(n!=null&&n.lockName)&&!!(n!=null&&n.lockId)&&!!k&&c.length>0,A=`${n.lockName}_${n.lockId}_`.replace("/","+"),O=`${k}`.replace("/","+"),Q=c.map(o=>o.name),V=c.length===1?"File":"Files",X=async o=>{o.preventDefault(),L(!0);const d=`${P}_${A}_${O}`,m=new FormData;c.forEach(D=>{const{base:T,ext:me}=Ae(D.name);m.append("files",D,`${d}/${A}_${T}_${O}.${me}`)}),m.append("droppedFileNames",Q),m.append("lockFullName",n.lockFullName),m.append("lockName",n.lockName),m.append("version",u==null?void 0:u.version),m.append("belt",u==null?void 0:u.belt),m.append("lockId",n.lockId),m.append("photoCredit",k),m.append("displayName",a==null?void 0:a.displayName),m.append("uploadsDir",d),m.append("notes",p);const le="https://explore.lpubelts.com:8443/upload",ce=!1,de=15e3;try{F(await $e({user:i,url:le,formData:m,snackBars:ce,timeoutDuration:de})),te(k)}catch(D){$(we(D)),f([]),c.forEach(T=>URL.revokeObjectURL(T.preview)),j([])}finally{L(!1)}},ee=t.useCallback(o=>{f(o),B(h.find(d=>d.id===o.lockId))},[h]),te=t.useCallback(o=>{y("photoCredit",o)},[y]),se=t.useCallback(o=>{const{value:d}=o.target;b(d)},[]),oe=t.useCallback(o=>{const{value:d}=o.target;x(d)},[]),M=t.useCallback(()=>{f({}),B(void 0),c.forEach(o=>URL.revokeObjectURL(o.preview)),j([]),F(void 0),L(!1),$(void 0),s(!1),I(""),x(""),w(!N)},[c,N]),ae=t.useCallback(()=>{s(!g),f([])},[g]),ne=t.useCallback(o=>{const{value:d}=o.target;I(d),f({lockFullName:d,lockName:d,lockId:"NOTINLIST"})},[]),ie=g?.5:1,{flexStyle:re}=W();return e.jsxs("div",{style:{maxWidth:800,padding:0,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,paddingLeft:8},children:[e.jsx("form",{action:null,encType:"multipart/form-data",method:"post",onSubmit:X,children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:"Select Lock"}),e.jsx("div",{style:{opacity:ie},children:e.jsx(Ue,{handleChangeLock:ee,allEntries:h,disabled:g,reset:N})}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx(De,{onChange:ae,color:"info",size:"small",id:"notInList",checked:g})," Submit photos for a lock not on the site."]}),e.jsxs(Re,{in:g,style:{marginTop:10},children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),e.jsx("br",{}),e.jsx(R,{type:"text",id:"altLockName",name:"altLockName",value:l,style:{width:400},onChange:ne,color:"info"})]}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{style:{display:re},children:[e.jsxs("div",{style:{marginRight:50,width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Files to Upload",e.jsx("br",{})]}),e.jsx(Le,{files:c,setFiles:j}),C&&e.jsxs("div",{children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10,marginTop:20},children:["Existing Images",e.jsx("br",{})]}),C.media?e.jsx("div",{children:e.jsx(Pe,{sx:{width:350},variant:"masonry",cols:2,gap:8,children:C.media.map(o=>e.jsx(Te,{children:e.jsx("img",{srcSet:`${o.thumbnailUrl}?w=164&fit=crop&auto=format&dpr=2 2x`,src:`${o.thumbnailUrl}?w=164&fit=crop&auto=format`,alt:o.title,loading:"lazy"})},o.thumbnailUrl))})}):e.jsx("span",{children:"no images"})]})]}),e.jsxs("div",{style:{width:350},children:[e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:500,marginBottom:10},children:["Details",e.jsx("br",{})]}),n.lockFullName&&e.jsxs("span",{children:[e.jsx("span",{style:{fontSize:"0.9rem"},children:"Lock Name"}),e.jsx("br",{}),e.jsxs("div",{style:{display:"flex"},children:[n.lockId!=="NOTINLIST"&&e.jsx(Se,{value:u==null?void 0:u.belt,style:{marginBottom:-10}}),e.jsx("div",{style:{fontWeight:700,fontSize:"1.2rem",marginLeft:10},children:n.lockFullName})]}),e.jsx("br",{})]}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Credit to"}),e.jsx("br",{}),e.jsx(R,{type:"text",name:"photoCredit",value:k,style:{width:350},onChange:se,color:"info"}),e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.9rem"},children:"Notes"}),e.jsx("br",{}),e.jsx(R,{type:"text",name:"notes",multiline:!0,fullWidth:!0,rows:3,color:"info",maxLength:1e3,id:"notes",value:p,onChange:oe}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(z,{type:"submit",variant:"contained",color:"info",disabled:!J||v,children:"Upload"})]})]}),e.jsx("br",{}),e.jsx("br",{})]})}),e.jsx(U,{open:v,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:e.jsx(Ie,{})})}),e.jsx(U,{open:!!S&&!r,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:[V," Uploaded Succesfully!"]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:M,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"Submit more photos"})})]})})}),e.jsx(U,{open:!!r,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:e.jsx("div",{style:{display:"flex"},children:e.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[e.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",e.jsx("br",{}),"Please try again later.",e.jsx("br",{})]}),e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",((Y=(_=r==null?void 0:r.response)==null?void 0:_.data)==null?void 0:Y.message)||(r==null?void 0:r.message),((H=(E=r==null?void 0:r.response)==null?void 0:E.data)==null?void 0:H.status)&&e.jsxs("span",{children:[" (",(G=(K=r==null?void 0:r.response)==null?void 0:K.data)==null?void 0:G.status,")"]})]}),e.jsx("div",{style:{width:"100%",textAlign:"center"},children:e.jsx(z,{onClick:M,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),e.jsx(ge,{feature:"uploadPhotos"})]})}function Ae(a){const i=a.lastIndexOf(".");return i===-1?{base:a,ext:""}:{base:a.substring(0,i),ext:a.substring(i)}}function ut(){const{isMobile:a}=W(),{profile:i,user:h}=fe();ye("LPU Belt Explorer - Submit Photos");const y=e.jsx(q.Fragment,{children:!a&&e.jsx("div",{style:{flexGrow:1,minWidth:"10px"}})});return e.jsx(Fe,{children:e.jsxs(ze,{allEntries:je,profile:i,children:[e.jsx(ke,{title:"Submit Photos",extras:y}),i&&!i.photoCredit&&e.jsx("div",{style:{marginTop:20,padding:"0px 0px"},children:e.jsx(be,{pageName:"photoUpload",maxWidth:820})}),e.jsx(We,{profile:i,user:h})]})})}export{ut as default};
