import{r,F as R,aA as w,aq as L,d as m,K as h,ap as q,j as G}from"./index-CwCZNzmA.js";import{D as K,f as V}from"./DataContext-DsYapkFM.js";import{r as I}from"./index-CZ7Q2fyX.js";import{c as W}from"./collectionStatsById-DY1NVZ7h.js";import{u as T}from"./useData-BCXcsHLL.js";import{h as J}from"./dataUrls-DkJe4Pqg.js";import{f as Q}from"./filterEntriesAdvanced-B_LinbMH.js";import{s as X}from"./setDeep-J6HEwWhX.js";function re({children:O,allEntries:i,profile:l}){const{filters:P,advancedFilterGroups:M}=r.useContext(R),{search:f,tab:d,sort:c,expandAll:A}=P,{data:v,loading:B,error:C}=T({urls:Z}),b=r.useMemo(()=>v&&!B&&!C?v.lockbazzarEntryIds:[],[v,C,B]),[k,g]=r.useState(.3),n=r.useMemo(()=>{const a=(l==null?void 0:l.userLockNotes)||{};return i.map(e=>{var o,N,F,j;const t=(o=e.media)==null?void 0:o.reduce((s,u)=>{var E;return u&&u.title&&((E=u.title)!=null&&E.includes("By:"))&&X(s,["names"],u.title.replace("By: ","").trim()),s},[]);return{...e,makes:e.makeModels[0].make?e.makeModels.map(({make:s})=>s):e.makeModels[0].model,fuzzy:I(e.makeModels.map(({make:s,model:u})=>[s,u]).flat().filter(s=>s).concat([e.version,e.notes,e.belt]).join(",")),content:[(N=e.media)!=null&&N.some(s=>!s.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(F=e.media)!=null&&F.some(s=>s.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((j=e.links)==null?void 0:j.length)>0?"Has Links":"No Links",L[e.belt].danPoints>0?"Worth Dan Points":void 0,m(e.lastUpdated).isAfter(m().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,a[e.id]?"Has Personal Notes":void 0].flat().filter(s=>s),collection:w.locks.map.map(s=>l&&l[s.key]&&l[s.key].includes(e.id)?s.label:"Not "+s.label),collectionSaves:W[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:a[e.id],photographers:t==null?void 0:t.names}})},[i,l]),z=r.useCallback(a=>{const e=f&&a.find(t=>t.id===f);return e?[e]:f?V.go(I(f),a,{keys:Y,threshold:-23e3}).map(t=>({...t.obj,score:t.score})).filter(t=>t.score>k):a},[f,k]),x=r.useMemo(()=>d==="search"||!d?z(n):z(n).filter(a=>a.simpleBelt===d),[n,z,d]),p=r.useMemo(()=>{const a=Q({advancedFilterGroups:M(),entries:n}),e=z([...a]);return c?e.sort((t,o)=>{if(c==="popularity")return o.collectionSaves-t.collectionSaves||o.views-t.views||t.fuzzy.localeCompare(o.fuzzy);if(c==="beltAscending")return h(t.belt,o.belt);if(c==="beltDescending")return q(t.belt,o.belt);if(c==="alphaAscending")return t.fuzzy.localeCompare(o.fuzzy);if(c==="alphaDescending")return o.fuzzy.localeCompare(t.fuzzy);if(c==="recentlyUpdated")return Math.floor(m(o.lastUpdated).valueOf()/3600)-Math.floor(m(t.lastUpdated).valueOf()/3600)||h(t.belt,o.belt)||t.fuzzy.localeCompare(o.fuzzy);if(c==="dateAdded")return Math.floor(m(o.dateAdded).valueOf()/3600*24)-Math.floor(m(t.dateAdded).valueOf()/3600*24)||h(t.belt,o.belt)||t.fuzzy.localeCompare(o.fuzzy)}):e},[M,n,z,c]),U=r.useCallback(a=>i.find(e=>e.id===a),[i]),y=r.useMemo(()=>d==="search"||!d?p:p.filter(a=>a.simpleBelt===d),[d,p]),D=r.useCallback(a=>b==null?void 0:b.includes(a),[b]),S=r.useMemo(()=>(l==null?void 0:l.blackBeltAwardedAt)>0,[l]),H=r.useMemo(()=>({allEntries:i,mappedEntries:n,searchedBeltEntries:x,visibleEntries:p,visibleBeltEntries:y,getEntryFromId:U,expandAll:A,profile:l,blackBeltUser:S,lockbazzarAvailable:D,searchCutoff:k,setSearchCutoff:g}),[i,n,x,p,y,U,A,l,S,D,k,g]);return G.jsx(K.Provider,{value:H,children:O})}const Y=["fuzzy"],Z={lockbazzarEntryIds:J};export{re as D};
