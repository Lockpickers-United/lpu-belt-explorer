import{r,F as R,aA as L,aq as _,d as u,K as v,ap as q,j as G}from"./index-qJKj7dMz.js";import{D as K,f as V}from"./DataContext-BeL_dr__.js";import{r as I}from"./index-cO_cXIus.js";import{c as W}from"./collectionStatsById-DY1NVZ7h.js";import{u as T}from"./useData-C-F0cDC0.js";import{h as J}from"./dataUrls-DkJe4Pqg.js";import{f as Q}from"./filterEntriesAdvanced-B_LinbMH.js";import{s as X}from"./setDeep-J6HEwWhX.js";function ce({children:O,allEntries:d,profile:o}){const{filters:P,advancedFilterGroups:M}=r.useContext(R),{search:m,tab:i,sort:c,expandAll:g}=P,{data:k,loading:A,error:B}=T({urls:Z}),z=r.useMemo(()=>k&&!A&&!B?k.lockbazzarEntryIds:[],[k,B,A]),[b,C]=r.useState(.3),n=r.useMemo(()=>{const s=(o==null?void 0:o.userLockNotes)||{};let l=[];return d.map(e=>{var j,N,F,w;const a=(j=e.media)==null?void 0:j.map(t=>{var h,E;return t&&t.title&&((h=t.title)!=null&&h.includes("By:"))&&X(l,[""],t.title.replace("By: ","").trim()),(E=t==null?void 0:t.thumbnailUrl)!=null&&E.includes("flickr.com")&&(t.thumbnailUrl=t.thumbnailUrl.replace("_w_d.jpg","_w.jpg")),t});return{...e,media:a,makes:e.makeModels[0].make?e.makeModels.map(({make:t})=>t):e.makeModels[0].model,fuzzy:I(e.makeModels.map(({make:t,model:h})=>[t,h]).flat().filter(t=>t).concat([e.version,e.notes,e.belt]).join(",")),content:[(N=e.media)!=null&&N.some(t=>!t.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(F=e.media)!=null&&F.some(t=>t.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((w=e.links)==null?void 0:w.length)>0?"Has Links":"No Links",_[e.belt].danPoints>0?"Worth Dan Points":void 0,u(e.lastUpdated).isAfter(u().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,s[e.id]?"Has Personal Notes":void 0].flat().filter(t=>t),collection:L.locks.map.map(t=>o&&o[t.key]&&o[t.key].includes(e.id)?t.label:"Not "+t.label),collectionSaves:W[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:s[e.id],photographers:l==null?void 0:l.names}})},[d,o]),f=r.useCallback(s=>{const l=m&&s.find(e=>e.id===m);return l?[l]:m?V.go(I(m),s,{keys:Y,threshold:-23e3}).map(e=>({...e.obj,score:e.score})).filter(e=>e.score>b):s},[m,b]),U=r.useMemo(()=>i==="search"||!i?f(n):f(n).filter(s=>s.simpleBelt===i),[n,f,i]),p=r.useMemo(()=>{const s=Q({advancedFilterGroups:M(),entries:n}),l=f([...s]);return c?l.sort((e,a)=>{if(c==="popularity")return a.collectionSaves-e.collectionSaves||a.views-e.views||e.fuzzy.localeCompare(a.fuzzy);if(c==="beltAscending")return v(e.belt,a.belt);if(c==="beltDescending")return q(e.belt,a.belt);if(c==="alphaAscending")return e.fuzzy.localeCompare(a.fuzzy);if(c==="alphaDescending")return a.fuzzy.localeCompare(e.fuzzy);if(c==="recentlyUpdated")return Math.floor(u(a.lastUpdated).valueOf()/3600)-Math.floor(u(e.lastUpdated).valueOf()/3600)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy);if(c==="dateAdded")return Math.floor(u(a.dateAdded).valueOf()/3600*24)-Math.floor(u(e.dateAdded).valueOf()/3600*24)||v(e.belt,a.belt)||e.fuzzy.localeCompare(a.fuzzy)}):l},[M,n,f,c]),x=r.useCallback(s=>d.find(l=>l.id===s),[d]),y=r.useMemo(()=>i==="search"||!i?p:p.filter(s=>s.simpleBelt===i),[i,p]),D=r.useCallback(s=>z==null?void 0:z.includes(s),[z]),S=r.useMemo(()=>(o==null?void 0:o.blackBeltAwardedAt)>0,[o]),H=r.useMemo(()=>({allEntries:d,mappedEntries:n,searchedBeltEntries:U,visibleEntries:p,visibleBeltEntries:y,getEntryFromId:x,expandAll:g,profile:o,blackBeltUser:S,lockbazzarAvailable:D,searchCutoff:b,setSearchCutoff:C}),[d,n,U,p,y,x,g,o,S,D,b,C]);return G.jsx(K.Provider,{value:H,children:O})}const Y=["fuzzy"],Z={lockbazzarEntryIds:J};export{ce as D};
