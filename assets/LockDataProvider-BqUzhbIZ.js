import{r,F as L,aA as V,aq as _,d as f,K as g,ap as q,j as G}from"./index-UBzCiWGi.js";import{D as K,f as W}from"./DataContext-B9D_8DZ5.js";import{r as I}from"./index-BACzujgT.js";import{c as T}from"./collectionStatsById-DY1NVZ7h.js";import{u as $}from"./useData-Chx7TFa8.js";import{h as J}from"./dataUrls-DkJe4Pqg.js";import{f as Q}from"./filterEntriesAdvanced-B_LinbMH.js";import{s as X}from"./setDeep-J6HEwWhX.js";import{e as O}from"./entryName-BVJVxERd.js";function Y(k){try{return new RegExp(k),!0}catch(c){if(c instanceof SyntaxError)return!1;throw c}}function ue({children:k,allEntries:c,profile:o}){const{filters:P,advancedFilterGroups:x}=r.useContext(L),{search:d,tab:i,sort:n,expandAll:M}=P,{data:v,loading:A,error:B}=$({urls:ee}),h=r.useMemo(()=>v&&!A&&!B?v.lockbazzarEntryIds:[],[v,B,A]),[b,C]=r.useState(.3),u=r.useMemo(()=>{const a=(o==null?void 0:o.userLockNotes)||{};let l=[];return c.map(e=>{var z,E,N,j;const t=(z=e.media)==null?void 0:z.map(s=>{var F,R;return s&&s.title&&((F=s.title)!=null&&F.includes("By:"))&&X(l,[""],s.title.replace("By: ","").trim()),(R=s==null?void 0:s.thumbnailUrl)!=null&&R.includes("flickr.com")&&(s.thumbnailUrl=s.thumbnailUrl.replace("_w_d.jpg","_w.jpg")),s});return{...e,media:t,makes:e.makeModels[0].make?e.makeModels.map(({make:s})=>s):e.makeModels[0].model,fuzzy:I([O(e,"long")].concat([e.version,e.notes,e.belt]).join(",")),content:[(E=e.media)!=null&&E.some(s=>!s.fullUrl.match(/youtube\.com/))?"Has Images":"No Images",(N=e.media)!=null&&N.some(s=>s.fullUrl.match(/youtube\.com/))?"Has Video":"No Video",((j=e.links)==null?void 0:j.length)>0?"Has Links":"No Links",_[e.belt].danPoints>0?"Worth Dan Points":void 0,f(e.lastUpdated).isAfter(f().subtract(1,"days"))?"Updated Recently":void 0,e.belt!=="Unranked"?"Is Ranked":void 0,a[e.id]?"Has Personal Notes":void 0].flat().filter(s=>s),collection:V.locks.map.map(s=>o&&o[s.key]&&o[s.key].includes(e.id)?s.label:"Not "+s.label),collectionSaves:T[e.id]||0,simpleBelt:e.belt.replace(/\s\d/g,""),filterBelts:e.belt.startsWith("Black")?["Black",e.belt]:[e.belt],personalNotes:a[e.id],photographers:l==null?void 0:l.names}})},[c,o]),m=r.useCallback(a=>{const l=d&&a.find(t=>t.id===d);if(l)return[l];const e=/^\/(.*)\/$/.exec(d);return e&&Y(e[1])?a.reduce((t,z)=>(O(z,"long").match(new RegExp(e[1],"i"))&&t.push(z),t),[]):d?W.go(I(d),a,{keys:Z,threshold:-23e3}).map(t=>({...t.obj,score:t.score})).filter(t=>t.score>b):a},[d,b]),U=r.useMemo(()=>i==="search"||!i?m(u):m(u).filter(a=>a.simpleBelt===i),[u,m,i]),p=r.useMemo(()=>{const a=Q({advancedFilterGroups:x(),entries:u}),l=m([...a]);return n?l.sort((e,t)=>{if(n==="popularity")return t.collectionSaves-e.collectionSaves||t.views-e.views||e.fuzzy.localeCompare(t.fuzzy);if(n==="beltAscending")return g(e.belt,t.belt);if(n==="beltDescending")return q(e.belt,t.belt);if(n==="alphaAscending")return e.fuzzy.localeCompare(t.fuzzy);if(n==="alphaDescending")return t.fuzzy.localeCompare(e.fuzzy);if(n==="recentlyUpdated")return Math.floor(f(t.lastUpdated).valueOf()/3600)-Math.floor(f(e.lastUpdated).valueOf()/3600)||g(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy);if(n==="dateAdded")return Math.floor(f(t.dateAdded).valueOf()/3600*24)-Math.floor(f(e.dateAdded).valueOf()/3600*24)||g(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}):l},[x,u,m,n]),y=r.useCallback(a=>c.find(l=>l.id===a),[c]),S=r.useMemo(()=>i==="search"||!i?p:p.filter(a=>a.simpleBelt===i),[i,p]),w=r.useCallback(a=>h==null?void 0:h.includes(a),[h]),D=r.useMemo(()=>(o==null?void 0:o.blackBeltAwardedAt)>0,[o]),H=r.useMemo(()=>({allEntries:c,mappedEntries:u,searchedBeltEntries:U,visibleEntries:p,visibleBeltEntries:S,getEntryFromId:y,expandAll:M,profile:o,blackBeltUser:D,lockbazzarAvailable:w,searchCutoff:b,setSearchCutoff:C}),[c,u,U,p,S,y,M,o,D,w,b,C]);return G.jsx(K.Provider,{value:H,children:k})}const Z=["fuzzy"],ee={lockbazzarEntryIds:J};export{ue as D};
