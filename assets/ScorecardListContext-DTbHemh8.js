import{r as s,F as k,ag as E,aI as Y,g as w,a2 as G,j as T,ak as z,d as r,ay as F,R as V}from"./index-BM4DZBjA.js";import{D as H,f as J}from"./DataContext-FyLry_eU.js";import{r as R}from"./index-BrxnQPsx.js";function N({children:v,cardActivity:i,cardBBCount:l,cardDanPoints:c,cardEligibleDan:m,cardNextDanPoints:u,cardNextDanLocks:f,cardUniqueLocks:p,cardMaxBelt:e,popularLocks:t,popularLocksBB:n}){const{filters:g}=s.useContext(k),{search:o,id:b,tab:L,name:Q,sort:j,image:X,locks:Z,...M}=g,h=s.useMemo(()=>i.map(a=>{const d=E(a.matchId),C=Y(a.matchId),P=w(a.matchId),W=P?"Belt":C?"Project":"Lock";return{...a,...d,...C,...P,id:a.id,type:W}}),[i]),O=s.useMemo(()=>h.reduce((a,d)=>(a[d.matchId]=d,a),{}),[h]),D=s.useMemo(()=>t.map(a=>({...E(a.id),...O[a.id],popularityRank:a.rank,userCount:a.saveCount})),[t,O]),y=s.useMemo(()=>n==null?void 0:n.map(a=>({...E(a.id),...O[a.id],popularityRank:a.rank,userCount:a.saveCount})),[n,O]),x=s.useMemo(()=>Object.keys(M).map(a=>{const d=M[a];return Array.isArray(d)?d.map(C=>({key:a,value:C})):{key:a,value:d}}).flat(),[M]),A=s.useMemo(()=>S(h,x,o,j),[h,x,o,j]),I=s.useMemo(()=>S(D,x.concat({key:"exceptionType",value:void 0}),o,"popular"),[D,x,o]),U=s.useMemo(()=>({allEntries:G,cardActivity:i,cardBBCount:l,cardDanPoints:c,cardEligibleDan:m,cardNextDanPoints:u,cardNextDanLocks:f,visibleEntries:A,popularEntries:I,bbPopularEntries:y,cardUniqueLocks:p,cardMaxBelt:e,getEntryFromId:E,getProjectEntryFromId:Y,getAwardEntryFromId:w}),[i,l,c,m,u,f,A,I,y,p,e]);return T.jsx(H.Provider,{value:U,children:v})}function S(v,i,l,c){const u=v.map(e=>{var t,n,g;return{...e,makes:(t=e==null?void 0:e.makeModels)==null?void 0:t.map(({make:o})=>o),fuzzy:R(((n=e==null?void 0:e.makeModels)==null?void 0:n.map(({make:o,model:b})=>[o,b]).flat().filter(o=>o).concat([e.version,e.notes,e.belt]).join(","))+" "),documentation:[e.exceptionType==="badlink"?"Bad Link":"Valid Link",e.date?"Valid Date":"No Date"],scoring:[(()=>{switch(e.exceptionType){case"nomatch":return"Unmatched";case"badlink":return"Bad Link";case"duplicate":return"Duplicate";case"upgraded":return"Upgraded"}switch(e.belt){case"White":case"Yellow":case"Orange":case"Green":return"Low Level";case"Unranked":return"Unranked"}switch(e.awardType){case"belt":case"dan":return"Belts & Dans"}return"Worth Points"})()],simpleBelt:(g=e==null?void 0:e.belt)==null?void 0:g.replace(/\s\d/g,"")}}).filter(e=>i.every(({key:t,value:n})=>Array.isArray(e[t])?e[t].includes(n):e[t]===n)),f=l?J.go(R(l),u,{keys:["fuzzy"],threshold:-25e3}).map(e=>({...e.obj,score:e.score})):u,p=(()=>{switch(c){case"popular":return(e,t)=>e.popularityRank-t.popularityRank||e.fuzzy.localeCompare(t.fuzzy);case"danPointsAscending":return(e,t)=>e.points-t.points||F(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"danPointsDescending":return(e,t)=>t.points-e.points||z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"dateAscending":return(e,t)=>r(e.date).valueOf()-r(t.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"dateDescending":return(e,t)=>r(t.date).valueOf()-r(e.date).valueOf()||z(e.simpleBelt,t.simpleBelt);case"beltAscending":return(e,t)=>F(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"beltDescending":return(e,t)=>z(e.belt,t.belt)||r(t.date).valueOf()-r(e.date).valueOf();case"alphaAscending":return(e,t)=>e.fuzzy.localeCompare(t.fuzzy)||t.points-e.points;case"alphaDescending":return(e,t)=>t.fuzzy.localeCompare(e.fuzzy)||t.points-e.points;default:return(e,t)=>r(r(t.date).format("YYYY-MM-DD")).valueOf()-r(r(e.date).format("YYYY-MM-DD")).valueOf()||z(e.belt,t.belt)||e.fuzzy.localeCompare(t.fuzzy)}})();return f.sort(p)}const K=V.createContext({});function B({children:v}){const{filters:i,addFilters:l,removeFilters:c}=s.useContext(k),m=i.id,u=s.useCallback(p=>{p?l([{key:"id",value:p}],!0):c(["id"])},[l,c]),f=s.useMemo(()=>({expanded:m,setExpanded:u}),[m,u]);return T.jsx(K.Provider,{value:f,children:v})}export{K as S,N as a,B as b};
