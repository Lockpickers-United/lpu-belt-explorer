import{r as n,A as w,D as S,K as M,j as t,J as T,B as x,I as A,a1 as Y,u as E,R as f,d as K,bC as O,N as q,h as H,T as N}from"./index-BpgV9Um0.js";import{p as G,c as J}from"./postData-BxPXQGEh.js";import{u as I}from"./useData-USrLLZfF.js";import{C as F}from"./ContentCopy-B3yv1IC-.js";import{P as Q,a as V}from"./PlatformBeltCountsTable-gDx-Jzon.js";import{C as L}from"./Cached-BL3GYrNz.js";import{L as X}from"./LoadingDisplay-Cwe-uNsH.js";import{n as Z,a as _,d as tt}from"./dataUrls-DkJe4Pqg.js";import{D as h}from"./Dialog-Dw_j-Mep.js";import{u as et}from"./usePageTitle-5bVBf1YX.js";import{E as rt}from"./ErrorMessage-C4T4j94b.js";import{L as st}from"./LoadingDisplay-rPLVZ_ie.js";import"./index-xsH4HHeE.js";import"./nivo-bar-BgFJvvrg.js";import"./nivo-axes-fk6-H9YH.js";import"./nivo-legends-tPBYmZe5.js";import"./uniq-C5hKke8S.js";import"./_baseClone-B8_SzSDx.js";import"./chartDefaults-pV7GKcxU.js";import"./BeltIcon-CADYLRXq.js";import"./TableRow-NaZQpDgk.js";import"./Box-8TIfHYrO.js";import"./CircularProgress-CK8YQlVv.js";import"./LPU-DltM2OBF.js";import"./LinearProgress-DsPW9WD3.js";function ot(){const{authLoaded:r}=n.useContext(w),{adminRole:s}=n.useContext(S),{user:o}=n.useContext(w),{getProfile:a}=n.useContext(S),i=o?o.uid:null,e=n.useCallback(async()=>{if(!i)return null;try{return await a(i)}catch(g){return console.error("Error loading profile.",g),null}},[a,i]),{data:l={},loading:d,error:u}=I({loadFn:e});return{authLoaded:r,adminRole:s,profile:l,user:o,loading:d,error:u}}function nt({text:r,title:s="Text"}){const o=n.useCallback(async()=>{await navigator.clipboard.writeText(r),M(`${s} copied to clipboard.`)},[r,s]);return r?t.jsx(T,{title:`Copy ${s}`,arrow:!0,disableFocusListener:!0,children:r?t.jsx(x,{variant:"outlined",size:"small",onClick:o,style:{color:"#ddd",borderColor:"#aaa"},startIcon:t.jsx(F,{}),children:"Copy"}):t.jsx(A,{onClick:o,children:t.jsx(F,{})})}):null}function it({handleClick:r,title:s="Refresh",iconOnly:o=!1}){return t.jsx(T,{title:"Refresh",arrow:!0,disableFocusListener:!0,children:o?t.jsx(A,{onClick:r,children:t.jsx(L,{})}):t.jsx(x,{variant:"outlined",size:"small",onClick:r,style:{color:"#ddd",borderColor:"#aaa"},startIcon:t.jsx(L,{}),children:s})})}const at=({data:r,refresh:s})=>{var C,b,B,v,k,R;const{user:o}=ot(),[a,i]=n.useState(!1),[e,l]=n.useState(void 0),[d,u]=n.useState(void 0),{discordBeltCounts:j,redditBeltCounts:g}=r,P=Y.reduce((m,p)=>{const c=`${p} Belt`;return m+`${c}	${j[c]}	${g[c]}
`},`Belt	Discord	Reddit
`),$=async()=>{const m=new FormData;m.append("time",K().format("YYYY-MM-DD HH:mm:ss")),i(!0);try{const p=`${Z}/fetch-reddit-flairs`,c=!0,W=6e4;try{u(await G({user:o,url:p,formData:m,snackBars:c,timeoutDuration:W}))}catch(D){console.error("Error fetching reddit belts:",D),l(J(D))}}catch{console.error("Error fetching reddit belts:",e)}finally{i(!1)}},y=n.useCallback(async()=>{u(void 0),i(!1),l(void 0),await s()},[s]),{flexStyle:z}=E(),U={margin:"46px 0px 26px 0px",width:"100%",backgroundColor:"#000",textAlign:"center"};return t.jsxs(f.Fragment,{children:[t.jsxs("div",{style:{maxWidth:700,padding:20,marginLeft:"auto",marginRight:"auto",marginTop:16,marginBottom:46,justifyItems:"center",backgroundColor:"#000",textAlign:"center"},children:[t.jsx("div",{style:{fontSize:"1.5rem",...U},children:"Discord & Reddit Belt Distribution"}),t.jsxs("div",{style:{display:z,marginTop:0,justifyItems:"center",backgroundColor:"#000"},children:[t.jsx(Q,{data:r}),t.jsx(V,{data:r})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",marginTop:40,justifyContent:"center"},children:[t.jsx(it,{handleClick:$}),t.jsx("div",{style:{width:16}}),t.jsx(nt,{text:P,title:"Reddit Counts"})]})]}),t.jsx(h,{open:a,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{width:320,textAlign:"center",padding:30},children:t.jsx(X,{message:"Fetching Reddit Belts, may take a while."})})}),t.jsx(h,{open:!!d&&!e,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsx("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:60,textAlign:"center"},children:"Reddit Belts Updated!"}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(x,{onClick:y,variant:"contained",color:"info",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})}),t.jsx(h,{open:!!e,componentsProps:{backdrop:{style:{backgroundColor:"#000",opacity:.7}}},children:t.jsx("div",{style:{display:"flex"},children:t.jsxs("div",{style:{backgroundColor:"#444",marginLeft:"auto",marginRight:"auto",padding:40},children:[t.jsxs("div",{style:{fontSize:"1.7rem",fontWeight:500,marginBottom:20,textAlign:"center"},children:["Something went wrong.",t.jsx("br",{}),"Please try again later.",t.jsx("br",{})]}),t.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:400,marginBottom:20,textAlign:"center"},children:["Error message: ",((b=(C=e==null?void 0:e.response)==null?void 0:C.data)==null?void 0:b.message)||(e==null?void 0:e.message),((v=(B=e==null?void 0:e.response)==null?void 0:B.data)==null?void 0:v.status)&&t.jsxs("span",{children:[" (",(R=(k=e==null?void 0:e.response)==null?void 0:k.data)==null?void 0:R.status,")"]})]}),t.jsx("div",{style:{width:"100%",textAlign:"center"},children:t.jsx(x,{onClick:y,variant:"contained",color:"error",style:{marginLeft:"auto",marginRight:"auto"},children:"OK"})})]})})})]})};function Pt(){const{data:r,loading:s,error:o,errorMessage:a,refresh:i}=I({urls:lt}),{profile:e,user:l}=O();et("Fetch Reddit Belt Data");const d=t.jsx(f.Fragment,{});return t.jsxs(f.Fragment,{children:[t.jsx(q,{title:"Belt Distribution Data",extras:d}),o&&t.jsx(rt,{errorMessage:a}),s&&t.jsx(st,{}),!s&&!o&&!!r&&t.jsx(at,{data:r,profile:e,user:l,refresh:i}),t.jsx(H,{}),t.jsx(N,{feature:"redditBelts"})]})}const lt={discordBeltCounts:tt,redditBeltCounts:_};export{Pt as default};
